(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var THREE=require("three");var Pointerlocker=require("./pointerlocker");var PI_2=Math.PI/2;module.exports=function(camera,options){if(!options)options={};camera.rotation.set(0,0,0);var pitchObject=new THREE.Object3D;pitchObject.add(camera);var yawObject=new THREE.Object3D;yawObject.add(pitchObject);this.domElement=options.domElement||document;if(this.domElement.setAttribute){this.domElement.setAttribute("tabindex",-1)}this.movementSpeed=options.movementSpeed||9;this.rollSpeed=options.rollSpeed||.5;this.movementSpeedMultiplier=1;this.jumpEnabled=options.jumpEnabled!==undefined?options.jumpEnabled:true;this.canJump=true;this.jumpVelocityBoost=options.jumpVelocityBoost||100;this.jumpVelocity=0;this.jumpGroundThreshold=options.jumpGroundThreshold||10;this.mass=options.mass||10;this.dragToLook=options.dragToLook||false;this.autoForward=options.autoForward||false;this.keysAsRotation=options.keysAsRotation||false;this.allowYMovement=options.allowYMovement||false;this.restrictedXRange=options.restrictedXRange||null;this.restrictedZRange=options.restrictedZRange||null;this.enabled=false;this.locker=new Pointerlocker;this.getObject=function(){return yawObject};this.pitchObject=function(){return pitchObject};this.setEnabled=function(enabled){this.enabled=enabled};this.requestPointerlock=function(){this.locker.requestPointerlock()};this.exitPointerlock=function(){this.locker.exitPointerlock()};this.reset=function(){[yawObject,pitchObject,camera].forEach(function(obj){obj.position.set(0,0,0);obj.rotation.set(0,0,0)})};this.prevTime=window.performance?window.performance.now():new Date;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.keydown=function(event){if(event.altKey){return}switch(event.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:{if(this.keysAsRotation){this.moveState.pitchUp=1}else{this.moveState.forward=1}}break;case 40:{if(this.keysAsRotation){this.moveState.pitchDown=1}else{this.moveState.back=1}}break;case 37:{if(this.keysAsRotation){this.moveState.yawLeft=1}else{this.moveState.left=1}}break;case 39:{if(this.keysAsRotation){this.moveState.yawRight=1}else{this.moveState.right=1}}break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1;break;case 32:{if(this.jumpEnabled&&this.canJump){this.jumpVelocity+=this.jumpVelocityBoost;this.canJump=false}}break}this.updateMovementVector();this.updateRotationVector()};this.keyup=function(event){switch(event.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:{this.moveState.forward=0;this.moveState.pitchUp=0}break;case 40:{this.moveState.back=0;this.moveState.pitchDown=0}break;case 37:{this.moveState.left=0;this.moveState.yawLeft=0}break;case 39:{this.moveState.right=0;this.moveState.yawRight=0}break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0;break;case 90:{this.reset()}break}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(event){if(!this.enabled)return;if(this.locker.canEverHavePointerLock()&&!this.locker.currentlyHasPointerlock)return;if(this.domElement!==document){this.domElement.focus()}event.preventDefault();event.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(event.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}};this.mousemove=function(event){if(!this.enabled)return;if(this.locker.canEverHavePointerLock()&&!this.locker.currentlyHasPointerlock)return;if(!this.dragToLook||this.mouseStatus>0){var movementX=event.movementX||event.mozMovementX||event.webkitMovementX;var movementY=event.movementY||event.mozMovementY||event.webkitMovementY;if(movementX===undefined||movementY===undefined){if(this.lastClientX!==undefined){movementX=event.clientX-this.lastClientX;movementY=event.clientY-this.lastClientY}else{movementX=0;movementY=0}this.lastClientX=event.clientX;this.lastClientY=event.clientY}yawObject.rotation.y-=movementX*.002;pitchObject.rotation.x-=movementY*.002;pitchObject.rotation.x=Math.max(-PI_2,Math.min(PI_2,pitchObject.rotation.x))}};this.mouseup=function(event){if(!this.enabled)return;if(this.locker.canEverHavePointerLock()&&!this.locker.currentlyHasPointerlock)return;event.preventDefault();event.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(event.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()};this.update=function(){var time=window.performance?window.performance.now():new Date;var delta=(time-this.prevTime)/1e3;if(this.enabled){var moveMult=delta*this.movementSpeed*this.movementSpeedMultiplier;var rotMult=delta*this.rollSpeed;yawObject.translateX(this.moveVector.x*moveMult);if(this.restrictedXRange){yawObject.position.x=clamp(yawObject.position.x,this.restrictedXRange.min,this.restrictedXRange.max)}yawObject.translateZ(this.moveVector.z*moveMult);if(this.restrictedZRange){yawObject.position.z=clamp(yawObject.position.z,this.restrictedZRange.min,this.restrictedZRange.max)}if(this.allowYMovement){yawObject.translateY(this.moveVector.y*moveMult)}else if(this.jumpEnabled){this.jumpVelocity-=9.8*this.mass*delta;var jdy=this.jumpVelocity*delta;yawObject.translateY(jdy);if(yawObject.position.y<this.jumpGroundThreshold){this.jumpVelocity=0;yawObject.position.y=this.jumpGroundThreshold;this.canJump=true}}if(this.keysAsRotation){yawObject.rotateX(this.rotationVector.x*rotMult);yawObject.rotateY(this.rotationVector.y*rotMult);yawObject.rotateZ(this.rotationVector.z*rotMult)}}this.mostRecentDelta=delta;this.prevTime=time};this.updateMovementVector=function(){var forward=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-forward+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){if(this.domElement!==document){return{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}}else{return{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}};function bind(scope,fn){return function(){fn.apply(scope,arguments)}}function clamp(num,min,max){return Math.min(Math.max(num,min),max)}this.domElement.addEventListener("contextmenu",function(event){event.preventDefault()},false);this.domElement.addEventListener("mousemove",bind(this,this.mousemove),false);this.domElement.addEventListener("mousedown",bind(this,this.mousedown),false);this.domElement.addEventListener("mouseup",bind(this,this.mouseup),false);window.addEventListener("keydown",bind(this,this.keydown),false);window.addEventListener("keyup",bind(this,this.keyup),false);this.updateMovementVector();this.updateRotationVector()}},{"./pointerlocker":2,three:106}],2:[function(require,module,exports){"use strict";module.exports=function(){var scope=this;var havePointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;var pointerlockElement=document.body;this.canRequestPointerlock=false;this.currentlyHasPointerlock=false;addPointerlockListeners();this.requestPointerlock=function(){scope.canRequestPointerlock=true;pointerlockElement.requestPointerLock=pointerlockElement.requestPointerLock||pointerlockElement.mozRequestPointerLock||pointerlockElement.webkitRequestPointerLock;if(pointerlockElement.requestPointerLock){pointerlockElement.requestPointerLock()}};this.exitPointerlock=function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;if(document.exitPointerLock){document.exitPointerLock()}scope.canRequestPointerlock=false};this.canEverHavePointerLock=function(){return havePointerLock};function pointerlockchange(){if(document.pointerLockElement===pointerlockElement||document.mozPointerLockElement===pointerlockElement||document.webkitPointerLockElement===pointerlockElement){scope.currentlyHasPointerlock=true}else{scope.currentlyHasPointerlock=false}if(scope.pointerLockChangeCallback){scope.pointerLockChangeCallback(scope.currentlyHasPointerlock)}}function pointerlockerror(event){console.log("POINTER LOCK ERROR:");console.log(event)}function addPointerlockListeners(){if(havePointerLock){document.addEventListener("pointerlockchange",function(){pointerlockchange()},false);document.addEventListener("mozpointerlockchange",function(){pointerlockchange()},false);document.addEventListener("webkitpointerlockchange",function(){pointerlockchange()},false);document.addEventListener("pointerlockerror",function(ev){pointerlockerror(ev)},false);document.addEventListener("mozpointerlockerror",function(ev){pointerlockerror(ev)},false);document.addEventListener("webkitpointerlockerror",function(ev){pointerlockerror(ev)},false)}}}},{}],3:[function(require,module,exports){"use strict";(function(context,factory){"use strict";if(typeof module!=="undefined"&&module.exports){module.exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{context.buzz=factory()}})(undefined,function(){"use strict";var AudioContext=window.AudioContext||window.webkitAudioContext;var buzz={defaults:{autoplay:false,duration:5e3,formats:[],loop:false,placeholder:"--",preload:"metadata",volume:80,webAudioApi:false,document:window.document},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),getAudioContext:function getAudioContext(){if(this.audioCtx===undefined){try{this.audioCtx=AudioContext?new AudioContext:null}catch(e){this.audioCtx=null}}return this.audioCtx},sound:function sound(src,options){options=options||{};var doc=options.document||buzz.defaults.document;var pid=0,events=[],eventsOnce={},supported=buzz.isSupported();this.load=function(){if(!supported){return this}this.sound.load();return this};this.play=function(){if(!supported){return this}this.sound.play();return this};this.togglePlay=function(){if(!supported){return this}if(this.sound.paused){this.sound.play()}else{this.sound.pause()}return this};this.pause=function(){if(!supported){return this}this.sound.pause();return this};this.isPaused=function(){if(!supported){return null}return this.sound.paused};this.stop=function(){if(!supported){return this}this.setTime(0);this.sound.pause();return this};this.isEnded=function(){if(!supported){return null}return this.sound.ended};this.loop=function(){if(!supported){return this}this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!supported){return this}this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!supported){return this}this.sound.muted=true;return this};this.unmute=function(){if(!supported){return this}this.sound.muted=false;return this};this.toggleMute=function(){if(!supported){return this}this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){if(!supported){return null}return this.sound.muted};this.setVolume=function(volume){if(!supported){return this}if(volume<0){volume=0}if(volume>100){volume=100}this.volume=volume;this.sound.volume=volume/100;return this};this.getVolume=function(){if(!supported){return this}return this.volume};this.increaseVolume=function(value){return this.setVolume(this.volume+(value||1))};this.decreaseVolume=function(value){return this.setVolume(this.volume-(value||1))};this.setTime=function(time){if(!supported){return this}var set=true;this.whenReady(function(){if(set===true){set=false;this.sound.currentTime=time}});return this};this.getTime=function(){if(!supported){return null}var time=Math.round(this.sound.currentTime*100)/100;return isNaN(time)?buzz.defaults.placeholder:time};this.setPercent=function(percent){if(!supported){return this}return this.setTime(buzz.fromPercent(percent,this.sound.duration))};this.getPercent=function(){if(!supported){return null}var percent=Math.round(buzz.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(percent)?buzz.defaults.placeholder:percent};this.setSpeed=function(duration){if(!supported){return this}this.sound.playbackRate=duration;return this};this.getSpeed=function(){if(!supported){return null}return this.sound.playbackRate};this.getDuration=function(){if(!supported){return null}var duration=Math.round(this.sound.duration*100)/100;return isNaN(duration)?buzz.defaults.placeholder:duration};this.getPlayed=function(){if(!supported){return null}return timerangeToArray(this.sound.played)};this.getBuffered=function(){if(!supported){return null}return timerangeToArray(this.sound.buffered)};this.getSeekable=function(){if(!supported){return null}return timerangeToArray(this.sound.seekable)};this.getErrorCode=function(){if(supported&&this.sound.error){return this.sound.error.code}return 0};this.getErrorMessage=function(){if(!supported){return null}switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){if(!supported){return null}return this.sound.readyState};this.getStateMessage=function(){if(!supported){return null}switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){if(!supported){return null}return this.sound.networkState};this.getNetworkStateMessage=function(){if(!supported){return null}switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(key,value){if(!supported){return this}this.sound[key]=value;return this};this.get=function(key){if(!supported){return null}return key?this.sound[key]:this.sound};this.bind=function(types,func){if(!supported){return this}types=types.split(" ");var self=this,efunc=function efunc(e){func.call(self,e)};for(var t=0;t<types.length;t++){var type=types[t],idx=type;type=idx.split(".")[0];events.push({idx:idx,func:efunc});this.sound.addEventListener(type,efunc,true)}return this};this.unbind=function(types){if(!supported){return this}types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t],type=idx.split(".")[0];for(var i=0;i<events.length;i++){var namespace=events[i].idx.split(".");if(events[i].idx===idx||namespace[1]&&namespace[1]===idx.replace(".","")){this.sound.removeEventListener(type,events[i].func,true);events.splice(i,1)}}}return this};this.bindOnce=function(type,func){if(!supported){return this}var self=this;eventsOnce[pid++]=false;this.bind(type+"."+pid,function(){if(!eventsOnce[pid]){eventsOnce[pid]=true;func.call(self)}self.unbind(type+"."+pid)});return this};this.trigger=function(types,detail){if(!supported){return this}types=types.split(" ");for(var t=0;t<types.length;t++){var idx=types[t];for(var i=0;i<events.length;i++){var eventType=events[i].idx.split(".");if(events[i].idx===idx||eventType[0]&&eventType[0]===idx.replace(".","")){var evt=doc.createEvent("HTMLEvents");evt.initEvent(eventType[0],false,true);evt.originalEvent=detail;this.sound.dispatchEvent(evt)}}}return this};this.fadeTo=function(to,duration,callback){if(!supported){return this}if(duration instanceof Function){callback=duration;duration=buzz.defaults.duration}else{duration=duration||buzz.defaults.duration}var from=this.volume,delay=duration/Math.abs(from-to),self=this;this.play();function doFade(){setTimeout(function(){if(from<to&&self.volume<to){self.setVolume(self.volume+=1);doFade()}else if(from>to&&self.volume>to){self.setVolume(self.volume-=1);doFade()}else if(callback instanceof Function){callback.apply(self)}},delay)}this.whenReady(function(){doFade()});return this};this.fadeIn=function(duration,callback){if(!supported){return this}return this.setVolume(0).fadeTo(100,duration,callback)};this.fadeOut=function(duration,callback){if(!supported){return this}return this.fadeTo(0,duration,callback)};this.fadeWith=function(sound,duration){if(!supported){return this}this.fadeOut(duration,function(){this.stop()});sound.play().fadeIn(duration);return this};this.whenReady=function(func){if(!supported){return null}var self=this;if(this.sound.readyState===0){this.bind("canplay.buzzwhenready",function(){func.call(self)})}else{func.call(self)}};this.addSource=function(src){var self=this,source=doc.createElement("source");source.src=src;if(buzz.types[getExt(src)]){source.type=buzz.types[getExt(src)]}this.sound.appendChild(source);source.addEventListener("error",function(e){self.trigger("sourceerror",e)});return source};function timerangeToArray(timeRange){var array=[],length=timeRange.length-1;for(var i=0;i<=length;i++){array.push({start:timeRange.start(i),end:timeRange.end(i)})}return array}function getExt(filename){return filename.split(".").pop()}if(supported&&src){for(var i in buzz.defaults){if(buzz.defaults.hasOwnProperty(i)){if(options[i]===undefined){options[i]=buzz.defaults[i]}}}this.sound=doc.createElement("audio");if(options.webAudioApi){var audioCtx=buzz.getAudioContext();if(audioCtx){this.source=audioCtx.createMediaElementSource(this.sound);this.source.connect(audioCtx.destination)}}if(src instanceof Array){for(var j in src){if(src.hasOwnProperty(j)){this.addSource(src[j])}}}else if(options.formats.length){for(var k in options.formats){if(options.formats.hasOwnProperty(k)){this.addSource(src+"."+options.formats[k])}}}else{this.addSource(src)}if(options.loop){this.loop()}if(options.autoplay){this.sound.autoplay="autoplay"}if(options.preload===true){this.sound.preload="auto"}else if(options.preload===false){this.sound.preload="none"}else{this.sound.preload=options.preload}this.setVolume(options.volume);buzz.sounds.push(this)}},group:function group(sounds){sounds=argsToArray(sounds,arguments);this.getSounds=function(){return sounds};this.add=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++){sounds.push(soundArray[a])}};this.remove=function(soundArray){soundArray=argsToArray(soundArray,arguments);for(var a=0;a<soundArray.length;a++){for(var i=0;i<sounds.length;i++){if(sounds[i]===soundArray[a]){sounds.splice(i,1);break}}}};this.load=function(){fn("load");return this};this.play=function(){fn("play");return this};this.togglePlay=function(){fn("togglePlay");return this};this.pause=function(time){fn("pause",time);return this};this.stop=function(){fn("stop");return this};this.mute=function(){fn("mute");return this};this.unmute=function(){fn("unmute");return this};this.toggleMute=function(){fn("toggleMute");return this};this.setVolume=function(volume){fn("setVolume",volume);return this};this.increaseVolume=function(value){fn("increaseVolume",value);return this};this.decreaseVolume=function(value){fn("decreaseVolume",value);return this};this.loop=function(){fn("loop");return this};this.unloop=function(){fn("unloop");return this};this.setSpeed=function(speed){fn("setSpeed",speed);return this};this.setTime=function(time){fn("setTime",time);return this};this.set=function(key,value){fn("set",key,value);return this};this.bind=function(type,func){fn("bind",type,func);return this};this.unbind=function(type){fn("unbind",type);return this};this.bindOnce=function(type,func){fn("bindOnce",type,func);return this};this.trigger=function(type){fn("trigger",type);return this};this.fade=function(from,to,duration,callback){fn("fade",from,to,duration,callback);return this};this.fadeIn=function(duration,callback){fn("fadeIn",duration,callback);return this};this.fadeOut=function(duration,callback){fn("fadeOut",duration,callback);return this};function fn(){var args=argsToArray(null,arguments),func=args.shift();for(var i=0;i<sounds.length;i++){sounds[i][func].apply(sounds[i],args)}}function argsToArray(array,args){return array instanceof Array?array:Array.prototype.slice.call(args)}},all:function all(){return new buzz.group(buzz.sounds)},isSupported:function isSupported(){return!!buzz.el.canPlayType},isOGGSupported:function isOGGSupported(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function isWAVSupported(){return!!buzz.el.canPlayType&&buzz.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function isMP3Supported(){return!!buzz.el.canPlayType&&buzz.el.canPlayType("audio/mpeg;")},isAACSupported:function isAACSupported(){return!!buzz.el.canPlayType&&(buzz.el.canPlayType("audio/x-m4a;")||buzz.el.canPlayType("audio/aac;"))},toTimer:function toTimer(time,withHours){var h,m,s;h=Math.floor(time/3600);h=isNaN(h)?"--":h>=10?h:"0"+h;m=withHours?Math.floor(time/60%60):Math.floor(time/60);m=isNaN(m)?"--":m>=10?m:"0"+m;s=Math.floor(time%60);s=isNaN(s)?"--":s>=10?s:"0"+s;return withHours?h+":"+m+":"+s:m+":"+s},fromTimer:function fromTimer(time){var splits=time.toString().split(":");if(splits&&splits.length===3){time=parseInt(splits[0],10)*3600+parseInt(splits[1],10)*60+parseInt(splits[2],10)}if(splits&&splits.length===2){time=parseInt(splits[0],10)*60+parseInt(splits[1],10)}return time},toPercent:function toPercent(value,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(value*100/total*r)/r},fromPercent:function fromPercent(percent,total,decimal){var r=Math.pow(10,decimal||0);return Math.round(total/100*percent*r)/r}};return buzz})},{}],4:[function(require,module,exports){"use strict";var THREE=require("three");module.exports=function(){"use strict";var SUPPORT_TRANSFERABLE,_is_simulating=false,_Physijs=Physijs,Physijs={},Eventable,getObjectId,getEulerXYZFromQuaternion,getQuatertionFromEuler,convertWorldPositionToObject,addObjectChildren,_temp1,_temp2,_temp_vector3_1=new THREE.Vector3,_temp_vector3_2=new THREE.Vector3,_temp_matrix4_1=new THREE.Matrix4,_quaternion_1=new THREE.Quaternion,MESSAGE_TYPES={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3},REPORT_ITEMSIZE=14,COLLISIONREPORT_ITEMSIZE=5,VEHICLEREPORT_ITEMSIZE=9,CONSTRAINTREPORT_ITEMSIZE=6;Physijs.scripts={};Eventable=function(){this._eventListeners={}};Eventable.prototype.addEventListener=function(event_name,callback){if(!this._eventListeners.hasOwnProperty(event_name)){this._eventListeners[event_name]=[]}this._eventListeners[event_name].push(callback)};Eventable.prototype.removeEventListener=function(event_name,callback){var index;if(!this._eventListeners.hasOwnProperty(event_name))return false;if((index=this._eventListeners[event_name].indexOf(callback))>=0){this._eventListeners[event_name].splice(index,1);return true}return false};Eventable.prototype.dispatchEvent=function(event_name){var i,parameters=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(event_name)){for(i=0;i<this._eventListeners[event_name].length;i++){this._eventListeners[event_name][i].apply(this,parameters)}}};Eventable.make=function(obj){obj.prototype.addEventListener=Eventable.prototype.addEventListener;obj.prototype.removeEventListener=Eventable.prototype.removeEventListener;obj.prototype.dispatchEvent=Eventable.prototype.dispatchEvent};getObjectId=function(){var _id=1;return function(){return _id++}}();getEulerXYZFromQuaternion=function(x,y,z,w){return new THREE.Vector3(Math.atan2(2*(x*w-y*z),w*w-x*x-y*y+z*z),Math.asin(2*(x*z+y*w)),Math.atan2(2*(z*w-x*y),w*w+x*x-y*y-z*z))};getQuatertionFromEuler=function(x,y,z){var c1,s1,c2,s2,c3,s3,c1c2,s1s2;c1=Math.cos(y);s1=Math.sin(y);c2=Math.cos(-z);s2=Math.sin(-z);c3=Math.cos(x);s3=Math.sin(x);c1c2=c1*c2;s1s2=s1*s2;return{w:c1c2*c3-s1s2*s3,x:c1c2*s3+s1s2*c3,y:s1*c2*c3+c1*s2*s3,z:c1*s2*c3-s1*c2*s3}};convertWorldPositionToObject=function(position,object){_temp_matrix4_1.identity();_temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);_temp_matrix4_1.getInverse(_temp_matrix4_1);_temp_vector3_1.copy(position);_temp_vector3_2.copy(object.position);return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1)};Physijs.noConflict=function(){window.Physijs=_Physijs;return Physijs};Physijs.createMaterial=function(material,friction,restitution){var physijs_material=function physijs_material(){};physijs_material.prototype=material;physijs_material=new physijs_material;physijs_material._physijs={id:material.id,friction:friction===undefined?.8:friction,restitution:restitution===undefined?.2:restitution};return physijs_material};Physijs.PointConstraint=function(objecta,objectb,position){if(position===undefined){position=objectb;objectb=undefined}this.type="point";this.appliedImpulse=0;this.id=getObjectId();this.objecta=objecta._physijs.id;this.positiona=convertWorldPositionToObject(position,objecta).clone();if(objectb){this.objectb=objectb._physijs.id;this.positionb=convertWorldPositionToObject(position,objectb).clone()}};Physijs.PointConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}};Physijs.HingeConstraint=function(objecta,objectb,position,axis){if(axis===undefined){axis=position;position=objectb;objectb=undefined}this.type="hinge";this.appliedImpulse=0;this.id=getObjectId();this.scene=objecta.parent;this.objecta=objecta._physijs.id;this.positiona=convertWorldPositionToObject(position,objecta).clone();this.position=position.clone();this.axis=axis;if(objectb){this.objectb=objectb._physijs.id;this.positionb=convertWorldPositionToObject(position,objectb).clone()}};Physijs.HingeConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}};Physijs.HingeConstraint.prototype.setLimits=function(low,high,bias_factor,relaxation_factor){this.scene.execute("hinge_setLimits",{constraint:this.id,low:low,high:high,bias_factor:bias_factor,relaxation_factor:relaxation_factor})};Physijs.HingeConstraint.prototype.enableAngularMotor=function(velocity,acceleration){this.scene.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:velocity,acceleration:acceleration})};Physijs.HingeConstraint.prototype.disableMotor=function(velocity,acceleration){this.scene.execute("hinge_disableMotor",{constraint:this.id})};Physijs.SliderConstraint=function(objecta,objectb,position,axis){if(axis===undefined){axis=position;position=objectb;objectb=undefined}this.type="slider";this.appliedImpulse=0;this.id=getObjectId();this.scene=objecta.parent;this.objecta=objecta._physijs.id;this.positiona=convertWorldPositionToObject(position,objecta).clone();this.axis=axis;if(objectb){this.objectb=objectb._physijs.id;this.positionb=convertWorldPositionToObject(position,objectb).clone()}};Physijs.SliderConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}};Physijs.SliderConstraint.prototype.setLimits=function(lin_lower,lin_upper,ang_lower,ang_upper){this.scene.execute("slider_setLimits",{constraint:this.id,lin_lower:lin_lower,lin_upper:lin_upper,ang_lower:ang_lower,ang_upper:ang_upper})};Physijs.SliderConstraint.prototype.setRestitution=function(linear,angular){this.scene.execute("slider_setRestitution",{constraint:this.id,linear:linear,angular:angular})};Physijs.SliderConstraint.prototype.enableLinearMotor=function(velocity,acceleration){this.scene.execute("slider_enableLinearMotor",{constraint:this.id,velocity:velocity,acceleration:acceleration})};Physijs.SliderConstraint.prototype.disableLinearMotor=function(){this.scene.execute("slider_disableLinearMotor",{constraint:this.id})};Physijs.SliderConstraint.prototype.enableAngularMotor=function(velocity,acceleration){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:velocity,acceleration:acceleration})};Physijs.SliderConstraint.prototype.disableAngularMotor=function(){this.scene.execute("slider_disableAngularMotor",{constraint:this.id})};Physijs.ConeTwistConstraint=function(objecta,objectb,position){if(position===undefined){throw"Both objects must be defined in a ConeTwistConstraint."}this.type="conetwist";this.appliedImpulse=0;this.id=getObjectId();this.scene=objecta.parent;this.objecta=objecta._physijs.id;this.positiona=convertWorldPositionToObject(position,objecta).clone();this.objectb=objectb._physijs.id;this.positionb=convertWorldPositionToObject(position,objectb).clone();this.axisa={x:objecta.rotation.x,y:objecta.rotation.y,z:objecta.rotation.z};this.axisb={x:objectb.rotation.x,y:objectb.rotation.y,z:objectb.rotation.z}};Physijs.ConeTwistConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}};Physijs.ConeTwistConstraint.prototype.setLimit=function(x,y,z){this.scene.execute("conetwist_setLimit",{constraint:this.id,x:x,y:y,z:z})};Physijs.ConeTwistConstraint.prototype.enableMotor=function(){this.scene.execute("conetwist_enableMotor",{constraint:this.id})};Physijs.ConeTwistConstraint.prototype.setMaxMotorImpulse=function(max_impulse){this.scene.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:max_impulse})};Physijs.ConeTwistConstraint.prototype.setMotorTarget=function(target){if(target instanceof THREE.Vector3){target=(new THREE.Quaternion).setFromEuler(new THREE.Euler(target.x,target.y,target.z))}else if(target instanceof THREE.Euler){target=(new THREE.Quaternion).setFromEuler(target)}else if(target instanceof THREE.Matrix4){target=(new THREE.Quaternion).setFromRotationMatrix(target)}this.scene.execute("conetwist_setMotorTarget",{constraint:this.id,x:target.x,y:target.y,z:target.z,w:target.w})};Physijs.ConeTwistConstraint.prototype.disableMotor=function(){this.scene.execute("conetwist_disableMotor",{constraint:this.id})};Physijs.DOFConstraint=function(objecta,objectb,position){if(position===undefined){position=objectb;objectb=undefined}this.type="dof";this.appliedImpulse=0;this.id=getObjectId();this.scene=objecta.parent;this.objecta=objecta._physijs.id;this.positiona=convertWorldPositionToObject(position,objecta).clone();this.axisa={x:objecta.rotation.x,y:objecta.rotation.y,z:objecta.rotation.z};if(objectb){this.objectb=objectb._physijs.id;this.positionb=convertWorldPositionToObject(position,objectb).clone();this.axisb={x:objectb.rotation.x,y:objectb.rotation.y,z:objectb.rotation.z}}};Physijs.DOFConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}};Physijs.DOFConstraint.prototype.setLinearLowerLimit=function(limit){this.scene.execute("dof_setLinearLowerLimit",{constraint:this.id,x:limit.x,y:limit.y,z:limit.z})};Physijs.DOFConstraint.prototype.setLinearUpperLimit=function(limit){this.scene.execute("dof_setLinearUpperLimit",{constraint:this.id,x:limit.x,y:limit.y,z:limit.z})};Physijs.DOFConstraint.prototype.setAngularLowerLimit=function(limit){this.scene.execute("dof_setAngularLowerLimit",{constraint:this.id,x:limit.x,y:limit.y,z:limit.z})};Physijs.DOFConstraint.prototype.setAngularUpperLimit=function(limit){this.scene.execute("dof_setAngularUpperLimit",{constraint:this.id,x:limit.x,y:limit.y,z:limit.z})};Physijs.DOFConstraint.prototype.enableAngularMotor=function(which){this.scene.execute("dof_enableAngularMotor",{constraint:this.id,which:which})};Physijs.DOFConstraint.prototype.configureAngularMotor=function(which,low_angle,high_angle,velocity,max_force){this.scene.execute("dof_configureAngularMotor",{constraint:this.id,which:which,low_angle:low_angle,high_angle:high_angle,velocity:velocity,max_force:max_force})};Physijs.DOFConstraint.prototype.disableAngularMotor=function(which){this.scene.execute("dof_disableAngularMotor",{constraint:this.id,which:which})};Physijs.Scene=function(params){var self=this;Eventable.call(this);THREE.Scene.call(this);this._worker=new Worker(Physijs.scripts.worker||"/js/lib/physijs_worker.js");this._worker.transferableMessage=this._worker.webkitPostMessage||this._worker.postMessage;this._materials_ref_counts={};this._objects={};this._vehicles={};this._constraints={};var ab=new ArrayBuffer(1);this._worker.transferableMessage(ab,[ab]);SUPPORT_TRANSFERABLE=ab.byteLength===0;this._worker.onmessage=function(event){var _temp,data=event.data;if(data instanceof ArrayBuffer&&data.byteLength!==1){data=new Float32Array(data)}if(data instanceof Float32Array){switch(data[0]){case MESSAGE_TYPES.WORLDREPORT:self._updateScene(data);break;case MESSAGE_TYPES.COLLISIONREPORT:self._updateCollisions(data);break;case MESSAGE_TYPES.VEHICLEREPORT:self._updateVehicles(data);break;case MESSAGE_TYPES.CONSTRAINTREPORT:self._updateConstraints(data);break}}else{if(data.cmd){switch(data.cmd){case"objectReady":_temp=data.params;if(self._objects[_temp]){self._objects[_temp].dispatchEvent("ready")}break;case"worldReady":self.dispatchEvent("ready");break;case"vehicle":window.test=data;break;default:console.debug("Received: "+data.cmd);console.dir(data.params);break}}else{switch(data[0]){case MESSAGE_TYPES.WORLDREPORT:self._updateScene(data);break;case MESSAGE_TYPES.COLLISIONREPORT:self._updateCollisions(data);break;case MESSAGE_TYPES.VEHICLEREPORT:self._updateVehicles(data);break;case MESSAGE_TYPES.CONSTRAINTREPORT:self._updateConstraints(data);break}}}};params=params||{};params.ammo=Physijs.scripts.ammo||"/js/lib/ammo.js";params.fixedTimeStep=params.fixedTimeStep||1/60;params.rateLimit=params.rateLimit||true;this.execute("init",params)};Physijs.Scene.prototype=new THREE.Scene;Physijs.Scene.prototype.constructor=Physijs.Scene;Eventable.make(Physijs.Scene);Physijs.Scene.prototype._updateScene=function(data){var num_objects=data[1],object,i,offset;for(i=0;i<num_objects;i++){offset=2+i*REPORT_ITEMSIZE;object=this._objects[data[offset]];if(object===undefined){continue}if(object.__dirtyPosition===false){object.position.set(data[offset+1],data[offset+2],data[offset+3])}if(object.__dirtyRotation===false){object.quaternion.set(data[offset+4],data[offset+5],data[offset+6],data[offset+7])}object._physijs.linearVelocity.set(data[offset+8],data[offset+9],data[offset+10]);object._physijs.angularVelocity.set(data[offset+11],data[offset+12],data[offset+13])}if(SUPPORT_TRANSFERABLE){this._worker.transferableMessage(data.buffer,[data.buffer])}_is_simulating=false;this.dispatchEvent("update")};Physijs.Scene.prototype._updateVehicles=function(data){var vehicle,wheel,i,offset;for(i=0;i<(data.length-1)/VEHICLEREPORT_ITEMSIZE;i++){offset=1+i*VEHICLEREPORT_ITEMSIZE;vehicle=this._vehicles[data[offset]];if(vehicle===undefined){continue}wheel=vehicle.wheels[data[offset+1]];wheel.position.set(data[offset+2],data[offset+3],data[offset+4]);wheel.quaternion.set(data[offset+5],data[offset+6],data[offset+7],data[offset+8])}if(SUPPORT_TRANSFERABLE){this._worker.transferableMessage(data.buffer,[data.buffer])}};Physijs.Scene.prototype._updateConstraints=function(data){var constraint,object,i,offset;for(i=0;i<(data.length-1)/CONSTRAINTREPORT_ITEMSIZE;i++){offset=1+i*CONSTRAINTREPORT_ITEMSIZE;constraint=this._constraints[data[offset]];object=this._objects[data[offset+1]];if(constraint===undefined||object===undefined){continue}_temp_vector3_1.set(data[offset+2],data[offset+3],data[offset+4]);_temp_matrix4_1.extractRotation(object.matrix);_temp_vector3_1.applyMatrix4(_temp_matrix4_1);constraint.positiona.addVectors(object.position,_temp_vector3_1);constraint.appliedImpulse=data[offset+5]}if(SUPPORT_TRANSFERABLE){this._worker.transferableMessage(data.buffer,[data.buffer])}};Physijs.Scene.prototype._updateCollisions=function(data){var i,j,offset,object,object2,id1,id2,collisions={},normal_offsets={};for(i=0;i<data[1];i++){offset=2+i*COLLISIONREPORT_ITEMSIZE;object=data[offset];object2=data[offset+1];normal_offsets[object+"-"+object2]=offset+2;normal_offsets[object2+"-"+object]=-1*(offset+2);if(!collisions[object])collisions[object]=[];collisions[object].push(object2);if(!collisions[object2])collisions[object2]=[];collisions[object2].push(object)}for(id1 in this._objects){if(!this._objects.hasOwnProperty(id1))continue;object=this._objects[id1];if(collisions[id1]){for(j=0;j<object._physijs.touches.length;j++){if(collisions[id1].indexOf(object._physijs.touches[j])===-1){object._physijs.touches.splice(j--,1)}}for(j=0;j<collisions[id1].length;j++){id2=collisions[id1][j];object2=this._objects[id2];if(object2){if(object._physijs.touches.indexOf(id2)===-1){object._physijs.touches.push(id2);_temp_vector3_1.subVectors(object.getLinearVelocity(),object2.getLinearVelocity());_temp1=_temp_vector3_1.clone();_temp_vector3_1.subVectors(object.getAngularVelocity(),object2.getAngularVelocity());_temp2=_temp_vector3_1.clone();var normal_offset=normal_offsets[object._physijs.id+"-"+object2._physijs.id];if(normal_offset>0){_temp_vector3_1.set(-data[normal_offset],-data[normal_offset+1],-data[normal_offset+2])}else{normal_offset*=-1;_temp_vector3_1.set(data[normal_offset],data[normal_offset+1],data[normal_offset+2])}object.dispatchEvent("collision",object2,_temp1,_temp2,_temp_vector3_1)}}}}else{object._physijs.touches.length=0}}this.collisions=collisions;if(SUPPORT_TRANSFERABLE){this._worker.transferableMessage(data.buffer,[data.buffer])}};Physijs.Scene.prototype.addConstraint=function(constraint,show_marker){this._constraints[constraint.id]=constraint;this.execute("addConstraint",constraint.getDefinition());if(show_marker){var marker;switch(constraint.type){case"point":marker=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);marker.position.copy(constraint.positiona);this._objects[constraint.objecta].add(marker);break;case"hinge":marker=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);marker.position.copy(constraint.positiona);this._objects[constraint.objecta].add(marker);break;case"slider":marker=new THREE.Mesh(new THREE.BoxGeometry(10,1,1),new THREE.MeshNormalMaterial);marker.position.copy(constraint.positiona);marker.rotation.set(constraint.axis.y,constraint.axis.x,constraint.axis.z);this._objects[constraint.objecta].add(marker);break;case"conetwist":marker=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);marker.position.copy(constraint.positiona);this._objects[constraint.objecta].add(marker);break;case"dof":marker=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial);marker.position.copy(constraint.positiona);this._objects[constraint.objecta].add(marker);break}}return constraint};Physijs.Scene.prototype.onSimulationResume=function(){this.execute("onSimulationResume",{})};Physijs.Scene.prototype.removeConstraint=function(constraint){if(this._constraints[constraint.id]!==undefined){this.execute("removeConstraint",{id:constraint.id});delete this._constraints[constraint.id]}};Physijs.Scene.prototype.execute=function(cmd,params){this._worker.postMessage({cmd:cmd,params:params})};addObjectChildren=function(parent,object){var i;for(i=0;i<object.children.length;i++){if(object.children[i]._physijs){object.children[i].updateMatrix();object.children[i].updateMatrixWorld();_temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);_quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);object.children[i]._physijs.position_offset={x:_temp_vector3_1.x,y:_temp_vector3_1.y,z:_temp_vector3_1.z};object.children[i]._physijs.rotation={x:_quaternion_1.x,y:_quaternion_1.y,z:_quaternion_1.z,w:_quaternion_1.w};parent._physijs.children.push(object.children[i]._physijs)}addObjectChildren(parent,object.children[i])}};Physijs.Scene.prototype.add=function(object){THREE.Mesh.prototype.add.call(this,object);if(object._physijs){object.world=this;if(object instanceof Physijs.Vehicle){this.add(object.mesh);this._vehicles[object._physijs.id]=object;this.execute("addVehicle",object._physijs)}else{object.__dirtyPosition=false;object.__dirtyRotation=false;this._objects[object._physijs.id]=object;if(object.children.length){object._physijs.children=[];addObjectChildren(object,object)}if(object.material._physijs){if(!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)){this.execute("registerMaterial",object.material._physijs);object._physijs.materialId=object.material._physijs.id;this._materials_ref_counts[object.material._physijs.id]=1}else{this._materials_ref_counts[object.material._physijs.id]++}}object._physijs.position={x:object.position.x,y:object.position.y,z:object.position.z};object._physijs.rotation={x:object.quaternion.x,y:object.quaternion.y,z:object.quaternion.z,w:object.quaternion.w};var mass_scaling=new THREE.Vector3(1,1,1);if(object._physijs.width){object._physijs.width*=object.scale.x}if(object._physijs.height){object._physijs.height*=object.scale.y}if(object._physijs.depth){object._physijs.depth*=object.scale.z}this.execute("addObject",object._physijs)}}};Physijs.Scene.prototype.remove=function(object){if(object instanceof Physijs.Vehicle){this.execute("removeVehicle",{id:object._physijs.id});while(object.wheels.length){this.remove(object.wheels.pop())}this.remove(object.mesh);delete this._vehicles[object._physijs.id]}else{THREE.Mesh.prototype.remove.call(this,object);if(object._physijs){delete this._objects[object._physijs.id];this.execute("removeObject",{id:object._physijs.id})}}if(object.material&&object.material._physijs&&this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)){this._materials_ref_counts[object.material._physijs.id]--;if(this._materials_ref_counts[object.material._physijs.id]==0){this.execute("unRegisterMaterial",object.material._physijs);delete this._materials_ref_counts[object.material._physijs.id]}}};Physijs.Scene.prototype.setFixedTimeStep=function(fixedTimeStep){if(fixedTimeStep){this.execute("setFixedTimeStep",fixedTimeStep)}};Physijs.Scene.prototype.setGravity=function(gravity){if(gravity){this.execute("setGravity",gravity)}};Physijs.Scene.prototype.simulate=function(timeStep,maxSubSteps){var object_id,object,update;if(_is_simulating){return false}_is_simulating=true;for(object_id in this._objects){if(!this._objects.hasOwnProperty(object_id))continue;object=this._objects[object_id];if(object.__dirtyPosition||object.__dirtyRotation){update={id:object._physijs.id};if(object.__dirtyPosition){update.pos={x:object.position.x,y:object.position.y,z:object.position.z};object.__dirtyPosition=false}if(object.__dirtyRotation){update.quat={x:object.quaternion.x,y:object.quaternion.y,z:object.quaternion.z,w:object.quaternion.w};object.__dirtyRotation=false}this.execute("updateTransform",update)}}this.execute("simulate",{timeStep:timeStep,maxSubSteps:maxSubSteps});return true};Physijs.Mesh=function(geometry,material,mass){var index;if(!geometry){return}Eventable.call(this);THREE.Mesh.call(this,geometry,material);if(!geometry.boundingBox){geometry.computeBoundingBox()}this._physijs={type:null,id:getObjectId(),mass:mass||0,touches:[],linearVelocity:new THREE.Vector3,angularVelocity:new THREE.Vector3}};Physijs.Mesh.prototype=new THREE.Mesh;Physijs.Mesh.prototype.constructor=Physijs.Mesh;Eventable.make(Physijs.Mesh);Physijs.Mesh.prototype.__defineGetter__("mass",function(){return this._physijs.mass});Physijs.Mesh.prototype.__defineSetter__("mass",function(mass){this._physijs.mass=mass;if(this.world){this.world.execute("updateMass",{id:this._physijs.id,mass:mass})}});Physijs.Mesh.prototype.applyCentralImpulse=function(force){if(this.world){this.world.execute("applyCentralImpulse",{id:this._physijs.id,x:force.x,y:force.y,z:force.z})}};Physijs.Mesh.prototype.applyImpulse=function(force,offset){if(this.world){this.world.execute("applyImpulse",{id:this._physijs.id,impulse_x:force.x,impulse_y:force.y,impulse_z:force.z,x:offset.x,y:offset.y,z:offset.z})}};Physijs.Mesh.prototype.applyCentralForce=function(force){if(this.world){this.world.execute("applyCentralForce",{id:this._physijs.id,x:force.x,y:force.y,z:force.z})}};Physijs.Mesh.prototype.applyForce=function(force,offset){if(this.world){this.world.execute("applyForce",{id:this._physijs.id,force_x:force.x,force_y:force.y,force_z:force.z,x:offset.x,y:offset.y,z:offset.z})}};Physijs.Mesh.prototype.getAngularVelocity=function(){return this._physijs.angularVelocity};Physijs.Mesh.prototype.setAngularVelocity=function(velocity){if(this.world){this.world.execute("setAngularVelocity",{id:this._physijs.id,x:velocity.x,y:velocity.y,z:velocity.z})}};Physijs.Mesh.prototype.getLinearVelocity=function(){return this._physijs.linearVelocity};Physijs.Mesh.prototype.setLinearVelocity=function(velocity){if(this.world){this.world.execute("setLinearVelocity",{id:this._physijs.id,x:velocity.x,y:velocity.y,z:velocity.z})}};Physijs.Mesh.prototype.setAngularFactor=function(factor){if(this.world){this.world.execute("setAngularFactor",{id:this._physijs.id,x:factor.x,y:factor.y,z:factor.z})}};Physijs.Mesh.prototype.setLinearFactor=function(factor){if(this.world){this.world.execute("setLinearFactor",{id:this._physijs.id,x:factor.x,y:factor.y,z:factor.z})}};Physijs.Mesh.prototype.setDamping=function(linear,angular){if(this.world){this.world.execute("setDamping",{id:this._physijs.id,linear:linear,angular:angular})}};Physijs.Mesh.prototype.setCcdMotionThreshold=function(threshold){if(this.world){this.world.execute("setCcdMotionThreshold",{id:this._physijs.id,threshold:threshold})}};Physijs.Mesh.prototype.setCcdSweptSphereRadius=function(radius){if(this.world){this.world.execute("setCcdSweptSphereRadius",{id:this._physijs.id,radius:radius})}};Physijs.PlaneMesh=function(geometry,material,mass){var width,height;Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;this._physijs.type="plane";this._physijs.normal=geometry.faces[0].normal.clone();this._physijs.mass=typeof mass==="undefined"?width*height:mass};Physijs.PlaneMesh.prototype=new Physijs.Mesh;Physijs.PlaneMesh.prototype.constructor=Physijs.PlaneMesh;Physijs.HeightfieldMesh=function(geometry,material,mass,xdiv,ydiv){Physijs.Mesh.call(this,geometry,material,mass);this._physijs.type="heightfield";this._physijs.xsize=geometry.boundingBox.max.x-geometry.boundingBox.min.x;this._physijs.ysize=geometry.boundingBox.max.y-geometry.boundingBox.min.y;this._physijs.xpts=typeof xdiv==="undefined"?Math.sqrt(geometry.vertices.length):xdiv+1;this._physijs.ypts=typeof ydiv==="undefined"?Math.sqrt(geometry.vertices.length):ydiv+1;this._physijs.absMaxHeight=Math.max(geometry.boundingBox.max.z,Math.abs(geometry.boundingBox.min.z));var points=[];var a,b;for(var i=0;i<geometry.vertices.length;i++){a=i%this._physijs.xpts;b=Math.round(i/this._physijs.xpts-i%this._physijs.xpts/this._physijs.xpts);points[i]=geometry.vertices[a+(this._physijs.ypts-b-1)*this._physijs.ypts].z}this._physijs.points=points};Physijs.HeightfieldMesh.prototype=new Physijs.Mesh;Physijs.HeightfieldMesh.prototype.constructor=Physijs.HeightfieldMesh;Physijs.BoxMesh=function(geometry,material,mass){var width,height,depth;Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;depth=geometry.boundingBox.max.z-geometry.boundingBox.min.z;this._physijs.type="box";this._physijs.width=width;this._physijs.height=height;this._physijs.depth=depth;this._physijs.mass=typeof mass==="undefined"?width*height*depth:mass};Physijs.BoxMesh.prototype=new Physijs.Mesh;Physijs.BoxMesh.prototype.constructor=Physijs.BoxMesh;Physijs.SphereMesh=function(geometry,material,mass){Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingSphere){geometry.computeBoundingSphere()}this._physijs.type="sphere";this._physijs.radius=geometry.boundingSphere.radius;this._physijs.mass=typeof mass==="undefined"?4/3*Math.PI*Math.pow(this._physijs.radius,3):mass};Physijs.SphereMesh.prototype=new Physijs.Mesh;Physijs.SphereMesh.prototype.constructor=Physijs.SphereMesh;Physijs.CylinderMesh=function(geometry,material,mass){var width,height,depth;Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;depth=geometry.boundingBox.max.z-geometry.boundingBox.min.z;this._physijs.type="cylinder";this._physijs.width=width;this._physijs.height=height;this._physijs.depth=depth;this._physijs.mass=typeof mass==="undefined"?width*height*depth:mass};Physijs.CylinderMesh.prototype=new Physijs.Mesh;Physijs.CylinderMesh.prototype.constructor=Physijs.CylinderMesh;Physijs.CapsuleMesh=function(geometry,material,mass){var width,height,depth;Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;depth=geometry.boundingBox.max.z-geometry.boundingBox.min.z;this._physijs.type="capsule";this._physijs.radius=Math.max(width/2,depth/2);this._physijs.height=height;this._physijs.mass=typeof mass==="undefined"?width*height*depth:mass};Physijs.CapsuleMesh.prototype=new Physijs.Mesh;Physijs.CapsuleMesh.prototype.constructor=Physijs.CapsuleMesh;Physijs.ConeMesh=function(geometry,material,mass){var width,height,depth;Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;this._physijs.type="cone";this._physijs.radius=width/2;this._physijs.height=height;this._physijs.mass=typeof mass==="undefined"?width*height:mass};Physijs.ConeMesh.prototype=new Physijs.Mesh;Physijs.ConeMesh.prototype.constructor=Physijs.ConeMesh;Physijs.ConcaveMesh=function(geometry,material,mass){var i,width,height,depth,vertices,face,triangles=[];Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}vertices=geometry.vertices;for(i=0;i<geometry.faces.length;i++){face=geometry.faces[i];if(face instanceof THREE.Face3){triangles.push([{x:vertices[face.a].x,y:vertices[face.a].y,z:vertices[face.a].z},{x:vertices[face.b].x,y:vertices[face.b].y,z:vertices[face.b].z},{x:vertices[face.c].x,y:vertices[face.c].y,z:vertices[face.c].z}])}else if(face instanceof THREE.Face4){triangles.push([{x:vertices[face.a].x,y:vertices[face.a].y,z:vertices[face.a].z},{x:vertices[face.b].x,y:vertices[face.b].y,z:vertices[face.b].z},{x:vertices[face.d].x,y:vertices[face.d].y,z:vertices[face.d].z}]);triangles.push([{x:vertices[face.b].x,y:vertices[face.b].y,z:vertices[face.b].z},{x:vertices[face.c].x,y:vertices[face.c].y,z:vertices[face.c].z},{x:vertices[face.d].x,y:vertices[face.d].y,z:vertices[face.d].z}])}}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;depth=geometry.boundingBox.max.z-geometry.boundingBox.min.z;this._physijs.type="concave";this._physijs.triangles=triangles;this._physijs.mass=typeof mass==="undefined"?width*height*depth:mass};Physijs.ConcaveMesh.prototype=new Physijs.Mesh;Physijs.ConcaveMesh.prototype.constructor=Physijs.ConcaveMesh;Physijs.ConvexMesh=function(geometry,material,mass){var i,width,height,depth,points=[];Physijs.Mesh.call(this,geometry,material,mass);if(!geometry.boundingBox){geometry.computeBoundingBox()}for(i=0;i<geometry.vertices.length;i++){points.push({x:geometry.vertices[i].x,y:geometry.vertices[i].y,z:geometry.vertices[i].z})}width=geometry.boundingBox.max.x-geometry.boundingBox.min.x;height=geometry.boundingBox.max.y-geometry.boundingBox.min.y;depth=geometry.boundingBox.max.z-geometry.boundingBox.min.z;this._physijs.type="convex";this._physijs.points=points;this._physijs.mass=typeof mass==="undefined"?width*height*depth:mass};Physijs.ConvexMesh.prototype=new Physijs.Mesh;Physijs.ConvexMesh.prototype.constructor=Physijs.ConvexMesh;Physijs.Vehicle=function(mesh,tuning){tuning=tuning||new Physijs.VehicleTuning;this.mesh=mesh;this.wheels=[];this._physijs={id:getObjectId(),rigidBody:mesh._physijs.id,suspension_stiffness:tuning.suspension_stiffness,suspension_compression:tuning.suspension_compression,suspension_damping:tuning.suspension_damping,max_suspension_travel:tuning.max_suspension_travel,friction_slip:tuning.friction_slip,max_suspension_force:tuning.max_suspension_force}};Physijs.Vehicle.prototype.addWheel=function(wheel_geometry,wheel_material,connection_point,wheel_direction,wheel_axle,suspension_rest_length,wheel_radius,is_front_wheel,tuning){var wheel=new THREE.Mesh(wheel_geometry,wheel_material);wheel.castShadow=wheel.receiveShadow=true;wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length/100).add(connection_point);this.world.add(wheel);this.wheels.push(wheel);this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:connection_point.x,y:connection_point.y,z:connection_point.z},wheel_direction:{x:wheel_direction.x,y:wheel_direction.y,z:wheel_direction.z},wheel_axle:{x:wheel_axle.x,y:wheel_axle.y,z:wheel_axle.z},suspension_rest_length:suspension_rest_length,wheel_radius:wheel_radius,is_front_wheel:is_front_wheel,tuning:tuning})};Physijs.Vehicle.prototype.setSteering=function(amount,wheel){if(wheel!==undefined&&this.wheels[wheel]!==undefined){this.world.execute("setSteering",{id:this._physijs.id,wheel:wheel,steering:amount})}else if(this.wheels.length>0){for(var i=0;i<this.wheels.length;i++){this.world.execute("setSteering",{id:this._physijs.id,wheel:i,steering:amount})}}};Physijs.Vehicle.prototype.setBrake=function(amount,wheel){if(wheel!==undefined&&this.wheels[wheel]!==undefined){this.world.execute("setBrake",{id:this._physijs.id,wheel:wheel,brake:amount})}else if(this.wheels.length>0){for(var i=0;i<this.wheels.length;i++){this.world.execute("setBrake",{id:this._physijs.id,wheel:i,brake:amount})}}};Physijs.Vehicle.prototype.applyEngineForce=function(amount,wheel){if(wheel!==undefined&&this.wheels[wheel]!==undefined){this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:wheel,force:amount})}else if(this.wheels.length>0){for(var i=0;i<this.wheels.length;i++){this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:i,force:amount})}}};Physijs.VehicleTuning=function(suspension_stiffness,suspension_compression,suspension_damping,max_suspension_travel,friction_slip,max_suspension_force){this.suspension_stiffness=suspension_stiffness!==undefined?suspension_stiffness:5.88;this.suspension_compression=suspension_compression!==undefined?suspension_compression:.83;this.suspension_damping=suspension_damping!==undefined?suspension_damping:.88;this.max_suspension_travel=max_suspension_travel!==undefined?max_suspension_travel:500;this.friction_slip=friction_slip!==undefined?friction_slip:10.5;this.max_suspension_force=max_suspension_force!==undefined?max_suspension_force:6e3};return Physijs}()},{three:106}],5:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=true;if(prop.value)prop.writable=true}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc&&desc.writable){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _inherits=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)subClass.__proto__=superClass};var _classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};Object.defineProperty(exports,"__esModule",{value:true});var THREE=require("three");var buzz=require("./lib/buzz");var TWEEN=require("tween.js");var io=require("socket.io-client");var kt=require("kutility");var Tone=require("tone");var nlp=require("nlp_compromise");var SheenScene=require("./sheen-scene.es6").SheenScene;var WordTracker=require("./word-tracker.es6").WordTracker;var TWEETS_PER_SECOND=4;var MainScene=exports.MainScene=function(_SheenScene){function MainScene(renderer,camera,scene,options){_classCallCheck(this,MainScene);_get(Object.getPrototypeOf(MainScene.prototype),"constructor",this).call(this,renderer,camera,scene,options);this.onPhone=options.onPhone||false;this.pushDelay=options.pushDelay||3e3;this.maxMeshCount=options.maxMeshCount||100;this.skyStyle=options.skyStyle!==undefined?options.skyStyle:{type:"sphere",number:11};this.controlHudVisible=false;this.skymeshVisible=true;this.dataVisible=true;this.useMeshImages=true;this.meshColorStyle="sentiment";this.usePercussion=true;this.useInstruments=true;this.useSynth=true;this.soundOn=true;this.tweetPaused=false;this.rotationRadius=100;this.zoomIncrement=.5;this.cameraRotationIncrement=.002;this.rotateCamera=true;this.zoomingIn=false;this.zoomingOut=false;this.rotatingLeft=false;this.rotatingRight=false;this.cameraRotationAngle=0;this.raycaster=new THREE.Raycaster;this.mouse=new THREE.Vector2;this.tweetMeshes=[];this.goodTweetCount=0;this.badTweetCount=0;this.totalSentiment=0;this.nounTracker=new WordTracker({bannedWords:["god","rt"]});this.verbTracker=new WordTracker({bannedWords:["is","rt","god"]});this.adjectiveTracker=new WordTracker;this.detailTweetTextElement=document.querySelector("#detail-tweet-text");this.tickerTweetTextElement=document.querySelector("#ticker-tweet-text");this.goodTweetCountElement=document.querySelector("#good-tweet-count");this.badTweetCountElement=document.querySelector("#bad-tweet-count");this.totalSentimentElement=document.querySelector("#total-sentiment");this.godAdjectiveElement=document.querySelector("#god-adjective");this.godVerbElement=document.querySelector("#god-verb");this.mostFrequentNounsElement=document.querySelector("#most-frequent-nouns-list");this.mostFrequentVerbsElement=document.querySelector("#most-frequent-verbs-list");this.mostFrequentAdjectivesElement=document.querySelector("#most-frequent-adjectives-list");this.setupControlHud();this.setupSkyWithStyle(this.skyStyle);this.setupSound()}_inherits(MainScene,_SheenScene);_createClass(MainScene,{doTimedWork:{value:function doTimedWork(inSimpleMode){_get(Object.getPrototypeOf(MainScene.prototype),"doTimedWork",this).call(this);this.useMeshes=!inSimpleMode;this.updateForUseMeshes();this.socket=io("185.21.216.190:6001");this.socket.on("fresh-tweet",this.handleNewTweet.bind(this))}},updateForUseMeshes:{value:function updateForUseMeshes(){if(this.useMeshes){removeClass(".tweet-ticker","nomesh");removeClass(".ticker-tweet-text","nomesh");removeClass(".stat-hud","nomesh");removeClass("#control-hud-mesh-section","hidden")}else{addClass(".tweet-ticker","nomesh");addClass(".ticker-tweet-text","nomesh");addClass(".stat-hud","nomesh");addClass("#control-hud-mesh-section","hidden")}for(var i=0;i<this.tweetMeshes.length;i++){var mesh=this.tweetMeshes[i];mesh.visible=this.useMeshes}}},setupControlHud:{value:function setupControlHud(){var _this=this;var setupToggleClickHandler=function(el,propertyName,callback){el.addEventListener("click",function(){el.classList.toggle("active");_this[propertyName]=!_this[propertyName];if(callback){callback()}},false)};var setupOptionsClickHandler=function(el,propertyName,propertyOptions,displayOptions,callback){el.addEventListener("click",function(){var currentDisplayOption=el.innerText;var currentOptionIndex=displayOptions.indexOf(currentDisplayOption);if(currentOptionIndex===-1)currentOptionIndex=0;var nextOptionIndex=currentOptionIndex<propertyOptions.length-1?currentOptionIndex+1:0;el.innerText=displayOptions[nextOptionIndex];_this[propertyName]=propertyOptions[nextOptionIndex];if(callback){callback()}},false)};setupToggleClickHandler(document.querySelector("#control-hud-toggle"),"controlHudVisible",function(){if(_this.controlHudVisible){removeClass("#control-hud-options","hidden")}else{addClass("#control-hud-options","hidden")}});setupToggleClickHandler(document.querySelector("#mesh-toggle"),"useMeshes",function(){_this.updateForUseMeshes()});setupToggleClickHandler(document.querySelector("#skybox-toggle"),"skymeshVisible",function(){_this.skymesh.visible=_this.skymeshVisible;if(_this.skymeshVisible){removeClass(".ticker-tweet-text","light-background");removeClass(".stat-hud","light-background")}else{addClass(".ticker-tweet-text","light-background");addClass(".stat-hud","light-background")}});setupToggleClickHandler(document.querySelector("#data-toggle"),"dataVisible",function(){if(_this.dataVisible){removeClass(".stat-hud","hidden");removeClass(".tweet-ticker","hidden")}else{addClass(".stat-hud","hidden");addClass(".tweet-ticker","hidden")}});setupOptionsClickHandler(document.querySelector("#mesh-color-options"),"meshColorStyle",["sentiment","random","none"],["sentiment colors","random colors","no colors"],function(){for(var i=0;i<_this.tweetMeshes.length;i++){var mesh=_this.tweetMeshes[i];mesh.material.color=_this.colorForTweetData(mesh.__tweetData)}});setupToggleClickHandler(document.querySelector("#mesh-images-toggle"),"useMeshImages");setupToggleClickHandler(document.querySelector("#sound-toggle"),"soundOn",function(){for(var key in _this.sounds){if(_this.sounds.hasOwnProperty(key)){var sound=_this.sounds[key];if(_this.soundOn){sound.unmute()}else{sound.mute()}}}});setupToggleClickHandler(document.querySelector("#instruments-toggle"),"useInstruments");setupToggleClickHandler(document.querySelector("#percussion-toggle"),"usePercussion");setupToggleClickHandler(document.querySelector("#synth-toggle"),"useSynth")}},setupSkyWithStyle:{value:function setupSkyWithStyle(style){if(style.type==="box"){var imagePrefix="media/textures/skybox"+style.number+"/";var directions=["px","nx","py","ny","pz","nz"];var imageSuffix=".jpg";var skyGeometry=new THREE.CubeGeometry(1e3,1e3,1e3);var materialArray=[];for(var i=0;i<6;i++)materialArray.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(imagePrefix+directions[i]+imageSuffix),side:THREE.BackSide}));var skyMaterial=new THREE.MeshFaceMaterial(materialArray);this.skymesh=new THREE.Mesh(skyGeometry,skyMaterial);this.scene.add(this.skymesh)}else{var skytexture=THREE.ImageUtils.loadTexture("media/textures/360sky/360sky"+style.number+".jpg",THREE.UVMapping);skytexture.minFilter=THREE.LinearFilter;this.skymesh=new THREE.Mesh(new THREE.SphereGeometry(500,60,40),new THREE.MeshBasicMaterial({map:skytexture}));this.skymesh.scale.x=-1;this.scene.add(this.skymesh)}}},setupSound:{value:function setupSound(){var _this=this;this.sounds={};this.synthVolume=-14;this.percussionVolume=15;this.holdVolume=40;this.instrumentVolume=40;this.backgroundVolume=65;this.panner=(new Tone.Panner).toMaster();this.sineSynth=new Tone.SimpleSynth({oscillator:{type:"sine"},envelope:{attack:.01,decay:.2,sustain:.4,release:.2}}).connect(this.panner);this.triSynth=new Tone.SimpleSynth({oscillator:{type:"triangle"},envelope:{attack:.01,decay:.2,sustain:.4,release:.2}}).connect(this.panner);this.panner.pan.value=.5;this.sineSynth.volume.value=this.triSynth.volume.value=this.synthVolume;var soundFilenames=["altglock1","altglock2","altglock3","altglock4","altglock5","altglock6","altglock7","altglock8","badmallet1","badmallet2","badmallet3","badmallet4","badmallet5","badmallet6","badmallet7","badmallet8","background1loud","bell1","bell2","bell3","bell4","clouds1","clouds2","clouds3","clouds4","clouds5","clouds6","clouds7","clouds8","dbass1","dbass2","dbass3","dbass4","dbass5","dbass6","dbass7","dbass8","glock1","glock2","glock3","glock4","glock5","glock6","glock7","glock8","glock9","glock10","glock11","glock12","glock13","mallet1","mallet2","mallet3","mallet4","mallet5","mallet6","mallet7","mallet8","tile1","tile2","tile3","tile4","tile5","tile6","tile7","tile8"];soundFilenames.forEach(function(filename){var sound=new buzz.sound("/media/sound/instruments/"+filename,{formats:["mp3","ogg"],webAudioApi:true,volume:_this.instrumentVolume});_this.sounds[filename]=sound});var soundFilenames3=["A","C","C2","D","E","F","G"];soundFilenames3.forEach(function(filename){var sound=new buzz.sound("/media/sound/holds/"+filename,{formats:["mp3","ogg"],webAudioApi:true,volume:_this.holdVolume});_this.sounds[filename]=sound});var soundFilenames2=[];for(var i=1;i<=31;i++){soundFilenames2.push("hh"+i)}for(var i=1;i<=19;i++){soundFilenames2.push("kick"+i)}soundFilenames2.forEach(function(filename){var sound=new buzz.sound("/media/sound/percussion/"+filename,{formats:["mp3"],webAudioApi:true,volume:_this.percussionVolume});_this.sounds[filename]=sound});this.sounds.background1loud.setVolume(this.backgroundVolume);this.sounds.background1loud.setTime(0);this.sounds.background1loud.loop().play();this.makeHoldNotes(1e4);this.makeHoldNotes(2e4)}},enter:{value:function enter(){_get(Object.getPrototypeOf(MainScene.prototype),"enter",this).call(this);this.renderer.setClearColor(15790320);var light=new THREE.SpotLight(16777215,1.5);light.position.set(0,500,2e3);light.castShadow=true;light.shadowCameraNear=200;light.shadowCameraFar=this.camera.far;light.shadowCameraFov=50;light.shadowBias=-22e-5;light.shadowMapWidth=2048;light.shadowMapHeight=2048;this.scene.add(light)}},update:{value:function update(dt){_get(Object.getPrototypeOf(MainScene.prototype),"update",this).call(this,dt);if(this.rotateCamera){this.cameraRotationAngle+=this.cameraRotationIncrement}this.camera.position.x=this.rotationRadius*Math.sin(this.cameraRotationAngle);this.camera.position.y=this.camera.position.x;this.camera.position.z=this.rotationRadius*Math.cos(this.cameraRotationAngle);this.camera.lookAt(this.scene.position);if(this.detailedTweetMesh){this.detailedTweetMesh.rotation.x+=this.detailedTweetMeshRotation.x;this.detailedTweetMesh.rotation.y+=this.detailedTweetMeshRotation.y;this.detailedTweetMesh.rotation.z+=this.detailedTweetMeshRotation.z}if(this.zoomingIn){this.zoomIn()}if(this.zoomingOut){this.zoomOut()}if(this.rotatingLeft){this.rotateLeft()}if(this.rotatingRight){this.rotateRight()}}},zoomIn:{value:function zoomIn(){if(this.rotationRadius>1){this.rotationRadius-=this.zoomIncrement}}},zoomOut:{value:function zoomOut(){if(this.rotationRadius<250){this.rotationRadius+=this.zoomIncrement}}},rotateLeft:{value:function rotateLeft(){if(this.rotateCamera){if(this.cameraRotationIncrement>2e-4){this.cameraRotationIncrement-=1e-4}}else{this.cameraRotationAngle-=this.cameraRotationIncrement*6}}},rotateRight:{value:function rotateRight(){if(this.rotateCamera){if(this.cameraRotationIncrement<.01){this.cameraRotationIncrement+=1e-4}}else{this.cameraRotationAngle+=this.cameraRotationIncrement*6}}},randomJump:{value:function randomJump(){this.cameraRotationAngle+=Math.random()*6}},spacebarPressed:{value:function spacebarPressed(){if(!this.useMeshes){this.tweetPaused=!this.tweetPaused}else{this.rotateCamera=!this.rotateCamera}}},keypress:{value:function keypress(keycode){_get(Object.getPrototypeOf(MainScene.prototype),"keypress",this).call(this,keycode);switch(keycode){case 106:this.randomJump();break}}},keydown:{value:function keydown(keycode){_get(Object.getPrototypeOf(MainScene.prototype),"keydown",this).call(this,keycode);switch(keycode){case 38:case 87:this.zoomingIn=true;break;case 40:case 83:this.zoomingOut=true;break;case 37:case 65:this.rotatingLeft=true;break;case 39:case 68:this.rotatingRight=true;break}}},keyup:{value:function keyup(keycode){_get(Object.getPrototypeOf(MainScene.prototype),"keyup",this).call(this,keycode);switch(keycode){case 38:case 87:this.zoomingIn=false;break;case 40:case 83:this.zoomingOut=false;break;case 37:case 65:this.rotatingLeft=false;break;case 39:case 68:this.rotatingRight=false;break}}},move:{value:function move(ev){_get(Object.getPrototypeOf(MainScene.prototype),"move",this).call(this,ev);var cursor="auto";if(!this.detailedTweetMesh){var intersects=this.mouseIntersections(ev);if(intersects.length>0)cursor="pointer"}this.domContainer.css("cursor",cursor)}},click:{value:function click(ev){_get(Object.getPrototypeOf(MainScene.prototype),"click",this).call(this,ev);if(this.detailedTweetMesh){this.bringDetailTweetBackHome();return}var intersects=this.mouseIntersections(ev);if(intersects.length>0){var firstIntersection=intersects[0].object;this.bringMeshToDetail(firstIntersection)}}},mouseIntersections:{value:function mouseIntersections(mouseEvent){this.mouse.x=mouseEvent.clientX/this.renderer.domElement.clientWidth*2-1;this.mouse.y=-(mouseEvent.clientY/this.renderer.domElement.clientHeight)*2+1;this.raycaster.setFromCamera(this.mouse,this.camera);var intersects=this.raycaster.intersectObjects(this.tweetMeshes);return intersects}},bringMeshToDetail:{value:function bringMeshToDetail(mesh){this.detailedTweetMesh=mesh;this.detailedTweetMesh.__positionBeforeDetail=mesh.position.clone();this.detailedTweetMeshRotation={x:(Math.random()-.5)*.01,y:(Math.random()-.5)*.01,z:(Math.random()-.5)*.01};var tweet=mesh.__tweetData.tweet;this.detailTweetTextElement.innerHTML="<b>"+tweet.username+"</b><br>"+urlify(tweet.text);THREE.SceneUtils.attach(mesh,this.scene,this.camera);this.tweenMeshSickStyles(mesh,{position:{x:0,y:1,z:-25},scale:12,detailOpacity:1})}},bringDetailTweetBackHome:{value:function bringDetailTweetBackHome(){var mesh=this.detailedTweetMesh;this.detailedTweetMesh=null;THREE.SceneUtils.detach(mesh,this.camera,this.scene);this.tweenMeshSickStyles(mesh,{position:mesh.__positionBeforeDetail,scale:Math.random()*4+.1,detailOpacity:0})}},tweenMeshSickStyles:{value:function tweenMeshSickStyles(mesh,options){var _this=this;var position=options.position;var scale=options.scale!==undefined?options.scale:1;var detailOpacity=options.detailOpacity!==undefined?options.detailOpacity:1;var properties={x:mesh.position.x,y:mesh.position.y,z:mesh.position.z,scale:mesh.scale.x,opacity:parseFloat(this.detailTweetTextElement.style.opacity)};var target={x:position.x,y:position.y,z:position.z,scale:scale,opacity:detailOpacity};new TWEEN.Tween(properties).to(target,500).onUpdate(function(){mesh.position.set(properties.x,properties.y,properties.z);mesh.scale.set(properties.scale,properties.scale,properties.scale);_this.detailTweetTextElement.style.opacity=properties.opacity}).easing(TWEEN.Easing.Cubic.Out).start()}},handleNewTweet:{value:function handleNewTweet(tweetData){var _this=this;setTimeout(function(){if(!_this.tweetPaused){_this.tickerTweetTextElement.innerHTML=urlify(tweetData.tweet.text)}_this.totalSentiment+=tweetData.sentiment;_this.totalSentimentElement.innerText=_this.totalSentiment;if(tweetData.sentiment>=0){_this.goodTweetCount+=1;_this.goodTweetCountElement.innerText=_this.goodTweetCount}else{_this.badTweetCount+=1;_this.badTweetCountElement.innerText=_this.badTweetCount}_this.processLanguage(tweetData.tweet);if(_this.soundOn){_this.makeGodSound(tweetData.sentiment)}},this.pushDelay);var meshDelay=Math.random()*this.pushDelay;if(Math.random()<.5)meshDelay*=Math.random();setTimeout(function(){if(_this.useMeshes){_this.addTweetMesh(tweetData,_this.pushDelay-meshDelay);_this.tweetPaused=false}},meshDelay)}},processLanguage:{value:function processLanguage(tweet){var sentence=nlp.pos(tweet.text).sentences[0];var nouns=sentence.nouns(),verbs=sentence.verbs(),adjectives=sentence.adjectives();function getWords(wordObjects){var words=[];for(var i=0;i<wordObjects.length;i++){words.push(wordObjects[i].text)}return words}if(nouns.length>0){this.nounTracker.track(getWords(nouns));this.mostFrequentNounsElement.innerText=this.nounTracker.mostFrequentWordsList()}if(verbs.length>0){this.verbTracker.track(getWords(verbs));this.mostFrequentVerbsElement.innerText=this.verbTracker.mostFrequentWordsList();var conjugation=kt.choice(verbs).analysis.conjugate();this.godVerbElement.innerText=conjugation.gerund}if(adjectives.length>0){var adjectiveWords=getWords(adjectives);this.adjectiveTracker.track(adjectiveWords);this.mostFrequentAdjectivesElement.innerText=this.adjectiveTracker.mostFrequentWordsList();this.godAdjectiveElement.innerText=kt.choice(adjectiveWords)}}},addTweetMesh:{value:function addTweetMesh(tweetData,tweenDelay){var _this=this;var mesh=new THREE.Mesh(new THREE.SphereGeometry(1,32,32),new THREE.MeshLambertMaterial({color:this.colorForTweetData(tweetData)}));if(this.useMeshImages){mesh.material.map=this.religionTextureForSentiment(tweetData.sentiment)}mesh.__tweetData=tweetData;mesh.castShadow=true;mesh.receiveShadow=true;mesh.position.copy(this.randomTweetMeshPosition());var scale={value:.05};var targetScale={value:Math.random()*2+tweetData.tweet.text.length/40};var updateMeshScale=function(){mesh.scale.set(scale.value,scale.value,scale.value)};updateMeshScale();setTimeout(function(){if(_this.appIsActive){var meshTween=new TWEEN.Tween(scale).to(targetScale,500);meshTween.onUpdate(updateMeshScale);meshTween.easing(TWEEN.Easing.Circular.Out);meshTween.start()}else{scale.value=targetScale.value;updateMeshScale()}},tweenDelay);this.scene.add(mesh);this.tweetMeshes.push(mesh);var lifetime=this.maxMeshCount/TWEETS_PER_SECOND*1e3-500;setTimeout(function(){removeFromArray(_this.tweetMeshes,mesh);if(mesh===_this.detailedTweetMesh){_this.bringDetailTweetBackHome()}var deathTween=new TWEEN.Tween(scale).to({value:.01},500);deathTween.onUpdate(updateMeshScale);deathTween.easing(TWEEN.Easing.Circular.Out);deathTween.onComplete(function(){_this.scene.remove(mesh)});deathTween.start()},lifetime)}},randomTweetMeshPosition:{value:function randomTweetMeshPosition(){return new THREE.Vector3((Math.random()-.5)*100,(Math.random()-.5)*100,(Math.random()-.5)*100)}},religionTextureForSentiment:{value:function religionTextureForSentiment(score){var fuzzySentimentImageCounts={amazing:454,great:759,good:473,ok:535,bad:322,worse:361,horrible:456};var fuzzySentiment=this.fuzzySentiment(score);var filebase="/media/photos/"+fuzzySentiment+"/"+fuzzySentiment;var idx=kt.randInt(fuzzySentimentImageCounts[fuzzySentiment]-1)+1;var filename=filebase+idx+".jpg";var texture=THREE.ImageUtils.loadTexture(filename);texture.minFilter=THREE.NearestFilter;texture.wrapS=texture.wrapT=THREE.ClampToEdgeWrapping;return texture}},fuzzySentiment:{value:function fuzzySentiment(score){if(score>10){return"amazing"}else if(score>0){return"great"}else if(score>-5){return"worse"}else{return"horrible"}}},colorForTweetData:{value:function colorForTweetData(tweetData){var score=tweetData.sentiment;var color=new THREE.Color(16777215);switch(this.meshColorStyle){case"sentiment":{var maxMagnitude=10;var clampedScore=score<0?Math.min(-score,maxMagnitude):Math.min(score,maxMagnitude);var percent=clampedScore/maxMagnitude;if(score<0){color.setRGB(1,1-percent,1-percent)}else{color.setRGB(1-percent,1,1-percent)}return color}case"random":{color.setRGB(Math.random(),Math.random(),Math.random());return color}default:{return color}}}},makeHoldNotes:{value:function makeHoldNotes(maxHoldDelay){var _this=this;var sounds=this.sounds;var holdSoundArray=[sounds.A,sounds.C,sounds.C2,sounds.D,sounds.E,sounds.F,sounds.G];var holdSound=kt.choice(holdSoundArray);if(holdSound.isPaused()||holdSound.getTime()>.2){holdSound.setTime(0);holdSound.play()}var holdDelay=3e3+Math.random()*Math.random()*maxHoldDelay;setTimeout(function(){_this.makeHoldNotes(maxHoldDelay)},holdDelay)}},makeGodSound:{value:function makeGodSound(score){var sounds=this.sounds;var soundArray=[];var percSoundArray=[];var noteArray=[];var sound;var sound2;if(score>15){soundArray=[sounds.glock13];percSoundArray=[sounds.hh28,sounds.hh29,sounds.hh30,sounds.hh31,sounds.hh32]}else if(score>14){soundArray=[sounds.glock12];percSoundArray=[sounds.hh27,sounds.hh28,sounds.hh29,sounds.hh30,sounds.hh31]}else if(score>13){soundArray=[sounds.glock11];percSoundArray=[sounds.hh26,sounds.hh27,sounds.hh28,sounds.hh29,sounds.hh30]}else if(score>12){soundArray=[sounds.glock10];percSoundArray=[sounds.hh25,sounds.hh26,sounds.hh27,sounds.hh28,sounds.hh29]}else if(score>11){soundArray=[sounds.glock9];percSoundArray=[sounds.hh24,sounds.hh25,sounds.hh26,sounds.hh27,sounds.hh28]}else if(score>10){soundArray=[sounds.glock8];percSoundArray=[sounds.hh23,sounds.hh24,sounds.hh25,sounds.hh26,sounds.hh27]}else if(score>9){soundArray=[sounds.glock7];percSoundArray=[sounds.hh22,sounds.hh23,sounds.hh24,sounds.hh25,sounds.hh26]}else if(score>8){soundArray=[sounds.altglock6];percSoundArray=[sounds.hh21,sounds.hh22,sounds.hh23,sounds.hh24,sounds.hh25]}else if(score>7){soundArray=[sounds.altglock5];percSoundArray=[sounds.hh20,sounds.hh21,sounds.hh22,sounds.hh23,sounds.hh24]}else if(score>6){soundArray=[sounds.altglock4];percSoundArray=[sounds.hh10,sounds.hh11,sounds.hh12,sounds.hh13,sounds.hh14]}else if(score>5){soundArray=[sounds.altglock3];percSoundArray=[sounds.hh9,sounds.hh10,sounds.hh11,sounds.hh12,sounds.hh13]}else if(score>4){soundArray=[sounds.altglock2];percSoundArray=[sounds.hh8,sounds.hh9,sounds.hh10,sounds.hh11,sounds.hh12]}else if(score>3){soundArray=[sounds.altglock1];percSoundArray=[sounds.hh7,sounds.hh8,sounds.hh9,sounds.hh10,sounds.hh11]}else if(score>2){soundArray=[sounds.mallet4,sounds.mallet5,sounds.mallet6,sounds.mallet7,sounds.mallet8];percSoundArray=[sounds.hh6,sounds.hh7,sounds.hh8,sounds.hh9,sounds.hh10]}else if(score>1){soundArray=[sounds.mallet3,sounds.mallet4,sounds.mallet5,sounds.mallet6,sounds.mallet7];percSoundArray=[sounds.hh5,sounds.hh6,sounds.hh7,sounds.hh8,sounds.hh9]}else if(score>0){soundArray=[sounds.mallet2,sounds.mallet3,sounds.mallet4,sounds.mallet5,sounds.mallet6];percSoundArray=[sounds.hh4,sounds.hh5,sounds.hh6,sounds.hh7,sounds.hh8]}else if(score>-1){soundArray=[sounds.mallet1,sounds.mallet2,sounds.mallet3,sounds.mallet4,sounds.mallet5];percSoundArray=[sounds.hh3,sounds.hh4,sounds.hh5,sounds.hh6,sounds.hh7]}else if(score>-2){soundArray=[sounds.dbass4,sounds.dbass5,sounds.dbass6,sounds.dbass7,sounds.dbass8];percSoundArray=[sounds.hh2,sounds.hh3,sounds.hh4,sounds.hh5,sounds.hh6]}else if(score>-3){soundArray=[sounds.dbass1note,sounds.dbass2,sounds.dbass3,sounds.dbass4,sounds.dbass5];percSoundArray=[sounds.hh1,sounds.hh2,sounds.hh3,sounds.hh4,sounds.hh5]}else if(score>-4){soundArray=[sounds.cloud8];percSoundArray=[sounds.kick17,sounds.kick18,sounds.kick19,sounds.kick20]}else if(score>-5){soundArray=[sounds.clouds7];percSoundArray=[sounds.kick13,sounds.kick14,sounds.kick15,sounds.kick16]}else if(score>-6){soundArray=[sounds.clouds6];percSoundArray=[sounds.kick9,sounds.kick10,sounds.kick11,sounds.kick12]}else if(score>-7){soundArray=[sounds.clouds5];percSoundArray=[sounds.kick6,sounds.kick7,sounds.kick8]}else if(score>-8){soundArray=[sounds.clouds4];percSoundArray=[sounds.kick4,sounds.kick5]}else if(score>-9){soundArray=[sounds.clouds3];percSoundArray=[sounds.kick3]}else if(score>-10){soundArray=[sounds.clouds2];percSoundArray=[sounds.kick2]}else{soundArray=[sounds.clouds1];percSoundArray=[sounds.kick1]}if(score>15){noteArray=["C8","D8","E8","F8","G8","A8","C9","D9","E9","F9","G9","A9"]}else if(score>10){noteArray=["C7","D7","E7","F7","G7","A7"]}else if(score>5){noteArray=["C6","D6","E6","F6","G6","A6"]}else if(score>0){noteArray=["C4","D4","E4","F4","G4","A4","C5","D5","E5","F5","G5","A5"]}else if(score>-5){noteArray=["C3","D3","E3","F3","G3","A3"]}else if(score>-10){noteArray=["C2","D2","E2","F2","G2","A2"]}else{noteArray=["C1","D1","E1","F1","G1","A1"]}if(this.useInstruments){sound=kt.choice(soundArray);if(sound.isPaused()||sound.getTime()>.2){sound.setTime(0);sound.play()}}if(this.usePercussion){sound2=kt.choice(percSoundArray);if(sound2.isPaused()||sound2.getTime()>.2){sound2.setTime(0);sound2.play()}}var maxMagnitude=30;var clampedScore=score<0?score:Math.min(score,maxMagnitude);var percent=clampedScore/maxMagnitude/2;if(this.useSynth){var note=kt.choice(noteArray);this.panner.pan.value=.5+percent;this.sineSynth.triggerAttackRelease(note,"32n")}}}});return MainScene}(SheenScene);function removeFromArray(arr,el){var idx=arr.indexOf(el);if(idx>-1){arr.splice(idx,1)}}function urlify(text){var urlRegex=/(https?:\/\/[^\s]+)/g;return text.replace(urlRegex,function(url){return'<a target="_blank" href="'+url+'">'+url+"</a>"})}function addClass(selector,name){var els=document.querySelectorAll(selector);for(var i=0;i<els.length;i++){els[i].classList.add(name)}}function removeClass(selector,name){var els=document.querySelectorAll(selector);for(var i=0;i<els.length;i++){els[i].classList.remove(name)}}},{"./lib/buzz":3,"./sheen-scene.es6":7,"./word-tracker.es6":11,kutility:41,nlp_compromise:43,"socket.io-client":94,three:106,tone:108,"tween.js":109}],6:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=true;if(prop.value)prop.writable=true}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc&&desc.writable){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _inherits=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)subClass.__proto__=superClass};var _classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};var $=require("jquery");var THREE=require("three");var Physijs=require("./lib/physi.js");var TWEEN=require("tween.js");var ThreeBoiler=require("./three-boiler.es6").ThreeBoiler;var MainScene=require("./main-scene.es6").MainScene;var FlyControls=require("./controls/fly-controls");require("./social-evader")();var ON_PHONE=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);var BaseLoadingText="is loading";var $splashStatus=$("#splash-status");var Sheen=function(_ThreeBoiler){function Sheen(){var _this=this;_classCallCheck(this,Sheen);_get(Object.getPrototypeOf(Sheen.prototype),"constructor",this).call(this,{antialias:true,alpha:true,onPhone:ON_PHONE});var isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);if(!isChrome){$("#splash-please-use-chrome").show()}if(this.renderer){this.renderer.shadowMapEnabled=true;this.renderer.shadowMapCullFace=THREE.CullFaceBack;this.renderer.shadowMapType=THREE.PCFSoftShadowMap;this.renderer.gammaInput=true;this.renderer.gammaOutput=true}this.mainScene=new MainScene(this.renderer,this.camera,this.scene,{onPhone:ON_PHONE});this.mainScene.controls=this.controls;this.clock=new THREE.Clock;$(document).click(function(ev){if($(ev.target).is("a")){return}if(_this.loading){return}if(_this.hasStarted){_this.mainScene.click(ev)}});$("#click-to-start").click(function(){if(!_this.hasStarted){_this.start(false)}});$("#click-to-start-simple").click(function(){if(!_this.hasStarted){_this.start(true)}});$(document).mousemove(function(ev){_this.mainScene.move(ev)})}_inherits(Sheen,_ThreeBoiler);_createClass(Sheen,{createScene:{value:function createScene(){var scene=new Physijs.Scene;scene.setGravity(new THREE.Vector3(0,-50,0));scene.addEventListener("update",function(){scene.simulate(undefined,1)});return scene}},createAmbientLight:{value:function createAmbientLight(){return new THREE.AmbientLight(5263440)}},activate:{value:function activate(){var _this=this;_get(Object.getPrototypeOf(Sheen.prototype),"activate",this).call(this);this.loading=true;this.updateLoadingView();setTimeout(function(){_this.didFinishLoading()},500);this.scene.simulate();this.mainScene.startScene()}},render:{value:function render(){_get(Object.getPrototypeOf(Sheen.prototype),"render",this).call(this);TWEEN.update();this.mainScene.update(this.clock.getDelta())}},setAppActive:{value:function setAppActive(active){_get(Object.getPrototypeOf(Sheen.prototype),"setAppActive",this).call(this,active);if(this.mainScene){this.mainScene.setAppActive(active)}}},keypress:{value:function keypress(keycode){_get(Object.getPrototypeOf(Sheen.prototype),"keypress",this).call(this,keycode);this.mainScene.keypress(keycode)}},keydown:{value:function keydown(keycode){_get(Object.getPrototypeOf(Sheen.prototype),"keydown",this).call(this,keycode);this.mainScene.keydown(keycode)}},keyup:{value:function keyup(keycode){_get(Object.getPrototypeOf(Sheen.prototype),"keyup",this).call(this,keycode);this.mainScene.keyup(keycode)}},spacebarPressed:{value:function spacebarPressed(){this.mainScene.spacebarPressed()}},updateLoadingView:{value:function updateLoadingView(){var _this=this;if(!this.loading){return}var currentText=$splashStatus.text();if(currentText.length<BaseLoadingText.length+3){currentText+=".";$splashStatus.text(currentText)}else{$splashStatus.text(BaseLoadingText)}setTimeout(function(){_this.updateLoadingView()},250)}},didFinishLoading:{value:function didFinishLoading(){var _this=this;this.loading=false;$splashStatus.text("is ready");$splashStatus.css("font-style","italic");if(this.onPhone){$("#splash-mobile-warning").fadeIn(1e3)}setTimeout(function(){if(!_this.hasStarted){$("#splash-controls").fadeIn(1e3)}},250);setTimeout(function(){if(!_this.hasStarted){$(".click-to-start-container").fadeIn(1e3)}},1750)}},start:{value:function start(simpleMode){$(".splash-overlay").fadeOut(1e3);if(this.onPhone){$("#mobile-error-overlay").fadeOut(1e3)}this.mainScene.doTimedWork(simpleMode);this.hasStarted=true}}});return Sheen}(ThreeBoiler);$(function(){var sheen=new Sheen;sheen.activate()})},{"./controls/fly-controls":1,"./lib/physi.js":4,"./main-scene.es6":5,"./social-evader":8,"./three-boiler.es6":9,jquery:39,three:106,"tween.js":109}],7:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=true;if(prop.value)prop.writable=true}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};Object.defineProperty(exports,"__esModule",{value:true});var THREE=require("three");var $=require("jquery");var SheenScene=exports.SheenScene=function(){function SheenScene(renderer,camera,scene,options){_classCallCheck(this,SheenScene);this.renderer=renderer;this.camera=camera;this.scene=scene;this.options=options;this.name="sheen scene";this.domContainer=$("body");$(window).resize(this.resize.bind(this));this.hasStarted=false;this.appIsActive=true}_createClass(SheenScene,{update:{value:function update(){}},setAppActive:{value:function setAppActive(active){this.appIsActive=active}},startScene:{value:function startScene(){this.enter();if(this.startAutomatically){this.doTimedWork()}}},enter:{value:function enter(){this.active=true;this.camera.position.set(0,0,0);this.camera.rotation.x=0;this.camera.rotation.y=0;this.camera.rotation.z=0}},doTimedWork:{value:function doTimedWork(){}},exit:{value:function exit(){this.active=false;var children=this.children();for(var i=0;i<children.length;i++){var child=children[i];this.scene.remove(child)}}},iWantOut:{value:function iWantOut(){if(this.exitCallback){this.exitCallback(this)}}},addMesh:{value:function addMesh(){}},click:{value:function click(){if(this.active&&this.isLive&&!this.hasStarted){this.doTimedWork();this.hasStarted=true}}},move:{value:function move(){}},resize:{value:function resize(){}},keypress:{value:function keypress(){}},keydown:{value:function keydown(){}},keyup:{value:function keyup(){}},children:{value:function children(){return[]}},makeAudio:{value:function makeAudio(basedFilename){var audio=document.createElement("audio");audio.src=basedFilename+".mp3";audio.preload=true;return audio}},makeVideo:{value:function makeVideo(basedFilename,fullscreen,z){var video=document.createElement("video");var videoURL;if(video.canPlayType("video/mp4").length>0){videoURL=basedFilename+".mp4"}else{videoURL=basedFilename+".webm"}video.src=videoURL;video.preload=true;video.loop=true;if(fullscreen){$(video).addClass("full-screen-video")}else{$(video).addClass("video-overlay")}if(z!==undefined){$(video).css("z-index",z)}this.domContainer.append(video);return video}},makeImage:{value:function makeImage(basedFilename,fullscreen,z){var img=$('<img src="'+basedFilename+'" class="image-overlay"/>');if(fullscreen){img.css("top","0px");img.css("left","0px");img.css("width","100%");img.css("height","100%")}if(z!==undefined){img.css("z-index",z)}this.domContainer.append(img);return img}},makeCanvas:{value:function makeCanvas(z){var canvas=$('<canvas class="canvas-overlay"></canvas>');if(z!==undefined){canvas.css("z-index",z)}this.domContainer.append(canvas);return canvas.get(0)}}});return SheenScene}()},{jquery:39,three:106}],8:[function(require,module,exports){"use strict";var $=require("jquery");var Vector=require("./vector");function evade(evt){var $this=$(this),corner=$this.offset(),center={x:corner.left+$this.outerWidth()/2,y:corner.top+$this.outerHeight()/2},dist=new Vector(center.x-evt.pageX,center.y-evt.pageY),closest=$this.outerWidth()/2;if(dist.length()>=closest){return}var delta=dist.normal().multeq(closest).sub(dist),newCorner={left:corner.left+delta.x,top:corner.top+delta.y};var pad=12;newCorner.left=clamp(newCorner.left,-pad,window.innerWidth-$this.outerWidth()+pad);newCorner.top=clamp(newCorner.top,-pad,window.innerHeight-$this.outerHeight()+pad);setTimeout(function(){$this.offset(newCorner)},100)}function clamp(val,min,max){if(val<min){return min}if(val>max){return max}return val}function beginEvade(){$(this).bind("mousemove",evade)}function endEvade(){$(this).unbind("mousemove",evade)}module.exports=function(){$(function(){$(".social-button").bind("mouseenter",beginEvade);$(".social-button").bind("mouseleave",endEvade)})}},{"./vector":10,jquery:39}],9:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=true;if(prop.value)prop.writable=true}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};Object.defineProperty(exports,"__esModule",{value:true});var $=require("jquery");var THREE=require("three");var ThreeBoiler=exports.ThreeBoiler=function(){function ThreeBoiler(rendererOptions){var _this=this;_classCallCheck(this,ThreeBoiler);this.onPhone=rendererOptions.onPhone||false;if(!this.onPhone){try{this.renderer=new THREE.WebGLRenderer(rendererOptions);this.renderMode="webgl"}catch(e){$(".webgl-error").show();setTimeout(function(){$(".webgl-error").fadeOut()},6666);this.renderer=new THREE.CanvasRenderer;this.renderMode="canvas"}this.renderer.setClearColor(16777215,1);document.body.appendChild(this.renderer.domElement)}this.scene=this.createScene();this.camera=this.createCamera();this.scene.add(this.camera);this.ambientLight=this.createAmbientLight();this.scene.add(this.ambientLight);$(window).resize(function(){_this.resize()});this.resize();$("body").keypress(function(ev){_this.keypress(ev.which)});$("body").keydown(function(ev){_this.keydown(ev.which)});$("body").keyup(function(ev){_this.keyup(ev.which)});this.setAppActive(true);$(window).blur(function(){_this.setAppActive(false)});$(window).focus(function(){_this.setAppActive(true)})}_createClass(ThreeBoiler,{createScene:{value:function createScene(){return new THREE.Scene}},createCamera:{value:function createCamera(){return new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,5e3)}},createAmbientLight:{value:function createAmbientLight(){return new THREE.AmbientLight(4210752)}},activate:{value:function activate(){this.frame=0;this.render()}},render:{value:function render(){var _this=this;requestAnimationFrame(function(){_this.render()});this.frame+=1;if(this.renderer){this.renderer.render(this.scene,this.camera)}}},resize:{value:function resize(){if(this.renderer){this.renderer.setSize(window.innerWidth,window.innerHeight)}this.camera.aspect=window.innerWidth/window.innerHeight;this.camera.updateProjectionMatrix()}},setAppActive:{value:function setAppActive(active){this.appIsActive=active}},fadeSceneOverlay:{value:function fadeSceneOverlay(behavior,options){if(!options)options={};var duration=options.duration||1e3;$sceneOverlay.fadeIn(duration,function(){behavior();$sceneOverlay.fadeOut(duration)})}},keypress:{value:function keypress(keycode){switch(keycode){case 32:this.spacebarPressed();break;default:break}}},keydown:{value:function keydown(keycode){}},keyup:{value:function keyup(keycode){}},spacebarPressed:{value:function spacebarPressed(){}}});return ThreeBoiler}();window._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=window._typeface_js;(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(id){clearTimeout(id)}})()},{jquery:39,three:106}],10:[function(require,module,exports){"use strict";module.exports=Vector;function Vector(x,y){this.x=x;this.y=y}Vector.prototype={clone:function clone(){return new Vector(this.x,this.y)},negate:function negate(){this.x=-this.x;this.y=-this.y;return this},neg:function neg(){return this.clone().negate()},addeq:function addeq(v){this.x+=v.x;this.y+=v.y;return this},subeq:function subeq(v){return this.addeq(v.neg())},add:function add(v){return this.clone().addeq(v)},sub:function sub(v){return this.clone().subeq(v)},multeq:function multeq(c){this.x*=c;this.y*=c;return this},diveq:function diveq(c){this.x/=c;this.y/=c;return this},mult:function mult(c){return this.clone().multeq(c)},div:function div(c){return this.clone().diveq(c)},dot:function dot(v){return this.x*v.x+this.y*v.y},length:function length(){return Math.sqrt(this.dot(this))},normal:function normal(){return this.clone().diveq(this.length())}}},{}],11:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=true;if(prop.value)prop.writable=true}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};Object.defineProperty(exports,"__esModule",{value:true});var WordTracker=exports.WordTracker=function(){function WordTracker(options){_classCallCheck(this,WordTracker);if(!options)options={};this.numberOfMostFrequentWords=options.numberOfMostFrequentWords||3;this.bannedWords=options.bannedWords||[];this.countmap={};this.mostFrequentWords=[]}_createClass(WordTracker,{track:{value:function track(words){for(var i=0;i<words.length;i++){var word=words[i].replace(/\s/g,"").toLowerCase();if(word.length===0||this.bannedWords.indexOf(word)>=0){continue}var count=this.countmap[word]||0;count+=1;this.countmap[word]=count;for(var j=0;j<this.numberOfMostFrequentWords;j++){var frequentWord=this.mostFrequentWords[j];var frequentWordCount=this.countmap[frequentWord]||0;if(count>frequentWordCount){var currentIndex=this.mostFrequentWords.indexOf(word);if(currentIndex>=0){this.mostFrequentWords[currentIndex]=frequentWord;this.mostFrequentWords[j]=word}else{this.mostFrequentWords.splice(j,0,word);if(this.mostFrequentWords.length>this.numberOfMostFrequentWords){this.mostFrequentWords.pop()}}break}}}}},mostFrequentWordsList:{value:function mostFrequentWordsList(){return this.mostFrequentWords.join(", ")}}});return WordTracker}()},{}],12:[function(require,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error("after called too many times")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],13:[function(require,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],14:[function(require,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],15:[function(require,module,exports){(function(){"use strict";var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var lookup=new Uint8Array(256);for(var i=0;i<chars.length;i++){lookup[chars.charCodeAt(i)]=i}exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=lookup[base64.charCodeAt(i)];encoded2=lookup[base64.charCodeAt(i+1)];encoded3=lookup[base64.charCodeAt(i+2)];encoded4=lookup[base64.charCodeAt(i+3)];bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})()},{}],16:[function(require,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var a=new Blob(["hi"]);return a.size===2}catch(e){return false}}();var blobSupportsArrayBufferView=blobSupported&&function(){try{var b=new Blob([new Uint8Array([1,2])]);return b.size===2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function mapArrayBufferViews(ary){for(var i=0;i<ary.length;i++){var chunk=ary[i];if(chunk.buffer instanceof ArrayBuffer){var buf=chunk.buffer;if(chunk.byteLength!==buf.byteLength){var copy=new Uint8Array(chunk.byteLength);copy.set(new Uint8Array(buf,chunk.byteOffset,chunk.byteLength));buf=copy.buffer}ary[i]=buf}}}function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;mapArrayBufferViews(ary);for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}function BlobConstructor(ary,options){mapArrayBufferViews(ary);return new Blob(ary,options||{})}module.exports=function(){if(blobSupported){return blobSupportsArrayBufferView?global.Blob:BlobConstructor}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],17:[function(require,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],18:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],19:[function(require,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],20:[function(require,module,exports){(function(process){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return typeof document!=="undefined"&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{return exports.storage.debug}catch(e){}if(typeof process!=="undefined"&&"env"in process){return process.env.DEBUG}}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}}).call(this,require("_process"))},{"./debug":21,_process:113}],21:[function(require,module,exports){exports=module.exports=debug.debug=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});args=exports.formatArgs.apply(self,args);var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:42}],22:[function(require,module,exports){module.exports=require("./lib/index")},{"./lib/index":23}],23:[function(require,module,exports){module.exports=require("./socket");module.exports.parser=require("engine.io-parser")},{"./socket":24,"engine.io-parser":33}],24:[function(require,module,exports){(function(global){var transports=require("./transports/index");var Emitter=require("component-emitter");var debug=require("debug")("engine.io-client:socket");var index=require("indexof");var parser=require("engine.io-parser");var parseuri=require("parseuri");var parsejson=require("parsejson");var parseqs=require("parseqs");module.exports=Socket;function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&"object"===typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.hostname=uri.host;opts.secure=uri.protocol==="https"||uri.protocol==="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}else if(opts.host){opts.hostname=parseuri(opts.host).host}this.secure=null!=opts.secure?opts.secure:global.location&&"https:"===location.protocol;if(opts.hostname&&!opts.port){opts.port=this.secure?"443":"80"}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:"localhost");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if("string"===typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||"t";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||["polling","websocket"];this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.perMessageDeflate=false!==opts.perMessageDeflate?opts.perMessageDeflate||{}:false;if(true===this.perMessageDeflate)this.perMessageDeflate={};if(this.perMessageDeflate&&null==this.perMessageDeflate.threshold){this.perMessageDeflate.threshold=1024}this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized===undefined?null:opts.rejectUnauthorized;this.forceNode=!!opts.forceNode;var freeGlobal=typeof global==="object"&&global;if(freeGlobal.global===freeGlobal){if(opts.extraHeaders&&Object.keys(opts.extraHeaders).length>0){this.extraHeaders=opts.extraHeaders}if(opts.localAddress){this.localAddress=opts.localAddress}}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingIntervalTimer=null;this.pingTimeoutTimer=null;this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=require("./transport");Socket.transports=require("./transports/index");Socket.parser=require("engine.io-parser");Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){transport="websocket"}else if(0===this.transports.length){var self=this;setTimeout(function(){self.emit("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})};Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1});var failed=false;var self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",function(msg){if(failed)return;if("pong"===msg.type&&"probe"===msg.data){debug('probe transport "%s" pong',name);self.upgrading=true;self.emit("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"===transport.name;debug('pausing current transport "%s"',self.transport.name);self.transport.pause(function(){if(failed)return;if("closed"===self.readyState)return;debug("changing transport and sending upgrade packet");cleanup();self.setTransport(transport);transport.send([{type:"upgrade"}]);self.emit("upgrade",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name;self.emit("upgradeError",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!==transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);self.removeListener("close",onclose);self.removeListener("upgrading",onupgrade)}transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"===this.transport.name;this.emit("open");this.flush();if("open"===this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emit("packet",packet);this.emit("heartbeat");switch(packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();this.emit("pong");break;case"error":var err=new Error("server error");err.code=packet.data;this.onError(err);break;case"message":this.emit("data",packet.data);this.emit("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"===this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if("closed"===self.readyState)return;self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){var self=this;this.sendPacket("ping",function(){self.emit("ping")})};Socket.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emit("drain")}else{this.flush()}};Socket.prototype.flush=function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};Socket.prototype.write=Socket.prototype.send=function(msg,options,fn){this.sendPacket("message",msg,options,fn);return this};Socket.prototype.sendPacket=function(type,data,options,fn){if("function"===typeof data){fn=data;data=undefined}if("function"===typeof options){fn=options;options=null}if("closing"===this.readyState||"closed"===this.readyState){return}options=options||{};options.compress=false!==options.compress;var packet={type:type,data:data,options:options};this.emit("packetCreate",packet);this.writeBuffer.push(packet);if(fn)this.once("flush",fn);this.flush()};Socket.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var self=this;if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}function close(){self.onClose("forced close");debug("socket closing - telling transport to close");self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose);self.removeListener("upgradeError",cleanupAndClose);close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose);self.once("upgradeError",cleanupAndClose)}return this};Socket.prototype.onError=function(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emit("error",err);this.onClose("transport error",err)};Socket.prototype.onClose=function(reason,desc){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",reason,desc);self.writeBuffer=[];self.prevBufferLen=0}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":25,"./transports/index":26,"component-emitter":32,debug:20,"engine.io-parser":33,indexof:37,parsejson:91,parseqs:92,parseuri:93}],25:[function(require,module,exports){var parser=require("engine.io-parser");var Emitter=require("component-emitter");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState="";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.forceNode=opts.forceNode;this.extraHeaders=opts.extraHeaders;this.localAddress=opts.localAddress}Emitter(Transport.prototype);Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type="TransportError";err.description=desc;this.emit("error",err);return this};Transport.prototype.open=function(){if("closed"===this.readyState||""===this.readyState){this.readyState="opening";this.doOpen()}return this};Transport.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if("open"===this.readyState){this.write(packets)}else{throw new Error("Transport not open")}};Transport.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit("packet",packet)};Transport.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":32,"engine.io-parser":33}],26:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest-ssl");var XHR=require("./polling-xhr");var JSONP=require("./polling-jsonp");var websocket=require("./websocket");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL="https:"===location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!==location.hostname||port!==opts.port;xs=opts.secure!==isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if("open"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":27,"./polling-xhr":28,"./websocket":30,"xmlhttprequest-ssl":31}],27:[function(require,module,exports){(function(global){var Polling=require("./polling");var inherit=require("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g;var rEscapedNewline=/\\n/g;var callbacks;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener("beforeunload",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];if(insertAt){insertAt.parentNode.insertBefore(script,insertAt)}else{(document.head||document.body).appendChild(script)}this.script=script;var isUAgecko="undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement("form");var area=document.createElement("textarea");var id=this.iframeId="eio_iframe_"+this.index;var iframe;form.className="socketio";form.style.position="absolute";form.style.top="-1000px";form.style.left="-1000px";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId;iframe.src="javascript:0"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,"\\\n");this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState==="complete"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":29,"component-inherit":19}],28:[function(require,module,exports){(function(global){var XMLHttpRequest=require("xmlhttprequest-ssl");var Polling=require("./polling");var Emitter=require("component-emitter");var inherit=require("component-inherit");var debug=require("debug")("engine.io-client:polling-xhr");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);this.requestTimeout=opts.requestTimeout;if(global.location){var isSSL="https:"===location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!==global.location.hostname||port!==opts.port;this.xs=opts.secure!==isSSL}else{this.extraHeaders=opts.extraHeaders}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;opts.requestTimeout=this.requestTimeout;opts.extraHeaders=this.extraHeaders;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!=="string"&&data!==undefined;var req=this.request({method:"POST",data:data,isBinary:isBinary});var self=this;req.on("success",fn);req.on("error",function(err){self.onError("xhr post error",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request();var self=this;req.on("data",function(data){self.onData(data)});req.on("error",function(err){self.onError("xhr poll error",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||"GET";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!==opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.requestTimeout=opts.requestTimeout;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.extraHeaders=opts.extraHeaders;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);try{if(this.extraHeaders){xhr.setDisableHeaderCheck(true);for(var i in this.extraHeaders){if(this.extraHeaders.hasOwnProperty(i)){xhr.setRequestHeader(i,this.extraHeaders[i])}}}}catch(e){}if(this.supportsBinary){xhr.responseType="arraybuffer"}if("POST"===this.method){try{if(this.isBinary){xhr.setRequestHeader("Content-type","application/octet-stream")}else{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}try{xhr.setRequestHeader("Accept","*/*")}catch(e){}if("withCredentials"in xhr){xhr.withCredentials=true}if(this.requestTimeout){xhr.timeout=this.requestTimeout}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!==xhr.readyState)return;if(200===xhr.status||1223===xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Request.prototype.onData=function(data){this.emit("data",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit("error",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if("undefined"===typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(contentType==="application/octet-stream"){data=this.xhr.response||this.xhr.responseText}else{if(!this.supportsBinary){data=this.xhr.responseText}else{try{data=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){var ui8Arr=new Uint8Array(this.xhr.response);var dataArray=[];for(var idx=0,length=ui8Arr.length;idx<length;idx++){dataArray.push(ui8Arr[idx])}data=String.fromCharCode.apply(null,dataArray)}}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return"undefined"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};Request.requestsCount=0;Request.requests={};if(global.document){if(global.attachEvent){global.attachEvent("onunload",unloadHandler)}else if(global.addEventListener){global.addEventListener("beforeunload",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":29,"component-emitter":32,"component-inherit":19,debug:20,"xmlhttprequest-ssl":31}],29:[function(require,module,exports){var Transport=require("../transport");var parseqs=require("parseqs");var parser=require("engine.io-parser");var inherit=require("component-inherit");var yeast=require("yeast");var debug=require("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=require("xmlhttprequest-ssl");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name="polling";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var self=this;this.readyState="pausing";function pause(){debug("paused");self.readyState="paused";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")};Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){if("opening"===self.readyState){self.onOpen()}if("close"===packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if("closed"!==this.readyState){this.polling=false;this.emit("pollComplete");if("open"===this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet");self.write([{type:"close"}])}if("open"===this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit("drain")};parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"https":"http";var port="";if(false!==this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&("https"===schema&&Number(this.port)!==443||"http"===schema&&Number(this.port)!==80)){port=":"+this.port}if(query.length){query="?"+query}var ipv6=this.hostname.indexOf(":")!==-1;return schema+"://"+(ipv6?"["+this.hostname+"]":this.hostname)+port+this.path+query}},{"../transport":25,"component-inherit":19,debug:20,"engine.io-parser":33,parseqs:92,"xmlhttprequest-ssl":31,yeast:111}],30:[function(require,module,exports){(function(global){var Transport=require("../transport");var parser=require("engine.io-parser");var parseqs=require("parseqs");var inherit=require("component-inherit");var yeast=require("yeast");var debug=require("debug")("engine.io-client:websocket");var BrowserWebSocket=global.WebSocket||global.MozWebSocket;var NodeWebSocket;if(typeof window==="undefined"){try{NodeWebSocket=require("ws")}catch(e){}}var WebSocket=BrowserWebSocket;if(!WebSocket&&typeof window==="undefined"){WebSocket=NodeWebSocket}module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}this.perMessageDeflate=opts.perMessageDeflate;this.usingBrowserWebSocket=BrowserWebSocket&&!opts.forceNode;if(!this.usingBrowserWebSocket){WebSocket=NodeWebSocket}Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name="websocket";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var uri=this.uri();var protocols=void 0;var opts={agent:this.agent,perMessageDeflate:this.perMessageDeflate};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;if(this.extraHeaders){opts.headers=this.extraHeaders}if(this.localAddress){opts.localAddress=this.localAddress}try{this.ws=this.usingBrowserWebSocket?new WebSocket(uri):new WebSocket(uri,protocols,opts)}catch(err){return this.emit("error",err)}if(this.ws.binaryType===undefined){this.supportsBinary=false}if(this.ws.supports&&this.ws.supports.binary){this.supportsBinary=true;this.ws.binaryType="nodebuffer"}else{this.ws.binaryType="arraybuffer"}this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError("websocket error",e)}};WS.prototype.write=function(packets){var self=this;this.writable=false;var total=packets.length;for(var i=0,l=total;i<l;i++){(function(packet){parser.encodePacket(packet,self.supportsBinary,function(data){if(!self.usingBrowserWebSocket){var opts={};if(packet.options){opts.compress=packet.options.compress}if(self.perMessageDeflate){var len="string"===typeof data?global.Buffer.byteLength(data):data.length;if(len<self.perMessageDeflate.threshold){opts.compress=false}}}try{if(self.usingBrowserWebSocket){self.ws.send(data)}else{self.ws.send(data,opts)}}catch(e){debug("websocket closed before onclose event")}--total||done()})})(packets[i])}function done(){self.emit("flush");setTimeout(function(){self.writable=true;self.emit("drain")},0)}};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"wss":"ws";var port="";if(this.port&&("wss"===schema&&Number(this.port)!==443||"ws"===schema&&Number(this.port)!==80)){port=":"+this.port}if(this.timestampRequests){query[this.timestampParam]=yeast()}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query="?"+query}var ipv6=this.hostname.indexOf(":")!==-1;return schema+"://"+(ipv6?"["+this.hostname+"]":this.hostname)+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!("__initialize"in WebSocket&&this.name===WS.prototype.name)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../transport":25,"component-inherit":19,debug:20,"engine.io-parser":33,parseqs:92,ws:112,yeast:111}],31:[function(require,module,exports){(function(global){var hasCORS=require("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!==typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new(global[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"has-cors":36}],32:[function(require,module,exports){if(typeof module!=="undefined"){module.exports=Emitter}function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks["$"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks["$"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],33:[function(require,module,exports){(function(global){var keys=require("./keys");var hasBinary=require("has-binary");var sliceBuffer=require("arraybuffer.slice");var after=require("after");var utf8=require("wtf-8");var base64encoder;if(global&&global.ArrayBuffer){base64encoder=require("base64-arraybuffer")}var isAndroid=typeof navigator!=="undefined"&&/Android/i.test(navigator.userAgent);var isPhantomJS=typeof navigator!=="undefined"&&/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:"error",data:"parser error"};var Blob=require("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if("function"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if("function"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(""+encoded)};function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof global.Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(data===undefined){return err}if(typeof data=="string"){if(data.charAt(0)=="b"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){data=tryDecode(data);if(data===false){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType==="blob"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};function tryDecode(data){try{data=utf8.decode(data)}catch(e){return false}return data}exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!base64encoder){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType==="blob"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary=="function"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback("0:")}function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(""))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!="string"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var packet;if(data==""){return callback(err,0,1)}var length="",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"!=chr){length+=chr}else{if(""==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=""}}if(length!=""){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p==="string"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p==="string";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded==="string"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength="";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":34,after:12,"arraybuffer.slice":13,"base64-arraybuffer":15,blob:16,"has-binary":35,"wtf-8":110}],34:[function(require,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],35:[function(require,module,exports){(function(global){var isArray=require("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON&&"function"==typeof obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:38}],36:[function(require,module,exports){try{module.exports=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(err){module.exports=false}},{}],37:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],38:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],39:[function(require,module,exports){(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){var arr=[];var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var document=window.document,version="2.1.3",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)+1>=0},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}if(obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j]}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:Date.now,support:support});jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];nodeType=context.nodeType;if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results}if(!seed&&documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType!==1&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;parent=doc.defaultView;if(parent&&parent!==parent.top){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false)}else if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler)}}documentIsHTML=!isXML(doc);support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag)}else if(support.qsa){return context.querySelectorAll(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\f]' msallowcapture=''>"+"<option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return typeof rootjQuery.ready!=="undefined"?rootjQuery.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0])}return indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});var rnotwhite=/\S+/g;var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function completed(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.ready.promise();var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet};jQuery.acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Data.uid++}Data.uid=1;Data.accepts=jQuery.acceptData;Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};var data_priv=new Data;var data_user=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};var rcheckableType=/^(?:checkbox|radio)$/i;(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&jQuery.acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}data_priv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);data_priv.remove(doc,fix)}else{data_priv.access(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,type,key,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(jQuery.acceptData(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}}});jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value}})},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];this.domManip(arguments,function(elem){arg=this.parentNode;jQuery.cleanData(getAll(this));if(arg){arg.replaceChild(elem,this)}});return arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=iframe[0].contentDocument;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){if(elem.ownerDocument.defaultView.opener){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)}return window.getComputedStyle(elem,null)};function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);if(computed){ret=computed.getPropertyValue(name)||computed[name]}if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}(function(){var pixelPositionVal,boxSizingReliableVal,docElem=document.documentElement,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;"+"position:absolute";container.appendChild(div);function computePixelPositionAndBoxSizingReliable(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;display:block;margin-top:1%;top:1%;"+"border:1px;padding:1px;width:4px;position:absolute";div.innerHTML="";docElem.appendChild(container);var divStyle=window.getComputedStyle(div,null);pixelPositionVal=divStyle.top!=="1%";boxSizingReliableVal=divStyle.width==="4px";docElem.removeChild(container)}if(window.getComputedStyle){jQuery.extend(support,{pixelPosition:function(){computePixelPositionAndBoxSizingReliable();return pixelPositionVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computePixelPositionAndBoxSizingReliable()}return boxSizingReliableVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";docElem.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv,null).marginRight);docElem.removeChild(container);div.removeChild(marginDiv);return ret}})}})();jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name[0].toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{float:"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||value!==value){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?data_priv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t"})();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}});jQuery.extend({propFix:{for:"htmlFor",class:"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=arguments.length===0||typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}finalValue=value?jQuery.trim(cur):"";if(elem.className!==finalValue){elem.className=finalValue}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(option.value,values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now();var rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=window.location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,throws:true})};jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}})}support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id]=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback){throw e}}},abort:function(){if(callback){callback()}}}}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=jQuery.trim(url.slice(off));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(typeof noGlobal===strundefined){window.jQuery=window.$=jQuery}return jQuery})},{}],40:[function(require,module,exports){(function(global){(function(){var isLoader=typeof define==="function"&&define.amd;var objectTypes={function:true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global=="object"&&global;if(freeGlobal&&(freeGlobal["global"]===freeGlobal||freeGlobal["window"]===freeGlobal||freeGlobal["self"]===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root["Object"]());exports||(exports=root["Object"]());var Number=context["Number"]||root["Number"],String=context["String"]||root["String"],Object=context["Object"]||root["Object"],Date=context["Date"]||root["Date"],SyntaxError=context["SyntaxError"]||root["SyntaxError"],TypeError=context["TypeError"]||root["TypeError"],Math=context["Math"]||root["Math"],nativeJSON=context["JSON"]||root["JSON"];if(typeof nativeJSON=="object"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a"}else if(name=="json"){isSupported=has("json-stringify")&&has("json-parse")}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=exports.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number)==="0"&&stringify(new String)=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\0\b\n\f\r\t"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name=="json-parse"){var parse=exports.parse;if(typeof parse=="function"){try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value["a"].length==5&&value["a"][0]===1;if(parseSupported){try{parseSupported=!parse('"\t"')}catch(exception){}if(parseSupported){try{parseSupported=parse("01")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse("1.")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property)}}if(isConstructor||isProperty.call(object,property="constructor")){callback(property)}}}return forEach(object,callback)};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(""):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else{value=null}}else if(typeof value.toJSON=="function"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return"null"}className=getClass.call(value);if(className==booleanClass){return""+value}else if(className==numberClass){return value>-1/0&&value<1/0?""+value:"null"}else if(className==stringClass){return quote(""+value)}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element)}result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+":"+(whitespace?" ":"")+element)}});result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)=="true"){Index+=4;return true}else if(source.slice(Index,Index+5)=="false"){Index+=5;return false}else if(source.slice(Index,Index+4)=="null"){Index+=4;return null}abort()}}return"$"};var get=function(value){var results,hasMembers;if(value=="$"){abort()}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1)}if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]"){break}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort()}}else{abort()}}if(value==","){abort()}results.push(get(value))}return results}else if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}"){break}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort()}}else{abort()}}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort()}results[value.slice(1)]=get(lex())}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}exports["runInContext"]=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root["JSON3"],isRestored=false;var JSON3=runInContext(root,root["JSON3"]={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root["JSON3"]=previousJSON;nativeJSON=previousJSON=null}return JSON3}});root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],41:[function(require,module,exports){module.exports=new Kutility;function Kutility(){}Kutility.prototype.choice=function(arr){var i=Math.floor(Math.random()*arr.length);return arr[i]};Kutility.prototype.shuffle=function(arr){var newArray=new Array(arr.length);for(var i=0;i<arr.length;i++)newArray[i]=arr[i];newArray.sort(function(){return.5-Math.random()});return newArray};Kutility.prototype.randColor=function(){var r=Math.floor(Math.random()*256);var g=Math.floor(Math.random()*256);var b=Math.floor(Math.random()*256);return"rgb("+r+","+g+","+b+")"};Kutility.prototype.randInt=function(num1,num2){var min,max;if(num1!==undefined&&num2!==undefined){min=num1;max=num2}else if(num1!==undefined){max=num1}else{max=0}if(min){return Math.floor(Math.random()*(max-min))+min}else{return Math.floor(Math.random()*max)}};Kutility.prototype.colorWheel=function(num){var text="rgb(";var entry=num%1536;num=entry%256;if(entry<256*1)return text+"0,255,"+num+")";else if(entry<256*2)return text+"0,"+(255-num)+",255)";else if(entry<256*3)return text+num+",0,255)";else if(entry<256*4)return text+"255,0,"+(255-num)+")";else if(entry<256*5)return text+"255,"+num+",0)";else return text+(255-num)+",255,0)"};Kutility.prototype.alphize=function(color,alpha){color.replace("rgb","rgba");color.replace(")",", "+alpha+")");return color};Kutility.prototype.contrasters=function(){var num=Math.floor(Math.random()*1536);var fg=this.colorWheel(num);var bg=this.colorWheel(num+650);return[fg,bg]};Kutility.prototype.randomShadow=function(el,size){var s=size+"px";var shadow="0px 0px "+s+" "+s+" "+this.randColor();addShadow(el,shadow)};Kutility.prototype.shadow=function(el,x,y,z,w,color){var xp=x+"px";var yp=y+"px";var zp=z+"px";var wp=w+"px";var shadow=xp+" "+yp+" "+zp+" "+wp+" "+color;addShadow(el,shadow)};function addShadow(el,shadow){el.css("-webkit-box-shadow",shadow);el.css("-moz-box-shadow",shadow);el.css("box-shadow",shadow)}Kutility.prototype.addTransform=function(el,transform){var curTransform=this.getTransform(el);curTransform=curTransform.replace("none","");var newTransform=curTransform+transform;this.setTransform(el,newTransform)};Kutility.prototype.setTransform=function(el,transform){el.css("-webkit-transform",transform);el.css("-moz-transform",transform);el.css("-ms-transform",transform);el.css("-o-transform",transform);el.css("transform",transform)};Kutility.prototype.getTransform=function(el){var possible=["transform","-webkit-transform","-moz-transform","-ms-transform","-o-transform"];for(var i=0;i<possible.length;i++){var f=el.css(possible[i]);if(f==="none"&&i+1<possible.length){var pf=el.css(possible[i+1]);if(pf)continue}return f}};Kutility.prototype.clearTransforms=function(el){el.css("-webkit-transform","");el.css("-moz-transform","");el.css("-ms-transform","");el.css("-o-transform","");el.css("transform","")};Kutility.prototype.rotate=function(el,x){var ct=this.getTransform(el);ct=ct.replace(/matrix\(.*?\)/,"").replace("none","");var t=" rotate("+x+"deg)";this.setTransform(el,ct+t)};Kutility.prototype.scale=function(el,x){var ct=this.getTransform(el);ct=ct.replace(/matrix\(.*?\)/,"").replace("none","");var t=" scale("+x+","+x+")";this.setTransform(el,ct+t)};Kutility.prototype.translate=function(el,x,y){var ct=this.getTransform(el);ct=ct.replace(/matrix\(.*?\)/,"").replace("none","");var t=" translate("+x+", "+y+")";this.setTransform(el,ct+t)};Kutility.prototype.skew=function(el,x,y){var ct=this.getTransform(el);ct=ct.replace(/skew\(.*?\)/,"").replace(/matrix\(.*?\)/,"").replace("none","");var xd=x+"deg";var yd=y+"deg";var t=" skew("+xd+", "+yd+")";this.setTransform(el,ct+t)};Kutility.prototype.warp=function(el,d,x,y){var ct=this.getTransform(el);ct=ct.replace(/matrix\(.*?\)/,"").replace("none","");var r=" rotate("+d+"deg)";var xd=x+"deg";var yd=y+"deg";var s=" skew("+xd+", "+yd+")";this.setTransform(el,ct+r+s)};Kutility.prototype.slaw=function(el,w,x,y){var ct=this.getTransform(el);ct=ct.replace(/matrix\(.*?\)/,"").replace("none","");var s=" scale("+w+","+w+")";var t=" translate("+x+", "+y+")";this.setTransform(el,ct+s+t)};Kutility.prototype.straw=function(el,w,x){var ct=this.getTransform(el);ct=ct.replace(/matrix\(.*?\)/,"").replace("none","");var s=" scale("+w+","+w+")";var r=" rotate("+x+"deg)";this.setTransform(el,ct+s+r)};Kutility.prototype.perp=function(el,x){var p=x+"px";el.css("-webkit-perspective",p);el.css("-moz-perspective",p);el.css("-ms-perspective",p);el.css("-o-perspective",p);el.css("perspective",p)};Kutility.prototype.perpo=function(el,x,y){var p=x+"% "+y+"%";el.css("-webkit-perspective-origin",p);el.css("-moz-perspective-origin",p);el.css("-ms-perspective-origin",p);el.css("-o-perspective-origin",p);el.css("perspective-origin",p)};Kutility.prototype.trans3d=function(el,x,y,z){var ct=this.getTransform(el);ct=ct.replace(/matrix3d\(.*?\)/,"").replace("none","");var t=" translate3d("+x+"px, "+y+"px, "+z+"px)";this.setTransform(el,ct+t)};Kutility.prototype.scale3d=function(el,x){var ct=this.getTransform(el);ct=ct.replace(/matrix3d\(.*?\)/,"").replace("none","");var t=" scale3d("+x+", "+x+", "+x+")";this.setTransform(el,ct+t)};Kutility.prototype.rotate3d=function(el,x,y,z,d){var ct=this.getTransform(el);ct=ct.replace(/matrix3d\(.*?\)/,"").replace("none","");var t=" rotate3d("+x+", "+y+", "+z+", "+d+"deg)";this.setTransform(el,ct+t)};Kutility.prototype.rotate3dx=function(el,d){this.rotate3d(el,1,0,0,d)};Kutility.prototype.rotate3dy=function(el,d){this.rotate3d(el,0,1,0,d)};Kutility.prototype.rotate3dz=function(el,d){this.rotate3d(el,0,0,1,d)};Kutility.prototype.addFilter=function(el,filter){var curFilter=this.getFilter(el);curFilter=curFilter.replace("none","");var newFilter=curFilter+" "+filter;this.setFilter(el,newFilter)};Kutility.prototype.setFilter=function(el,filter){el.css("-webkit-filter",filter);el.css("-moz-filter",filter);el.css("-ms-filter",filter);el.css("-o-filter",filter);el.css("filter",filter)};Kutility.prototype.getFilter=function(el){var possible=["filter","-webkit-filter","-moz-filter","-ms-filter","-o-filter"];for(var i=0;i<possible.length;i++){var f=el.css(possible[i]);if(f==="none"&&i+1<possible.length){var pf=el.css(possible[i+1]);if(pf)continue}return f}};Kutility.prototype.clearFilters=function(el){el.css("-webkit-filter","");el.css("-moz-filter","");el.css("-ms-filter","");el.css("-o-filter","");el.css("filter","")};Kutility.prototype.grayscale=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/grayscale\(.*?\)/,"").replace("none","");var f=" grayscale("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.sepia=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/sepia\(.*?\)/,"").replace("none","");var f=" sepia("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.saturate=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/saturate\(.*?\)/,"").replace("none","");var f=" saturate("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.invert=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/invert\(.*?\)/,"").replace("none","");var f=" invert("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.hutate=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/hue-rotate\(.*?\)/,"").replace("none","");var f=" hue-rotate("+x+"deg)";this.setFilter(el,cf+f)};Kutility.prototype.opace=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/opacity\(.*?\)/,"").replace("none","");var f=" opacity("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.brightness=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/brightness\(.*?\)/,"").replace("none","");var f=" brightness("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.contrast=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/contrast\(.*?\)/,"").replace("none","");var f=" contrast("+x+"%)";this.setFilter(el,cf+f)};Kutility.prototype.blur=function(el,x){var cf=this.getFilter(el);cf=cf.replace(/blur\(.*?\)/,"").replace("none","");var f=" blur("+x+"px)";this.setFilter(el,cf+f)}},{}],42:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0){return parse(val)}else if(type==="number"&&isNaN(val)===false){return options.long?fmtLong(val):fmtShort(val)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse(str){str=String(str);if(str.length>1e4){return}var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}function fmtShort(ms){if(ms>=d){return Math.round(ms/d)+"d"}if(ms>=h){return Math.round(ms/h)+"h"}if(ms>=m){return Math.round(ms/m)+"m"}if(ms>=s){return Math.round(ms/s)+"s"}return ms+"ms"}function fmtLong(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n){return}if(ms<n*1.5){return Math.floor(ms/n)+" "+name}return Math.ceil(ms/n)+" "+name+"s"}},{}],43:[function(require,module,exports){var parents=require("./src/parents/parents");var sentence_parser=require("./src/methods/tokenization/sentence");var tokenize=require("./src/methods/tokenization/tokenize");var ngram=require("./src/methods/tokenization/ngram");var normalize=require("./src/methods/transliteration/unicode_normalisation");var syllables=require("./src/methods/syllables/syllable");var americanize=require("./src/methods/localization/americanize");var britishize=require("./src/methods/localization/britishize");var pos=require("./src/pos");var spot=require("./src/spot");var nlp={noun:parents.noun,adjective:parents.adjective,verb:parents.verb,adverb:parents.adverb,value:parents.value,sentences:sentence_parser,ngram:ngram,tokenize:tokenize,americanize:americanize,britishize:britishize,syllables:syllables,normalize:normalize.normalize,denormalize:normalize.denormalize,pos:pos,spot:spot};if(typeof window==="object"||typeof DedicatedWorkerGlobalScope==="function"){self.nlp=nlp}module.exports=nlp},{"./src/methods/localization/americanize":59,"./src/methods/localization/britishize":60,"./src/methods/syllables/syllable":61,"./src/methods/tokenization/ngram":62,"./src/methods/tokenization/sentence":63,"./src/methods/tokenization/tokenize":64,"./src/methods/transliteration/unicode_normalisation":65,"./src/parents/parents":77,"./src/pos":87,"./src/spot":90}],44:[function(require,module,exports){var multiples=require("./lexicon/multiples");var values=require("./lexicon/values");var demonyms=require("./lexicon/demonyms");var abbreviations=require("./lexicon/abbreviations");var honourifics=require("./lexicon/honourifics");var uncountables=require("./lexicon/uncountables");var firstnames=require("./lexicon/firstnames");var irregular_nouns=require("./lexicon/irregular_nouns");var verbs=require("./lexicon/verbs");var verb_conjugate=require("../parents/verb/conjugate/conjugate");var verb_irregulars=require("../parents/verb/conjugate/verb_irregulars");var phrasal_verbs=require("./lexicon/phrasal_verbs");var adjectives=require("./lexicon/adjectives");var adj_to_adv=require("../parents/adjective/conjugate/to_adverb");var to_superlative=require("../parents/adjective/conjugate/to_superlative");var to_comparative=require("../parents/adjective/conjugate/to_comparative");var convertables=require("../parents/adjective/conjugate/convertables");var main={etc:"FW",ie:"FW",there:"EX",better:"JJR",earlier:"JJR",has:"VB",more:"RBR",sounds:"VBZ"};var compact={CC:["yet","therefore","or","while","nor","whether","though","because","but","for","and","if","however","before","although","how","plus","versus","not"],VBD:["where'd","when'd","how'd","what'd","said","had","been","began","came","did","meant","went"],VBN:["given","known","shown","seen","born"],VBG:["going","being","according","resulting","developing","staining"],CP:["is","will be","are","was","were","am","isn't","ain't","aren't"],DT:["this","any","enough","each","whatever","every","which","these","another","plenty","whichever","neither","an","a","least","own","few","both","those","the","that","various","what","either","much","some","else","no","la","le","les","des","de","du","el"],IN:["until","onto","of","into","out","except","across","by","between","at","down","as","from","around","with","among","upon","amid","to","along","since","about","off","on","within","in","during","per","without","throughout","through","than","via","up","unlike","despite","below","unless","towards","besides","after","whereas","'o","amidst","amongst","apropos","atop","barring","chez","circa","mid","midst","notwithstanding","qua","sans","vis-a-vis","thru","till","versus","without","w/o","o'","a'"],MD:["can","may","could","might","will","ought to","would","must","shall","should","ought","shouldn't","wouldn't","couldn't","mustn't","shan't","shant","lets","who'd","let's"],PP:["mine","something","none","anything","anyone","theirs","himself","ours","his","my","their","yours","your","our","its","nothing","herself","hers","themselves","everything","myself","itself","her","who","whom","whose"],PRP:["it","they","i","them","you","she","me","he","him","ourselves","us","we","thou","il","elle","yourself","'em"],RB:["now","again","already","soon","directly","toward","forever","apart","instead","yes","alone","ago","indeed","ever","quite","perhaps","where","then","here","thus","very","often","once","never","why","when","away","always","sometimes","also","maybe","so","just","well","several","such","randomly","too","rather","abroad","almost","anyway","twice","aside","moreover","anymore","newly","damn","somewhat","somehow","meanwhile","hence","further","furthermore"],UH:["uhh","uh-oh","ugh","sheesh","eww","pff","voila","oy","eep","hurrah","yuck","ow","duh","oh","hmm","yeah","whoa","ooh","whee","ah","bah","gah","yaa","phew","gee","ahem","eek","meh","yahoo","oops","d'oh","psst","argh","grr","nah","shhh","whew","mmm","yay","uh-huh","boo","wow","nope"],NN:["president","dollar","student","patent","funding","morning","banking","ceiling","energy","secretary","purpose","friends","event"]};var i,arr;var keys=Object.keys(compact);var l=keys.length;for(i=0;i<l;i++){arr=compact[keys[i]];for(i2=0;i2<arr.length;i2++){main[arr[i2]]=keys[i]}}keys=Object.keys(values);l=keys.length;for(i=0;i<l;i++){main[keys[i]]="CD"}l=demonyms.length;for(i=0;i<l;i++){main[demonyms[i]]="JJ"}l=abbreviations.length;for(i=0;i<l;i++){main[abbreviations[i]]="NNAB"}l=honourifics.length;for(i=0;i<l;i++){main[honourifics[i]]="NNAB"}l=uncountables.length;for(i=0;i<l;i++){main[uncountables[i]]="NN"}l=irregular_nouns.length;for(i=0;i<l;i++){main[irregular_nouns[i][0]]="NN";main[irregular_nouns[i][1]]="NNS"}Object.keys(firstnames).forEach(function(k){main[k]="NNP"});Object.keys(multiples).forEach(function(k){main[k]=multiples[k]});Object.keys(phrasal_verbs).forEach(function(k){main[k]=phrasal_verbs[k]});var c;l=verbs.length;for(i=0;i<l;i++){c=verb_conjugate(verbs[i]);main[c.infinitive]=main[c.infinitive]||"VBP";main[c.past]=main[c.past]||"VBD";main[c.gerund]=main[c.gerund]||"VBG";main[c.present]=main[c.present]||"VBZ";if(c.doer){main[c.doer]=main[c.doer]||"NNA"}if(c.participle){main[c.participle]=main[c.participle]||"VBN"}}l=verb_irregulars.length;for(i=0;i<l;i++){c=verb_irregulars[i];main[c.infinitive]=main[c.infinitive]||"VBP";main[c.gerund]=main[c.gerund]||"VBG";main[c.past]=main[c.past]||"VBD";main[c.present]=main[c.present]||"VBZ";if(c.doer){main[c.doer]=main[c.doer]||"NNA"}if(c.participle){main[c.future]=main[c.future]||"VB"}}var tmp,j;l=adjectives.length;for(i=0;i<l;i++){main[adjectives[i]]="JJ"}keys=Object.keys(convertables);l=keys.length;for(i=0;i<l;i++){j=keys[i];main[j]="JJ";tmp=adj_to_adv(j);if(tmp&&tmp!==j&&!main[tmp]){main[tmp]=main[tmp]||"RB"}tmp=to_comparative(j);if(tmp&&!tmp.match(/^more ./)&&tmp!==j&&!main[tmp]){main[tmp]=main[tmp]||"JJR"}tmp=to_superlative(j);if(tmp&&!tmp.match(/^most ./)&&tmp!==j&&!main[tmp]){main[tmp]=main[tmp]||"JJS"}}module.exports=main},{"../parents/adjective/conjugate/convertables":66,"../parents/adjective/conjugate/to_adverb":67,"../parents/adjective/conjugate/to_comparative":68,"../parents/adjective/conjugate/to_superlative":70,"../parents/verb/conjugate/conjugate":81,"../parents/verb/conjugate/verb_irregulars":84,"./lexicon/abbreviations":45,"./lexicon/adjectives":46,"./lexicon/demonyms":47,"./lexicon/firstnames":48,"./lexicon/honourifics":49,"./lexicon/irregular_nouns":50,"./lexicon/multiples":51,"./lexicon/phrasal_verbs":52,"./lexicon/uncountables":53,"./lexicon/values":54,"./lexicon/verbs":55}],45:[function(require,module,exports){var honourifics=require("./honourifics");var main=["arc","al","ave","blvd","cl","ct","cres","exp","rd","st","dist","mt","fy","hwy","pd","pl","plz","tce","llb","md","bl","ma","ba","lit","ala","ariz","ark","cal","calif","col","colo","conn","del","fed","fla","fl","ga","ida","ind","ia","la","kan","kans","ken","ky","la","md","mich","minn","mont","neb","nebr","nev","okla","penna","penn","pa","dak","tenn","tex","ut","vt","va","wash","wis","wisc","wy","wyo","usafa","alta","ont","que","sask","yuk","dept","univ","assn","bros","inc","ltd","co","corp","yahoo","joomla","jeopardy"];main=main.concat(honourifics);module.exports=main},{"./honourifics":49}],46:[function(require,module,exports){module.exports=["colonial","moody","literal","actual","probable","apparent","usual","aberrant","ablaze","able","absolute","aboard","abrupt","absent","absorbing","abundant","accurate","adult","afraid","agonizing","ahead","aloof","amazing","arbitrary","arrogant","asleep","astonishing","average","awake","aware","awkward","back","bad","bankrupt","bawdy","beneficial","bent","best","better","bizarre","bloody","bouncy","brilliant","broken","burly","busy","cagey","careful","caring","certain","chief","chilly","civil","clever","closed","cloudy","colossal","commercial","common","complete","complex","concerned","concrete","congruent","constant","cooing","correct","cowardly","craven","cuddly","daily","damaged","damaging","dapper","dashing","deadpan","deeply","defiant","degenerate","delicate","delightful","desperate","determined","didactic","difficult","discreet","done","double","doubtful","downtown","dreary","east","eastern","elderly","elegant","elfin","elite","eminent","encouraging","entire","erect","ethereal","exact","expert","extra","exuberant","exultant","false","fancy","faulty","female","fertile","fierce ","financial","first","fit","fixed","flagrant","foamy","foolish","foregoing","foreign","former","fortunate","frantic","freezing","frequent","fretful","friendly","fun","furry","future","gainful","gaudy","giant","giddy","gigantic","gleaming","global","gold","gone","good","goofy","graceful","grateful","gratis","gray","grey","groovy","gross","guarded","half","handy","hanging","hateful","heady","heavenly","hellish","helpful","hesitant","highfalutin","homely","honest","huge","humdrum","hurried","hurt","icy","ignorant","ill","illegal","immediate","immense","imminent","impartial","imperfect","imported","initial","innate","inner","inside","irate","jolly","juicy","junior","juvenile","kaput","kindly","knowing","labored","languid","latter","learned","left","legal","lethal","level","lewd","likely","literate","lively","living","lonely","longing","loutish","lovely","loving","lowly","luxuriant","lying","macabre","madly","magenta","main","major","makeshift","male","mammoth","measly","meaty","medium","mere","middle","miniature","minor","miscreant","mobile","moldy","mute","naive","nearby","necessary","neighborly","next","nimble","nonchalant","nondescript","nonstop","north","nosy","obeisant","obese","obscene","observant","obsolete","offbeat","official","ok","open","opposite","organic","outdoor","outer","outgoing","oval","over","overall","overt","overweight","overwrought","painful","past","peaceful","perfect","petite","picayune","placid","plant","pleasant","polite","potential","pregnant","premium","present","pricey","prickly","primary","prior","private","profuse","proper","public","pumped","puny","quack","quaint","quickest","rabid","racial","ready","real","rebel","recondite","redundant","relevant","remote","resolute","resonant","right","rightful","ritzy","robust","romantic","roomy","rough","royal","salty","same","scary","scientific","screeching","second","secret","secure","sedate","seemly","selfish","senior","separate","severe","shiny","shocking","shut","shy","sick","significant","silly","sincere","single","skinny","slight","slimy","smelly","snobbish","social","somber","sordid","sorry","southern","spare","special","specific","spicy","splendid","squeamish","standard","standing","steadfast","steady","stereotyped","still","striped","stupid","sturdy","subdued","subsequent","substantial","sudden","super","superb","superficial","supreme","sure","taboo","tan","tasteful","tawdry","telling","temporary","terrific","tested","thoughtful","tidy","tiny","top","torpid","tranquil","trite","ugly","ultra","unbecoming","understood","uneven","unfair","unlikely","unruly","unsightly","untidy","unwritten","upbeat","upper","uppity","upset","upstairs","uptight","used","useful","utter","uttermost","vagabond","vanilla","various","vengeful","verdant","violet","volatile","wanting","wary","wasteful","weary","weekly","welcome","western","whole","wholesale","wiry","wistful","womanly","wooden","woozy","wound","wrong","wry","zany","sacred","unknown","detailed","ongoing","prominent","permanent","diverse","partial","moderate","contemporary","intense","widespread","ultimate","ideal","adequate","sophisticated","naked","dominant","precise","intact","adverse","genuine","subtle","universal","resistant","routine","distant","unexpected","soviet","blind","artificial","mild","legitimate","unpublished","superior","intermediate","everyday","dumb","excess","sexy","fake","monthly","premature","sheer","generic","insane","contrary","twin","upcoming","bottom","costly","indirect","sole","unrelated","hispanic","improper","underground","legendary","reluctant","beloved","inappropriate","corrupt","irrelevant","justified","obscure","profound","hostile","influential","inadequate","abstract","timely","authentic","bold","intimate","straightforward","rival","right-wing","racist","symbolic","unprecedented","loyal","talented","troubled","noble","instant","incorrect","dense","blond","deliberate","blank","rear","feminine","apt","stark","alcoholic","teenage","vibrant","humble","vain","covert","bland","trendy","foul","populist","alarming","hooked","wicked","deaf","left-wing","lousy","malignant","stylish","upscale","hourly","refreshing","cozy","slick","dire","yearly","inbred","part-time","finite","backwards","nightly","unauthorized","cheesy","indoor","surreal","bald","masculine","shady","spirited","eerie","horrific","smug","stern","hefty","savvy","bogus","elaborate","gloomy","pristine","extravagant","serene","advanced","perverse","devout","crisp","rosy","slender","melancholy","faux","phony","danish","lofty","nuanced","lax","adept","barren","shameful","sleek","solemn","vacant","dishonest","brisk","fluent","insecure","humid","menacing","moot","soothing","self-loathing","far-reaching","harrowing","scathing","perplexing","calming","unconvincing","unsuspecting","unassuming","surprising","unappealing","vexing","unending","easygoing","appetizing","disgruntled","retarded","undecided","unregulated","unsupervised","unrecognized","crazed","distressed","jagged","paralleled","cramped","warped","antiquated","fabled","deranged","diseased","ragged","intoxicated","hallowed","crowded","ghastly","disorderly","saintly","wily","sly","sprightly","ghostly","oily","hilly","grisly","earthly","friendly","unwieldy","many","most","last","expected","far","due","divine","all","together","only","outside","multiple","appropriate","evil","favorite","limited","random","republican","okay","essential","secondary","gay","south","pro","northern","urban","acute","prime","arab","overnight","mixed","crucial","behind","above","beyond","against","under","other","less"]},{}],47:[function(require,module,exports){module.exports=["afghan","albanian","algerian","argentine","armenian","australian","aussie","austrian","bangladeshi","belgian","bolivian","bosnian","brazilian","bulgarian","cambodian","canadian","chilean","chinese","colombian","croat","cuban","czech","dominican","egyptian","british","estonian","ethiopian","finnish","french","gambian","georgian","german","greek","haitian","hungarian","indian","indonesian","iranian","iraqi","irish","israeli","italian","jamaican","japanese","jordanian","kenyan","korean","kuwaiti","latvian","lebanese","liberian","libyan","lithuanian","macedonian","malaysian","mexican","mongolian","moroccan","dutch","nicaraguan","nigerian","norwegian","omani","pakistani","palestinian","filipino","polish","portuguese","qatari","romanian","russian","rwandan","samoan","saudi","scottish","senegalese","serbian","singaporean","slovak","somali","sudanese","swedish","swiss","syrian","taiwanese","thai","tunisian","ugandan","ukrainian","american","hindi","spanish","venezuelan","vietnamese","welsh","african","european","asian","californian"]},{}],48:[function(require,module,exports){var main=[];var male_names={will:"iam,ie,ard,is,iams",fred:",erick,die,rick,dy",marc:"us,,o,os,el",darr:"ell,yl,en,el,in",fran:"k,cis,cisco,klin,kie",terr:"y,ance,ence,ell",rand:"y,all,olph,al",brad:"ley,,ford,y",jeff:"rey,,ery,ry",john:",ny,nie,athan",greg:"ory,,g,orio",mar:"k,tin,vin,io,shall,ty,lon,lin",car:"l,los,lton,roll,y,ey",ken:"neth,,t,ny,dall,drick",har:"old,ry,vey,ley,lan,rison",ste:"ven,phen,ve,wart,phan,rling",jer:"ry,emy,ome,emiah,maine,ald",mic:"hael,heal,ah,key,hel",dar:"yl,in,nell,win,ius",dan:"iel,ny,,e",wil:"bur,son,bert,fred,fredo",ric:"hard,ky,ardo,k,key",cli:"fford,nton,fton,nt,ff",cla:"rence,ude,yton,rk,y",ben:"jamin,,nie,ny,ito",rod:"ney,erick,olfo,ger,",rob:"ert,erto,bie,",gar:"y,ry,rett,land",sam:"uel,,my,mie",and:"rew,re,y,res",jos:"eph,e,hua,h",joe:",l,y,sph",leo:"nard,n,,nardo",tom:",my,as,mie",bry:"an,ant,ce,on",ant:"hony,onio,oine,on",jac:"k,ob,kson",cha:"rles,d,rlie,se",sha:"wn,ne,un",bre:"nt,tt,ndan,t",jes:"se,us,s",al:"bert,an,len,fred,exander,ex,vin,lan,fredo,berto,ejandro,fonso,ton,,onzo,i,varo",ro:"nald,ger,y,nnie,land,n,ss,osevelt,gelio,lando,man,cky,yce,scoe,ry",de:"nnis,rek,an,rrick,lbert,vin,wey,xter,wayne,metrius,nis,smond",ja:"mes,son,y,red,vier,ke,sper,mal,rrod",el:"mer,lis,bert,ias,ijah,don,i,ton,liot,liott,vin,wood",ma:"tthew,nuel,urice,thew,x,tt,lcolm,ck,son",do:"nald,uglas,n,nnie,ug,minic,yle,mingo,minick",er:"ic,nest,ik,nesto,ick,vin,nie,win",ra:"ymond,lph,y,mon,fael,ul,miro,phael",ed:"ward,win,die,gar,uardo,,mund,mond",co:"rey,ry,dy,lin,nrad,rnelius",le:"roy,wis,ster,land,vi",lo:"uis,nnie,renzo,ren,well,uie,u,gan",da:"vid,le,ve,mon,llas,mian,mien",jo:"nathan,n,rge,rdan,nathon,aquin",ru:"ssell,ben,dolph,dy,fus,ssel,sty",ke:"vin,ith,lvin,rmit",ar:"thur,nold,mando,turo,chie,mand",re:"ginald,x,ynaldo,uben,ggie",ge:"orge,rald,ne,rard,offrey,rardo",la:"rry,wrence,nce,urence,mar,mont",mo:"rris,ses,nte,ises,nty",ju:"an,stin,lio,lian,lius,nior",pe:"ter,dro,rry,te,rcy",tr:"avis,oy,evor,ent",he:"nry,rbert,rman,ctor,ath",no:"rman,el,ah,lan,rbert",em:"anuel,il,ilio,mett,manuel",wa:"lter,yne,rren,llace,de",mi:"ke,guel,lton,tchell,les",sa:"lvador,lvatore,ntiago,ul,ntos",ch:"ristopher,ris,ester,ristian,uck",pa:"ul,trick,blo,t",st:"anley,uart,an",hu:"gh,bert,go,mberto",br:"ian,uce,andon,ain",vi:"ctor,ncent,rgil,cente",ca:"lvin,meron,leb",gu:"y,illermo,stavo",lu:"is,ther,ke,cas",gr:"ant,ady,over,aham",ne:"il,lson,al,d",t:"homas,imothy,odd,ony,heodore,im,yler,ed,yrone,aylor,erence,immy,oby,eddy,yson",s:"cott,ean,idney,ergio,eth,pencer,herman,ylvester,imon,heldon,cotty,olomon",r:"yan",n:"icholas,athan,athaniel,ick,icolas",a:"dam,aron,drian,ustin,ngelo,braham,mos,bel,gustin,ugust,dolfo",b:"illy,obby,arry,ernard,ill,ob,yron,lake,ert,oyd,illie,laine,art,uddy,urton",e:"ugene,arl,verett,nrique,van,arnest,frain,than,steban",h:"oward,omer,orace,ans,al",p:"hillip,hilip,reston,hil,ierre",c:"raig,urtis,lyde,ecil,esar,edric,leveland,urt",j:"immy,im,immie",g:"lenn,ordon,len,ilbert,abriel,ilberto",m:"elvin,yron,erle,urray",k:"yle,arl,urt,irk,ristopher",o:"scar,tis,liver,rlando,mar,wen,rville,tto",l:"loyd,yle,ionel",f:"loyd,ernando,elix,elipe,orrest,abian,idel",w:"esley,endell,m,oodrow,inston",d:"ustin,uane,wayne,wight,rew,ylan",z:"achary",v:"ernon,an,ance",i:"an,van,saac,ra,rving,smael,gnacio,rvin",q:"uentin,uinton",x:"avier"};var female_names={mari:"a,e,lyn,an,anne,na,ssa,bel,sa,sol,tza",kris:"ten,tin,tina,ti,tine,ty,ta,tie",jean:"ette,ne,nette,nie,ine,nine",chri:"stine,stina,sty,stie,sta,sti",marg:"aret,ie,arita,uerite,ret,o",ange:"la,lica,lina,lia,line",fran:"ces,cine,cisca",kath:"leen,erine,y,ryn,arine",sher:"ry,ri,yl,i,rie",caro:"l,lyn,line,le,lina",dian:"e,a,ne,na",jenn:"ifer,ie,y,a",luci:"lle,a,nda,le",kell:"y,i,ey,ie",rosa:",lie,lind",jani:"ce,e,s,ne",stac:"y,ey,ie,i",shel:"ly,ley,ia",laur:"a,en,ie,el",trac:"y,ey,i,ie",jane:"t,,lle,tte",bett:"y,ie,e,ye",rose:"mary,marie,tta",joan:",ne,n,na",mar:"y,tha,jorie,cia,lene,sha,yann,cella,ta,la,cy,tina",lor:"i,raine,etta,a,ena,ene,na,ie",sha:"ron,nnon,ri,wna,nna,na,una",dor:"othy,is,a,een,thy,othea",cla:"ra,udia,ire,rice,udette",eli:"zabeth,sa,sabeth,se,za",kar:"en,la,a,i,in",tam:"my,ara,i,mie,ika",ann:"a,,e,ie,ette",car:"men,rie,la,a,mela",mel:"issa,anie,inda",ali:"ce,cia,son,sha,sa",bri:"ttany,dget,ttney,dgette",lyn:"n,da,ne,ette",del:"ores,la,ia,oris",ter:"esa,ri,i",son:"ia,ya,ja,dra",deb:"orah,ra,bie,ora",jac:"queline,kie,quelyn,lyn",lat:"oya,asha,onya,isha",che:"ryl,lsea,ri,rie",vic:"toria,ki,kie,ky",sus:"an,ie,anne,ana",rob:"erta,yn",est:"her,elle,ella,er",lea:"h,,nne,nn",lil:"lian,lie,a,y",ma:"ureen,ttie,xine,bel,e,deline,ggie,mie,ble,ndy,ude,yra,nuela,vis,gdalena,tilda",jo:"yce,sephine,,di,dy,hanna,sefina,sie,celyn,lene,ni,die",be:"verly,rtha,atrice,rnice,th,ssie,cky,linda,ulah,rnadette,thany,tsy,atriz",ca:"therine,thy,ssandra,ndace,ndice,mille,itlin,ssie,thleen,llie",le:"slie,na,ona,ticia,igh,la,nora,ola,sley,ila",el:"aine,len,eanor,sie,la,ena,oise,vira,sa,va,ma",sa:"ndra,rah,ra,lly,mantha,brina,ndy,die,llie",mi:"chelle,ldred,chele,nnie,riam,sty,ndy,randa,llie",co:"nnie,lleen,nstance,urtney,ra,rinne,nsuelo,rnelia",ju:"lie,dith,dy,lia,anita,ana,stine",da:"wn,nielle,rlene,na,isy,rla,phne",re:"becca,nee,na,bekah,ba",al:"ma,lison,berta,exandra,yssa,ta",ra:"chel,mona,chael,quel,chelle",an:"drea,ita,a,gie,toinette,tonia",ge:"raldine,rtrude,orgia,nevieve,orgina",de:"nise,anna,siree,na,ana,e",ja:"smine,na,yne",lu:"cy,z,la,pe,ella,isa",je:"ssica,nifer,well,ri",ad:"a,rienne,die,ele,riana,eline",pa:"tricia,mela,ula,uline,tsy,m,tty,ulette,tti,trice,trica,ige",ke:"ndra,rri,isha,ri",mo:"nica,lly,nique,na,llie",lo:"uise,is,la",he:"len,ather,idi,nrietta,lene,lena",me:"gan,rcedes,redith,ghan,agan",wi:"lma,lla,nnie",ga:"il,yle,briela,brielle,le",er:"in,ica,ika,ma,nestine",ce:"cilia,lia,celia,leste,cile",ka:"tie,y,trina,yla,te",ol:"ga,ivia,lie,a",li:"nda,sa,ndsay,ndsey,zzie",na:"ncy,talie,omi,tasha,dine",la:"verne,na,donna,ra",vi:"rginia,vian,ola",ha:"rriet,nnah",pe:"ggy,arl,nny,tra",br:"enda,andi,ooke",ki:"mberly,m,mberley,rsten",au:"drey,tumn,dra",bo:"nnie,bbie,nita,bbi",do:"nna,lores,lly,minique",gl:"oria,adys,enda,enna",tr:"icia,ina,isha,udy",ta:"ra,nya,sha,bitha",ro:"sie,xanne,chelle,nda",am:"y,anda,ber,elia",fa:"ye,nnie,y",ni:"cole,na,chole,kki",ve:"ronica,ra,lma,rna",gr:"ace,etchen,aciela,acie",b:"arbara,lanca,arbra,ianca",r:"uth,ita,honda",s:"hirley,tephanie,ylvia,heila,uzanne,ue,tella,ophia,ilvia,ophie,tefanie,heena,ummer,elma,ocorro,ybil,imone",c:"ynthia,rystal,indy,harlene,ristina,leo",e:"velyn,mily,dna,dith,thel,mma,va,ileen,unice,ula,ssie,ffie,tta,ugenia",a:"shley,pril,gnes,rlene,imee,bigail,ida,bby,ileen",t:"heresa,ina,iffany,helma,onya,oni,herese,onia",i:"rene,da,rma,sabel,nez,ngrid,va,mogene,sabelle",w:"anda,endy,hitney",p:"hyllis,riscilla,olly",n:"orma,ellie,ora,ettie,ell",f:"lorence,elicia,lora,reda,ern,rieda",v:"alerie,anessa",j:"ill,illian",y:"vonne,olanda,vette",g:"ina,wendolyn,wen,oldie",l:"ydia",m:"yrtle,yra,uriel,yrna",h:"ilda",o:"pal,ra,felia",k:"rystal",d:"ixie,ina",u:"rsula"};var ambiguous=["casey","jamie","lee","jaime","jessie","morgan","rene","robin","devon","kerry","alexis","guadalupe","blair","kasey","jean","marion","aubrey","shelby","jan","shea","jade","kenyatta","kelsey","shay","lashawn","trinity","regan","jammie","cassidy","cheyenne","reagan","shiloh","marlo","andra","devan","rosario","lee"];var i,arr,i2,l,keys;keys=Object.keys(male_names);l=keys.length;for(i=0;i<l;i++){arr=male_names[keys[i]].split(",");for(i2=0;i2<arr.length;i2++){main[keys[i]+arr[i2]]="m"}}keys=Object.keys(female_names);l=keys.length;for(i=0;i<l;i++){arr=female_names[keys[i]].split(",");for(i2=0;i2<arr.length;i2++){main[keys[i]+arr[i2]]="f"}}l=ambiguous.length;for(i=0;i<l;i+=1){main[ambiguous[i]]="a"}module.exports=main},{}],49:[function(require,module,exports){var main=["jr","mr","mrs","ms","dr","prof","sr","sen","corp","rep","gov","atty","supt","det","rev","col","gen","lt","cmdr","adm","capt","sgt","cpl","maj","miss","misses","mister","sir","esq","mstr","phd","adj","adv","asst","bldg","brig","comdr","hon","messrs","mlle","mme","op","ord","pvt","reps","res","sens","sfc","surg"];module.exports=main},{}],50:[function(require,module,exports){var main=[["child","_ren"],["person","people"],["leaf","leaves"],["database","_s"],["quiz","_zes"],["child","_ren"],["stomach","_s"],["sex","_es"],["move","_s"],["shoe","_s"],["goose","geese"],["phenomenon","phenomena"],["barracks","_"],["deer","_"],["syllabus","syllabi"],["index","indices"],["appendix","appendices"],["criterion","criteria"],["man","men"],["sex","_es"],["rodeo","_s"],["epoch","_s"],["zero","_s"],["avocado","_s"],["halo","_s"],["tornado","_s"],["tuxedo","_s"],["sombrero","_s"],["addendum","addenda"],["alga","_e"],["alumna","_e"],["alumnus","alumni"],["bacillus","bacilli"],["cactus","cacti"],["beau","_x"],["chteau","_x"],["chateau","_x"],["tableau","_x"],["corpus","corpora"],["curriculum","curricula"],["echo","_es"],["embargo","_es"],["foot","feet"],["genus","genera"],["hippopotamus","hippopotami"],["larva","_e"],["libretto","libretti"],["loaf","loaves"],["matrix","matrices"],["memorandum","memoranda"],["mosquito","_es"],["opus","opera"],["ovum","ova"],["ox","_en"],["radius","radii"],["referendum","referenda"],["thief","thieves"],["tooth","teeth"]];main=main.map(function(a){a[1]=a[1].replace("_",a[0]);return a});module.exports=main},{}],51:[function(require,module,exports){module.exports={"of course":"RB","at least":"RB","no longer":"RB","sort of":"RB","at first":"RB","once again":"RB","once more":"RB","up to":"RB","by now":"RB","all but":"RB","just about":"RB","on board":"JJ","a lot":"RB","by far":"RB","at best":"RB","at large":"RB","for good":"RB","vice versa":"JJ","en route":"JJ","for sure":"RB","upside down":"JJ","at most":"RB","per se":"RB","at worst":"RB","upwards of":"RB","en masse":"RB","point blank":"RB","up front":"JJ","in situ":"JJ","in vitro":"JJ","ad hoc":"JJ","de facto":"JJ","ad infinitum":"JJ","ad nauseam":"RB","for keeps":"JJ","a priori":"FW","et cetera":"FW","off guard":"JJ","spot on":"JJ","ipso facto":"JJ","not withstanding":"RB","de jure":"RB","a la":"IN","ad hominem":"NN","par excellence":"RB","de trop":"RB","a posteriori":"RB","fed up":"JJ","brand new":"JJ","old fashioned":"JJ","bona fide":"JJ","well off":"JJ","far off":"JJ","straight forward":"JJ","hard up":"JJ","sui generis":"JJ","en suite":"JJ","avant garde":"JJ","sans serif":"JJ","gung ho":"JJ","super duper":"JJ","new york":"NN","new england":"NN","new hampshire":"NN","new delhi":"NN","new jersey":"NN","new mexico":"NN","united states":"NN","united kingdom":"NN","great britain":"NN","head start":"NN"}},{}],52:[function(require,module,exports){var verb_conjugate=require("../../parents/verb/conjugate/conjugate");var main=["be onto","fall behind","fall through","fool with","get across","get along","get at","give way","hear from","hear of","lash into","make do","run across","set upon","take aback","keep from"];var opposites={away:"back",in:"out",on:"off",over:"under",together:"apart",up:"down"};var symmetric={away:"blow,bounce,bring,call,come,cut,drop,fire,get,give,go,keep,pass,put,run,send,shoot,switch,take,tie,throw",in:"bang,barge,bash,beat,block,book,box,break,bring,burn,butt,carve,cash,check,come,cross,drop,fall,fence,fill,give,grow,hand,hang,head,jack,keep,leave,let,lock,log,move,opt,pack,peel,pull,put,rain,reach,ring,rub,send,set,settle,shut,sign,smash,snow,strike,take,try,turn,type,warm,wave,wean,wear,wheel",on:"add,call,carry,catch,count,feed,get,give,go,grind,head,hold,keep,lay,log,pass,pop,power,put,send,show,snap,switch,take,tell,try,turn,wait",over:"come,go,look,read,run,talk",together:"come,pull,put",up:"add,back,beat,bend,blow,boil,bottle,break,bring,buckle,bundle,call,carve,clean,cut,dress,fill,flag,fold,get,give,grind,grow,hang,hold,keep,let,load,lock,look,man,mark,melt,move,pack,pin,pipe,plump,pop,power,pull,put,rub,scale,scrape,send,set,settle,shake,show,sit,slow,smash,square,stand,strike,take,tear,tie,turn,use,wash,wind"};Object.keys(symmetric).forEach(function(k){symmetric[k].split(",").forEach(function(s){main.push(s+" "+k);main.push(s+" "+opposites[k])})});var asymmetric={about:"bring,fool,gad,go,root",after:"go,look,take",ahead:"get,go,press",along:"bring,move",apart:"fall,take",around:"ask,boss,bring,call,come,fool,get,horse,joke,lie,mess,play",away:"back,carry,file,frighten,hide,wash",back:"fall,fight,hit,hold,look,pay,stand,think",by:"drop,get,go,stop,swear,swing,tick,zip",down:"bog,calm,fall,hand,hunker,jot,knock,lie,narrow,note,pat,pour,run,tone,trickle,wear",for:"fend,file,gun,hanker,root,shoot",forth:"bring,come",forward:"come,look",in:"cave,chip,hone,jump,key,pencil,plug,rein,shade,sleep,stop,suck,tie,trade,tuck,usher,weigh,zero",into:"look,run",it:"go,have",off:"auction,be,beat,blast,block,brush,burn,buzz,cast,cool,drop,end,face,fall,fend,frighten,goof,jack,kick,knock,laugh,level,live,make,mouth,nod,pair,pay,peel,read,reel,ring,rip,round,sail,shave,shoot,sleep,slice,split,square,stave,stop,storm,strike,tear,tee,tick,tip,top,walk,work,write",on:"bank,bargain,egg,frown,hit,latch,pile,prattle,press,spring,spur,tack,urge,yammer",out:"act,ask,back,bail,bear,black,blank,bleed,blow,blurt,branch,buy,cancel,cut,eat,edge,farm,figure,find,fill,find,fish,fizzle,flake,flame,flare,flesh,flip,geek,get,help,hide,hold,iron,knock,lash,level,listen,lose,luck,make,max,miss,nerd,pan,pass,pick,pig,point,print,psych,rat,read,rent,root,rule,run,scout,see,sell,shout,single,sit,smoke,sort,spell,splash,stamp,start,storm,straighten,suss,time,tire,top,trip,trot,wash,watch,weird,whip,wimp,wipe,work,zone,zonk",over:"bend,bubble,do,fall,get,gloss,hold,keel,mull,pore,sleep,spill,think,tide,tip",round:"get,go",through:"go,run",to:"keep,see",up:"act,beef,board,bone,boot,brighten,build,buy,catch,cheer,cook,end,eye,face,fatten,feel,fess,finish,fire,firm,flame,flare,free,freeze,freshen,fry,fuel,gang,gear,goof,hack,ham,heat,hit,hole,hush,jazz,juice,lap,light,lighten,line,link,listen,live,loosen,make,mash,measure,mess,mix,mock,mop,muddle,open,own,pair,patch,pick,prop,psych,read,rough,rustle,save,shack,sign,size,slice,slip,snap,sober,spark,split,spruce,stack,start,stay,stir,stitch,straighten,string,suck,suit,sum,team,tee,think,tidy,tighten,toss,trade,trip,type,vacuum,wait,wake,warm,weigh,whip,wire,wise,word,write,zip"};Object.keys(asymmetric).forEach(function(k){asymmetric[k].split(",").forEach(function(s){main.push(s+" "+k)})});main=main.reduce(function(h,s){h[s]="VBP";return h},{});var tags={present:"VB",past:"VBD",future:"VBF",gerund:"VBG",infinitive:"VBP"};var cache={};var split,verb,particle,phrasal;Object.keys(main).forEach(function(s){split=s.split(" ");verb=split[0];particle=split[1];if(cache[verb]===undefined){cache[verb]=verb_conjugate(verb)}Object.keys(cache[verb]).forEach(function(k){phrasal=cache[verb][k]+" "+particle;main[phrasal]=tags[k]})});module.exports=main},{"../../parents/verb/conjugate/conjugate":81}],53:[function(require,module,exports){module.exports=["aircraft","bass","bison","fowl","halibut","moose","salmon","spacecraft","tuna","trout","advice","information","knowledge","trouble","enjoyment","fun","recreation","relaxation","meat","rice","bread","cake","coffee","ice","water","oil","grass","hair","fruit","wildlife","equipment","machinery","furniture","mail","luggage","jewelry","clothing","money","mathematics","economics","physics","civics","ethics","gymnastics","mumps","measles","news","tennis","baggage","currency","soap","toothpaste","food","sugar","butter","flour","research","leather","wool","wood","coal","weather","homework","cotton","silk","patience","impatience","vinegar","art","beef","blood","cash","chaos","cheese","chewing","conduct","confusion","education","electricity","entertainment","fiction","forgiveness","gold","gossip","ground","happiness","history","honey","hospitality","importance","justice","laughter","leisure","lightning","literature","luck","melancholy","milk","mist","music","noise","oxygen","paper","pay","peace","peanut","pepper","petrol","plastic","pork","power","pressure","rain","recognition","sadness","safety","salt","sand","scenery","shopping","silver","snow","softness","space","speed","steam","sunshine","tea","thunder","time","traffic","trousers","violence","warmth","wine","steel","soccer","hockey","golf","fish","gum","liquid","series","sheep","species","fahrenheit","celcius","kelvin","hertz"]},{}],54:[function(require,module,exports){module.exports=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety","hundred","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion","january","february","april","june","july","august","september","october","november","december","jan","feb","mar","apr","jun","jul","aug","sep","oct","nov","dec","sept","sep","monday","tuesday","wednesday","thursday","friday","saturday","sunday"].reduce(function(h,s){h[s]="CD";return h},{})},{}],55:[function(require,module,exports){module.exports=["collapse","stake","forsee","suck","answer","argue","tend","examine","depend","form","figure","mind","surround","suspect","reflect","wonder","hope","end","thank","file","regard","report","imagine","consider","ensure","cause","work","enter","stop","defeat","surge","launch","turn","like","control","relate","remember","join","listen","train","spring","enjoy","fail","recognize","obtain","learn","fill","announce","prevent","achieve","realize","involve","remove","aid","visit","test","prepare","ask","carry","suppose","determine","raise","love","use","pull","improve","contain","offer","talk","pick","care","express","remain","operate","close","add","mention","support","decide","walk","vary","demand","describe","agree","happen","allow","suffer","study","press","watch","seem","occur","contribute","claim","compare","apply","direct","discuss","indicate","require","change","fix","reach","prove","expect","exist","play","permit","kill","charge","increase","believe","create","continue","live","help","represent","edit","serve","appear","cover","maintain","start","stay","move","extend","design","supply","suggest","want","approach","call","include","try","receive","save","discover","marry","need","establish","keep","assume","attend","unite","explain","publish","accept","settle","reduce","do","look","interact","concern","labor","return","select","die","provide","seek","wish","finish","follow","disagree","produce","attack","attempt","brake","brush","burn","bang","bomb","budget","comfort","cook","copy","cough","crush","cry","check","claw","clip","combine","damage","desire","doubt","drain","dance","decrease","defect","deposit","drift","dip","dive","divorce","dream","exchange","envy","exert","exercise","export","fold","flood","focus","forecast","fracture","grip","guide","guard","guarantee","guess","hate","heat","handle","hire","host","hunt","hurry","import","judge","jump","jam","kick","kiss","knock","laugh","lift","lock","lecture","link","load","loan","lump","melt","message","murder","neglect","overlap","overtake","overuse","print","protest","pump","push","post","progress","promise","purchase","regret","request","reward","roll","rub","rent","repair","sail","scale","screw","shock","sleep","slip","smash","smell","smoke","sneeze","snow","surprise","scratch","search","share","shave","spit","splash","stain","stress","switch","taste","touch","trade","trick","twist","trap","travel","tune","undergo","undo","uplift","vote","wash","wave","whistle","wreck","yawn","betray","restrict","perform","worry","point","activate","fear","plan","note","face","predict","differ","deserve","torture","recall","count","admit","insist","lack","pass","belong","complain","constitute","rely","refuse","range","cite","flash","arrive","reveal","consist","observe","notice","trust","display","view","stare","acknowledge","owe","gaze","treat","account","gather","address","confirm","estimate","manage","participate","sneak","drop","mirror","experience","strive","arch","dislike","favor","earn","emphasize","match","question","emerge","encourage","matter","name","head","line","slam","list","warn","ignore","resemble","feature","place","reverse","accuse","spoil","retain","survive","praise","function","please","date","remind","deliver","echo","engage","deny","yield","center","gain","anticipate","reason","side","thrive","defy","dodge","enable","applaud","bear","persist","pose","reject","attract","await","inhibit","declare","process","risk","urge","value","block","confront","credit","cross","amuse","dare","resent","smile","gloss","threaten","collect","depict","dismiss","submit","benefit","step","deem","limit","sense","issue","embody","force","govern","replace","bother","cater","adopt","empower","outweigh","alter","enrich","influence","prohibit","pursue","warrant","convey","approve","reserve","rest","strain","wander","adjust","dress","market","mingle","disapprove","evaluate","flow","inhabit","pop","rule","depart","roam","assert","disappear","envision","pause","afford","challenge","grab","grumble","house","portray","revel","base","conduct","review","stem","crave","mark","store","target","unlock","weigh","resist","drag","pour","reckon","assign","cling","rank","attach","decline","destroy","interfere","paint","skip","sprinkle","wither","allege","retire","score","monitor","expand","honor","pack","assist","float","appeal","stretch","undermine","assemble","boast","bounce","grasp","install","borrow","crack","elect","shout","contrast","overcome","relax","relent","strengthen","conform","dump","pile","scare","relive","resort","rush","boost","cease","command","excel","plug","plunge","proclaim","discourage","endure","ruin","stumble","abandon","cheat","convince","merge","convert","harm","multiply","overwhelm","chew","invent","bury","wipe","added","took","define","goes","measure","enhance","distinguish","avoid","don't","won't","what's"]},{}],56:[function(require,module,exports){module.exports={VB:{name:"verb, generic",parent:"verb",tag:"VB"},VBD:{name:"past-tense verb",parent:"verb",tense:"past",tag:"VBD"},VBN:{name:"past-participle verb",parent:"verb",tense:"past",tag:"VBN"},VBP:{name:"infinitive verb",parent:"verb",tense:"present",tag:"VBP"},VBF:{name:"future-tense verb",parent:"verb",tense:"future",tag:"VBF"},VBZ:{name:"present-tense verb",tense:"present",parent:"verb",tag:"VBZ"},CP:{name:"copula",parent:"verb",tag:"CP"},VBG:{name:"gerund verb",parent:"verb",tag:"VBG"},JJ:{name:"adjective, generic",parent:"adjective",tag:"JJ"},JJR:{name:"comparative adjective",parent:"adjective",tag:"JJR"},JJS:{name:"superlative adjective",parent:"adjective",tag:"JJS"},RB:{name:"adverb",parent:"adverb",tag:"RB"},RBR:{name:"comparative adverb",parent:"adverb",tag:"RBR"},RBS:{name:"superlative adverb",parent:"adverb",tag:"RBS"},NN:{name:"noun, generic",parent:"noun",tag:"NN"},NNP:{name:"singular proper noun",parent:"noun",tag:"NNP"},NNA:{name:"noun, active",parent:"noun",tag:"NNA"},NNPA:{name:"noun, acronym",parent:"noun",tag:"NNPA"},NNPS:{name:"plural proper noun",parent:"noun",tag:"NNPS"},NNAB:{name:"noun, abbreviation",parent:"noun",tag:"NNAB"},NNS:{name:"plural noun",parent:"noun",tag:"NNS"},NNO:{name:"possessive noun",parent:"noun",tag:"NNO"},NNG:{name:"gerund noun",parent:"noun",tag:"VBG"},PP:{name:"possessive pronoun",parent:"noun",tag:"PP"},FW:{name:"foreign word",parent:"glue",tag:"FW"},CD:{name:"cardinal value, generic",parent:"value",tag:"CD"},DA:{name:"date",parent:"value",tag:"DA"},NU:{name:"number",parent:"value",tag:"NU"},IN:{name:"preposition",parent:"glue",tag:"IN"},MD:{name:"modal verb",parent:"verb",tag:"MD"},CC:{name:"co-ordating conjunction",parent:"glue",tag:"CC"},PRP:{name:"personal pronoun",parent:"noun",tag:"PRP"},DT:{name:"determiner",parent:"glue",tag:"DT"},UH:{name:"interjection",parent:"glue",tag:"UH"},EX:{name:"existential there",parent:"glue",tag:"EX"}}},{}],57:[function(require,module,exports){var data={NN:["ceae","inae","idae","leaf","rgan","eman","sman","star","boat","tube","rica","tica","nica","auce","tics","ency","ancy","poda","tude","xide","body","weed","tree","rrel","stem","cher","icer","erer","ader","ncer","izer","ayer","nner","ates","ales","ides","rmes","etes","llet","uage","ings","aphy","chid","tein","vein","hair","tris","unit","cake","nake","illa","ella","icle","ille","etle","scle","cell","bell","bill","palm","toma","game","lamp","bone","mann","ment","wood","book","nson","agon","odon","dron","iron","tion","itor","ator","root","cope","tera","hora","lora","bird","worm","fern","horn","wort","ourt","stry","etry","bush","ness","gist","rata","lata","tata","moth","lity","nity","sity","rity","city","dity","vity","drug","dium","llum","trum","inum","lium","tium","atum","rium","icum","anum","nium","orum","icus","opus","chus","ngus","thus","rius","rpus"],JJ:["liac","siac","clad","deaf","xial","hial","chal","rpal","asal","rial","teal","oeal","vial","phal","sial","heal","rbal","neal","geal","dial","eval","bial","ugal","kian","izan","rtan","odan","llan","zian","eian","eyan","ndan","eban","near","unar","lear","liar","-day","-way","tech","sick","tuck","inct","unct","wide","endo","uddy","eedy","uted","aled","rred","oned","rted","obed","oped","ched","dded","cted","tied","eked","ayed","rked","teed","mmed","tred","awed","rbed","bbed","axed","bred","pied","cked","rced","ened","fied","lved","mned","kled","hted","lied","eted","rded","lued","rved","azed","oked","ghed","sked","emed","aded","ived","mbed","pted","zled","ored","pled","wned","afed","nied","aked","gued","oded","oved","oled","ymed","lled","bled","cled","eded","toed","ited","oyed","eyed","ured","omed","ixed","pped","ined","lted","iced","exed","nded","amed","owed","dged","nted","eged","nned","used","ibed","nced","umed","dled","died","rged","aped","oted","uled","ided","nked","aved","rled","rned","aned","rmed","lmed","aged","ized","eved","ofed","thed","ered","ared","ated","eled","sted","ewed","nsed","nged","lded","gged","osed","fled","shed","aced","ffed","tted","uced","iled","uded","ired","yzed","-fed","mped","iked","fted","imed","hree","llel","aten","lden","nken","apen","ozen","ober","-set","nvex","osey","laid","paid","xvii","xxii","-air","tair","icit","knit","nlit","xxiv","-six","-old","held","cile","ible","able","gile","full","-ply","bbly","ggly","zzly","-one","mane","mune","rung","uing","mant","yant","uant","pant","urnt","awny","eeny","ainy","orny","siny","tood","shod","-toe","d-on","-top","-for","odox","wept","eepy","oopy","hird","dern","worn","mart","ltry","oury","ngry","arse","bose","cose","mose","iose","gish","kish","pish","wish","vish","yish","owsy","ensy","easy","ifth","edth","urth","ixth","00th","ghth","ilty","orty","ifty","inty","ghty","kety","afty","irty","roud","true","wful","dful","rful","mful","gful","lful","hful","kful","iful","yful","sful","tive","cave","sive","five","cive","xxvi","urvy","nown","hewn","lown","-two","lowy","ctyl"],VB:["wrap","hear","draw","rlay","away","elay","duce","esce","elch","ooch","pick","huck","back","hack","ruct","lict","nect","vict","eact","tect","vade","lude","vide","rude","cede","ceed","ivel","hten","rken","shen","open","quer","over","efer","eset","uiet","pret","ulge","lign","pugn","othe","rbid","raid","veil","vail","roil","join","dain","feit","mmit","erit","voke","make","weld","uild","idle","rgle","otle","rble","self","fill","till","eels","sult","pply","sume","dime","lame","lump","rump","vene","cook","look","from","elop","grow","adow","ploy","sorb","pare","uire","jure","lore","surf","narl","earn","ourn","hirr","tort","-fry","uise","lyse","sise","hise","tise","nise","lise","rise","anse","gise","owse","oosh","resh","cuss","uess","sess","vest","inst","gest","fest","xist","into","ccur","ieve","eive","olve","down","-dye","laze","lyze","raze","ooze"],RB:["that","oubt","much","diem","high","atim","sely","nely","ibly","lely","dely","ally","gely","imly","tely","ully","ably","owly","vely","cely","mely","mply","ngly","exly","ffly","rmly","rely","uely","time","iori","oors","wise","orst","east","ways"]};module.exports=Object.keys(data).reduce(function(h,k){data[k].forEach(function(w){h[w]=k});return h},{})},{}],58:[function(require,module,exports){module.exports=[[".[cts]hy$","JJ"],[".[st]ty$","JJ"],[".[lnr]ize$","VB"],[".[gk]y$","JJ"],[".fies$","VB"],[".some$","JJ"],[".[nrtumcd]al$","JJ"],[".que$","JJ"],[".[tnl]ary$","JJ"],[".[di]est$","JJS"],["^(un|de|re)\\-[a-z]..","VB"],[".lar$","JJ"],["[bszmp]{2}y","JJ"],[".zes$","VB"],[".[icldtgrv]ent$","JJ"],[".[rln]ates$","VBZ"],[".[oe]ry$","JJ"],["[rdntkdhs]ly$","RB"],[".[lsrnpb]ian$","JJ"],[".[^aeiou]ial$","JJ"],[".[^aeiou]eal$","JJ"],[".[vrl]id$","JJ"],[".[ilk]er$","JJR"],[".ike$","JJ"],[".ends$","VB"],[".wards$","RB"],[".rmy$","JJ"],[".rol$","NN"],[".tors$","NN"],[".azy$","JJ"],[".where$","RB"],[".ify$","VB"],[".bound$","JJ"],[".ens$","VB"],[".oid$","JJ"],[".vice$","NN"],[".rough$","JJ"],[".mum$","JJ"],[".teen(th)?$","CD"],[".oses$","VB"],[".ishes$","VB"],[".ects$","VB"],[".tieth$","CD"],[".ices$","NN"],[".bles$","VB"],[".pose$","VB"],[".ions$","NN"],[".ean$","JJ"],[".[ia]sed$","JJ"],[".tized$","VB"],[".llen$","JJ"],[".fore$","RB"],[".ances$","NN"],[".gate$","VB"],[".nes$","VB"],[".less$","RB"],[".ried$","JJ"],[".gone$","JJ"],[".made$","JJ"],[".[pdltrkvyns]ing$","JJ"],[".tions$","NN"],[".tures$","NN"],[".ous$","JJ"],[".ports$","NN"],[". so$","RB"],[".ints$","NN"],[".[gt]led$","JJ"],["[aeiou].*ist$","JJ"],[".lked$","VB"],[".fully$","RB"],[".*ould$","MD"],["^-?[0-9]+(.[0-9]+)?$","CD"],["[a-z]*\\-[a-z]*\\-","JJ"],["[a-z]'s$","NNO"],[".'n$","VB"],[".'re$","CP"],[".'ll$","MD"],[".'t$","VB"],[".tches$","VB"],["^https?:?//[a-z0-9]","CD"],["^www.[a-z0-9]","CD"],[".ize$","VB"],[".[^aeiou]ise$","VB"],[".[aeiou]te$","VB"],[".ea$","NN"],["[aeiou][pns]er$","NN"],[".ia$","NN"],[".sis$","NN"],[".[aeiou]na$","NN"],[".[^aeiou]ity$","NN"],[".[^aeiou]ium$","NN"],[".[^aeiou][ei]al$","JJ"],[".ffy$","JJ"],[".[^aeiou]ic$","JJ"],[".(gg|bb|zz)ly$","JJ"],[".[aeiou]my$","JJ"],[".[aeiou]ble$","JJ"],[".[^aeiou]ful$","JJ"],[".[^aeiou]ish$","JJ"],[".[^aeiou]ica$","NN"],["[aeiou][^aeiou]is$","NN"],["[^aeiou]ard$","NN"],["[^aeiou]ism$","NN"],[".[^aeiou]ity$","NN"],[".[^aeiou]ium$","NN"],[".[lstrn]us$","NN"],["..ic$","JJ"],["[aeiou][^aeiou]id$","JJ"],[".[^aeiou]ish$","JJ"],[".[^aeiou]ive$","JJ"],["[ea]{2}zy$","JJ"]].map(function(a){return{reg:new RegExp(a[0],"i"),pos:a[1]}})},{}],59:[function(require,module,exports){module.exports=function(str){var patterns=[{reg:/([^aeiou][iy])s(e|ed|es|ing)?$/,repl:"$1z$2"},{reg:/(..)our(ly|y|ite)?$/,repl:"$1or$2"},{reg:/([^cdnv])re(s)?$/,repl:"$1er$2"},{reg:/([aeiou])xion([ed])?$/,repl:"$1tion$2"},{reg:/logue$/,repl:"log"},{reg:/([o|a])e/,repl:"e"},{reg:/e(ing|able)$/,repl:"$1"},{reg:/([aeiou]+[^aeiou]+[aeiou]+)ll(ful|ment|est|ing|or|er|ed)$/,repl:"$1l$2"}];for(var i=0;i<patterns.length;i++){if(str.match(patterns[i].reg)){return str.replace(patterns[i].reg,patterns[i].repl)}}return str}},{}],60:[function(require,module,exports){module.exports=function(str){var patterns=[{reg:/([^aeiou][iy])z(e|ed|es|ing)?$/,repl:"$1s$2"},{reg:/([aeiou]+[^aeiou]+[aeiou]+)l(ful|ment|est|ing|or|er|ed)$/,repl:"$1ll$2",exceptions:[]}];for(var i=0;i<patterns.length;i++){if(str.match(patterns[i].reg)){return str.replace(patterns[i].reg,patterns[i].repl)}}return str}},{}],61:[function(require,module,exports){module.exports=function(str){var all=[];var postprocess=function(arr){arr=arr.map(function(w){w=w.replace(/^ */,"");w=w.replace(/ *$/,"");return w});if(arr.length>2){return arr}var ones=[/^[^aeiou]?ion/,/^[^aeiou]?ised/,/^[^aeiou]?iled/];var l=arr.length;if(l>1){var suffix=arr[l-2]+arr[l-1];for(var i=0;i<ones.length;i++){if(suffix.match(ones[i])){arr[l-2]=arr[l-2]+arr[l-1];arr.pop()}}}return arr};var doer=function(str){var vow=/[aeiouy]$/;if(!str){return}var chars=str.split("");var before="";var after="";var current="";for(var i=0;i<chars.length;i++){before=chars.slice(0,i).join("");current=chars[i];after=chars.slice(i+1,chars.length).join("");var candidate=before+chars[i];if(before.match(vow)&&!current.match(vow)){if(after.match(/^e[sm]/)){candidate+="e";after=after.replace(/^e/,"")}all.push(candidate);return doer(after)}if(candidate.match(/(eo|eu|ia|oa|ua|ui)$/i)){all.push(before);all.push(current);return doer(after)}}if(str.match(/[aiouy]/)||str.match(/ee$/)){all.push(str)}else{all[all.length-1]=(all[all.length-1]||"")+str}};str.split(/\s\-/).forEach(function(s){doer(s)});all=postprocess(all);if(all.length===0){all=[str]}return all}},{}],62:[function(require,module,exports){module.exports=function(text,options){options=options||{};var min_count=options.min_count||1;var max_size=options.max_size||5;var REallowedChars=/[^a-zA-Z'\-]+/g;var i,j,k,textlen,s;var keys=[null];var results=[];max_size++;for(i=1;i<=max_size;i++){keys.push({})}text=text.replace(REallowedChars," ").replace(/^\s+/,"").replace(/\s+$/,"");text=text.toLowerCase();text=text.split(/\s+/);for(i=0,textlen=text.length;i<textlen;i++){s=text[i];keys[1][s]=(keys[1][s]||0)+1;for(j=2;j<=max_size;j++){if(i+j<=textlen){s+=" "+text[i+j-1];keys[j][s]=(keys[j][s]||0)+1}else{break}}}i=undefined;for(k=1;k<max_size;k++){results[k]=[];var key=keys[k];for(i in key){if(key.hasOwnProperty(i)&&key[i]>=min_count){results[k].push({word:i,count:key[i],size:k})}}}results=results.filter(function(s){return s!==null});results=results.map(function(r){r=r.sort(function(a,b){return b.count-a.count});return r});return results}},{}],63:[function(require,module,exports){module.exports=function(text){var abbreviations=require("../../data/lexicon/abbreviations");var sentences=[];var chunks=text.split(/(\S.+?[.\?!])(?=\s+|$|")/g);abbreviations=abbreviations.concat(["jan","feb","mar","apr","jun","jul","aug","sep","oct","nov","dec","sept","sep"]);abbreviations=abbreviations.concat(["ex","eg","ie","circa","ca","cca","vs","etc","esp","ft","bc","ad"]);var abbrev_reg=new RegExp("\\b("+abbreviations.join("|")+")[.!?] ?$","i");var acronym_reg=new RegExp("[ |.][A-Z].?$","i");var elipses_reg=new RegExp("\\.\\.\\.*$");var chunks_length=chunks.length;for(i=0;i<chunks_length;i++){if(chunks[i]){chunks[i]=chunks[i].replace(/^\s+|\s+$/g,"");if(chunks[i+1]&&chunks[i].match(abbrev_reg)||chunks[i].match(acronym_reg)||chunks[i].match(elipses_reg)){chunks[i+1]=((chunks[i]||"")+" "+(chunks[i+1]||"")).replace(/ +/g," ")}else if(chunks[i]&&chunks[i].length>0){sentences.push(chunks[i]);chunks[i]=""}}}if(sentences.length===0){return[text]}return sentences}},{"../../data/lexicon/abbreviations":45}],64:[function(require,module,exports){var sentence_parser=require("./sentence");var multiples=require("../../data/lexicon/multiples");var multi_words=Object.keys(multiples).map(function(m){return m.split(" ")});var normalise=function(str){if(!str){return""}str=str.toLowerCase();str=str.replace(/[,\.!:;\?\(\)]/,"");str=str.replace(//g,"'");str=str.replace(/"/g,"");str=str.replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]+/g,"'");str=str.replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]+/g,'"');if(!str.match(/[a-z0-9]/i)){return""}return str};var sentence_type=function(sentence){if(sentence.match(/\?$/)){return"interrogative"}else if(sentence.match(/\!$/)){return"exclamative"}else{return"declarative"}};var combine_multiples=function(arr){var better=[];var normalised=arr.map(function(a){return normalise(a)});for(var i=0;i<arr.length;i++){for(var o=0;o<multi_words.length;o++){if(arr[i+1]&&normalised[i]===multi_words[o][0]&&normalised[i+1]===multi_words[o][1]){arr[i]=arr[i]+" "+arr[i+1];arr[i+1]=null;break}}better.push(arr[i])}return better.filter(function(w){return w})};var tokenize=function(str){var sentences=sentence_parser(str);return sentences.map(function(sentence){var arr=sentence.split(" ");arr=combine_multiples(arr);var tokens=arr.map(function(w,i){return{text:w,normalised:normalise(w),title_case:w.match(/^[A-Z][a-z]/)!==null,noun_capital:i>0&&w.match(/^[A-Z][a-z]/)!==null,punctuated:w.match(/[,;:\(\)"]/)!==null||undefined,end:i===arr.length-1||undefined,start:i===0||undefined}});return{sentence:sentence,tokens:tokens,type:sentence_type(sentence)}})};module.exports=tokenize},{"../../data/lexicon/multiples":51,"./sentence":63}],65:[function(require,module,exports){var compact={2:"",3:"",5:"",8:"","!":"","?":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",I:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:""};var data=[];Object.keys(compact).forEach(function(k){compact[k].split("").forEach(function(s){data.push([s,k])})});var normaler={};var greek={};data.forEach(function(arr){normaler[arr[0]]=arr[1];greek[arr[1]]=arr[0]});var normalize=function(str,options){options=options||{};options.percentage=options.percentage||50;var arr=str.split("").map(function(s){var r=Math.random()*100;if(normaler[s]&&r<options.percentage){return normaler[s]||s}else{return s}});return arr.join("")};var denormalize=function(str,options){options=options||{};options.percentage=options.percentage||50;var arr=str.split("").map(function(s){var r=Math.random()*100;if(greek[s]&&r<options.percentage){return greek[s]||s}else{return s}});return arr.join("")};module.exports={normalize:normalize,denormalize:denormalize}},{}],66:[function(require,module,exports){module.exports=["absurd","aggressive","alert","alive","awesome","beautiful","big","bitter","black","blue","bored","boring","brash","brave","brief","bright","broad","brown","calm","charming","cheap","clean","cold","cool","cruel","cute","damp","deep","dear","dead","dark","dirty","drunk","dull","eager","efficient","even","faint","fair","fanc","fast","fat","feeble","few","fierce","fine","flat","forgetful","frail","full","gentle","glib","great","green","gruesome","handsome","hard","harsh","high","hollow","hot","impolite","innocent","keen","kind","lame","lean","light","little","loose","long","loud","low","lush","macho","mean","meek","mellow","mundane","near","neat","new","nice","normal","odd","old","pale","pink","plain","poor","proud","purple","quick","rare","rapid","red","rich","ripe","rotten","round","rude","sad","safe","scarce","scared","shallow","sharp","short","shrill","simple","slim","slow","small","smart","smooth","soft","sore","sour","square","stale","steep","stiff","straight","strange","strong","sweet","swift","tall","tame","tart","tender","tense","thick","thin","tight","tough","vague","vast","vulgar","warm","weak","wet","white","wide","wild","wise","young","yellow","easy","narrow","late","early","soon","close","empty","dry","windy","noisy","thirsty","hungry","fresh","quiet","clear","heavy","happy","funny","lucky","pretty","important","interesting","attractive","dangerous","intellegent","pure","orange","large","firm","grand","formal","raw","weird","glad","mad","strict","tired","solid","extreme","mature","true","free","curly","angry"].reduce(function(h,s){h[s]=true;return h},{})},{}],67:[function(require,module,exports){var main=function(str){var irregulars={idle:"idly",public:"publicly",vague:"vaguely",day:"daily",icy:"icily",single:"singly",female:"womanly",male:"manly",simple:"simply",whole:"wholly",special:"especially",straight:"straight",wrong:"wrong",fast:"fast",hard:"hard",late:"late",early:"early",well:"well",best:"best",latter:"latter",bad:"badly"};var dont={foreign:1,black:1,modern:1,next:1,difficult:1,degenerate:1,young:1,awake:1,back:1,blue:1,brown:1,orange:1,complex:1,cool:1,dirty:1,done:1,empty:1,fat:1,fertile:1,frozen:1,gold:1,grey:1,gray:1,green:1,medium:1,parallel:1,outdoor:1,unknown:1,undersized:1,used:1,welcome:1,yellow:1,white:1,fixed:1,mixed:1,super:1,guilty:1,tiny:1,able:1,unable:1,same:1,adult:1};var transforms=[{reg:/al$/i,repl:"ally"},{reg:/ly$/i,repl:"ly"},{reg:/(.{3})y$/i,repl:"$1ily"},{reg:/que$/i,repl:"quely"},{reg:/ue$/i,repl:"uly"},{reg:/ic$/i,repl:"ically"},{reg:/ble$/i,repl:"bly"},{reg:/l$/i,repl:"ly"}];var not_matches=[/airs$/,/ll$/,/ee.$/,/ile$/];if(dont[str]){return null}if(irregulars[str]){return irregulars[str]}if(str.length<=3){return null}var i;for(i=0;i<not_matches.length;i++){if(str.match(not_matches[i])){return null}}for(i=0;i<transforms.length;i++){if(str.match(transforms[i].reg)){return str.replace(transforms[i].reg,transforms[i].repl)}}return str+"ly"};module.exports=main},{}],68:[function(require,module,exports){var convertables=require("./convertables");var main=function(str){var irregulars={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder"};var dont={overweight:1,main:1,nearby:1,asleep:1,weekly:1,secret:1,certain:1};var transforms=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}];var matches=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/];var not_matches=[/ary$/,/ous$/];if(dont.hasOwnProperty(str)){return null}for(i=0;i<transforms.length;i++){if(str.match(transforms[i].reg)){return str.replace(transforms[i].reg,transforms[i].repl)}}if(convertables.hasOwnProperty(str)){if(str.match(/e$/)){return str+"r"}else{return str+"er"}}if(irregulars.hasOwnProperty(str)){return irregulars[str]}var i;for(i=0;i<not_matches.length;i++){if(str.match(not_matches[i])){return"more "+str}}for(i=0;i<matches.length;i++){if(str.match(matches[i])){return str+"er"}}return"more "+str};module.exports=main},{"./convertables":66}],69:[function(require,module,exports){module.exports=function(w){var irregulars={clean:"cleanliness",naivety:"naivety"};if(!w){return""}if(irregulars.hasOwnProperty(w)){return irregulars[w]}if(w.match(" ")){return w}if(w.match(/w$/)){return w}var transforms=[{reg:/y$/,repl:"iness"},{reg:/le$/,repl:"ility"},{reg:/ial$/,repl:"y"},{reg:/al$/,repl:"ality"},{reg:/ting$/,repl:"ting"},{reg:/ring$/,repl:"ring"},{reg:/bing$/,repl:"bingness"},{reg:/sing$/,repl:"se"},{reg:/ing$/,repl:"ment"},{reg:/ess$/,repl:"essness"},{reg:/ous$/,repl:"ousness"}];for(var i=0;i<transforms.length;i++){if(w.match(transforms[i].reg)){return w.replace(transforms[i].reg,transforms[i].repl)}}if(w.match(/s$/)){return w}return w+"ness"}},{}],70:[function(require,module,exports){var convertables=require("./convertables");module.exports=function(str){var irregulars={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best"};var dont={overweight:1,ready:1};var transforms=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"}];var matches=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/];var not_matches=[/ary$/];var generic_transformation=function(str){if(str.match(/e$/)){return str+"st"}else{return str+"est"}};for(i=0;i<transforms.length;i++){if(str.match(transforms[i].reg)){return str.replace(transforms[i].reg,transforms[i].repl)}}if(convertables.hasOwnProperty(str)){return generic_transformation(str)}if(dont.hasOwnProperty(str)){return"most "+str}if(irregulars.hasOwnProperty(str)){return irregulars[str]}var i;for(i=0;i<not_matches.length;i++){if(str.match(not_matches[i])){return"most "+str}}for(i=0;i<matches.length;i++){if(str.match(matches[i])){return generic_transformation(str)}}return"most "+str}},{"./convertables":66}],71:[function(require,module,exports){var Adjective=function(str,sentence,word_i){var the=this;the.word=str||"";var to_comparative=require("./conjugate/to_comparative");var to_superlative=require("./conjugate/to_superlative");var adj_to_adv=require("./conjugate/to_adverb");var adj_to_noun=require("./conjugate/to_noun");var parts_of_speech=require("../../data/parts_of_speech");the.conjugate=function(){return{comparative:to_comparative(the.word),superlative:to_superlative(the.word),adverb:adj_to_adv(the.word),noun:adj_to_noun(the.word)}};the.which=function(){if(the.word.match(/..est$/)){return parts_of_speech["JJS"]}if(the.word.match(/..er$/)){return parts_of_speech["JJR"]}return parts_of_speech["JJ"]}();return the};module.exports=Adjective},{"../../data/parts_of_speech":56,"./conjugate/to_adverb":67,"./conjugate/to_comparative":68,"./conjugate/to_noun":69,"./conjugate/to_superlative":70}],72:[function(require,module,exports){module.exports=function(str){var irregulars={idly:"idle",sporadically:"sporadic",basically:"basic",grammatically:"grammatical",alphabetically:"alphabetical",economically:"economical",conically:"conical",politically:"political",vertically:"vertical",practically:"practical",theoretically:"theoretical",critically:"critical",fantastically:"fantastic",mystically:"mystical",pornographically:"pornographic",fully:"full",jolly:"jolly",wholly:"whole"};var transforms=[{reg:/bly$/i,repl:"ble"},{reg:/gically$/i,repl:"gical"},{reg:/([rsdh])ically$/i,repl:"$1ical"},{reg:/ically$/i,repl:"ic"},{reg:/uly$/i,repl:"ue"},{reg:/ily$/i,repl:"y"},{reg:/(.{3})ly$/i,repl:"$1"}];if(irregulars.hasOwnProperty(str)){return irregulars[str]}for(var i=0;i<transforms.length;i++){if(str.match(transforms[i].reg)){return str.replace(transforms[i].reg,transforms[i].repl)}}return str}},{}],73:[function(require,module,exports){var Adverb=function(str,sentence,word_i){var the=this;the.word=str||"";var to_adjective=require("./conjugate/to_adjective");var parts_of_speech=require("../../data/parts_of_speech");the.conjugate=function(){return{adjective:to_adjective(the.word)}};the.which=function(){if(the.word.match(/..est$/)){return parts_of_speech["RBS"]}if(the.word.match(/..er$/)){return parts_of_speech["RBR"]}return parts_of_speech["RB"]}();return the};module.exports=Adverb},{"../../data/parts_of_speech":56,"./conjugate/to_adjective":72}],74:[function(require,module,exports){var uncountables=require("../../../data/lexicon/uncountables");var irregular_nouns=require("../../../data/lexicon/irregular_nouns");var i;var uncountable_nouns=uncountables.reduce(function(h,a){h[a]=true;return h},{});var titlecase=function(str){if(!str){return""}return str.charAt(0).toUpperCase()+str.slice(1)};var irregulars=[["he","they"],["she","they"],["this","these"],["that","these"],["mine","ours"],["hers","theirs"],["his","theirs"],["i","we"],["move","_s"],["myself","ourselves"],["yourself","yourselves"],["himself","themselves"],["herself","themselves"],["themself","themselves"],["its","theirs"],["theirs","_"]];irregulars=irregulars.concat(irregular_nouns);var pluralize_rules=[[/(ax|test)is$/i,"$1es"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"],[/(octop|vir)i$/i,"$1i"],[/([rl])f$/i,"$1ves"],[/(alias|status)$/i,"$1es"],[/(bu)s$/i,"$1ses"],[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"],[/([ti])um$/i,"$1a"],[/([ti])a$/i,"$1a"],[/sis$/i,"ses"],[/(?:([^f])fe|([lr])f)$/i,"$1ves"],[/(hive)$/i,"$1s"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(x|ch|ss|sh|s|z)$/i,"$1es"],[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"],[/^(ox)$/i,"$1en"],[/^(oxen)$/i,"$1"],[/(quiz)$/i,"$1zes"],[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(.*)/i,"$1s"]].map(function(a){return{reg:a[0],repl:a[1]}});var pluralize=function(str){var low=str.toLowerCase();if(uncountable_nouns[low]){return str}if(is_plural(low)===true){return str}var found=irregulars.filter(function(r){return r[0]===low});if(found[0]){if(titlecase(low)===str){return titlecase(found[0][1])}else{return found[0][1]}}if(str.match(/([a-z]*) (of|in|by|for) [a-z]/)){var first=(str.match(/^([a-z]*) (of|in|by|for) [a-z]/)||[])[1];if(first){var better_first=pluralize(first);return better_first+str.replace(first,"")}}for(i=0;i<pluralize_rules.length;i++){if(str.match(pluralize_rules[i].reg)){return str.replace(pluralize_rules[i].reg,pluralize_rules[i].repl)}}};var singularize_rules=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/ives$/i,"ife"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1sis"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|s|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^f])ves$/i,"$1fe"],[/([lr])ves$/i,"$1f"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]].map(function(a){return{reg:a[0],repl:a[1]}});var singularize=function(str){var low=str.toLowerCase();if(uncountable_nouns[low]){return str}if(is_plural(low)===false){return str}var found=irregulars.filter(function(r){return r[1]===low});if(found[0]){if(titlecase(low)===str){return titlecase(found[0][0])}else{return found[0][0]}}if(str.match(/([a-z]*) (of|in|by|for) [a-z]/)){var first=str.match(/^([a-z]*) (of|in|by|for) [a-z]/);if(first&&first[1]){var better_first=singularize(first[1]);return better_first+str.replace(first[1],"")}}for(i=0;i<singularize_rules.length;i++){if(str.match(singularize_rules[i].reg)){return str.replace(singularize_rules[i].reg,singularize_rules[i].repl)}}return str};var is_plural=function(str){str=(str||"").toLowerCase();var preposition=str.match(/([a-z]*) (of|in|by|for) [a-z]/);if(preposition&&preposition[1]){str=preposition[1]}for(i=0;i<irregulars.length;i++){if(irregulars[i][1]===str){return true}if(irregulars[i][0]===str){return false}}var plural_indicators=[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i];for(i=0;i<plural_indicators.length;i++){if(str.match(plural_indicators[i])){return true}}var singular_indicators=[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i];for(i=0;i<singular_indicators.length;i++){if(str.match(singular_indicators[i])){return false}}if(str.match(/s$/)&&!str.match(/ss$/)&&str.length>3){return true}return false};var inflect=function(str){if(uncountable_nouns[str]){return{plural:str,singular:str}}if(is_plural(str)){return{plural:str,singular:singularize(str)}}else{return{singular:str,plural:pluralize(str)}}};module.exports={inflect:inflect,is_plural:is_plural,singularize:singularize,pluralize:pluralize}},{"../../../data/lexicon/irregular_nouns":50,"../../../data/lexicon/uncountables":53}],75:[function(require,module,exports){module.exports=function(str){if(!str){return null}var irregulars={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"};var is_acronym=function(s){if(s.length<=5&&s.match(/^[A-Z]*$/)){return true}if(s.length>=4&&s.match(/^([A-Z]\.)*$/)){return true}return false};var an_acronyms={A:true,E:true,F:true,H:true,I:true,L:true,M:true,N:true,O:true,R:true,S:true,X:true};var a_regexs=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i];if(irregulars.hasOwnProperty(str)){return irregulars[str]}if(is_acronym(str)&&an_acronyms.hasOwnProperty(str.substr(0,1))){return"an"}for(var i=0;i<a_regexs.length;i++){if(str.match(a_regexs[i])){return"a"}}if(str.match(/^[aeiou]/i)){return"an"}return"a"}},{}],76:[function(require,module,exports){var Noun=function(str,sentence,word_i){var the=this;var token,next;if(sentence!==undefined&&word_i!==undefined){token=sentence.tokens[word_i];next=sentence.tokens[word_i+i]}the.word=str||"";var parts_of_speech=require("../../data/parts_of_speech");var firstnames=require("../../data/lexicon/firstnames");var honourifics=require("../../data/lexicon/honourifics");var inflect=require("./conjugate/inflect");var indefinite_article=require("./indefinite_article");var prps={it:"PRP",they:"PRP",i:"PRP",them:"PRP",you:"PRP",she:"PRP",me:"PRP",he:"PRP",him:"PRP",her:"PRP",us:"PRP",we:"PRP",thou:"PRP"};var blacklist={itself:1,west:1,western:1,east:1,eastern:1,north:1,northern:1,south:1,southern:1,the:1,one:1,your:1,my:1,today:1,yesterday:1,tomorrow:1,era:1,century:1,it:1};var possessives={his:"he",her:"she",hers:"she",their:"they",theirs:"they",them:"they",its:"it",mine:"i",yours:"you",our:"we",ours:"we"};the.is_acronym=function(){var s=the.word;if(s.length<=5&&s.match(/^[A-Z]*$/)){return true}if(s.length>=4&&s.match(/^([A-Z]\.)*$/)){return true}return false};the.is_entity=function(){if(!token){return false}if(token.normalised.length<3||!token.normalised.match(/[a-z]/i)){return false}if(prps[token.normalised]){return false}if(blacklist[token.normalised]){return false}if(token.pos){if(token.pos.tag=="NNA"){return false}if(token.pos.tag=="NNO"){return false}if(token.pos.tag=="NNG"){return false}if(token.pos.tag=="NNP"){return true}}if(token.noun_capital){return true}if(token.normalised.match(/ /)){return true}if(token.normalised.match(/\./)){return true}if(token.normalised.length<5&&token.text.match(/^[A-Z]*$/)){return true}if(the.is_acronym()){return true}return false};the.conjugate=function(){return inflect.inflect(the.word)};the.is_plural=function(){return inflect.is_plural(the.word)};the.article=function(){if(the.is_plural()){return"the"}else{return indefinite_article(the.word)}};the.pluralize=function(){return inflect.pluralize(the.word)};the.singularize=function(){return inflect.singularize(the.word)};the.is_person=function(){var i,l;var blacklist=["center","centre","memorial","school","bridge","university","house","college","square","park","foundation","institute","club","museum","arena","stadium","ss","of","the","for","and","&","co","sons"];l=blacklist.length;for(i=0;i<l;i++){if(the.word.match(new RegExp("\\b"+blacklist[i]+"\\b","i"))){return false}}l=honourifics.length;for(i=0;i<l;i++){if(the.word.match(new RegExp("\\b"+honourifics[i]+"\\.?\\b","i"))){return true}}var names=the.word.split(" ").map(function(a){return a.toLowerCase()});if(firstnames[names[0]]){return true}if(names.length>2&&firstnames[names[1]]){return true}if(the.word.match(/[a-z]{3,20} [a-z]\.? [a-z]{3,20}/i)){return true}return false};the.pronoun=function(){if(the.is_person()){var names=the.word.split(" ").map(function(a){return a.toLowerCase()});if(firstnames[names[0]]==="m"||firstnames[names[1]]=="m"){return"he"}if(firstnames[names[0]]==="f"||firstnames[names[1]]=="f"){return"she"}if(the.word.match(/^(mrs|miss|ms|misses|mme|mlle)\.? /,"i")){return"she"}if(the.word.match(/\b(mr|mister|sr|jr)\b/,"i")){return"he"}if(firstnames[names[0]]==="a"||firstnames[names[1]]=="a"){return"they"}if(names[0].match(/[aeiy]$/)){return"she"}if(names[0].match(/[ou]$/)){return"he"}if(names[0].match(/(nn|ll|tt)/)){return"she"}return"they"}if(the.is_plural()){return"they"}return"it"};the.referenced_by=function(){if(token&&token.pos.tag!=="PRP"&&token.pos.tag!=="PP"){var prp=the.pronoun();var interested=sentence.tokens.slice(word_i+1,sentence.tokens.length);if(sentence.next){interested=interested.concat(sentence.next.tokens)}var matches=[];for(var i=0;i<interested.length;i++){if(interested[i].pos.tag==="PRP"&&(interested[i].normalised===prp||possessives[interested[i].normalised]===prp)){matches.push(interested[i])}else if(interested[i].pos.tag==="PP"&&possessives[interested[i].normalised]===prp){matches.push(interested[i])}else if(interested[i].pos.parent==="noun"&&interested[i].analysis.pronoun()===prp){break}}return matches}return[]};the.reference_to=function(){if(token&&(token.pos.tag==="PRP"||token.pos.tag==="PP")){var prp=token.normalised;if(possessives[prp]!==undefined){prp=possessives[prp]}var interested=sentence.tokens.slice(0,word_i);if(sentence.last){interested=sentence.last.tokens.concat(interested)}interested=interested.reverse();for(var i=0;i<interested.length;i++){if(interested[i].pos.parent==="noun"&&interested[i].pos.tag!=="PRP"&&interested[i].analysis.pronoun()===prp){return interested[i]}}}};the.which=function(){if(the.word.match(/'s$/)){return parts_of_speech["NNO"]}return parts_of_speech["NN"]}();return the};module.exports=Noun},{"../../data/lexicon/firstnames":48,"../../data/lexicon/honourifics":49,"../../data/parts_of_speech":56,"./conjugate/inflect":74,"./indefinite_article":75}],77:[function(require,module,exports){var Adjective=require("./adjective/index");var Noun=require("./noun/index");var Adverb=require("./adverb/index");var Verb=require("./verb/index");var Value=require("./value/index");var parents={adjective:function(str,next,last,token){return new Adjective(str,next,last,token)},noun:function(str,next,last,token){return new Noun(str,next,last,token)},adverb:function(str,next,last,token){return new Adverb(str,next,last,token)},verb:function(str,next,last,token){return new Verb(str,next,last,token)},value:function(str,next,last,token){return new Value(str,next,last,token)},glue:function(str,next,last,token){return{}}};module.exports=parents},{"./adjective/index":71,"./adverb/index":73,"./noun/index":76,"./value/index":79,"./verb/index":86}],78:[function(require,module,exports){var months="(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|aug|sept|oct|nov|dec),?";var days="([0-9]{1,2}),?";var years="([12][0-9]{3})";var to_obj=function(arr,places){return Object.keys(places).reduce(function(h,k){h[k]=arr[places[k]];return h},{})};var regexes=[{reg:String(months)+" "+String(days)+"-"+String(days)+" "+String(years),example:"March 7th-11th 1987",process:function(arr){if(!arr){arr=[]}var places={month:1,day:2,to_day:3,year:4};return to_obj(arr,places)}},{reg:String(days)+" of "+String(months)+" to "+String(days)+" of "+String(months)+" "+String(years),example:"28th of September to 5th of October 2008",process:function(arr){if(!arr){arr=[]}var places={day:1,month:2,to_day:3,to_month:4,to_year:5};return to_obj(arr,places)}},{reg:String(months)+" "+String(days)+" to "+String(months)+" "+String(days)+" "+String(years),example:"March 7th to june 11th 1987",process:function(arr){if(!arr){arr=[]}var places={month:1,day:2,to_month:3,to_day:4,year:5,to_year:5};return to_obj(arr,places)}},{reg:"between "+String(days)+" "+String(months)+" and "+String(days)+" "+String(months)+" "+String(years),example:"between 13 February and 15 February 1945",process:function(arr){if(!arr){arr=[]}var places={day:1,month:2,to_day:3,to_month:4,year:5,to_year:5};return to_obj(arr,places)}},{reg:"between "+String(months)+" "+String(days)+" and "+String(months)+" "+String(days)+" "+String(years),example:"between March 7th and june 11th 1987",process:function(arr){if(!arr){arr=[]}var places={month:1,day:2,to_month:3,to_day:4,year:5,to_year:5};return to_obj(arr,places)}},{reg:String(months)+" "+String(days)+" "+String(years),example:"March 1st 1987",process:function(arr){if(!arr){arr=[]}var places={month:1,day:2,year:3};return to_obj(arr,places)}},{reg:String(days)+" - "+String(days)+" of "+String(months)+" "+String(years),example:"3rd - 5th of March 1969",process:function(arr){if(!arr){arr=[]}var places={day:1,to_day:2,month:3,year:4};return to_obj(arr,places)}},{reg:String(days)+" of "+String(months)+" "+String(years),example:"3rd of March 1969",process:function(arr){if(!arr){arr=[]}var places={day:1,month:2,year:3};return to_obj(arr,places)}},{reg:String(months)+" "+years+",? to "+String(months)+" "+String(years),example:"September 1939 to April 1945",process:function(arr){if(!arr){arr=[]}var places={month:1,year:2,to_month:3,to_year:4};return to_obj(arr,places)}},{reg:String(months)+" "+String(years),example:"March 1969",process:function(arr){if(!arr){arr=[]}var places={month:1,year:2};return to_obj(arr,places)}},{reg:String(months)+" "+days,example:"March 18th",process:function(arr){if(!arr){arr=[]}var places={month:1,day:2};return to_obj(arr,places)}},{reg:String(days)+" of "+months,example:"18th of March",process:function(arr){if(!arr){arr=[]}var places={month:2,day:1};return to_obj(arr,places)}},{reg:years+" ?- ?"+String(years),example:"1997-1998",process:function(arr){if(!arr){arr=[]}var places={year:1,to_year:2};return to_obj(arr,places)}},{reg:years,example:"1998",process:function(arr){if(!arr){arr=[]}var places={year:1};return to_obj(arr,places)}}].map(function(o){o.reg=new RegExp(o.reg,"g");return o});var months_obj={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11,jan:0,feb:1,mar:2,apr:3,aug:7,sept:8,oct:9,nov:10,dec:11};var last_dates=[31,29,31,30,31,30,31,31,30,31,30,31];var preprocess=function(str){str=str.toLowerCase();str=str.replace(/([0-9])(th|rd|st)/g,"$1");return str};var postprocess=function(obj,options){var d;d=new Date;options=options||{};obj.year=parseInt(obj.year,10)||undefined;obj.day=parseInt(obj.day,10)||undefined;obj.to_day=parseInt(obj.to_day,10)||undefined;obj.to_year=parseInt(obj.to_year,10)||undefined;obj.month=months_obj[obj.month];obj.to_month=months_obj[obj.to_month];if(obj.to_month!==undefined&&obj.month===undefined){obj.month=obj.to_month}if(obj.to_month===undefined&&obj.month!==undefined){obj.to_month=obj.month}if(obj.to_year&&!obj.year){obj.year=obj.to_year}if(!obj.to_year&&obj.year&&obj.to_month!==undefined){obj.to_year=obj.year}if(options.assume_year&&!obj.year){obj.year=d.getFullYear()}if(obj.day!==undefined&&(obj.day>31||obj.month!==undefined&&obj.day>last_dates[obj.month])){obj.day=undefined}if(obj.to_month!==undefined&&obj.to_month<obj.month){return{}}if(obj.to_year&&obj.to_year<obj.year){obj.year=undefined;obj.to_year=undefined}if(obj.year>2090||obj.year<1200){obj.year=undefined;obj.to_year=undefined}obj={day:obj.day,month:obj.month,year:obj.year,to:{day:obj.to_day,month:obj.to_month,year:obj.to_year}};if(obj.year&&obj.day&&obj.month!==undefined){obj.date_object=new Date;obj.date_object.setYear(obj.year);obj.date_object.setMonth(obj.month);obj.date_object.setDate(obj.day)}if(obj.to.year&&obj.to.day&&obj.to.month!==undefined){obj.to.date_object=new Date;obj.to.date_object.setYear(obj.to.year);obj.to.date_object.setMonth(obj.to.month);obj.to.date_object.setDate(obj.to.day)}if(obj.year||obj.month!==undefined){return obj}return{}};module.exports=function(str,options){options=options||{};str=preprocess(str);var arr,good,clone_reg,obj;var l=regexes.length;for(var i=0;i<l;i+=1){obj=regexes[i];if(str.match(obj.reg)){clone_reg=new RegExp(obj.reg.source,"i");arr=clone_reg.exec(str);good=obj.process(arr);return postprocess(good,options)}}}},{}],79:[function(require,module,exports){var Value=function(str,sentence,word_i){var the=this;the.word=str||"";var to_number=require("./to_number");var date_extractor=require("./date_extractor");var parts_of_speech=require("../../data/parts_of_speech");the.date=function(options){options=options||{};return date_extractor(the.word,options)};the.is_date=function(){var months=/(january|february|march|april|may|june|july|august|september|october|november|december|jan|feb|mar|apr|aug|sept|oct|nov|dec)/i;var times=/1?[0-9]:[0-9]{2}/;var days=/\b(monday|tuesday|wednesday|thursday|friday|saturday|sunday|mon|tues|wed|thurs|fri|sat|sun)\b/i;if(the.word.match(months)||the.word.match(times)||the.word.match(days)){return true}return false};the.number=function(){if(the.is_date()){return null}return to_number(the.word)};the.which=function(){if(the.date()){return parts_of_speech["DA"]}if(the.number()){return parts_of_speech["NU"]}return parts_of_speech["CD"]}();return the};module.exports=Value},{"../../data/parts_of_speech":56,"./date_extractor":78,"./to_number":80}],80:[function(require,module,exports){"use strict";var ones={a:1,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9};var teens={ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19};var tens={twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90,twentieth:20,thirtieth:30,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90};var multiple={hundred:100,grand:1e3,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,octillion:1e27,nonillion:1e30,decillion:1e33};var main=function(s){var ones_done=false;var teens_done=false;var tens_done=false;var multiple_done={};var total=0;var global_multiplier=1;s=s.replace(/, ?/g,"");s=s.replace(/[$]/,"");if(s.match(/[0-9]\.[0-9]/)&&parseFloat(s)==s){return parseFloat(s)}if(parseInt(s,10)==s){return parseInt(s,10)}if(s.match(/[0-9][\-:][0-9]/)){return null}var mults=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5},{reg:/^(a\s)?quarter[\s\-]/i,mult:.25}];for(i=0;i<mults.length;i++){if(s.match(mults[i].reg)){global_multiplier=mults[i].mult;s=s.replace(mults[i].reg,"");break}}var words=s.toString().split(/[\s\-]+/);var w,x;var current_sum=0;var local_multiplier=1;var decimal_mode=false;for(var i=0;i<words.length;i++){w=words[i];if(w=="and"){continue}if(w=="point"||w=="decimal"){if(decimal_mode){return null}decimal_mode=true;total+=current_sum;current_sum=0;ones_done=false;local_multiplier=.1;continue}if(decimal_mode){x=null;if(ones[w]!==undefined){x=ones[w]}if(teens[w]!==undefined){x=teens[w]}if(parseInt(w,10)==w){x=parseInt(w,10)}if(!x){return null}if(x<10){total+=x*local_multiplier;local_multiplier=local_multiplier*.1;current_sum=0;continue}if(x<100){total+=x*(local_multiplier*.1);local_multiplier=local_multiplier*.01;current_sum=0;continue}}if(w.match(/^[0-9]\.[0-9]$/)){current_sum+=parseFloat(w);continue}if(parseInt(w,10)==w){current_sum+=parseInt(w,10);continue}if(ones[w]!==undefined){if(ones_done){return null}if(teens_done){return null}ones_done=true;current_sum+=ones[w];continue}if(teens[w]){if(ones_done){return null}if(teens_done){return null}if(tens_done){return null}teens_done=true;current_sum+=teens[w];continue}if(tens[w]){if(ones_done){return null}if(teens_done){return null}if(tens_done){return null}tens_done=true;current_sum+=tens[w];continue}if(multiple[w]){if(multiple_done[w]){return null}multiple_done[w]=true;ones_done=false;teens_done=false;tens_done=false;if(current_sum===0){total=total||1;total*=multiple[w]}else{current_sum*=multiple[w];total+=current_sum}current_sum=0;continue}return null}if(current_sum){total+=(current_sum||1)*local_multiplier}total=total*global_multiplier;return total};module.exports=main},{}],81:[function(require,module,exports){var verb_to_doer=require("./to_doer");var verb_irregulars=require("./verb_irregulars");var verb_rules=require("./verb_rules");var suffix_rules=require("./suffix_rules");var predict=function(w){var endsWith=function(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1};var arr=Object.keys(suffix_rules);for(i=0;i<arr.length;i++){if(endsWith(w,arr[i])){return suffix_rules[arr[i]]}}return"infinitive"};var fallback=function(w){var infinitive;if(w.length>4){infinitive=w.replace(/ed$/,"")}else{infinitive=w.replace(/d$/,"")}var present,past,gerund,doer;if(w.match(/[^aeiou]$/)){gerund=w+"ing";past=w+"ed";if(w.match(/ss$/)){present=w+"es"}else{present=w+"s"}doer=verb_to_doer(infinitive)}else{gerund=w.replace(/[aeiou]$/,"ing");past=w.replace(/[aeiou]$/,"ed");present=w.replace(/[aeiou]$/,"es");doer=verb_to_doer(infinitive)}return{infinitive:infinitive,present:present,past:past,gerund:gerund,doer:doer,future:"will "+infinitive}};var fufill=function(obj,prefix){if(!obj.infinitive){return obj}if(!obj.gerund){obj.gerund=obj.infinitive+"ing"}if(!obj.doer){obj.doer=verb_to_doer(obj.infinitive)}if(!obj.present){obj.present=obj.infinitive+"s"}if(!obj.past){obj.past=obj.infinitive+"ed"}if(prefix){Object.keys(obj).forEach(function(k){obj[k]=prefix+obj[k]})}if(!obj.future){obj.future="will "+obj.infinitive}if(!obj.perfect){obj.perfect="have "+obj.past}if(!obj.pluperfect){obj.pluperfect="had "+obj.past}if(!obj.future_perfect){obj.future_perfect="will have "+obj.past}return obj};var main=function(w){if(w===undefined){return{}}var phrasal_reg=new RegExp("^(.*?) (in|out|on|off|behind|way|with|of|do|away|across|ahead|back|over|under|together|apart|up|upon|aback|down|about|before|after|around|to|forth|round|through|along|onto)$","i");if(w.match(" ")&&w.match(phrasal_reg)){var split=w.match(phrasal_reg,"");var phrasal_verb=split[1];var particle=split[2];var result=main(phrasal_verb);delete result["doer"];Object.keys(result).forEach(function(k){if(result[k]){result[k]+=" "+particle}});return result}if(w.match(/^had [a-z]/i)){w=w.replace(/^had /i,"")}if(w.match(/^have [a-z]/i)){w=w.replace(/^have /i,"")}if(w.match(/^will have [a-z]/i)){w=w.replace(/^will have /i,"")}w=w.replace(/^will /i,"");var prefix=(w.match(/^(over|under|re|anti|full)\-?/i)||[])[0];var verb=w.replace(/^(over|under|re|anti|full)\-?/i,"");var obj={};var l=verb_irregulars.length;var x,i;for(i=0;i<l;i++){x=verb_irregulars[i];if(verb===x.present||verb===x.gerund||verb===x.past||verb===x.infinitive){obj=JSON.parse(JSON.stringify(verb_irregulars[i]));return fufill(obj,prefix)}}var predicted=predict(w)||"infinitive";l=verb_rules[predicted].length;var r,keys;for(i=0;i<l;i++){r=verb_rules[predicted][i];if(w.match(r.reg)){obj[predicted]=w;keys=Object.keys(r.repl);for(var o=0;o<keys.length;o++){if(keys[o]===predicted){obj[keys[o]]=w}else{obj[keys[o]]=w.replace(r.reg,r.repl[keys[o]])}}return fufill(obj)}}return fallback(w)};module.exports=main},{"./suffix_rules":82,"./to_doer":83,"./verb_irregulars":84,"./verb_rules":85}],82:[function(require,module,exports){var compact={gerund:["ing"],infinitive:["ate","ize","tion","rify","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","eed","er","le"],past:["ed","lt","nt","pt","ew","ld"],present:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns","s"]};var suffix_rules={};var keys=Object.keys(compact);var l=keys.length;var l2,i;for(i=0;i<l;i++){l2=compact[keys[i]].length;for(var o=0;o<l2;o++){suffix_rules[compact[keys[i]][o]]=keys[i]}}module.exports=suffix_rules},{}],83:[function(require,module,exports){module.exports=function(str){str=str||"";var irregulars={tie:"tier",dream:"dreamer",sail:"sailer",run:"runner",rub:"rubber",begin:"beginner",win:"winner",claim:"claimant",deal:"dealer",spin:"spinner"};var dont={aid:1,fail:1,appear:1,happen:1,seem:1,try:1,say:1,marry:1,be:1,forbid:1,understand:1,bet:1};var transforms=[{reg:/e$/i,repl:"er"},{reg:/([aeiou])([mlgp])$/i,repl:"$1$2$2er"},{reg:/([rlf])y$/i,repl:"$1ier"},{reg:/^(.?.[aeiou])t$/i,repl:"$1tter"}];if(dont.hasOwnProperty(str)){return null}if(irregulars.hasOwnProperty(str)){return irregulars[str]}for(var i=0;i<transforms.length;i++){if(str.match(transforms[i].reg)){return str.replace(transforms[i].reg,transforms[i].repl)}}return str+"er"}},{}],84:[function(require,module,exports){var types=["infinitive","gerund","past","present","doer","future"];var compact=[["arise","arising","arose","_s","_r"],["babysit","_ting","babysat","_s","_ter"],["be","_ing","was","is",""],["beat","_ing","_","_s","_er"],["become","becoming","became","_s","_r"],["bend","_ing","bent","_s","_er"],["begin","_ning","began","_s","_ner"],["bet","_ting","_","_s","_ter"],["bind","_ing","bound","_s","_er"],["bite","biting","bit","_s","_r"],["bleed","_ing","bled","_s","_er"],["blow","_ing","blew","_s","_er"],["break","_ing","broke","_s","_er"],["breed","_ing","bred","_s","_er"],["bring","_ing","brought","_s","_er"],["broadcast","_ing","_","_s","_er"],["build","_ing","built","_s","_er"],["buy","_ing","bought","_s","_er"],["catch","_ing","caught","_es","_er"],["choose","choosing","chose","_s","_r"],["come","coming","came","_s","_r"],["cost","_ing","_","_s","_er"],["cut","_ting","_","_s","_ter"],["deal","_ing","_t","_s","_er"],["dig","_ging","dug","_s","_ger"],["do","_ing","did","_es","_er"],["draw","_ing","drew","_s","_er"],["drink","_ing","drank","_s","_er"],["drive","driving","drove","_s","_r"],["eat","_ing","ate","_s","_er"],["fall","_ing","fell","_s","_er"],["feed","_ing","fed","_s","_er"],["feel","_ing","felt","_s","_er"],["fight","_ing","fought","_s","_er"],["find","_ing","found","_s","_er"],["fly","_ing","flew","_s","flier"],["forbid","_ing","forbade","_s"],["forget","_ing","forgot","_s","_er"],["forgive","forgiving","forgave","_s","_r"],["freeze","freezing","froze","_s","_r"],["get","_ting","got","_s","_ter"],["give","giving","gave","_s","_r"],["go","_ing","went","_es","_er"],["grow","_ing","grew","_s","_er"],["hang","_ing","hung","_s","_er"],["have","having","had","has"],["hear","_ing","_d","_s","_er"],["hide","hiding","hid","_s","_r"],["hit","_ting","_","_s","_ter"],["hold","_ing","held","_s","_er"],["hurt","_ing","_","_s","_er"],["know","_ing","knew","_s","_er"],["relay","_ing","_ed","_s","_er"],["lay","_ing","laid","_s","_er"],["lead","_ing","led","_s","_er"],["leave","leaving","left","_s","_r"],["lend","_ing","lent","_s","_er"],["let","_ting","_","_s","_ter"],["lie","lying","lay","_s","_r"],["light","_ing","lit","_s","_er"],["lose","losing","lost","_s","_r"],["make","making","made","_s","_r"],["mean","_ing","_t","_s","_er"],["meet","_ing","met","_s","_er"],["pay","_ing","paid","_s","_er"],["put","_ting","_","_s","_ter"],["quit","_ting","_","_s","_ter"],["read","_ing","_","_s","_er"],["ride","riding","rode","_s","_r"],["ring","_ing","rang","_s","_er"],["rise","rising","rose","_s","_r"],["run","_ning","ran","_s","_ner"],["say","_ing","said","_s"],["see","_ing","saw","_s","_r"],["sell","_ing","sold","_s","_er"],["send","_ing","sent","_s","_er"],["set","_ting","_","_s","_ter"],["shake","shaking","shook","_s","_r"],["shine","shining","shone","_s","_r"],["shoot","_ing","shot","_s","_er"],["show","_ing","_ed","_s","_er"],["shut","_ting","_","_s","_ter"],["sing","_ing","sang","_s","_er"],["sink","_ing","sank","_s","_er"],["sit","_ting","sat","_s","_ter"],["slide","sliding","slid","_s","_r"],["speak","_ing","spoke","_s","_er"],["spend","_ing","spent","_s","_er"],["spin","_ning","spun","_s","_ner"],["spread","_ing","_","_s","_er"],["stand","_ing","stood","_s","_er"],["steal","_ing","stole","_s","_er"],["stick","_ing","stuck","_s","_er"],["sting","_ing","stung","_s","_er"],["strike","striking","struck","_s","_r"],["swear","_ing","swore","_s","_er"],["swim","_ing","swam","_s","_mer"],["swing","_ing","swung","_s","_er"],["take","taking","took","_s","_r"],["teach","_ing","taught","_s","_er"],["tear","_ing","tore","_s","_er"],["tell","_ing","told","_s","_er"],["think","_ing","thought","_s","_er"],["throw","_ing","threw","_s","_er"],["understand","_ing","understood","_s"],["wake","waking","woke","_s","_r"],["wear","_ing","wore","_s","_er"],["win","_ning","won","_s","_ner"],["withdraw","_ing","withdrew","_s","_er"],["write","writing","wrote","_s","_r"],["tie","tying","_d","_s","_r"],["obey","_ing","_ed","_s","_er"],["ski","_ing","_ied","_s","_er"],["boil","_ing","_ed","_s","_er"],["miss","_ing","_ed","_","_er"],["act","_ing","_ed","_s","_or"],["compete","competing","_d","_s","competitor"],["being","are","were","are"],["imply","_ing","implied","implies","implier"],["ice","icing","_d","_s","_r"],["develop","_ing","_","_s","_er"],["wait","_ing","_ed","_s","_er"],["aim","_ing","_ed","_s","_er"],["spill","_ing","spilt","_s","_er"],["drop","_ping","_ped","_s","_per"],["head","_ing","_ed","_s","_er"],["log","_ging","_ged","_s","_ger"],["rub","_bing","_bed","_s","_ber"],["smash","_ing","_ed","_es","_er"],["add","_ing","_ed","_s","_er"],["word","_ing","_ed","_s","_er"],["suit","_ing","_ed","_s","_er"],["be","am","was","am",""],["load","_ing","_ed","_s","_er"]];module.exports=compact.map(function(arr){var obj={};for(var i=0;i<arr.length;i++){obj[types[i]]=arr[i].replace(/_/,arr[0])}return obj})},{}],85:[function(require,module,exports){var verb_rules={infinitive:[["(eed)$",{pr:"$1s",g:"$1ing",pa:"$1ed",do:"$1er"}],["(e)(ep)$",{pr:"$1$2s",g:"$1$2ing",pa:"$1pt",do:"$1$2er"}],["(a[tg]|i[zn]|ur|nc|gl|is)e$",{pr:"$1es",g:"$1ing",pa:"$1ed"}],["([i|f|rr])y$",{pr:"$1ies",g:"$1ying",pa:"$1ied"}],["([td]er)$",{pr:"$1s",g:"$1ing",pa:"$1ed"}],["([bd]l)e$",{pr:"$1es",g:"$1ing",pa:"$1ed"}],["(ish|tch|ess)$",{pr:"$1es",g:"$1ing",pa:"$1ed"}],["(ion|end|e[nc]t)$",{pr:"$1s",g:"$1ing",pa:"$1ed"}],["(om)e$",{pr:"$1es",g:"$1ing",pa:"ame"}],["([aeiu])([pt])$",{pr:"$1$2s",g:"$1$2$2ing",pa:"$1$2"}],["(er)$",{pr:"$1s",g:"$1ing",pa:"$1ed"}],["(en)$",{pr:"$1s",g:"$1ing",pa:"$1ed"}]],present:[["(ies)$",{in:"y",g:"ying",pa:"ied"}],["(tch|sh)es$",{in:"$1",g:"$1ing",pa:"$1ed"}],["(ss)es$",{in:"$1",g:"$1ing",pa:"$1ed"}],["([tzlshicgrvdnkmu])es$",{in:"$1e",g:"$1ing",pa:"$1ed"}],["(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$",{in:"$1",g:"$1ing",pa:"$1ed"}],["(ow)s$",{in:"$1",g:"$1ing",pa:"ew"}],["(op)s$",{in:"$1",g:"$1ping",pa:"$1ped"}],["([eirs])ts$",{in:"$1t",g:"$1tting",pa:"$1tted"}],["(ll)s$",{in:"$1",g:"$1ing",pa:"$1ed"}],["(el)s$",{in:"$1",g:"$1ling",pa:"$1led"}],["(ip)es$",{in:"$1e",g:"$1ing",pa:"$1ed"}],["ss$",{in:"ss",g:"ssing",pa:"ssed"}],["s$",{in:"",g:"ing",pa:"ed"}]],gerund:[["pping$",{in:"p",pr:"ps",pa:"pped"}],["lling$",{in:"ll",pr:"lls",pa:"lled"}],["tting$",{in:"t",pr:"ts",pa:"t"}],["ssing$",{in:"ss",pr:"sses",pa:"ssed"}],["gging$",{in:"g",pr:"gs",pa:"gged"}],["([^aeiou])ying$",{in:"$1y",pr:"$1ies",pa:"$1ied",do:"$1ier"}],["(i.)ing$",{in:"$1e",pr:"$1es",pa:"$1ed"}],["(u[rtcb]|[bdtpkg]l|n[cg]|a[gdkvtc]|[ua]s|[dr]g|yz|o[rlsp]|cre)ing$",{in:"$1e",pr:"$1es",pa:"$1ed"}],["(ch|sh)ing$",{in:"$1",pr:"$1es",pa:"$1ed"}],["(..)ing$",{in:"$1",pr:"$1s",pa:"$1ed"}]],past:[["(ued)$",{pr:"ues",g:"uing",pa:"ued",do:"uer"}],["(e|i)lled$",{pr:"$1lls",g:"$1lling",pa:"$1lled",do:"$1ller"}],["(sh|ch)ed$",{in:"$1",pr:"$1es",g:"$1ing",do:"$1er"}],["(tl|gl)ed$",{in:"$1e",pr:"$1es",g:"$1ing",do:"$1er"}],["(ss)ed$",{in:"$1",pr:"$1es",g:"$1ing",do:"$1er"}],["pped$",{in:"p",pr:"ps",g:"pping",do:"pper"}],["tted$",{in:"t",pr:"ts",g:"tting",do:"tter"}],["gged$",{in:"g",pr:"gs",g:"gging",do:"gger"}],["(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$",{in:"$1",pr:"$1s",g:"$1ing",do:"$1er"}],["(..[^aeiou])ed$",{in:"$1e",pr:"$1es",g:"$1ing",do:"$1er"}],["ied$",{in:"y",pr:"ies",g:"ying",do:"ier"}],["(.o)ed$",{in:"$1o",pr:"$1os",g:"$1oing",do:"$1oer"}],["(.i)ed$",{in:"$1",pr:"$1s",g:"$1ing",do:"$1er"}],["([rl])ew$",{in:"$1ow",pr:"$1ows",g:"$1owing"}],["([pl])t$",{in:"$1t",pr:"$1ts",g:"$1ting"}]]};verb_rules=Object.keys(verb_rules).reduce(function(h,k){h[k]=verb_rules[k].map(function(a){var obj={reg:new RegExp(a[0],"i"),repl:{infinitive:a[1]["in"],present:a[1]["pr"],past:a[1]["pa"],gerund:a[1]["g"]}};if(a[1]["do"]){obj.repl.doer=a[1]["do"]}return obj});return h},{});module.exports=verb_rules},{}],86:[function(require,module,exports){var Verb=function(str,sentence,word_i){var the=this;var token,next;if(sentence!==undefined&&word_i!==undefined){token=sentence.tokens[word_i];next=sentence.tokens[word_i+i]}the.word=str||"";var verb_conjugate=require("./conjugate/conjugate");var parts_of_speech=require("../../data/parts_of_speech");var copulas={is:"CP","will be":"CP",will:"CP",are:"CP",was:"CP",were:"CP"};var modals={can:"MD",may:"MD",could:"MD",might:"MD",will:"MD","ought to":"MD",would:"MD",must:"MD",shall:"MD",should:"MD"};var tenses={past:"VBD",participle:"VBN",infinitive:"VBP",present:"VBZ",gerund:"VBG"};the.conjugate=function(){return verb_conjugate(the.word)};the.to_past=function(){if(the.form==="gerund"){return the.word}return verb_conjugate(the.word).past};the.to_present=function(){return verb_conjugate(the.word).present};the.to_future=function(){return"will "+verb_conjugate(the.word).infinitive};the.form=function(){var order=["past","present","gerund","infinitive"];var forms=verb_conjugate(the.word);for(var i=0;i<order.length;i++){if(forms[order[i]]===the.word){return order[i]}}}();the.tense=function(){if(the.word.match(/\bwill\b/)){return"future"}if(the.form==="present"){return"present"}if(the.form==="past"){return"past"}return"present"}();the.which=function(){if(copulas[the.word]){return parts_of_speech["CP"]}if(the.word.match(/([aeiou][^aeiouwyrlm])ing$/)){return parts_of_speech["VBG"]}var form=the.form;return parts_of_speech[tenses[form]]}();the.negative=function(){if(the.word.match(/n't$/)){return true}if((modals[the.word]||copulas[the.word])&&next&&next.normalised==="not"){return true}return false};return the};module.exports=Verb},{"../../data/parts_of_speech":56,"./conjugate/conjugate":81}],87:[function(require,module,exports){var lexicon=require("./data/lexicon");var values=require("./data/lexicon/values");var tokenize=require("./methods/tokenization/tokenize");var parts_of_speech=require("./data/parts_of_speech");var word_rules=require("./data/word_rules");var wordnet_suffixes=require("./data/unambiguous_suffixes");var Sentence=require("./sentence");var Section=require("./section");var parents=require("./parents/parents");var particles=["in","out","on","off","behind","way","with","of","do","away","across","ahead","back","over","under","together","apart","up","upon","aback","down","about","before","after","around","to","forth","round","through","along","onto"];particles=particles.reduce(function(h,s){h[s]=true;return h},{});var merge_tokens=function(a,b){a.text+=" "+b.text;a.normalised+=" "+b.normalised;a.pos_reason+="|"+b.pos_reason;a.start=a.start||b.start;a.noun_capital=a.noun_capital&&b.noun_capital;a.punctuated=a.punctuated||b.punctuated;a.end=a.end||b.end;return a};var combine_tags=function(sentence){var arr=sentence.tokens||[];for(var i=0;i<=arr.length;i++){var next=arr[i+1];if(arr[i]&&next){var tag=arr[i].pos.tag;if(tag===next.pos.tag&&arr[i].punctuated!==true&&arr[i].noun_capital==next.noun_capital){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null}else if(tag==="NNP"&&next.pos.tag==="NN"||tag==="NN"&&next.pos.tag==="NNP"){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null;arr[i+1].pos=parts_of_speech["NNP"]}else if(tag==="CD"&&next.pos.tag==="CD"){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null}else if(tag==="NNAB"&&next.pos.parent==="noun"||arr[i].pos.parent==="noun"&&next.pos.tag==="NNAB"){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null}else if(arr[i].normalised==="will"&&next.pos.parent==="verb"){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null}else if(tag==="CD"&&(next.normalised==="and"||next.normalised==="the")&&arr[i+2]&&arr[i+2].pos.tag==="CD"){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null}else if(tag=="NN"&&arr[i].noun_capital&&(next.normalised=="of"||next.normalised=="and")&&arr[i+2]&&arr[i+2].noun_capital){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null;arr[i+2]=merge_tokens(arr[i+1],arr[i+2]);arr[i+1]=null}else if(arr[i].noun_capital&&next.normalised=="of"&&arr[i+2]&&arr[i+2].pos.tag=="DT"&&arr[i+3]&&arr[i+3].noun_capital){arr[i+1]=merge_tokens(arr[i],arr[i+1]);arr[i]=null;arr[i+2]=merge_tokens(arr[i+1],arr[i+2]);arr[i+1]=null;arr[i+3]=merge_tokens(arr[i+2],arr[i+3]);arr[i+2]=null}}}sentence.tokens=arr.filter(function(r){return r});return sentence};var combine_phrasal_verbs=function(sentence){var arr=sentence.tokens||[];for(var i=1;i<arr.length;i++){if(particles[arr[i].normalised]){if(lexicon[arr[i-1].normalised+" "+arr[i].normalised]){arr[i]=merge_tokens(arr[i-1],arr[i]);arr[i-1]=null}}}sentence.tokens=arr.filter(function(r){return r});return sentence};var lexicon_pass=function(w){if(lexicon.hasOwnProperty(w)){return parts_of_speech[lexicon[w]]}if(w.match(/^(over|under|out|-|un|re|en).{4}/)){var attempt=w.replace(/^(over|under|out|.*?-|un|re|en)/,"");return parts_of_speech[lexicon[attempt]]}};var rules_pass=function(w){for(var i=0;i<word_rules.length;i++){if(w.length>4&&w.match(word_rules[i].reg)){return parts_of_speech[word_rules[i].pos]}}};var fourth_pass=function(token,i,sentence){var last=sentence.tokens[i-1];var next=sentence.tokens[i+1];var strong_determiners={the:1,a:1,an:1};if((token.normalised=="march"||token.normalised=="april"||token.normalised=="may")&&(next&&next.pos.tag=="CD"||last&&last.pos.tag=="CD")){token.pos=parts_of_speech["CD"];token.pos_reason="may_is_date"}if(next&&token.pos.parent!=="noun"&&token.pos.parent!=="glue"&&next.pos.tag==="MD"){token.pos=parts_of_speech["NN"];token.pos_reason="before_modal"}if(last&&last.normalised=="will"&&!last.punctuated&&token.pos.parent=="noun"&&token.pos.tag!=="PRP"&&token.pos.tag!=="PP"){token.pos=parts_of_speech["VB"];token.pos_reason="after_will"}if(last&&last.normalised=="i"&&!last.punctuated&&token.pos.parent=="noun"){token.pos=parts_of_speech["VB"];token.pos_reason="after_i"}if(last&&token.pos.parent==="noun"&&token.pos.tag!=="PRP"&&token.pos.tag!=="PP"&&last.pos.tag==="RB"&&!last.start){token.pos=parts_of_speech["VB"];token.pos_reason="after_adverb"}if(next&&token.pos.parent==="adjective"&&next.pos.parent==="adjective"&&!token.punctuated){token.pos=parts_of_speech["RB"];token.pos_reason="consecutive_adjectives"}if(last&&token.pos.parent==="verb"&&strong_determiners[last.pos.normalised]&&token.pos.tag!="CP"){token.pos=parts_of_speech["NN"];token.pos_reason="determiner-verb"}if(last&&last.pos.tag==="CP"&&token.pos.tag!=="DT"&&token.pos.tag!=="RB"&&token.pos.tag!=="PRP"&&token.pos.parent!=="adjective"&&token.pos.parent!=="value"){token.pos=parts_of_speech["JJ"];token.pos_reason="copula-adjective"}if(last&&next&&last.pos.tag==="CP"&&token.pos.tag==="RB"&&next.pos.parent==="verb"){sentence.tokens[i+1].pos=parts_of_speech["JJ"];sentence.tokens[i+1].pos_reason="copula-adverb-adjective"}if(next&&next.pos.tag=="PRP"&&token.pos.tag!=="PP"&&token.pos.parent=="noun"&&!token.punctuated){token.pos=parts_of_speech["VB"];token.pos_reason="before_[him|her|it]"}if(last&&next&&last.pos.tag==="DT"&&next.pos.parent==="noun"&&token.pos.parent==="verb"){token.pos=parts_of_speech["JJ"];token.pos_reason="determiner-adjective-noun"}if(last&&last.pos.tag==="PRP"&&token.pos.tag==="JJ"){token.pos=parts_of_speech["VB"];token.pos_reason="adjective-after-pronoun"}return token};var handle_contractions=function(arr){var contractions={"i'd":["i","would"],"she'd":["she","would"],"he'd":["he","would"],"they'd":["they","would"],"we'd":["we","would"],"i'll":["i","will"],"she'll":["she","will"],"he'll":["he","will"],"they'll":["they","will"],"we'll":["we","will"],"i've":["i","have"],"they've":["they","have"],"we've":["we","have"],"should've":["should","have"],"would've":["would","have"],"could've":["could","have"],"must've":["must","have"],"i'm":["i","am"],"we're":["we","are"],"they're":["they","are"],cannot:["can","not"]};var before,after,fix;for(var i=0;i<arr.length;i++){if(contractions.hasOwnProperty(arr[i].normalised)){before=arr.slice(0,i);after=arr.slice(i+1,arr.length);fix=[{text:arr[i].text,normalised:contractions[arr[i].normalised][0],start:arr[i].start},{text:"",normalised:contractions[arr[i].normalised][1],start:undefined}];arr=before.concat(fix);arr=arr.concat(after);return handle_contractions(arr)}}return arr};var handle_ambiguous_contractions=function(arr){var ambiguous_contractions={"he's":"he","she's":"she","it's":"it","who's":"who","what's":"what","where's":"where","when's":"when","why's":"why","how's":"how"};var before,after,fix;for(var i=0;i<arr.length;i++){if(ambiguous_contractions.hasOwnProperty(arr[i].normalised)){before=arr.slice(0,i);after=arr.slice(i+1,arr.length);var chosen="is";for(var o=i+1;o<arr.length;o++){if(arr[o]&&arr[o].pos&&arr[o].pos.tag=="VBD"){chosen="has";break}}fix=[{text:arr[i].text,normalised:ambiguous_contractions[arr[i].normalised],start:arr[i].start,pos:parts_of_speech[lexicon[ambiguous_contractions[arr[i].normalised]]],pos_reason:"ambiguous_contraction"},{text:"",normalised:chosen,start:undefined,pos:parts_of_speech[lexicon[chosen]],pos_reason:"silent_contraction"}];arr=before.concat(fix);arr=arr.concat(after);return handle_ambiguous_contractions(arr)}}return arr};var main=function(text,options){options=options||{};if(!text||!text.match(/[a-z0-9]/i)){return new Section([])}var sentences=tokenize(text);sentences.forEach(function(sentence){var first=sentence.tokens[0];if(first){if(sentence.tokens[1]&&sentence.tokens[1].noun_capital&&!lexicon_pass(first.normalised)){sentence.tokens[0].noun_capital=true}}sentence.tokens=handle_contractions(sentence.tokens);sentence.tokens=sentence.tokens.map(function(token){if(token.noun_capital&&!values[token.normalised]){token.pos=parts_of_speech["NN"];token.pos_reason="noun_capitalised";return token}var lex=lexicon_pass(token.normalised);if(lex){token.pos=lex;token.pos_reason="lexicon";if(token.pos.tag==="NNAB"){token.punctuated=false}return token}if(!token.normalised){token.pos=parts_of_speech["UH"];token.pos_reason="wordless_string";return token}var len=token.normalised.length;if(len>4){var suffix=token.normalised.substr(len-4,len-1);if(wordnet_suffixes.hasOwnProperty(suffix)){token.pos=parts_of_speech[wordnet_suffixes[suffix]];token.pos_reason="wordnet suffix";return token}}var r=rules_pass(token.normalised);if(r){token.pos=r;token.pos_reason="regex suffix";return token}if(parseFloat(token.normalised)){token.pos=parts_of_speech["CD"];token.pos_reason="parsefloat";return token}return token});sentence.tokens=sentence.tokens.map(function(token,i){if(token.pos_reason!=="lexicon"&&token.normalised.match(/.ed$/)){token.pos=parts_of_speech["VB"];token.pos_reason="ed"}return token});sentence.tokens=handle_ambiguous_contractions(sentence.tokens);var need=null;var reason="";sentence.tokens=sentence.tokens.map(function(token,i){var next=sentence.tokens[i+1];if(token.pos){if(token.normalised=="the"||token.normalised=="a"||token.normalised=="an"||token.pos.tag==="PP"){need="noun";reason=token.pos.name;return token}if(token.pos.tag==="PRP"&&token.pos.tag!=="PP"||token.pos.tag==="MD"){need="verb";reason=token.pos.name;return token}}if(token.pos){if(need=="verb"&&token.pos.parent=="noun"&&(!next||next.pos&&next.pos.parent!="noun")){if(!next||!next.pos||next.pos.parent!=need){token.pos=parts_of_speech["VB"];token.pos_reason="signal from "+reason;need=null}}if(need=="noun"&&token.pos.parent=="verb"&&(!next||next.pos&&next.pos.parent!="verb")){if(!next||!next.pos||next.pos.parent!=need){token.pos=parts_of_speech["NN"];token.pos_reason="signal from "+reason;need=null}}}if(need&&!token.pos){if(!next||!next.pos||next.pos.parent!=need){token.pos=parts_of_speech[need];token.pos_reason="signal from "+reason;need=null}}if(need==="verb"&&token.pos&&token.pos.parent==="verb"){need=null}if(need==="noun"&&token.pos&&token.pos.parent==="noun"){need=null}return token});var has={};sentence.tokens.forEach(function(token){if(token.pos){has[token.pos.parent]=true}});sentence.tokens=sentence.tokens.map(function(token,i){if(!token.pos){if(has["adjective"]&&has["noun"]&&!has["verb"]){token.pos=parts_of_speech["VB"];token.pos_reason="need one verb";has["verb"]=true;return token}token.pos=parts_of_speech["NN"];token.pos_reason="noun fallback"}return token});sentence.tokens=sentence.tokens.map(function(token,i){return fourth_pass(token,i,sentence)});sentence.tokens=sentence.tokens.map(function(token,i){return fourth_pass(token,i,sentence)})});if(!options.dont_combine){sentences=sentences.map(function(s){return combine_tags(s)});sentences=sentences.map(function(s){return combine_phrasal_verbs(s)})}sentences=sentences.map(function(s){var sentence=new Sentence(s.tokens);sentence.type=s.type;return sentence});sentences=sentences.map(function(s){s.tokens=s.tokens.map(function(token,i){token.analysis=parents[token.pos.parent](token.normalised,s,i);return token});return s});sentences=sentences.map(function(sentence,i){sentence.last=sentences[i-1];sentence.next=sentences[i+1];return sentence});return new Section(sentences)};module.exports=main},{"./data/lexicon":44,"./data/lexicon/values":54,"./data/parts_of_speech":56,"./data/unambiguous_suffixes":57,"./data/word_rules":58,"./methods/tokenization/tokenize":64,"./parents/parents":77,"./section":88,"./sentence":89}],88:[function(require,module,exports){var Section=function(sentences){var the=this;the.sentences=sentences||[];the.text=function(){return the.sentences.map(function(s){return s.text()}).join(" ")};the.tense=function(){return the.sentences.map(function(s){return s.tense()})};the.nouns=function(){return the.sentences.map(function(s){return s.nouns()}).reduce(function(arr,a){return arr.concat(a)},[])};the.entities=function(options){return the.sentences.map(function(s){return s.entities(options)}).reduce(function(arr,a){return arr.concat(a)},[])};the.people=function(){return the.sentences.map(function(s){return s.people()}).reduce(function(arr,a){return arr.concat(a)},[])};the.adjectives=function(){return the.sentences.map(function(s){return s.adjectives()}).reduce(function(arr,a){return arr.concat(a)},[])};the.verbs=function(){return the.sentences.map(function(s){return s.verbs()}).reduce(function(arr,a){return arr.concat(a)},[])};the.adverbs=function(){return the.sentences.map(function(s){return s.adverbs()}).reduce(function(arr,a){return arr.concat(a)},[])};the.values=function(){return the.sentences.map(function(s){return s.values()}).reduce(function(arr,a){return arr.concat(a)},[])};the.tags=function(){return the.sentences.map(function(s){return s.tags()})};the.negate=function(){the.sentences=the.sentences.map(function(s){return s.negate()});return the};the.to_past=function(){the.sentences=the.sentences.map(function(s){return s.to_past()});return the};the.to_present=function(){the.sentences=the.sentences.map(function(s){return s.to_present()});return the};the.to_future=function(){the.sentences=the.sentences.map(function(s){return s.to_future()});return the}};module.exports=Section},{}],89:[function(require,module,exports){var Sentence=function(tokens){var the=this;the.tokens=tokens||[];var capitalise=function(s){return s.charAt(0).toUpperCase()+s.slice(1)};the.tense=function(){var verbs=the.tokens.filter(function(token){return token.pos.parent==="verb"});return verbs.map(function(v){return v.analysis.tense})};the.to_past=function(){the.tokens=the.tokens.map(function(token){if(token.pos.parent==="verb"){token.text=token.analysis.to_past();token.normalised=token.text}return token});return the};the.to_present=function(){the.tokens=the.tokens.map(function(token){if(token.pos.parent==="verb"){token.text=token.analysis.to_present();token.normalised=token.text}return token});return the};the.to_future=function(){the.tokens=the.tokens.map(function(token){if(token.pos.parent==="verb"){token.text=token.analysis.to_future();token.normalised=token.text}return token});return the};the.insert=function(token,i){if(i&&token){the.tokens.splice(i,0,token)}};the.negate=function(){var logic_negate={everyone:"no one",everybody:"nobody",someone:"no one",somebody:"nobody",always:"never",is:"isn't",are:"aren't",was:"wasn't",will:"won't","didn't":"did","wouldn't":"would","couldn't":"could","shouldn't":"should","can't":"can","won't":"will","mustn't":"must","shan't":"shall",shant:"shall",did:"didn't",would:"wouldn't",could:"couldn't",should:"shouldn't",can:"can't",must:"mustn't"};for(var i=0;i<the.tokens.length;i++){var tok=the.tokens[i];if(tok.pos_reason==="ambiguous_contraction"){tok.text=tok.normalised}if(logic_negate[tok.normalised]&&(!the.tokens[i+1]||the.tokens[i+1].normalised!="not")){tok.text=logic_negate[tok.normalised];tok.normalised=logic_negate[tok.normalised];if(tok.capitalised){tok.text=capitalise(tok.text)}return the}if(tok.pos.parent=="verb"){if(tok.analysis.negative()){if(the.tokens[i+1]&&the.tokens[i+1].normalised=="not"){the.tokens.splice(i+1,1)}return the}if(tok.normalised.match(/^will /i)){tok.text=tok.text.replace(/^will /i,"won't ");tok.normalised=tok.text;if(tok.capitalised){tok.text=capitalise(tok.text)}return the}if(tok.analysis.form=="infinitive"&&tok.analysis.form!="future"){tok.text="don't "+(tok.analysis.conjugate().infinitive||tok.text);tok.normalised=tok.text.toLowerCase();return the}if(tok.analysis.form=="gerund"){tok.text="not "+tok.text;tok.normalised=tok.text.toLowerCase();return the}if(tok.analysis.tense=="past"){tok.text="didn't "+(tok.analysis.conjugate().infinitive||tok.text);tok.normalised=tok.text.toLowerCase();return the}if(tok.analysis.tense=="present"){tok.text="doesn't "+(tok.analysis.conjugate().infinitive||tok.text);tok.normalised=tok.text.toLowerCase();return the}if(tok.analysis.tense=="future"){if(tok.normalised=="will"){tok.normalised="won't";tok.text="won't"}else{tok.text=tok.text.replace(/^will /i,"won't ");tok.normalised=tok.normalised.replace(/^will /i,"won't ")}if(tok.capitalised){tok.text=capitalise(tok.text)}return the}return the}}return the};the.entities=function(options){var spots=[];options=options||{};the.tokens.forEach(function(token){if(token.pos.parent==="noun"&&token.analysis.is_entity()){spots.push(token)}});if(options.ignore_gerund){spots=spots.filter(function(t){return t.pos.tag!=="VBG"})}return spots};the.people=function(){return the.entities({}).filter(function(o){return o.analysis.is_person()})};the.text=function(){return the.tokens.map(function(s){return s.text}).join(" ")};the.verbs=function(){return the.tokens.filter(function(t){return t.pos.parent=="verb"})};the.adverbs=function(){return the.tokens.filter(function(t){return t.pos.parent=="adverb"})};the.nouns=function(){return the.tokens.filter(function(t){return t.pos.parent=="noun"})};the.adjectives=function(){return the.tokens.filter(function(t){return t.pos.parent=="adjective"})};the.values=function(){return the.tokens.filter(function(t){return t.pos.parent=="value"})};the.tags=function(){return the.tokens.map(function(t){return t.pos.tag})};the.referables=function(){var pronouns={he:undefined,she:undefined,they:undefined,it:undefined};the.tokens.forEach(function(t){if(t.pos.parent=="noun"&&t.pos.tag!="PRP"){pronouns[t.analysis.pronoun()]=t}});return pronouns};return the};module.exports=Sentence},{}],90:[function(require,module,exports){var pos=require("./pos");var main=function(text,options){options=options||{};var sentences=pos(text,options).sentences;var arr=sentences.reduce(function(arr,s){return arr.concat(s.entities(options))},[]);var ignore={};arr=arr.filter(function(o){if(o.analysis.is_person()){o.normalised.split(" ").forEach(function(s){ignore[s]=true})}if(ignore[o.normalised]){return false}return true});return arr};module.exports=main},{"./pos":87}],91:[function(require,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/;var rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g;var rtrimLeft=/^\s+/;var rtrimRight=/\s+$/;module.exports=function parsejson(data){if("string"!=typeof data||!data){return null}data=data.replace(rtrimLeft,"").replace(rtrimRight,"");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],92:[function(require,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],93:[function(require,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}return uri}},{}],94:[function(require,module,exports){var url=require("./url");var parser=require("socket.io-parser");var Manager=require("./manager");var debug=require("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri==="object"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var path=parsed.path;var sameNamespace=cache[id]&&path in cache[id].nsps;var newConnection=opts.forceNew||opts["force new connection"]||false===opts.multiplex||sameNamespace;var io;if(newConnection){debug("ignoring socket cache for %s",source);io=Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=Manager(source,opts)}io=cache[id]}if(parsed.query&&!opts.query){opts.query=parsed.query}else if(opts&&"object"===typeof opts.query){opts.query=encodeQueryString(opts.query)}return io.socket(parsed.path,opts)}function encodeQueryString(obj){var str=[];for(var p in obj){if(obj.hasOwnProperty(p)){str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]))}}return str.join("&")}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=require("./manager");exports.Socket=require("./socket")},{"./manager":95,"./socket":97,"./url":98,debug:20,"socket.io-parser":101}],95:[function(require,module,exports){var eio=require("engine.io-client");var Socket=require("./socket");var Emitter=require("component-emitter");var parser=require("socket.io-parser");var on=require("./on");var bind=require("component-bind");var debug=require("debug")("socket.io-client:manager");var indexOf=require("indexof");var Backoff=require("backo2");var has=Object.prototype.hasOwnProperty;module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&"object"===typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState="closed";this.uri=uri;this.connecting=[];this.lastPing=null;this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){if(has.call(this.nsps,nsp)){this.nsps[nsp].id=this.engine.id}}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn,opts){debug("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState="opening";this.skipReconnect=false;var openSub=on(socket,"open",function(){self.onopen();fn&&fn()});var errorSub=on(socket,"error",function(data){debug("connect_error");self.cleanup();self.readyState="closed";self.emitAll("connect_error",data);if(fn){var err=new Error("Connection error");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout);openSub.destroy();socket.close();socket.emit("error","timeout");self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug("open");this.cleanup();this.readyState="open";this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata")));this.subs.push(on(socket,"ping",bind(this,"onping")));this.subs.push(on(socket,"pong",bind(this,"onpong")));this.subs.push(on(socket,"error",bind(this,"onerror")));this.subs.push(on(socket,"close",bind(this,"onclose")));this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")))};Manager.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};Manager.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)};Manager.prototype.onerror=function(err){debug("error",err);this.emitAll("error",err)};Manager.prototype.socket=function(nsp,opts){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp,opts);this.nsps[nsp]=socket;var self=this;socket.on("connecting",onConnecting);socket.on("connect",function(){socket.id=self.engine.id});if(this.autoConnect){onConnecting()}}function onConnecting(){if(!~indexOf(self.connecting,socket)){self.connecting.push(socket)}}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connecting,socket);if(~index)this.connecting.splice(index,1);if(this.connecting.length)return;this.close()};Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;if(packet.query&&packet.type===0)packet.nsp+="?"+packet.query;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i],packet.options)}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){debug("cleanup");var subsLength=this.subs.length;for(var i=0;i<subsLength;i++){var sub=this.subs.shift();sub.destroy()}this.packetBuffer=[];this.encoding=false;this.lastPing=null;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){debug("disconnect");this.skipReconnect=true;this.reconnecting=false;if("opening"===this.readyState){this.cleanup()}this.backoff.reset();this.readyState="closed";if(this.engine)this.engine.close()};Manager.prototype.onclose=function(reason){debug("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug("attempting reconnect");self.emitAll("reconnect_attempt",self.backoff.attempts);self.emitAll("reconnecting",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug("reconnect attempt error");self.reconnecting=false;self.reconnect();self.emitAll("reconnect_error",err.data)}else{debug("reconnect success");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",attempt)}},{"./on":96,"./socket":97,backo2:14,"component-bind":17,"component-emitter":99,debug:20,"engine.io-client":22,indexof:37,"socket.io-parser":101}],96:[function(require,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],97:[function(require,module,exports){var parser=require("socket.io-parser");var Emitter=require("component-emitter");var toArray=require("to-array");var on=require("./on");var bind=require("component-bind");var debug=require("debug")("socket.io-client:socket");var hasBin=require("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};var emit=Emitter.prototype.emit;function Socket(io,nsp,opts){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true;if(opts&&opts.query){this.query=opts.query}if(this.io.autoConnect)this.open()}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"===this.io.readyState)this.onopen();this.emit("connecting");return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift("message");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};packet.options={};packet.options.compress=!this.flags||false!==this.flags.compress;if("function"===typeof args[args.length-1]){debug("emitting packet with ack id %d",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}delete this.flags;return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug("transport is open - connecting");if("/"!==this.nsp){if(this.query){this.packet({type:parser.CONNECT,query:this.query})}else{this.packet({type:parser.CONNECT})}}};Socket.prototype.onclose=function(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!==this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){var ack=this.acks[packet.id];if("function"===typeof ack){debug("calling ack %s with %j",packet.id,packet.data);ack.apply(this,packet.data);delete this.acks[packet.id]}else{debug("bad ack %s",packet.id)}};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this};Socket.prototype.compress=function(compress){this.flags=this.flags||{};this.flags.compress=compress;return this}},{"./on":96,"component-bind":17,"component-emitter":99,debug:20,"has-binary":35,"socket.io-parser":101,"to-array":107}],98:[function(require,module,exports){(function(global){var parseuri=require("parseuri");var debug=require("debug")("socket.io-client:url");module.exports=url;function url(uri,loc){var obj=uri;loc=loc||global.location;if(null==uri)uri=loc.protocol+"//"+loc.host;if("string"===typeof uri){if("/"===uri.charAt(0)){if("/"===uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.host+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!==typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";var ipv6=obj.host.indexOf(":")!==-1;var host=ipv6?"["+obj.host+"]":obj.host;obj.id=obj.protocol+"://"+host+":"+obj.port;obj.href=obj.protocol+"://"+host+(loc&&loc.port===obj.port?"":":"+obj.port);return obj}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:20,parseuri:93}],99:[function(require,module,exports){arguments[4][32][0].apply(exports,arguments)},{dup:32}],100:[function(require,module,exports){(function(global){var isArray=require("isarray");var isBuf=require("./is-buffer");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&"object"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&"object"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":102,isarray:38}],101:[function(require,module,exports){var debug=require("debug")("socket.io-parser");var json=require("json3");var Emitter=require("component-emitter");var binary=require("./binary");var isBuf=require("./is-buffer");exports.protocol=4;exports.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug("encoding packet %j",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str="";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+="-"}if(obj.nsp&&"/"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=",";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=",";str+=json.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",packet)}}else{this.emit("decoded",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf="";while(str.charAt(++i)!="-"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"==str.charAt(i+1)){p.nsp="";while(++i){var c=str.charAt(i);if(","==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp="/"}var next=str.charAt(i+1);if(""!==next&&Number(next)==next){p.id="";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){p=tryParse(p,str.substr(i))}debug("decoded %s as %j",str,p);return p}function tryParse(p,str){try{p.data=json.parse(str)}catch(e){return error()}return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:"parser error"}}},{"./binary":100,"./is-buffer":102,"component-emitter":18,debug:103,json3:40}],102:[function(require,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],103:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{"./debug":104}],104:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:105}],105:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=""+str;if(str.length>1e4)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],106:[function(require,module,exports){var self=self||{};var THREE={REVISION:"72"};if(typeof define==="function"&&define.amd){define("three",THREE)}else if("undefined"!==typeof exports&&"undefined"!==typeof module){module.exports=THREE}if(self.requestAnimationFrame===undefined||self.cancelAnimationFrame===undefined){(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!self.requestAnimationFrame;++x){self.requestAnimationFrame=self[vendors[x]+"RequestAnimationFrame"];self.cancelAnimationFrame=self[vendors[x]+"CancelAnimationFrame"]||self[vendors[x]+"CancelRequestAnimationFrame"]}if(self.requestAnimationFrame===undefined&&self.setTimeout!==undefined){self.requestAnimationFrame=function(callback){var currTime=Date.now(),timeToCall=Math.max(0,16-(currTime-lastTime));var id=self.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(self.cancelAnimationFrame===undefined&&self.clearTimeout!==undefined){self.cancelAnimationFrame=function(id){self.clearTimeout(id)}}})()}if(Math.sign===undefined){Math.sign=function(x){return x<0?-1:x>0?1:+x}}if(Function.prototype.name===undefined&&Object.defineProperty!==undefined){Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}})}THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.NeverDepth=0;THREE.AlwaysDepth=1;THREE.LessDepth=2;THREE.LessEqualDepth=3;THREE.EqualDepth=4;THREE.GreaterEqualDepth=5;THREE.GreaterDepth=6;THREE.NotEqualDepth=7;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.HalfFloatType=1025;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(vector,camera){console.warn("THREE.Projector: .projectVector() is now vector.project().");vector.project(camera)};this.unprojectVector=function(vector,camera){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");vector.unproject(camera)};this.pickingRay=function(vector,camera){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.Color=function(color){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(color)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(value){if(value instanceof THREE.Color){this.copy(value)}else if(typeof value==="number"){this.setHex(value)}else if(typeof value==="string"){this.setStyle(value)}return this},setHex:function(hex){hex=Math.floor(hex);this.r=(hex>>16&255)/255;this.g=(hex>>8&255)/255;this.b=(hex&255)/255;return this},setRGB:function(r,g,b){this.r=r;this.g=g;this.b=b;return this},setHSL:function(){function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*6*(2/3-t);return p}return function(h,s,l){h=THREE.Math.euclideanModulo(h,1);s=THREE.Math.clamp(s,0,1);l=THREE.Math.clamp(l,0,1);if(s===0){this.r=this.g=this.b=l}else{var p=l<=.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this}}(),setStyle:function(style){var parseAlpha=function(strAlpha){var alpha=parseFloat(strAlpha);if(alpha<1){console.warn("THREE.Color: Alpha component of color "+style+" will be ignored.")}return alpha};var m;if(m=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){var color;var name=m[1];var components=m[2];switch(name){case"rgb":if(color=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*$/.exec(components)){this.r=Math.min(255,parseInt(color[1],10))/255;this.g=Math.min(255,parseInt(color[2],10))/255;this.b=Math.min(255,parseInt(color[3],10))/255;return this}if(color=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(components)){this.r=Math.min(100,parseInt(color[1],10))/100;this.g=Math.min(100,parseInt(color[2],10))/100;this.b=Math.min(100,parseInt(color[3],10))/100;return this}break;case"rgba":if(color=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(components)){this.r=Math.min(255,parseInt(color[1],10))/255;this.g=Math.min(255,parseInt(color[2],10))/255;this.b=Math.min(255,parseInt(color[3],10))/255;parseAlpha(color[4]);return this}if(color=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(components)){this.r=Math.min(100,parseInt(color[1],10))/100;this.g=Math.min(100,parseInt(color[2],10))/100;this.b=Math.min(100,parseInt(color[3],10))/100;parseAlpha(color[4]);return this}break;case"hsl":if(color=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(components)){var h=parseFloat(color[1]);var s=parseInt(color[2],10)/100;var l=parseInt(color[3],10)/100;return this.setHSL(h,s,l)}break;case"hsla":if(color=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(components)){var h=parseFloat(color[1]);var s=parseInt(color[2],10)/100;var l=parseInt(color[3],10)/100;parseAlpha(color[4]);return this.setHSL(h,s,l)}break}}else if(m=/^\#([A-Fa-f0-9]+)$/.exec(style)){var hex=m[1];var size=hex.length;if(size===3){this.r=parseInt(hex.charAt(0)+hex.charAt(0),16)/255;this.g=parseInt(hex.charAt(1)+hex.charAt(1),16)/255;this.b=parseInt(hex.charAt(2)+hex.charAt(2),16)/255;return this}else if(size===6){this.r=parseInt(hex.charAt(0)+hex.charAt(1),16)/255;this.g=parseInt(hex.charAt(2)+hex.charAt(3),16)/255;this.b=parseInt(hex.charAt(4)+hex.charAt(5),16)/255;return this}}if(style&&style.length>0){var hex=THREE.ColorKeywords[style];if(hex!==undefined){this.setHex(hex)}else{console.warn("THREE.Color: Unknown color "+style)}}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(color){this.r=color.r;this.g=color.g;this.b=color.b;return this},copyGammaToLinear:function(color,gammaFactor){if(gammaFactor===undefined)gammaFactor=2;this.r=Math.pow(color.r,gammaFactor);this.g=Math.pow(color.g,gammaFactor);this.b=Math.pow(color.b,gammaFactor);return this},copyLinearToGamma:function(color,gammaFactor){if(gammaFactor===undefined)gammaFactor=2;var safeInverse=gammaFactor>0?1/gammaFactor:1;this.r=Math.pow(color.r,safeInverse);this.g=Math.pow(color.g,safeInverse);this.b=Math.pow(color.b,safeInverse);return this},convertGammaToLinear:function(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(optionalTarget){var hsl=optionalTarget||{h:0,s:0,l:0};var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=lightness<=.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this},add:function(color){this.r+=color.r;this.g+=color.g;this.b+=color.b;return this},addColors:function(color1,color2){this.r=color1.r+color2.r;this.g=color1.g+color2.g;this.b=color1.b+color2.b;return this},addScalar:function(s){this.r+=s;this.g+=s;this.b+=s;return this},multiply:function(color){this.r*=color.r;this.g*=color.g;this.b*=color.b;return this},multiplyScalar:function(s){this.r*=s;this.g*=s;this.b*=s;return this},lerp:function(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(array){this.r=array[0];this.g=array[1];this.b=array[2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.r;array[offset+1]=this.g;array[offset+2]=this.b;return array}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(x,y,z,w){this._x=x||0;this._y=y||0;this._z=z||0;this._w=w!==undefined?w:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get w(){return this._w},set w(value){this._w=value;this.onChangeCallback()},set:function(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(quaternion){this._x=quaternion.x;this._y=quaternion.y;this._z=quaternion.z;this._w=quaternion.w;this.onChangeCallback();return this},setFromEuler:function(euler,update){if(euler instanceof THREE.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var c1=Math.cos(euler._x/2);var c2=Math.cos(euler._y/2);var c3=Math.cos(euler._z/2);var s1=Math.sin(euler._x/2);var s2=Math.sin(euler._y/2);var s3=Math.sin(euler._z/2);var order=euler.order;if(order==="XYZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(order==="YXZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(order==="ZXY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(order==="ZYX"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(order==="YZX"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(order==="XZY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}if(update!==false)this.onChangeCallback();return this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);this._x=axis.x*s;this._y=axis.y*s;this._z=axis.z*s;this._w=Math.cos(halfAngle);this.onChangeCallback();return this},setFromRotationMatrix:function(m){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(trace>0){s=.5/Math.sqrt(trace+1);this._w=.25/s;this._x=(m32-m23)*s;this._y=(m13-m31)*s;this._z=(m21-m12)*s}else if(m11>m22&&m11>m33){s=2*Math.sqrt(1+m11-m22-m33);this._w=(m32-m23)/s;this._x=.25*s;this._y=(m12+m21)/s;this._z=(m13+m31)/s}else if(m22>m33){s=2*Math.sqrt(1+m22-m11-m33);this._w=(m13-m31)/s;this._x=(m12+m21)/s;this._y=.25*s;this._z=(m23+m32)/s}else{s=2*Math.sqrt(1+m33-m11-m22);this._w=(m21-m12)/s;this._x=(m13+m31)/s;this._y=(m23+m32)/s;this._z=.25*s}this.onChangeCallback();return this},setFromUnitVectors:function(){var v1,r;var EPS=1e-6;return function(vFrom,vTo){if(v1===undefined)v1=new THREE.Vector3;r=vFrom.dot(vTo)+1;if(r<EPS){r=0;if(Math.abs(vFrom.x)>Math.abs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0)}else{v1.set(0,-vFrom.z,vFrom.y)}}else{v1.crossVectors(vFrom,vTo)}this._x=v1.x;this._y=v1.y;this._z=v1.z;this._w=r;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var l=this.length();if(l===0){this._x=0;this._y=0;this._z=0;this._w=1}else{l=1/l;this._x=this._x*l;this._y=this._y*l;this._z=this._z*l;this._w=this._w*l}this.onChangeCallback();return this},multiply:function(q,p){if(p!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(q,p)}return this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w;var qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;this.onChangeCallback();return this},multiplyVector3:function(vector){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return vector.applyQuaternion(this)},slerp:function(qb,t){if(t===0)return this;if(t===1)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w;var cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0){this._w=-qb._w;this._x=-qb._x;this._y=-qb._y;this._z=-qb._z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(cosHalfTheta>=1){this._w=w;this._x=x;this._y=y;this._z=z;return this}var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001){this._w=.5*(w+this._w);this._x=.5*(x+this._x);this._y=.5*(y+this._y);this._z=.5*(z+this._z);return this}var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this._w=w*ratioA+this._w*ratioB;this._x=x*ratioA+this._x*ratioB;this._y=y*ratioA+this._y*ratioB;this._z=z*ratioA+this._z*ratioB;this.onChangeCallback();return this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function(array,offset){if(offset===undefined)offset=0;this._x=array[offset];this._y=array[offset+1];this._z=array[offset+2];this._w=array[offset+3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._w;return array},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){}};THREE.Quaternion.slerp=function(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)};THREE.Vector2=function(x,y){this.x=x||0;this.y=y||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(x,y){this.x=x;this.y=y;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(v){this.x=v.x;this.y=v.y;return this},add:function(v,w){if(w!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;return this},addScalar:function(s){this.x+=s;this.y+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(v,s){this.x+=v.x*s;this.y+=v.y*s;return this},sub:function(v,w){if(w!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;return this},subScalar:function(s){this.x-=s;this.y-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(v){this.x*=v.x;this.y*=v.y;return this},multiplyScalar:function(s){this.x*=s;this.y*=s;return this},divide:function(v){this.x/=v.x;this.y/=v.y;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar}else{this.x=0;this.y=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}return this},clampScalar:function(){var min,max;return function clampScalar(minVal,maxVal){if(min===undefined){min=new THREE.Vector2;max=new THREE.Vector2}min.set(minVal,minVal);max.set(maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];return this}};THREE.Vector3=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},add:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(v,s){this.x+=v.x*s;this.y+=v.y*s;this.z+=v.z*s;return this},sub:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;return this},subScalar:function(s){this.x-=s;this.y-=s;this.z-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(v,w)}this.x*=v.x;this.y*=v.y;this.z*=v.z;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var quaternion;return function applyEuler(euler){if(euler instanceof THREE.Euler===false){console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromEuler(euler));return this}}(),applyAxisAngle:function(){var quaternion;return function applyAxisAngle(axis,angle){if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle));return this}}(),applyMatrix3:function(m){var x=this.x;var y=this.y;var z=this.z;var e=m.elements;this.x=e[0]*x+e[3]*y+e[6]*z;this.y=e[1]*x+e[4]*y+e[7]*z;this.z=e[2]*x+e[5]*y+e[8]*z;return this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12];this.y=e[1]*x+e[5]*y+e[9]*z+e[13];this.z=e[2]*x+e[6]*y+e[10]*z+e[14];return this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;var d=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*d;this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*d;this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*d;return this},applyQuaternion:function(q){var x=this.x;var y=this.y;var z=this.z;var qx=q.x;var qy=q.y;var qz=q.z;var qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this},project:function(){var matrix;return function project(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld));return this.applyProjection(matrix)}}(),unproject:function(){var matrix;return function unproject(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix));return this.applyProjection(matrix)}}(),transformDirection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z;this.y=e[1]*x+e[5]*y+e[9]*z;this.z=e[2]*x+e[6]*y+e[10]*z;this.normalize();return this},divide:function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar}else{this.x=0;this.y=0;this.z=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}return this},clampScalar:function(){var min,max;return function clampScalar(minVal,maxVal){if(min===undefined){min=new THREE.Vector3;max=new THREE.Vector3}min.set(minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},cross:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(v,w)}var x=this.x,y=this.y,z=this.z;this.x=y*v.z-z*v.y;this.y=z*v.x-x*v.z;this.z=x*v.y-y*v.x;return this},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this},projectOnVector:function(){var v1,dot;return function projectOnVector(vector){if(v1===undefined)v1=new THREE.Vector3;v1.copy(vector).normalize();dot=this.dot(v1);return this.copy(v1).multiplyScalar(dot)}}(),projectOnPlane:function(){var v1;return function projectOnPlane(planeNormal){if(v1===undefined)v1=new THREE.Vector3;v1.copy(this).projectOnVector(planeNormal);return this.sub(v1)}}(),reflect:function(){var v1;return function reflect(normal){if(v1===undefined)v1=new THREE.Vector3;return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function(v){var theta=this.dot(v)/(this.length()*v.length());return Math.acos(THREE.Math.clamp(theta,-1,1))},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x;var dy=this.y-v.y;var dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},setEulerFromRotationMatrix:function(m,order){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(q,order){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(m){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(m)},getScaleFromMatrix:function(m){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(m)},getColumnFromMatrix:function(index,matrix){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(index,matrix)},setFromMatrixPosition:function(m){this.x=m.elements[12];this.y=m.elements[13];this.z=m.elements[14];return this},setFromMatrixScale:function(m){var sx=this.set(m.elements[0],m.elements[1],m.elements[2]).length();var sy=this.set(m.elements[4],m.elements[5],m.elements[6]).length();var sz=this.set(m.elements[8],m.elements[9],m.elements[10]).length();this.x=sx;this.y=sy;this.z=sz;return this},setFromMatrixColumn:function(index,matrix){var offset=index*4;var me=matrix.elements;this.x=me[offset];this.y=me[offset+1];this.z=me[offset+2];return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];this.z=attribute.array[index+2];return this}};THREE.Vector4=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==undefined?w:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setW:function(w){this.w=w;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w!==undefined?v.w:1;return this},add:function(v,w){if(w!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(v,s){this.x+=v.x*s;this.y+=v.y*s;this.z+=v.z*s;this.w+=v.w*s;return this},sub:function(v,w){if(w!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},subScalar:function(s){this.x-=s;this.y-=s;this.z-=s;this.w-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;this.w*=scalar;return this},applyMatrix4:function(m){var x=this.x;var y=this.y;var z=this.z;var w=this.w;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar;this.w*=invScalar}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);if(s<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s}return this},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,epsilon=.01,epsilon2=.1,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<epsilon&&Math.abs(m13-m31)<epsilon&&Math.abs(m23-m32)<epsilon){if(Math.abs(m12+m21)<epsilon2&&Math.abs(m13+m31)<epsilon2&&Math.abs(m23+m32)<epsilon2&&Math.abs(m11+m22+m33-3)<epsilon2){this.set(1,0,0,0);return this}angle=Math.PI;var xx=(m11+1)/2;var yy=(m22+1)/2;var zz=(m33+1)/2;var xy=(m12+m21)/4;var xz=(m13+m31)/4;var yz=(m23+m32)/4;if(xx>yy&&xx>zz){if(xx<epsilon){x=0;y=.707106781;z=.707106781}else{x=Math.sqrt(xx);y=xy/x;z=xz/x}}else if(yy>zz){if(yy<epsilon){x=.707106781;y=0;z=.707106781}else{y=Math.sqrt(yy);x=xy/y;z=yz/y}}else{if(zz<epsilon){x=.707106781;y=.707106781;z=0}else{z=Math.sqrt(zz);x=xz/z;y=yz/z}}this.set(x,y,z,angle);return this}var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));if(Math.abs(s)<.001)s=1;this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=Math.acos((m11+m22+m33-1)/2);return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}if(this.w>v.w){this.w=v.w}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}if(this.w<v.w){this.w=v.w}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}if(this.w<min.w){this.w=min.w}else if(this.w>max.w){this.w=max.w}return this},clampScalar:function(){var min,max;return function clampScalar(minVal,maxVal){if(min===undefined){min=new THREE.Vector4;max=new THREE.Vector4}min.set(minVal,minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];this.w=array[offset+3];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;array[offset+3]=this.w;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];this.z=attribute.array[index+2];this.w=attribute.array[index+3];return this}};THREE.Euler=function(x,y,z,order){this._x=x||0;this._y=y||0;this._z=z||0;this._order=order||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get order(){return this._order},set order(value){this._order=value;this.onChangeCallback()},set:function(x,y,z,order){this._x=x;this._y=y;this._z=z;this._order=order||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(euler){this._x=euler._x;this._y=euler._y;this._z=euler._z;this._order=euler._order;this.onChangeCallback();return this},setFromRotationMatrix:function(m,order,update){var clamp=THREE.Math.clamp;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this._order;if(order==="XYZ"){this._y=Math.asin(clamp(m13,-1,1));if(Math.abs(m13)<.99999){this._x=Math.atan2(-m23,m33);this._z=Math.atan2(-m12,m11)}else{this._x=Math.atan2(m32,m22);this._z=0}}else if(order==="YXZ"){this._x=Math.asin(-clamp(m23,-1,1));if(Math.abs(m23)<.99999){this._y=Math.atan2(m13,m33);this._z=Math.atan2(m21,m22)}else{this._y=Math.atan2(-m31,m11);this._z=0}}else if(order==="ZXY"){this._x=Math.asin(clamp(m32,-1,1));if(Math.abs(m32)<.99999){this._y=Math.atan2(-m31,m33);this._z=Math.atan2(-m12,m22)}else{this._y=0;this._z=Math.atan2(m21,m11)}}else if(order==="ZYX"){this._y=Math.asin(-clamp(m31,-1,1));if(Math.abs(m31)<.99999){this._x=Math.atan2(m32,m33);this._z=Math.atan2(m21,m11)}else{this._x=0;this._z=Math.atan2(-m12,m22)}}else if(order==="YZX"){this._z=Math.asin(clamp(m21,-1,1));if(Math.abs(m21)<.99999){this._x=Math.atan2(-m23,m22);this._y=Math.atan2(-m31,m11)}else{this._x=0;this._y=Math.atan2(m13,m33)}}else if(order==="XZY"){this._z=Math.asin(-clamp(m12,-1,1));if(Math.abs(m12)<.99999){this._x=Math.atan2(m32,m22);this._y=Math.atan2(m13,m11)}else{this._x=Math.atan2(-m23,m33);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order)}this._order=order;if(update!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var matrix;return function(q,order,update){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.makeRotationFromQuaternion(q);this.setFromRotationMatrix(matrix,order,update);return this}}(),setFromVector3:function(v,order){return this.set(v.x,v.y,v.z,order||this._order)},reorder:function(){var q=new THREE.Quaternion;return function(newOrder){q.setFromEuler(this);this.setFromQuaternion(q,newOrder)}}(),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function(array){this._x=array[0];this._y=array[1];this._z=array[2];if(array[3]!==undefined)this._order=array[3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._order;return array},toVector3:function(optionalResult){if(optionalResult){return optionalResult.set(this._x,this._y,this._z)}else{return new THREE.Vector3(this._x,this._y,this._z)}},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){}};THREE.Line3=function(start,end){this.start=start!==undefined?start:new THREE.Vector3;this.end=end!==undefined?end:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(start,end){this.start.copy(start);this.end.copy(end);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(line){this.start.copy(line.start);this.end.copy(line.end);return this},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var startP=new THREE.Vector3;var startEnd=new THREE.Vector3;return function(point,clampToLine){startP.subVectors(point,this.start);startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd);var startEnd_startP=startEnd.dot(startP);var t=startEnd_startP/startEnd2;if(clampToLine){t=THREE.Math.clamp(t,0,1)}return t}}(),closestPointToPoint:function(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine);var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},applyMatrix4:function(matrix){this.start.applyMatrix4(matrix);this.end.applyMatrix4(matrix);return this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)}};THREE.Box2=function(min,max){this.min=min!==undefined?min:new THREE.Vector2(Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector2;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}};THREE.Box3=function(min,max){this.min=min!==undefined?min:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),setFromObject:function(){var v1=new THREE.Vector3;return function(object){var scope=this;object.updateMatrixWorld(true);this.makeEmpty();object.traverse(function(node){var geometry=node.geometry;if(geometry!==undefined){if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;for(var i=0,il=vertices.length;i<il;i++){v1.copy(vertices[i]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}else if(geometry instanceof THREE.BufferGeometry&&geometry.attributes["position"]!==undefined){var positions=geometry.attributes["position"].array;for(var i=0,il=positions.length;i<il;i+=3){v1.set(positions[i],positions[i+1],positions[i+2]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),getBoundingSphere:function(){var v1=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Sphere;result.center=this.center();result.radius=this.size(v1).length()*.5;return result}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},applyMatrix4:function(){var points=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(matrix){points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);this.makeEmpty();this.setFromPoints(points);return this}}(),translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;te[0]=n11;te[3]=n12;te[6]=n13;te[1]=n21;te[4]=n22;te[7]=n23;te[2]=n31;te[5]=n32;te[8]=n33;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(m){var me=m.elements;this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8]);return this},multiplyVector3:function(vector){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return vector.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1;return function(array,offset,length){if(v1===undefined)v1=new THREE.Vector3;if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset;i<length;i+=3,j+=3){v1.fromArray(array,j);v1.applyMatrix3(this);v1.toArray(array,j)}return array}}(),applyToBuffer:function(){var v1;return function applyToBuffer(buffer,offset,length){if(v1===undefined)v1=new THREE.Vector3;if(offset===undefined)offset=0;if(length===undefined)length=buffer.length/buffer.itemSize;for(var i=0,j=offset;i<length;i++,j++){v1.x=buffer.getX(j);v1.y=buffer.getY(j);v1.z=buffer.getZ(j);v1.applyMatrix3(this);buffer.setXYZ(v1.x,v1.y,v1.z)}return buffer}}(),multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[3]*=s;te[6]*=s;te[1]*=s;te[4]*=s;te[7]*=s;te[2]*=s;te[5]*=s;te[8]*=s;return this},determinant:function(){var te=this.elements;var a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(matrix,throwOnInvertible){var me=matrix.elements;var te=this.elements;te[0]=me[10]*me[5]-me[6]*me[9];te[1]=-me[10]*me[1]+me[2]*me[9];te[2]=me[6]*me[1]-me[2]*me[5];te[3]=-me[10]*me[4]+me[6]*me[8];te[4]=me[10]*me[0]-me[2]*me[8];te[5]=-me[6]*me[0]+me[2]*me[4];te[6]=me[9]*me[4]-me[5]*me[8];te[7]=-me[9]*me[0]+me[1]*me[8];te[8]=me[5]*me[0]-me[1]*me[4];var det=me[0]*te[0]+me[1]*te[3]+me[2]*te[6];if(det===0){var msg="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{console.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},transpose:function(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];return array},getNormalMatrix:function(m){this.getInverse(m).transpose();return this},transposeIntoArray:function(r){var m=this.elements;r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8]]}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(m){this.elements.set(m.elements);return this},extractPosition:function(m){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(m)},copyPosition:function(m){var te=this.elements;var me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this},extractBasis:function(xAxis,yAxis,zAxis){var te=this.elements;xAxis.set(te[0],te[1],te[2]);yAxis.set(te[4],te[5],te[6]);zAxis.set(te[8],te[9],te[10]);return this},makeBasis:function(xAxis,yAxis,zAxis){this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1);return this},extractRotation:function(){var v1;return function(m){if(v1===undefined)v1=new THREE.Vector3;var te=this.elements;var me=m.elements;var scaleX=1/v1.set(me[0],me[1],me[2]).length();var scaleY=1/v1.set(me[4],me[5],me[6]).length();var scaleZ=1/v1.set(me[8],me[9],me[10]).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this}}(),makeRotationFromEuler:function(euler){if(euler instanceof THREE.Euler===false){console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var te=this.elements;var x=euler.x,y=euler.y,z=euler.z;var a=Math.cos(x),b=Math.sin(x);var c=Math.cos(y),d=Math.sin(y);var e=Math.cos(z),f=Math.sin(z);if(euler.order==="XYZ"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c}else if(euler.order==="YXZ"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c}else if(euler.order==="ZXY"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c}else if(euler.order==="ZYX"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c}else if(euler.order==="YZX"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f}else if(euler.order==="XZY"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},setRotationFromQuaternion:function(q){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(q)},makeRotationFromQuaternion:function(q){var te=this.elements;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},lookAt:function(){var x,y,z;return function(eye,target,up){if(x===undefined)x=new THREE.Vector3;if(y===undefined)y=new THREE.Vector3;if(z===undefined)z=new THREE.Vector3;var te=this.elements;z.subVectors(eye,target).normalize();if(z.length()===0){z.z=1}x.crossVectors(up,z).normalize();if(x.length()===0){z.x+=1e-4;x.crossVectors(up,z).normalize()}y.crossVectors(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this}}(),multiply:function(m,n){if(n!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(m,n)}return this.multiplyMatrices(this,m)},multiplyMatrices:function(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];var a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];var a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];var a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];var b11=be[0],b12=be[4],b13=be[8],b14=be[12];var b21=be[1],b22=be[5],b23=be[9],b24=be[13];var b31=be[2],b32=be[6],b33=be[10],b34=be[14];var b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this},multiplyToArray:function(a,b,r){var te=this.elements;this.multiplyMatrices(a,b);r[0]=te[0];r[1]=te[1];r[2]=te[2];r[3]=te[3];r[4]=te[4];r[5]=te[5];r[6]=te[6];r[7]=te[7];r[8]=te[8];r[9]=te[9];r[10]=te[10];r[11]=te[11];r[12]=te[12];r[13]=te[13];r[14]=te[14];r[15]=te[15];return this},multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this},multiplyVector3:function(vector){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return vector.applyProjection(this)},multiplyVector4:function(vector){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1;return function(array,offset,length){if(v1===undefined)v1=new THREE.Vector3;if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset;i<length;i+=3,j+=3){v1.fromArray(array,j);v1.applyMatrix4(this);v1.toArray(array,j)}return array}}(),applyToBuffer:function(){var v1;return function applyToBuffer(buffer,offset,length){if(v1===undefined)v1=new THREE.Vector3;if(offset===undefined)offset=0;if(length===undefined)length=buffer.length/buffer.itemSize;for(var i=0,j=offset;i<length;i++,j++){v1.x=buffer.getX(j);v1.y=buffer.getY(j);v1.z=buffer.getZ(j);v1.applyMatrix4(this);buffer.setXYZ(v1.x,v1.y,v1.z)}return buffer}}(),rotateAxis:function(v){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");v.transformDirection(this)},crossVector:function(vector){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},determinant:function(){var te=this.elements;var n11=te[0],n12=te[4],n13=te[8],n14=te[12];var n21=te[1],n22=te[5],n23=te[9],n24=te[13];var n31=te[2],n32=te[6],n33=te[10],n34=te[14];var n41=te[3],n42=te[7],n43=te[11],n44=te[15];return n41*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+n42*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+n43*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+n44*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function(){var te=this.elements;var tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];array[offset+9]=te[9];array[offset+10]=te[10];array[offset+11]=te[11];array[offset+12]=te[12];array[offset+13]=te[13];array[offset+14]=te[14];array[offset+15]=te[15];return array},getPosition:function(){var v1;return function(){if(v1===undefined)v1=new THREE.Vector3;console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var te=this.elements;return v1.set(te[12],te[13],te[14])}}(),setPosition:function(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this},getInverse:function(m,throwOnInvertible){var te=this.elements;var me=m.elements;var n11=me[0],n12=me[4],n13=me[8],n14=me[12];var n21=me[1],n22=me[5],n23=me[9],n24=me[13];var n31=me[2],n32=me[6],n33=me[10],n34=me[14];var n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44;te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44;te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44;te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44;te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44;te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44;te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34;te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44;te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44;te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44;te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34;te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43;te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43;te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43;te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;var det=n11*te[0]+n21*te[4]+n31*te[8]+n41*te[12];if(det===0){var msg="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{console.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},translate:function(v){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(angle){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(angle){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(angle){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(axis,angle){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this},getMaxScaleOnAxis:function(){var te=this.elements;var scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];var scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];var scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)))},makeTranslation:function(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(axis,angle){var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x,y=axis.y,z=axis.z;var tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this},makeScale:function(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this},compose:function(position,quaternion,scale){this.makeRotationFromQuaternion(quaternion);this.scale(scale);this.setPosition(position);return this},decompose:function(){var vector,matrix;return function(position,quaternion,scale){if(vector===undefined)vector=new THREE.Vector3;if(matrix===undefined)matrix=new THREE.Matrix4;var te=this.elements;var sx=vector.set(te[0],te[1],te[2]).length();var sy=vector.set(te[4],te[5],te[6]).length();var sz=vector.set(te[8],te[9],te[10]).length();var det=this.determinant();if(det<0){sx=-sx}position.x=te[12];position.y=te[13];position.z=te[14];matrix.elements.set(this.elements);var invSX=1/sx;var invSY=1/sy;var invSZ=1/sz;matrix.elements[0]*=invSX;matrix.elements[1]*=invSX;matrix.elements[2]*=invSX;matrix.elements[4]*=invSY;matrix.elements[5]*=invSY;matrix.elements[6]*=invSY;matrix.elements[8]*=invSZ;matrix.elements[9]*=invSZ;matrix.elements[10]*=invSZ;quaternion.setFromRotationMatrix(matrix);scale.x=sx;scale.y=sy;scale.z=sz;return this}}(),makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements;var x=2*near/(right-left);var y=2*near/(top-bottom);var a=(right+left)/(right-left);var b=(top+bottom)/(top-bottom);var c=-(far+near)/(far-near);var d=-2*far*near/(far-near);te[0]=x;te[4]=0;te[8]=a;te[12]=0;te[1]=0;te[5]=y;te[9]=b;te[13]=0;te[2]=0;te[6]=0;te[10]=c;te[14]=d;te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan(THREE.Math.degToRad(fov*.5));var ymin=-ymax;var xmin=ymin*aspect;var xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements;var w=right-left;var h=top-bottom;var p=far-near;var x=(right+left)/w;var y=(top+bottom)/h;var z=(far+near)/p;te[0]=2/w;te[4]=0;te[8]=0;te[12]=-x;te[1]=0;te[5]=2/h;te[9]=0;te[13]=-y;te[2]=0;te[6]=0;te[10]=-2/p;te[14]=-z;te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this},equals:function(matrix){var te=this.elements;var me=matrix.elements;for(var i=0;i<16;i++){if(te[i]!==me[i])return false}return true},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8],te[9],te[10],te[11],te[12],te[13],te[14],te[15]]}};THREE.Ray=function(origin,direction){this.origin=origin!==undefined?origin:new THREE.Vector3;this.direction=direction!==undefined?direction:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(origin,direction){this.origin.copy(origin);this.direction.copy(direction);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(ray){this.origin.copy(ray.origin);this.direction.copy(ray.direction);return this},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var v1=new THREE.Vector3;return function(t){this.origin.copy(this.at(t,v1));return this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);if(directionDistance<0){return result.copy(this.origin)}return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(point){return Math.sqrt(this.distanceSqToPoint(point))},distanceSqToPoint:function(){var v1=new THREE.Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);if(directionDistance<0){return this.origin.distanceToSquared(point)}v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);return v1.distanceToSquared(point)}}(),distanceSqToSegment:function(){var segCenter=new THREE.Vector3;var segDir=new THREE.Vector3;var diff=new THREE.Vector3;return function(v0,v1,optionalPointOnRay,optionalPointOnSegment){segCenter.copy(v0).add(v1).multiplyScalar(.5);segDir.copy(v1).sub(v0).normalize();diff.copy(this.origin).sub(segCenter);var segExtent=v0.distanceTo(v1)*.5;var a01=-this.direction.dot(segDir);var b0=diff.dot(this.direction);var b1=-diff.dot(segDir);var c=diff.lengthSq();var det=Math.abs(1-a01*a01);var s0,s1,sqrDist,extDet;if(det>0){s0=a01*b1-b0;s1=a01*b0-b1;extDet=segExtent*det;if(s0>=0){if(s1>=-extDet){if(s1<=extDet){var invDet=1/det;s0*=invDet;s1*=invDet;sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else{s1=segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{s1=-segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{if(s1<=-extDet){s0=Math.max(0,-(-a01*segExtent+b0));s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}else if(s1<=extDet){s0=0;s1=Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=s1*(s1+2*b1)+c}else{s0=Math.max(0,-(a01*segExtent+b0));s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}}}else{s1=a01>0?-segExtent:segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}if(optionalPointOnRay){optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin)}if(optionalPointOnSegment){optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter)}return sqrDist}}(),isIntersectionSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},intersectSphere:function(){var v1=new THREE.Vector3;return function(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction);var d2=v1.dot(v1)-tca*tca;var radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;var thc=Math.sqrt(radius2-d2);var t0=tca-thc;var t1=tca+thc;if(t0<0&&t1<0)return null;if(t0<0)return this.at(t1,optionalTarget);return this.at(t0,optionalTarget)}}(),isIntersectionPlane:function(plane){var distToPoint=plane.distanceToPoint(this.origin);if(distToPoint===0){return true}var denominator=plane.normal.dot(this.direction);if(denominator*distToPoint<0){return true}return false},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);if(denominator===0){if(plane.distanceToPoint(this.origin)===0){return 0}return null}var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t>=0?t:null},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);if(t===null){return null}return this.at(t,optionalTarget)},isIntersectionBox:function(){var v=new THREE.Vector3;return function(box){return this.intersectBox(box,v)!==null}}(),intersectBox:function(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax;var invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z;var origin=this.origin;if(invdirx>=0){tmin=(box.min.x-origin.x)*invdirx;tmax=(box.max.x-origin.x)*invdirx}else{tmin=(box.max.x-origin.x)*invdirx;tmax=(box.min.x-origin.x)*invdirx}if(invdiry>=0){tymin=(box.min.y-origin.y)*invdiry;tymax=(box.max.y-origin.y)*invdiry}else{tymin=(box.max.y-origin.y)*invdiry;tymax=(box.min.y-origin.y)*invdiry}if(tmin>tymax||tymin>tmax)return null;if(tymin>tmin||tmin!==tmin)tmin=tymin;if(tymax<tmax||tmax!==tmax)tmax=tymax;if(invdirz>=0){tzmin=(box.min.z-origin.z)*invdirz;tzmax=(box.max.z-origin.z)*invdirz}else{tzmin=(box.max.z-origin.z)*invdirz;tzmax=(box.min.z-origin.z)*invdirz}if(tmin>tzmax||tzmin>tmax)return null;if(tzmin>tmin||tmin!==tmin)tmin=tzmin;if(tzmax<tmax||tmax!==tmax)tmax=tzmax;if(tmax<0)return null;return this.at(tmin>=0?tmin:tmax,optionalTarget)},intersectTriangle:function(){var diff=new THREE.Vector3;var edge1=new THREE.Vector3;var edge2=new THREE.Vector3;var normal=new THREE.Vector3;return function(a,b,c,backfaceCulling,optionalTarget){edge1.subVectors(b,a);edge2.subVectors(c,a);normal.crossVectors(edge1,edge2);var DdN=this.direction.dot(normal);var sign;if(DdN>0){if(backfaceCulling)return null;sign=1}else if(DdN<0){sign=-1;DdN=-DdN}else{return null}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0){return null}var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0){return null}if(DdQxE2+DdE1xQ>DdN){return null}var QdN=-sign*diff.dot(normal);if(QdN<0){return null}return this.at(QdN/DdN,optionalTarget)}}(),applyMatrix4:function(matrix4){this.direction.add(this.origin).applyMatrix4(matrix4);this.origin.applyMatrix4(matrix4);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)}};THREE.Sphere=function(center,radius){this.center=center!==undefined?center:new THREE.Vector3;this.radius=radius!==undefined?radius:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(center,radius){this.center.copy(center);this.radius=radius;return this},setFromPoints:function(){var box=new THREE.Box3;return function(points,optionalCenter){var center=this.center;if(optionalCenter!==undefined){center.copy(optionalCenter)}else{box.setFromPoints(points).center(center)}var maxRadiusSq=0;for(var i=0,il=points.length;i<il;i++){maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]))}this.radius=Math.sqrt(maxRadiusSq);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(sphere){this.center.copy(sphere.center);this.radius=sphere.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},clampPoint:function(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point);var result=optionalTarget||new THREE.Vector3;result.copy(point);if(deltaLengthSq>this.radius*this.radius){result.sub(this.center).normalize();result.multiplyScalar(this.radius).add(this.center)}return result},getBoundingBox:function(optionalTarget){var box=optionalTarget||new THREE.Box3;box.set(this.center,this.center);box.expandByScalar(this.radius);return box},applyMatrix4:function(matrix){this.center.applyMatrix4(matrix);this.radius=this.radius*matrix.getMaxScaleOnAxis();return this},translate:function(offset){this.center.add(offset);return this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius}};THREE.Frustum=function(p0,p1,p2,p3,p4,p5){this.planes=[p0!==undefined?p0:new THREE.Plane,p1!==undefined?p1:new THREE.Plane,p2!==undefined?p2:new THREE.Plane,p3!==undefined?p3:new THREE.Plane,p4!==undefined?p4:new THREE.Plane,p5!==undefined?p5:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(p0,p1,p2,p3,p4,p5){var planes=this.planes;planes[0].copy(p0);planes[1].copy(p1);planes[2].copy(p2);planes[3].copy(p3);planes[4].copy(p4);planes[5].copy(p5);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(frustum){var planes=this.planes;for(var i=0;i<6;i++){planes[i].copy(frustum.planes[i])}return this},setFromMatrix:function(m){var planes=this.planes;var me=m.elements;var me0=me[0],me1=me[1],me2=me[2],me3=me[3];var me4=me[4],me5=me[5],me6=me[6],me7=me[7];var me8=me[8],me9=me[9],me10=me[10],me11=me[11];var me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();return this},intersectsObject:function(){var sphere=new THREE.Sphere;return function(object){var geometry=object.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(object.matrixWorld);return this.intersectsSphere(sphere)}}(),intersectsSphere:function(sphere){var planes=this.planes;var center=sphere.center;var negRadius=-sphere.radius;for(var i=0;i<6;i++){var distance=planes[i].distanceToPoint(center);if(distance<negRadius){return false}}return true},intersectsBox:function(){var p1=new THREE.Vector3,p2=new THREE.Vector3;return function(box){var planes=this.planes;for(var i=0;i<6;i++){var plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x;p2.x=plane.normal.x>0?box.max.x:box.min.x;p1.y=plane.normal.y>0?box.min.y:box.max.y;p2.y=plane.normal.y>0?box.max.y:box.min.y;p1.z=plane.normal.z>0?box.min.z:box.max.z;p2.z=plane.normal.z>0?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1);var d2=plane.distanceToPoint(p2);if(d1<0&&d2<0){return false}}return true}}(),containsPoint:function(point){var planes=this.planes;for(var i=0;i<6;i++){if(planes[i].distanceToPoint(point)<0){return false}}return true}};THREE.Plane=function(normal,constant){this.normal=normal!==undefined?normal:new THREE.Vector3(1,0,0);this.constant=constant!==undefined?constant:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(normal,constant){this.normal.copy(normal);this.constant=constant;return this},setComponents:function(x,y,z,w){this.normal.set(x,y,z);this.constant=w;return this},setFromNormalAndCoplanarPoint:function(normal,point){this.normal.copy(normal);this.constant=-point.dot(this.normal);return this},setFromCoplanarPoints:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(normal,a);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(plane){this.normal.copy(plane.normal);this.constant=plane.constant;return this},normalize:function(){var inverseNormalLength=1/this.normal.length();this.normal.multiplyScalar(inverseNormalLength);this.constant*=inverseNormalLength;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(point){return this.normal.dot(point)+this.constant},distanceToSphere:function(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function(point,optionalTarget){return this.orthoPoint(point,optionalTarget).sub(point).negate()},orthoPoint:function(point,optionalTarget){var perpendicularMagnitude=this.distanceToPoint(point);var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(perpendicularMagnitude)},isIntersectionLine:function(line){var startSign=this.distanceToPoint(line.start);var endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0},intersectLine:function(){var v1=new THREE.Vector3;return function(line,optionalTarget){var result=optionalTarget||new THREE.Vector3;var direction=line.delta(v1);var denominator=this.normal.dot(direction);if(denominator===0){if(this.distanceToPoint(line.start)===0){return result.copy(line.start)}return undefined}var t=-(line.start.dot(this.normal)+this.constant)/denominator;if(t<0||t>1){return undefined}return result.copy(direction).multiplyScalar(t).add(line.start)}}(),coplanarPoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var m1=new THREE.Matrix3;return function(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix);var newNormal=v1.copy(this.normal).applyMatrix3(normalMatrix);var newCoplanarPoint=this.coplanarPoint(v2);newCoplanarPoint.applyMatrix4(matrix);this.setFromNormalAndCoplanarPoint(newNormal,newCoplanarPoint);return this}}(),translate:function(offset){this.constant=this.constant-offset.dot(this.normal);return this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant}};THREE.Math={generateUUID:function(){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var uuid=new Array(36);var rnd=0,r;return function(){for(var i=0;i<36;i++){if(i===8||i===13||i===18||i===23){uuid[i]="-"}else if(i===14){uuid[i]="4"}else{if(rnd<=2)rnd=33554432+Math.random()*16777216|0;r=rnd&15;rnd=rnd>>4;uuid[i]=chars[i===19?r&3|8:r]}}return uuid.join("")}}(),clamp:function(x,a,b){return x<a?a:x>b?b:x},clampBottom:function(x,a){return x<a?a:x},euclideanModulo:function(n,m){return(n%m+m)%m},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},smoothstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*(3-2*x)},smootherstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*x*(x*(x*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(low,high){return low+Math.floor(Math.random()*(high-low+1))},randFloat:function(low,high){return low+Math.random()*(high-low)},randFloatSpread:function(range){return range*(.5-Math.random())},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(degrees){return degrees*degreeToRadiansFactor}}(),radToDeg:function(){var radianToDegreesFactor=180/Math.PI;return function(radians){return radians*radianToDegreesFactor}}(),isPowerOfTwo:function(value){return(value&value-1)===0&&value!==0},nextPowerOfTwo:function(value){value--;value|=value>>1;value|=value>>2;value|=value>>4;value|=value>>8;value|=value>>16;value++;return value}};THREE.Spline=function(points){this.points=points;var c=[],v3={x:0,y:0,z:0},point,intPoint,weight,w2,w3,pa,pb,pc,pd;this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++){this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]}}};this.getPoint=function(k){point=(this.points.length-1)*k;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>this.points.length-2?this.points.length-1:intPoint+1;c[3]=intPoint>this.points.length-3?this.points.length-1:intPoint+2;pa=this.points[c[0]];pb=this.points[c[1]];pc=this.points[c[2]];pd=this.points[c[3]];w2=weight*weight;w3=weight*w2;v3.x=interpolate(pa.x,pb.x,pc.x,pd.x,weight,w2,w3);v3.y=interpolate(pa.y,pb.y,pc.y,pd.y,weight,w2,w3);v3.z=interpolate(pa.z,pb.z,pc.z,pd.z,weight,w2,w3);return v3};this.getControlPointsArray=function(){var i,p,l=this.points.length,coords=[];for(i=0;i<l;i++){p=this.points[i];coords[i]=[p.x,p.y,p.z]}return coords};this.getLength=function(nSubDivisions){var i,index,nSamples,position,point=0,intPoint=0,oldIntPoint=0,oldPosition=new THREE.Vector3,tmpVec=new THREE.Vector3,chunkLengths=[],totalLength=0;chunkLengths[0]=0;if(!nSubDivisions)nSubDivisions=100;nSamples=this.points.length*nSubDivisions;oldPosition.copy(this.points[0]);for(i=1;i<nSamples;i++){index=i/nSamples;position=this.getPoint(index);tmpVec.copy(position);totalLength+=tmpVec.distanceTo(oldPosition);oldPosition.copy(position);point=(this.points.length-1)*index;intPoint=Math.floor(point);if(intPoint!==oldIntPoint){chunkLengths[intPoint]=totalLength;oldIntPoint=intPoint}}chunkLengths[chunkLengths.length]=totalLength;return{chunks:chunkLengths,total:totalLength}};this.reparametrizeByArcLength=function(samplingCoef){var i,j,index,indexCurrent,indexNext,realDistance,sampling,position,newpoints=[],tmpVec=new THREE.Vector3,sl=this.getLength();newpoints.push(tmpVec.copy(this.points[0]).clone());for(i=1;i<this.points.length;i++){realDistance=sl.chunks[i]-sl.chunks[i-1];sampling=Math.ceil(samplingCoef*realDistance/sl.total);indexCurrent=(i-1)/(this.points.length-1);indexNext=i/(this.points.length-1);for(j=1;j<sampling-1;j++){index=indexCurrent+j*(1/sampling)*(indexNext-indexCurrent);position=this.getPoint(index);newpoints.push(tmpVec.copy(position).clone())}newpoints.push(tmpVec.copy(this.points[i]).clone())}this.points=newpoints};function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}};THREE.Triangle=function(a,b,c){this.a=a!==undefined?a:new THREE.Vector3;this.b=b!==undefined?b:new THREE.Vector3;this.c=c!==undefined?c:new THREE.Vector3};THREE.Triangle.normal=function(){var v0=new THREE.Vector3;return function(a,b,c,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(c,b);v0.subVectors(a,b);result.cross(v0);var resultLengthSq=result.lengthSq();if(resultLengthSq>0){return result.multiplyScalar(1/Math.sqrt(resultLengthSq))}return result.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(point,a,b,c,optionalTarget){v0.subVectors(c,a);v1.subVectors(b,a);v2.subVectors(point,a);var dot00=v0.dot(v0);var dot01=v0.dot(v1);var dot02=v0.dot(v2);var dot11=v1.dot(v1);var dot12=v1.dot(v2);var denom=dot00*dot11-dot01*dot01;var result=optionalTarget||new THREE.Vector3;if(denom===0){return result.set(-2,-1,-1)}var invDenom=1/denom;var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return result.set(1-u-v,v,u)}}();THREE.Triangle.containsPoint=function(){var v1=new THREE.Vector3;return function(point,a,b,c){var result=THREE.Triangle.barycoordFromPoint(point,a,b,c,v1);return result.x>=0&&result.y>=0&&result.x+result.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(points,i0,i1,i2){this.a.copy(points[i0]);this.b.copy(points[i1]);this.c.copy(points[i2]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(triangle){this.a.copy(triangle.a);this.b.copy(triangle.b);this.c.copy(triangle.c);return this},area:function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;return function(){v0.subVectors(this.c,this.b);v1.subVectors(this.a,this.b);return v0.cross(v1).length()*.5}}(),midpoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(optionalTarget){return THREE.Triangle.normal(this.a,this.b,this.c,optionalTarget)},plane:function(optionalTarget){var result=optionalTarget||new THREE.Plane;return result.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(point,optionalTarget){return THREE.Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget)},containsPoint:function(point){return THREE.Triangle.containsPoint(point,this.a,this.b,this.c)},equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)}};THREE.Clock=function(autoStart){this.autoStart=autoStart!==undefined?autoStart:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var newTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();diff=.001*(newTime-this.oldTime);this.oldTime=newTime;this.elapsedTime+=diff}return diff}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(object){object.addEventListener=THREE.EventDispatcher.prototype.addEventListener;object.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;object.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;object.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){if(this._listeners===undefined)this._listeners={};var listeners=this._listeners;if(listeners[type]===undefined){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}},hasEventListener:function(type,listener){if(this._listeners===undefined)return false;var listeners=this._listeners;if(listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1){return true}return false},removeEventListener:function(type,listener){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[type];if(listenerArray!==undefined){var index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}},dispatchEvent:function(event){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[event.type];if(listenerArray!==undefined){event.target=this;var array=[];var length=listenerArray.length;for(var i=0;i<length;i++){array[i]=listenerArray[i]}for(var i=0;i<length;i++){array[i].call(this,event)}}}};(function(THREE){THREE.Raycaster=function(origin,direction,near,far){this.ray=new THREE.Ray(origin,direction);this.near=near||0;this.far=far||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})};function descSort(a,b){return a.distance-b.distance}var intersectObject=function(object,raycaster,intersects,recursive){if(object.visible===false)return;object.raycast(raycaster,intersects);if(recursive===true){var children=object.children;for(var i=0,l=children.length;i<l;i++){intersectObject(children[i],raycaster,intersects,true)}}};THREE.Raycaster.prototype={constructor:THREE.Raycaster,linePrecision:1,set:function(origin,direction){this.ray.set(origin,direction)},setFromCamera:function(coords,camera){if(camera instanceof THREE.PerspectiveCamera){this.ray.origin.setFromMatrixPosition(camera.matrixWorld);this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(this.ray.origin).normalize()}else if(camera instanceof THREE.OrthographicCamera){this.ray.origin.set(coords.x,coords.y,-1).unproject(camera);this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)}else{console.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(object,recursive){var intersects=[];intersectObject(object,this,intersects,recursive);intersects.sort(descSort);return intersects},intersectObjects:function(objects,recursive){var intersects=[];if(Array.isArray(objects)===false){console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return intersects}for(var i=0,l=objects.length;i<l;i++){intersectObject(objects[i],this,intersects,recursive)}intersects.sort(descSort);return intersects}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var position=new THREE.Vector3;var rotation=new THREE.Euler;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3(1,1,1);var onRotationChange=function(){quaternion.setFromEuler(rotation,false)};var onQuaternionChange=function(){rotation.setFromQuaternion(quaternion,undefined,false)};rotation.onChange(onRotationChange);quaternion.onChange(onQuaternionChange);Object.defineProperties(this,{position:{enumerable:true,value:position},rotation:{enumerable:true,value:rotation},quaternion:{enumerable:true,value:quaternion},scale:{enumerable:true,value:scale},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}});this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.DefaultMatrixAutoUpdate=true;THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(value){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=value},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(value){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(value){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(matrix){this.matrix.multiplyMatrices(matrix,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function(euler){this.quaternion.setFromEuler(euler,true)},setRotationFromMatrix:function(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:function(){var q1=new THREE.Quaternion;return function(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.multiply(q1);return this}}(),rotateX:function(){var v1=new THREE.Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new THREE.Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new THREE.Vector3;return function(axis,distance){v1.copy(axis).applyQuaternion(this.quaternion);this.position.add(v1.multiplyScalar(distance));return this}}(),translate:function(distance,axis){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(axis,distance)},translateX:function(){var v1=new THREE.Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new THREE.Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var m1=new THREE.Matrix4;return function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}}(),lookAt:function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(vector,this.position,this.up);this.quaternion.setFromRotationMatrix(m1)}}(),add:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(object===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",object);return this}if(object instanceof THREE.Object3D){if(object.parent!==null){object.parent.remove(object)}object.parent=this;object.dispatchEvent({type:"added"});this.children.push(object)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object)}return this},remove:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.remove(arguments[i])}}var index=this.children.indexOf(object);if(index!==-1){object.parent=null;object.dispatchEvent({type:"removed"});this.children.splice(index,1)}},getChildByName:function(name){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(name)},getObjectById:function(id){return this.getObjectByProperty("id",id)},getObjectByName:function(name){return this.getObjectByProperty("name",name)},getObjectByProperty:function(name,value){if(this[name]===value)return this;for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];var object=child.getObjectByProperty(name,value);if(object!==undefined){return object}}return undefined},getWorldPosition:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);return result.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var position=new THREE.Vector3;var scale=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,result,scale);return result}}(),getWorldRotation:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Euler;this.getWorldQuaternion(quaternion);return result.setFromQuaternion(quaternion,this.rotation.order,false)}}(),getWorldScale:function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,quaternion,result);return result}}(),getWorldDirection:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,1).applyQuaternion(quaternion)}}(),raycast:function(){},traverse:function(callback){callback(this);var children=this.children;for(var i=0,l=children.length;i<l;i++){children[i].traverse(callback)}},traverseVisible:function(callback){if(this.visible===false)return;callback(this);var children=this.children;for(var i=0,l=children.length;i<l;i++){children[i].traverseVisible(callback)}},traverseAncestors:function(callback){var parent=this.parent;if(parent!==null){callback(parent);parent.traverseAncestors(callback)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(force){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||force===true){if(this.parent===null){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}},toJSON:function(meta){var isRootObject=meta===undefined;var data={};if(isRootObject){meta={geometries:{},materials:{},textures:{},images:{}};data.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"}}data.uuid=this.uuid;data.type=this.type;if(this.name!=="")data.name=this.name;if(JSON.stringify(this.userData)!=="{}")data.userData=this.userData;if(this.visible!==true)data.visible=this.visible;data.matrix=this.matrix.toArray();if(this.children.length>0){data.children=[];for(var i=0;i<this.children.length;i++){data.children.push(this.children[i].toJSON(meta).object)}}var output={};if(isRootObject){var geometries=extractFromCache(meta.geometries);var materials=extractFromCache(meta.materials);var textures=extractFromCache(meta.textures);var images=extractFromCache(meta.images);if(geometries.length>0)output.geometries=geometries;if(materials.length>0)output.materials=materials;if(textures.length>0)output.textures=textures;if(images.length>0)output.images=images}output.object=data;return output;function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata;values.push(data)}return values}},clone:function(recursive){return(new this.constructor).copy(this,recursive)},copy:function(source,recursive){if(recursive===undefined)recursive=true;this.name=source.name;this.up.copy(source.up);this.position.copy(source.position);this.quaternion.copy(source.quaternion);this.scale.copy(source.scale);this.rotationAutoUpdate=source.rotationAutoUpdate;this.matrix.copy(source.matrix);this.matrixWorld.copy(source.matrixWorld);this.matrixAutoUpdate=source.matrixAutoUpdate;this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate;this.visible=source.visible;this.castShadow=source.castShadow;this.receiveShadow=source.receiveShadow;this.frustumCulled=source.frustumCulled;this.renderOrder=source.renderOrder;this.userData=JSON.parse(JSON.stringify(source.userData));if(recursive===true){for(var i=0;i<source.children.length;i++){var child=source.children[i];this.add(child.clone())}}return this}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Face3=function(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal instanceof THREE.Vector3?normal:new THREE.Vector3;this.vertexNormals=Array.isArray(normal)?normal:[];this.color=color instanceof THREE.Color?color:new THREE.Color;this.vertexColors=Array.isArray(color)?color:[];this.materialIndex=materialIndex!==undefined?materialIndex:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.a=source.a;this.b=source.b;this.c=source.c;this.normal.copy(source.normal);this.color.copy(source.color);this.materialIndex=source.materialIndex;for(var i=0,il=source.vertexNormals.length;i<il;i++){this.vertexNormals[i]=source.vertexNormals[i].clone()}for(var i=0,il=source.vertexColors.length;i<il;i++){this.vertexColors[i]=source.vertexColors[i].clone()}return this}};THREE.Face4=function(a,b,c,d,normal,color,materialIndex){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,normal,color,materialIndex)};THREE.BufferAttribute=function(array,itemSize){this.uuid=THREE.Math.generateUUID();this.array=array;this.itemSize=itemSize;this.dynamic=false;this.updateRange={offset:0,count:-1};this.version=0};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(value){if(value===true)this.version++},setDynamic:function(value){this.dynamic=value;return this},copy:function(source){this.array=new source.array.constructor(source.array);this.itemSize=source.itemSize;this.dynamic=source.dynamic;return this},copyAt:function(index1,attribute,index2){index1*=this.itemSize;index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}return this},copyArray:function(array){this.array.set(array);return this},copyColorsArray:function(colors){var array=this.array,offset=0;for(var i=0,l=colors.length;i<l;i++){var color=colors[i];if(color===undefined){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i);color=new THREE.Color}array[offset++]=color.r;array[offset++]=color.g;array[offset++]=color.b}return this},copyIndicesArray:function(indices){var array=this.array,offset=0;for(var i=0,l=indices.length;i<l;i++){var index=indices[i];array[offset++]=index.a;array[offset++]=index.b;array[offset++]=index.c}return this},copyVector2sArray:function(vectors){var array=this.array,offset=0;for(var i=0,l=vectors.length;i<l;i++){var vector=vectors[i];if(vector===undefined){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i);vector=new THREE.Vector2}array[offset++]=vector.x;array[offset++]=vector.y}return this},copyVector3sArray:function(vectors){var array=this.array,offset=0;for(var i=0,l=vectors.length;i<l;i++){var vector=vectors[i];if(vector===undefined){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i);vector=new THREE.Vector3}array[offset++]=vector.x;array[offset++]=vector.y;array[offset++]=vector.z}return this},copyVector4sArray:function(vectors){var array=this.array,offset=0;for(var i=0,l=vectors.length;i<l;i++){var vector=vectors[i];if(vector===undefined){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i);vector=new THREE.Vector4}array[offset++]=vector.x;array[offset++]=vector.y;array[offset++]=vector.z;array[offset++]=vector.w}return this},set:function(value,offset){if(offset===undefined)offset=0;this.array.set(value,offset);return this},getX:function(index){return this.array[index*this.itemSize]},setX:function(index,x){this.array[index*this.itemSize]=x;return this},getY:function(index){return this.array[index*this.itemSize+1]},setY:function(index,y){this.array[index*this.itemSize+1]=y;return this},getZ:function(index){return this.array[index*this.itemSize+2]},setZ:function(index,z){this.array[index*this.itemSize+2]=z;return this},getW:function(index){return this.array[index*this.itemSize+3]},setW:function(index,w){this.array[index*this.itemSize+3]=w;return this},setXY:function(index,x,y){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;return this},setXYZ:function(index,x,y,z){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;this.array[index+2]=z;return this},setXYZW:function(index,x,y,z,w){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;this.array[index+2]=z;this.array[index+3]=w;return this},clone:function(){return(new this.constructor).copy(this)}};THREE.Int8Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Int8Array(array),itemSize)};THREE.Uint8Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Uint8Array(array),itemSize)};THREE.Uint8ClampedAttribute=function(array,itemSize){return new THREE.BufferAttribute(new Uint8ClampedArray(array),itemSize)};THREE.Int16Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Int16Array(array),itemSize)};THREE.Uint16Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Uint16Array(array),itemSize)};THREE.Int32Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Int32Array(array),itemSize)};THREE.Uint32Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Uint32Array(array),itemSize)};THREE.Float32Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Float32Array(array),itemSize)};THREE.Float64Attribute=function(array,itemSize){return new THREE.BufferAttribute(new Float64Array(array),itemSize)};THREE.DynamicBufferAttribute=function(array,itemSize){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new THREE.BufferAttribute(array,itemSize).setDynamic(true)};THREE.InstancedBufferAttribute=function(array,itemSize,meshPerAttribute){THREE.BufferAttribute.call(this,array,itemSize);this.meshPerAttribute=meshPerAttribute||1};THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute;THREE.InstancedBufferAttribute.prototype.copy=function(source){THREE.BufferAttribute.prototype.copy.call(this,source);this.meshPerAttribute=source.meshPerAttribute;return this};THREE.InterleavedBuffer=function(array,stride){this.uuid=THREE.Math.generateUUID();this.array=array;this.stride=stride;this.dynamic=false;this.updateRange={offset:0,count:-1};this.version=0};THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(value){if(value===true)this.version++},setDynamic:function(value){this.dynamic=value;return this},copy:function(source){this.array=new source.array.constructor(source.array);this.stride=source.stride;this.dynamic=source.dynamic},copyAt:function(index1,attribute,index2){index1*=this.stride;index2*=attribute.stride;for(var i=0,l=this.stride;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}return this},set:function(value,offset){if(offset===undefined)offset=0;this.array.set(value,offset);return this},clone:function(){return(new this.constructor).copy(this)}};THREE.InstancedInterleavedBuffer=function(array,stride,meshPerAttribute){THREE.InterleavedBuffer.call(this,array,stride);this.meshPerAttribute=meshPerAttribute||1};THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype);THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer;THREE.InstancedInterleavedBuffer.prototype.copy=function(source){THREE.InterleavedBuffer.prototype.copy.call(this,source);this.meshPerAttribute=source.meshPerAttribute;return this};THREE.InterleavedBufferAttribute=function(interleavedBuffer,itemSize,offset){this.uuid=THREE.Math.generateUUID();this.data=interleavedBuffer;this.itemSize=itemSize;this.offset=offset};THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(index,x){this.data.array[index*this.data.stride+this.offset]=x;return this},setY:function(index,y){this.data.array[index*this.data.stride+this.offset+1]=y;return this},setZ:function(index,z){this.data.array[index*this.data.stride+this.offset+2]=z;return this},setW:function(index,w){this.data.array[index*this.data.stride+this.offset+3]=w;return this},getX:function(index){return this.data.array[index*this.data.stride+this.offset]},getY:function(index){return this.data.array[index*this.data.stride+this.offset+1]},getZ:function(index){return this.data.array[index*this.data.stride+this.offset+2]},getW:function(index){return this.data.array[index*this.data.stride+this.offset+3]},setXY:function(index,x,y){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;return this},setXYZ:function(index,x,y,z){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;this.data.array[index+2]=z;return this},setXYZW:function(index,x,y,z,w){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;this.data.array[index+2]=z;this.data.array[index+3]=w;return this}};THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(matrix){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);for(var i=0,il=this.vertices.length;i<il;i++){var vertex=this.vertices[i];vertex.applyMatrix4(matrix)}for(var i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++){face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},rotateX:function(){var m1;return function rotateX(angle){if(m1===undefined)m1=new THREE.Matrix4;m1.makeRotationX(angle);this.applyMatrix(m1);return this}}(),rotateY:function(){var m1;return function rotateY(angle){if(m1===undefined)m1=new THREE.Matrix4;m1.makeRotationY(angle);this.applyMatrix(m1);return this}}(),rotateZ:function(){var m1;return function rotateZ(angle){if(m1===undefined)m1=new THREE.Matrix4;m1.makeRotationZ(angle);this.applyMatrix(m1);return this}}(),translate:function(){var m1;return function translate(x,y,z){if(m1===undefined)m1=new THREE.Matrix4;m1.makeTranslation(x,y,z);this.applyMatrix(m1);return this}}(),scale:function(){var m1;return function scale(x,y,z){if(m1===undefined)m1=new THREE.Matrix4;m1.makeScale(x,y,z);this.applyMatrix(m1);return this}}(),lookAt:function(){var obj;return function lookAt(vector){if(obj===undefined)obj=new THREE.Object3D;obj.lookAt(vector);obj.updateMatrix();this.applyMatrix(obj.matrix)}}(),fromBufferGeometry:function(geometry){var scope=this;var indices=geometry.index!==null?geometry.index.array:undefined;var attributes=geometry.attributes;var vertices=attributes.position.array;var normals=attributes.normal!==undefined?attributes.normal.array:undefined;var colors=attributes.color!==undefined?attributes.color.array:undefined;var uvs=attributes.uv!==undefined?attributes.uv.array:undefined;var uvs2=attributes.uv2!==undefined?attributes.uv2.array:undefined;if(uvs2!==undefined)this.faceVertexUvs[1]=[];var tempNormals=[];var tempUVs=[];var tempUVs2=[];for(var i=0,j=0,k=0;i<vertices.length;i+=3,j+=2,k+=4){scope.vertices.push(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]));if(normals!==undefined){tempNormals.push(new THREE.Vector3(normals[i],normals[i+1],normals[i+2]))}if(colors!==undefined){scope.colors.push(new THREE.Color(colors[i],colors[i+1],colors[i+2]))}if(uvs!==undefined){tempUVs.push(new THREE.Vector2(uvs[j],uvs[j+1]))}if(uvs2!==undefined){tempUVs2.push(new THREE.Vector2(uvs2[j],uvs2[j+1]))}}var addFace=function(a,b,c){var vertexNormals=normals!==undefined?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[];var vertexColors=colors!==undefined?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[];var face=new THREE.Face3(a,b,c,vertexNormals,vertexColors);scope.faces.push(face);if(uvs!==undefined){scope.faceVertexUvs[0].push([tempUVs[a].clone(),tempUVs[b].clone(),tempUVs[c].clone()])}if(uvs2!==undefined){scope.faceVertexUvs[1].push([tempUVs2[a].clone(),tempUVs2[b].clone(),tempUVs2[c].clone()])}};if(indices!==undefined){var groups=geometry.groups;if(groups.length>0){for(var i=0;i<groups.length;i++){var group=groups[i];var start=group.start;var count=group.count;for(var j=start,jl=start+count;j<jl;j+=3){addFace(indices[j],indices[j+1],indices[j+2])}}}else{for(var i=0;i<indices.length;i+=3){addFace(indices[i],indices[i+1],indices[i+2])}}}else{for(var i=0;i<vertices.length/3;i+=3){addFace(i,i+1,i+2)}}this.computeFaceNormals();if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone()}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var offset=this.boundingBox.center().negate();this.translate(offset.x,offset.y,offset.z);return offset},normalize:function(){this.computeBoundingSphere();var center=this.boundingSphere.center;var radius=this.boundingSphere.radius;var s=radius===0?1:1/radius;var matrix=new THREE.Matrix4;matrix.set(s,0,0,-s*center.x,0,s,0,-s*center.y,0,0,s,-s*center.z,0,0,0,1);this.applyMatrix(matrix);return this},computeFaceNormals:function(){var cb=new THREE.Vector3,ab=new THREE.Vector3;for(var f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f];var vA=this.vertices[face.a];var vB=this.vertices[face.b];var vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);cb.normalize();face.normal.copy(cb)}},computeVertexNormals:function(areaWeighted){var v,vl,f,fl,face,vertices;vertices=new Array(this.vertices.length);for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v]=new THREE.Vector3}if(areaWeighted){var vA,vB,vC;var cb=new THREE.Vector3,ab=new THREE.Vector3;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vA=this.vertices[face.a];vB=this.vertices[face.b];vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);vertices[face.a].add(cb);vertices[face.b].add(cb);vertices[face.c].add(cb)}}else{for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vertices[face.a].add(face.normal);vertices[face.b].add(face.normal);vertices[face.c].add(face.normal)}}for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].normalize()}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];var vertexNormals=face.vertexNormals;if(vertexNormals.length===3){vertexNormals[0].copy(vertices[face.a]);vertexNormals[1].copy(vertices[face.b]);vertexNormals[2].copy(vertices[face.c])}else{vertexNormals[0]=vertices[face.a].clone();vertexNormals[1]=vertices[face.b].clone();vertexNormals[2]=vertices[face.c].clone()}}},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone()}else{face.__originalFaceNormal.copy(face.normal)}if(!face.__originalVertexNormals)face.__originalVertexNormals=[];for(i=0,il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone()}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i])}}}var tmpGeo=new THREE.Geometry;tmpGeo.faces=this.faces;for(i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals;var dstNormalsVertex=this.morphNormals[i].vertexNormals;var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){faceNormal=new THREE.Vector3;vertexNormals={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals)}}var morphNormals=this.morphNormals[i];tmpGeo.vertices=this.morphTargets[i].vertices;tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2])}}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals}},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){var d=0;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){if(i>0){d+=vertices[i].distanceTo(vertices[i-1])}this.lineDistances[i]=d}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(geometry,matrix,materialIndexOffset){if(geometry instanceof THREE.Geometry===false){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry);return}var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0];if(materialIndexOffset===undefined)materialIndexOffset=0;if(matrix!==undefined){normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix)}for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i];var vertexCopy=vertex.clone();if(matrix!==undefined)vertexCopy.applyMatrix4(matrix);vertices1.push(vertexCopy)}for(i=0,il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;faceCopy=new THREE.Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);faceCopy.normal.copy(face.normal);if(normalMatrix!==undefined){faceCopy.normal.applyMatrix3(normalMatrix).normalize()}for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(normalMatrix!==undefined){normal.applyMatrix3(normalMatrix).normalize()}faceCopy.vertexNormals.push(normal)}faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone())}faceCopy.materialIndex=face.materialIndex+materialIndexOffset;faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(uv===undefined){continue}for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(uv[j].clone())}uvs1.push(uvCopy)}},mergeMesh:function(mesh){if(mesh instanceof THREE.Mesh===false){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",mesh);return}mesh.matrixAutoUpdate&&mesh.updateMatrix();this.merge(mesh.geometry,mesh.matrix)},mergeVertices:function(){var verticesMap={};var unique=[],changes=[];var v,key;var precisionPoints=4;var precision=Math.pow(10,precisionPoints);var i,il,face;var indices,j,jl;for(i=0,il=this.vertices.length;i<il;i++){v=this.vertices[i];key=Math.round(v.x*precision)+"_"+Math.round(v.y*precision)+"_"+Math.round(v.z*precision);if(verticesMap[key]===undefined){verticesMap[key]=i;unique.push(this.vertices[i]);changes[i]=unique.length-1}else{changes[i]=changes[verticesMap[key]]}}var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){face=this.faces[i];face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];indices=[face.a,face.b,face.c];var dupIndex=-1;for(var n=0;n<3;n++){if(indices[n]===indices[(n+1)%3]){dupIndex=n;faceIndicesToRemove.push(i);break}}}for(i=faceIndicesToRemove.length-1;i>=0;i--){var idx=faceIndicesToRemove[i];this.faces.splice(idx,1);for(j=0,jl=this.faceVertexUvs.length;j<jl;j++){this.faceVertexUvs[j].splice(idx,1)}}var diff=this.vertices.length-unique.length;this.vertices=unique;return diff},toJSON:function(){var data={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};data.uuid=this.uuid;data.type=this.type;if(this.name!=="")data.name=this.name;if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined)data[key]=parameters[key]}return data}var vertices=[];for(var i=0;i<this.vertices.length;i++){var vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}var faces=[];var normals=[];var normalsHash={};var colors=[];var colorsHash={};var uvs=[];var uvsHash={};for(var i=0;i<this.faces.length;i++){var face=this.faces[i];var hasMaterial=false;var hasFaceUv=false;var hasFaceVertexUv=this.faceVertexUvs[0][i]!==undefined;var hasFaceNormal=face.normal.length()>0;var hasFaceVertexNormal=face.vertexNormals.length>0;var hasFaceColor=face.color.r!==1||face.color.g!==1||face.color.b!==1;var hasFaceVertexColor=face.vertexColors.length>0;var faceType=0;faceType=setBit(faceType,0,0);faceType=setBit(faceType,1,hasMaterial);faceType=setBit(faceType,2,hasFaceUv);faceType=setBit(faceType,3,hasFaceVertexUv);faceType=setBit(faceType,4,hasFaceNormal);faceType=setBit(faceType,5,hasFaceVertexNormal);faceType=setBit(faceType,6,hasFaceColor);faceType=setBit(faceType,7,hasFaceVertexColor);faces.push(faceType);faces.push(face.a,face.b,face.c);if(hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal){faces.push(getNormalIndex(face.normal))}if(hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor){faces.push(getColorIndex(face.color))}if(hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();if(normalsHash[hash]!==undefined){return normalsHash[hash]}normalsHash[hash]=normals.length/3;normals.push(normal.x,normal.y,normal.z);return normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();if(colorsHash[hash]!==undefined){return colorsHash[hash]}colorsHash[hash]=colors.length;colors.push(color.getHex());return colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();if(uvsHash[hash]!==undefined){return uvsHash[hash]}uvsHash[hash]=uvs.length/2;uvs.push(uv.x,uv.y);return uvsHash[hash]}data.data={};data.data.vertices=vertices;data.data.normals=normals;if(colors.length>0)data.data.colors=colors;if(uvs.length>0)data.data.uvs=[uvs];data.data.faces=faces;return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];var vertices=source.vertices;for(var i=0,il=vertices.length;i<il;i++){this.vertices.push(vertices[i].clone())}var faces=source.faces;for(var i=0,il=faces.length;i<il;i++){this.faces.push(faces[i].clone())}for(var i=0,il=source.faceVertexUvs.length;i<il;i++){var faceVertexUvs=source.faceVertexUvs[i];if(this.faceVertexUvs[i]===undefined){this.faceVertexUvs[i]=[]}for(var j=0,jl=faceVertexUvs.length;j<jl;j++){var uvs=faceVertexUvs[j],uvsCopy=[];for(var k=0,kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone())}this.faceVertexUvs[i].push(uvsCopy)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=false;this.normalsNeedUpdate=false;this.colorsNeedUpdate=false;this.uvsNeedUpdate=false;this.groupsNeedUpdate=false};THREE.DirectGeometry.prototype={constructor:THREE.DirectGeometry,computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(geometry){var group;var groups=[];var materialIndex;var faces=geometry.faces;for(var i=0;i<faces.length;i++){var face=faces[i];if(face.materialIndex!==materialIndex){materialIndex=face.materialIndex;if(group!==undefined){group.count=i*3-group.start;groups.push(group)}group={start:i*3,materialIndex:materialIndex}}}if(group!==undefined){group.count=i*3-group.start;groups.push(group)}this.groups=groups},fromGeometry:function(geometry){var faces=geometry.faces;var vertices=geometry.vertices;var faceVertexUvs=geometry.faceVertexUvs;var hasFaceVertexUv=faceVertexUvs[0]&&faceVertexUvs[0].length>0;var hasFaceVertexUv2=faceVertexUvs[1]&&faceVertexUvs[1].length>0;var morphTargets=geometry.morphTargets;var morphTargetsLength=morphTargets.length;if(morphTargetsLength>0){var morphTargetsPosition=[];for(var i=0;i<morphTargetsLength;i++){morphTargetsPosition[i]=[]}this.morphTargets.position=morphTargetsPosition}var morphNormals=geometry.morphNormals;var morphNormalsLength=morphNormals.length;if(morphNormalsLength>0){var morphTargetsNormal=[];for(var i=0;i<morphNormalsLength;i++){morphTargetsNormal[i]=[]}this.morphTargets.normal=morphTargetsNormal}var skinIndices=geometry.skinIndices;var skinWeights=geometry.skinWeights;var hasSkinIndices=skinIndices.length===vertices.length;var hasSkinWeights=skinWeights.length===vertices.length;for(var i=0;i<faces.length;i++){var face=faces[i];this.vertices.push(vertices[face.a],vertices[face.b],vertices[face.c]);var vertexNormals=face.vertexNormals;if(vertexNormals.length===3){this.normals.push(vertexNormals[0],vertexNormals[1],vertexNormals[2])}else{var normal=face.normal;this.normals.push(normal,normal,normal)}var vertexColors=face.vertexColors;if(vertexColors.length===3){this.colors.push(vertexColors[0],vertexColors[1],vertexColors[2])}else{var color=face.color;this.colors.push(color,color,color)}if(hasFaceVertexUv===true){var vertexUvs=faceVertexUvs[0][i];if(vertexUvs!==undefined){this.uvs.push(vertexUvs[0],vertexUvs[1],vertexUvs[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",i);this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)}}if(hasFaceVertexUv2===true){var vertexUvs=faceVertexUvs[1][i];if(vertexUvs!==undefined){this.uvs2.push(vertexUvs[0],vertexUvs[1],vertexUvs[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",i);this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2)}}for(var j=0;j<morphTargetsLength;j++){var morphTarget=morphTargets[j].vertices;morphTargetsPosition[j].push(morphTarget[face.a],morphTarget[face.b],morphTarget[face.c])}for(var j=0;j<morphNormalsLength;j++){var morphNormal=morphNormals[j].vertexNormals[i];morphTargetsNormal[j].push(morphNormal.a,morphNormal.b,morphNormal.c)}if(hasSkinIndices){this.skinIndices.push(skinIndices[face.a],skinIndices[face.b],skinIndices[face.c])}if(hasSkinWeights){this.skinWeights.push(skinWeights[face.a],skinWeights[face.b],skinWeights[face.c])}}this.computeGroups(geometry);this.verticesNeedUpdate=geometry.verticesNeedUpdate;this.normalsNeedUpdate=geometry.normalsNeedUpdate;this.colorsNeedUpdate=geometry.colorsNeedUpdate;this.uvsNeedUpdate=geometry.uvsNeedUpdate;this.groupsNeedUpdate=geometry.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.DirectGeometry.prototype);THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:Infinity}};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addIndex:function(index){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(index)},getIndex:function(){return this.index},setIndex:function(index){this.index=index},addAttribute:function(name,attribute){if(attribute instanceof THREE.BufferAttribute===false&&attribute instanceof THREE.InterleavedBufferAttribute===false){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.addAttribute(name,new THREE.BufferAttribute(arguments[1],arguments[2]));return}if(name==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(attribute)}this.attributes[name]=attribute},getAttribute:function(name){return this.attributes[name]},removeAttribute:function(name){delete this.attributes[name]},get drawcalls(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups},get offsets(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups},addDrawCall:function(start,count,indexOffset){if(indexOffset!==undefined){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(start,count)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},addGroup:function(start,count,materialIndex){this.groups.push({start:start,count:count,materialIndex:materialIndex!==undefined?materialIndex:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(start,count){this.drawRange.start=start;this.drawRange.count=count},applyMatrix:function(matrix){var position=this.attributes.position;if(position!==undefined){matrix.applyToVector3Array(position.array);position.needsUpdate=true}var normal=this.attributes.normal;if(normal!==undefined){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);normalMatrix.applyToVector3Array(normal.array);normal.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},rotateX:function(){var m1;return function rotateX(angle){if(m1===undefined)m1=new THREE.Matrix4;m1.makeRotationX(angle);this.applyMatrix(m1);return this}}(),rotateY:function(){var m1;return function rotateY(angle){if(m1===undefined)m1=new THREE.Matrix4;m1.makeRotationY(angle);this.applyMatrix(m1);return this}}(),rotateZ:function(){var m1;return function rotateZ(angle){if(m1===undefined)m1=new THREE.Matrix4;m1.makeRotationZ(angle);this.applyMatrix(m1);return this}}(),translate:function(){var m1;return function translate(x,y,z){if(m1===undefined)m1=new THREE.Matrix4;m1.makeTranslation(x,y,z);this.applyMatrix(m1);return this}}(),scale:function(){var m1;return function scale(x,y,z){if(m1===undefined)m1=new THREE.Matrix4;m1.makeScale(x,y,z);this.applyMatrix(m1);return this}}(),lookAt:function(){var obj;return function lookAt(vector){if(obj===undefined)obj=new THREE.Object3D;obj.lookAt(vector);obj.updateMatrix();this.applyMatrix(obj.matrix)}}(),center:function(){this.computeBoundingBox();var offset=this.boundingBox.center().negate();this.translate(offset.x,offset.y,offset.z);return offset},setFromObject:function(object){var geometry=object.geometry;if(object instanceof THREE.Points||object instanceof THREE.Line){var positions=new THREE.Float32Attribute(geometry.vertices.length*3,3);var colors=new THREE.Float32Attribute(geometry.colors.length*3,3);this.addAttribute("position",positions.copyVector3sArray(geometry.vertices));this.addAttribute("color",colors.copyColorsArray(geometry.colors));if(geometry.lineDistances&&geometry.lineDistances.length===geometry.vertices.length){var lineDistances=new THREE.Float32Attribute(geometry.lineDistances.length,1);this.addAttribute("lineDistance",lineDistances.copyArray(geometry.lineDistances))}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone()}if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone()}}else if(object instanceof THREE.Mesh){if(geometry instanceof THREE.Geometry){this.fromGeometry(geometry)}}return this},updateFromObject:function(object){var geometry=object.geometry;if(object instanceof THREE.Mesh){var direct=geometry.__directGeometry;if(direct===undefined){return this.fromGeometry(geometry)}direct.verticesNeedUpdate=geometry.verticesNeedUpdate;direct.normalsNeedUpdate=geometry.normalsNeedUpdate;direct.colorsNeedUpdate=geometry.colorsNeedUpdate;direct.uvsNeedUpdate=geometry.uvsNeedUpdate;direct.groupsNeedUpdate=geometry.groupsNeedUpdate;geometry.verticesNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.groupsNeedUpdate=false;geometry=direct}if(geometry.verticesNeedUpdate===true){var attribute=this.attributes.position;if(attribute!==undefined){attribute.copyVector3sArray(geometry.vertices);attribute.needsUpdate=true}geometry.verticesNeedUpdate=false}if(geometry.normalsNeedUpdate===true){var attribute=this.attributes.normal;if(attribute!==undefined){attribute.copyVector3sArray(geometry.normals);attribute.needsUpdate=true}geometry.normalsNeedUpdate=false}if(geometry.colorsNeedUpdate===true){var attribute=this.attributes.color;if(attribute!==undefined){attribute.copyColorsArray(geometry.colors);attribute.needsUpdate=true}geometry.colorsNeedUpdate=false}if(geometry.lineDistancesNeedUpdate){var attribute=this.attributes.lineDistance;if(attribute!==undefined){attribute.copyArray(geometry.lineDistances);attribute.needsUpdate=true}geometry.lineDistancesNeedUpdate=false}if(geometry.groupsNeedUpdate){geometry.computeGroups(object.geometry);this.groups=geometry.groups;geometry.groupsNeedUpdate=false}return this},fromGeometry:function(geometry){geometry.__directGeometry=(new THREE.DirectGeometry).fromGeometry(geometry);return this.fromDirectGeometry(geometry.__directGeometry)},fromDirectGeometry:function(geometry){var positions=new Float32Array(geometry.vertices.length*3);this.addAttribute("position",new THREE.BufferAttribute(positions,3).copyVector3sArray(geometry.vertices));if(geometry.normals.length>0){var normals=new Float32Array(geometry.normals.length*3);this.addAttribute("normal",new THREE.BufferAttribute(normals,3).copyVector3sArray(geometry.normals))}if(geometry.colors.length>0){var colors=new Float32Array(geometry.colors.length*3);this.addAttribute("color",new THREE.BufferAttribute(colors,3).copyColorsArray(geometry.colors))}if(geometry.uvs.length>0){var uvs=new Float32Array(geometry.uvs.length*2);this.addAttribute("uv",new THREE.BufferAttribute(uvs,2).copyVector2sArray(geometry.uvs))}if(geometry.uvs2.length>0){var uvs2=new Float32Array(geometry.uvs2.length*2);this.addAttribute("uv2",new THREE.BufferAttribute(uvs2,2).copyVector2sArray(geometry.uvs2))}if(geometry.indices.length>0){var TypeArray=geometry.vertices.length>65535?Uint32Array:Uint16Array;var indices=new TypeArray(geometry.indices.length*3);this.setIndex(new THREE.BufferAttribute(indices,1).copyIndicesArray(geometry.indices))}this.groups=geometry.groups;for(var name in geometry.morphTargets){var array=[];var morphTargets=geometry.morphTargets[name];for(var i=0,l=morphTargets.length;i<l;i++){var morphTarget=morphTargets[i];var attribute=new THREE.Float32Attribute(morphTarget.length*3,3);array.push(attribute.copyVector3sArray(morphTarget))}this.morphAttributes[name]=array}if(geometry.skinIndices.length>0){var skinIndices=new THREE.Float32Attribute(geometry.skinIndices.length*4,4);this.addAttribute("skinIndex",skinIndices.copyVector4sArray(geometry.skinIndices))}if(geometry.skinWeights.length>0){var skinWeights=new THREE.Float32Attribute(geometry.skinWeights.length*4,4);this.addAttribute("skinWeight",skinWeights.copyVector4sArray(geometry.skinWeights))}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone()}if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone()}return this},computeBoundingBox:function(){var vector=new THREE.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var positions=this.attributes.position.array;if(positions){var bb=this.boundingBox;bb.makeEmpty();for(var i=0,il=positions.length;i<il;i+=3){vector.fromArray(positions,i);bb.expandByPoint(vector)}}if(positions===undefined||positions.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}}(),computeBoundingSphere:function(){var box=new THREE.Box3;var vector=new THREE.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var positions=this.attributes.position.array;if(positions){box.makeEmpty();var center=this.boundingSphere.center;for(var i=0,il=positions.length;i<il;i+=3){vector.fromArray(positions,i);box.expandByPoint(vector)}box.center(center);var maxRadiusSq=0;for(var i=0,il=positions.length;i<il;i+=3){vector.fromArray(positions,i);maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector))}this.boundingSphere.radius=Math.sqrt(maxRadiusSq);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var index=this.index;var attributes=this.attributes;var groups=this.groups;if(attributes.position){var positions=attributes.position.array;if(attributes.normal===undefined){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(positions.length),3))}else{var normals=attributes.normal.array;for(var i=0,il=normals.length;i<il;i++){normals[i]=0}}var normals=attributes.normal.array;var vA,vB,vC,pA=new THREE.Vector3,pB=new THREE.Vector3,pC=new THREE.Vector3,cb=new THREE.Vector3,ab=new THREE.Vector3;if(index){var indices=index.array;if(groups.length===0){this.addGroup(0,indices.length)}for(var j=0,jl=groups.length;j<jl;++j){var group=groups[j];var start=group.start;var count=group.count;for(var i=start,il=start+count;i<il;i+=3){vA=indices[i+0]*3;vB=indices[i+1]*3;vC=indices[i+2]*3;pA.fromArray(positions,vA);pB.fromArray(positions,vB);pC.fromArray(positions,vC);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[vA]+=cb.x;normals[vA+1]+=cb.y;normals[vA+2]+=cb.z;normals[vB]+=cb.x;normals[vB+1]+=cb.y;normals[vB+2]+=cb.z;normals[vC]+=cb.x;normals[vC+1]+=cb.y;normals[vC+2]+=cb.z}}}else{for(var i=0,il=positions.length;i<il;i+=9){pA.fromArray(positions,i);pB.fromArray(positions,i+3);pC.fromArray(positions,i+6);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[i]=cb.x;normals[i+1]=cb.y;normals[i+2]=cb.z;normals[i+3]=cb.x;normals[i+4]=cb.y;normals[i+5]=cb.z;normals[i+6]=cb.x;normals[i+7]=cb.y;normals[i+8]=cb.z}}this.normalizeNormals();attributes.normal.needsUpdate=true}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(size){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(geometry,offset){if(geometry instanceof THREE.BufferGeometry===false){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",geometry);return}if(offset===undefined)offset=0;var attributes=this.attributes;for(var key in attributes){if(geometry.attributes[key]===undefined)continue;var attribute1=attributes[key];var attributeArray1=attribute1.array;var attribute2=geometry.attributes[key];var attributeArray2=attribute2.array;var attributeSize=attribute2.itemSize;for(var i=0,j=attributeSize*offset;i<attributeArray2.length;i++,j++){attributeArray1[j]=attributeArray2[i]}}return this},normalizeNormals:function(){var normals=this.attributes.normal.array;var x,y,z,n;for(var i=0,il=normals.length;i<il;i+=3){x=normals[i];y=normals[i+1];z=normals[i+2];n=1/Math.sqrt(x*x+y*y+z*z);normals[i]*=n;normals[i+1]*=n;normals[i+2]*=n}},toJSON:function(){var data={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};data.uuid=this.uuid;data.type=this.type;if(this.name!=="")data.name=this.name;if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined)data[key]=parameters[key]}return data}data.data={attributes:{}};var index=this.index;if(index!==null){var array=Array.prototype.slice.call(index.array);data.data.index={type:index.array.constructor.name,array:array}}var attributes=this.attributes;for(var key in attributes){var attribute=attributes[key];var array=Array.prototype.slice.call(attribute.array);data.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array}}var groups=this.groups;if(groups.length>0){data.data.groups=JSON.parse(JSON.stringify(groups))}var boundingSphere=this.boundingSphere;if(boundingSphere!==null){data.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}}return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){var index=source.index;if(index!==null){this.setIndex(index.clone())}var attributes=source.attributes;for(var name in attributes){var attribute=attributes[name];this.addAttribute(name,attribute.clone())}var groups=source.groups;for(var i=0,l=groups.length;i<l;i++){var group=groups[i];this.addGroup(group.start,group.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.BufferGeometry.MaxIndex=65535;THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=undefined};THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry;THREE.InstancedBufferGeometry.prototype.addGroup=function(start,count,instances){this.groups.push({start:start,count:count,instances:instances})};THREE.InstancedBufferGeometry.prototype.copy=function(source){var index=source.index;if(index!==null){this.setIndex(index.clone())}var attributes=source.attributes;for(var name in attributes){var attribute=attributes[name];this.addAttribute(name,attribute.clone())}var groups=source.groups;for(var i=0,l=groups.length;i<l;i++){var group=groups[i];this.addGroup(group.start,group.count,group.instances)}return this};THREE.EventDispatcher.prototype.apply(THREE.InstancedBufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,-1).applyQuaternion(quaternion)}}();THREE.Camera.prototype.lookAt=function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(this.position,vector,this.up);this.quaternion.setFromRotationMatrix(m1)}}();THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)};THREE.Camera.prototype.copy=function(source){THREE.Object3D.prototype.copy.call(this,source);this.matrixWorldInverse.copy(source.matrixWorldInverse);this.projectionMatrix.copy(source.projectionMatrix);return this};THREE.CubeCamera=function(near,far,cubeResolution){THREE.Object3D.call(this);this.type="CubeCamera";var fov=90,aspect=1;var cameraPX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new THREE.Vector3(1,0,0));this.add(cameraPX);var cameraNX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new THREE.Vector3(-1,0,0));this.add(cameraNX);var cameraPY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new THREE.Vector3(0,1,0));this.add(cameraPY);var cameraNY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new THREE.Vector3(0,-1,0));this.add(cameraNY);var cameraPZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new THREE.Vector3(0,0,1));this.add(cameraPZ);var cameraNZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new THREE.Vector3(0,0,-1));this.add(cameraNZ);this.renderTarget=new THREE.WebGLRenderTargetCube(cubeResolution,cubeResolution,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(renderer,scene){if(this.parent===null)this.updateMatrixWorld();var renderTarget=this.renderTarget;var generateMipmaps=renderTarget.generateMipmaps;renderTarget.generateMipmaps=false;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget);renderer.setRenderTarget(null)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.OrthographicCamera=function(left,right,top,bottom,near,far){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var dx=(this.right-this.left)/(2*this.zoom);var dy=(this.top-this.bottom)/(2*this.zoom);var cx=(this.right+this.left)/2;var cy=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(cx-dx,cx+dx,cy+dy,cy-dy,this.near,this.far)};THREE.OrthographicCamera.prototype.copy=function(source){THREE.Camera.prototype.copy.call(this,source);this.left=source.left;this.right=source.right;this.top=source.top;this.bottom=source.bottom;this.near=source.near;this.far=source.far;this.zoom=source.zoom;return this};THREE.OrthographicCamera.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.zoom=this.zoom;data.object.left=this.left;data.object.right=this.right;data.object.top=this.top;data.object.bottom=this.bottom;data.object.near=this.near;data.object.far=this.far;return data};THREE.PerspectiveCamera=function(fov,aspect,near,far){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=fov!==undefined?fov:50;this.aspect=aspect!==undefined?aspect:1;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;this.fov=2*THREE.Math.radToDeg(Math.atan(frameHeight/(focalLength*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(fullWidth,fullHeight,x,y,width,height){this.fullWidth=fullWidth;this.fullHeight=fullHeight;this.x=x;this.y=y;this.width=width;this.height=height;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var fov=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var aspect=this.fullWidth/this.fullHeight;var top=Math.tan(THREE.Math.degToRad(fov*.5))*this.near;var bottom=-top;var left=aspect*bottom;var right=aspect*top;var width=Math.abs(right-left);var height=Math.abs(top-bottom);this.projectionMatrix.makeFrustum(left+this.x*width/this.fullWidth,left+(this.x+this.width)*width/this.fullWidth,top-(this.y+this.height)*height/this.fullHeight,top-this.y*height/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(fov,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.copy=function(source){THREE.Camera.prototype.copy.call(this,source);this.fov=source.fov;this.aspect=source.aspect;this.near=source.near;this.far=source.far;this.zoom=source.zoom;return this};THREE.PerspectiveCamera.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.zoom=this.zoom;data.object.fov=this.fov;data.object.aspect=this.aspect;data.object.near=this.near;data.object.far=this.far;return data};THREE.Light=function(color){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(color)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.copy=function(source){THREE.Object3D.prototype.copy.call(this,source);this.color.copy(source.color);return this};THREE.AmbientLight=function(color){THREE.Light.call(this,color);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.AmbientLight.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();return data};THREE.DirectionalLight=function(color,intensity){THREE.Light.call(this,color);this.type="DirectionalLight";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.DirectionalLight.prototype.copy=function(source){THREE.Light.prototype.copy.call(this,source);this.intensity=source.intensity;this.target=source.target.clone();this.castShadow=source.castShadow;this.onlyShadow=source.onlyShadow;this.shadowCameraNear=source.shadowCameraNear;this.shadowCameraFar=source.shadowCameraFar;this.shadowCameraLeft=source.shadowCameraLeft;this.shadowCameraRight=source.shadowCameraRight;this.shadowCameraTop=source.shadowCameraTop;this.shadowCameraBottom=source.shadowCameraBottom;this.shadowCameraVisible=source.shadowCameraVisible;this.shadowBias=source.shadowBias;this.shadowDarkness=source.shadowDarkness;this.shadowMapWidth=source.shadowMapWidth;this.shadowMapHeight=source.shadowMapHeight;return this};THREE.DirectionalLight.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();data.object.intensity=this.intensity;return data};THREE.HemisphereLight=function(skyColor,groundColor,intensity){THREE.Light.call(this,skyColor);this.type="HemisphereLight";this.position.set(0,1,0);this.updateMatrix();this.groundColor=new THREE.Color(groundColor);this.intensity=intensity!==undefined?intensity:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;THREE.HemisphereLight.prototype.copy=function(source){THREE.Light.prototype.copy.call(this,source);this.groundColor.copy(source.groundColor);this.intensity=source.intensity;return this};THREE.HemisphereLight.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();data.object.groundColor=this.groundColor.getHex();data.object.intensity=this.intensity;return data};THREE.PointLight=function(color,intensity,distance,decay){THREE.Light.call(this,color);this.type="PointLight";this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.decay=decay!==undefined?decay:1};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.PointLight.prototype.copy=function(source){THREE.Light.prototype.copy.call(this,source);this.intensity=source.intensity;this.distance=source.distance;this.decay=source.decay;return this};THREE.PointLight.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();data.object.intensity=this.intensity;data.object.distance=this.distance;data.object.decay=this.decay;return data};THREE.SpotLight=function(color,intensity,distance,angle,exponent,decay){THREE.Light.call(this,color);this.type="SpotLight";this.position.set(0,1,0);this.updateMatrix();this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.angle=angle!==undefined?angle:Math.PI/3;this.exponent=exponent!==undefined?exponent:10;this.decay=decay!==undefined?decay:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.SpotLight.prototype.copy=function(source){THREE.Light.prototype.copy.call(this,source);this.intensity=source.intensity;this.distance=source.distance;this.angle=source.angle;this.exponent=source.exponent;this.decay=source.decay;this.target=source.target.clone();this.castShadow=source.castShadow;this.onlyShadow=source.onlyShadow;this.shadowCameraNear=source.shadowCameraNear;this.shadowCameraFar=source.shadowCameraFar;this.shadowCameraFov=source.shadowCameraFov;this.shadowCameraVisible=source.shadowCameraVisible;this.shadowBias=source.shadowBias;this.shadowDarkness=source.shadowDarkness;this.shadowMapWidth=source.shadowMapWidth;this.shadowMapHeight=source.shadowMapHeight;return this};THREE.SpotLight.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();data.object.intensity=this.intensity;data.object.distance=this.distance;data.object.angle=this.angle;data.object.exponent=this.exponent;data.object.decay=this.decay;return data};THREE.Cache={enabled:false,files:{},add:function(key,file){if(this.enabled===false)return;this.files[key]=file},get:function(key){if(this.enabled===false)return;return this.files[key]},remove:function(key){delete this.files[key]},clear:function(){this.files={}}};THREE.Loader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,extractUrlBase:function(url){var parts=url.split("/");if(parts.length===1)return"./";parts.pop();return parts.join("/")+"/"},initMaterials:function(materials,texturePath,crossOrigin){var array=[];for(var i=0;i<materials.length;++i){array[i]=this.createMaterial(materials[i],texturePath,crossOrigin)}return array},createMaterial:function(){var imageLoader;return function createMaterial(m,texturePath,crossOrigin){var scope=this;if(crossOrigin===undefined&&scope.crossOrigin!==undefined)crossOrigin=scope.crossOrigin;if(imageLoader===undefined)imageLoader=new THREE.ImageLoader;function nearest_pow2(n){var l=Math.log(n)/Math.LN2;return Math.pow(2,Math.round(l))}function create_texture(where,name,sourceFile,repeat,offset,wrap,anisotropy){var fullPath=texturePath+sourceFile;var texture;var loader=THREE.Loader.Handlers.get(fullPath);if(loader!==null){texture=loader.load(fullPath)}else{texture=new THREE.Texture;loader=imageLoader;loader.setCrossOrigin(crossOrigin);loader.load(fullPath,function(image){if(THREE.Math.isPowerOfTwo(image.width)===false||THREE.Math.isPowerOfTwo(image.height)===false){var width=nearest_pow2(image.width);var height=nearest_pow2(image.height);var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0,width,height);texture.image=canvas}else{texture.image=image}texture.needsUpdate=true})}texture.sourceFile=sourceFile;if(repeat){texture.repeat.set(repeat[0],repeat[1]);if(repeat[0]!==1)texture.wrapS=THREE.RepeatWrapping;if(repeat[1]!==1)texture.wrapT=THREE.RepeatWrapping}if(offset){texture.offset.set(offset[0],offset[1])}if(wrap){var wrapMap={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(wrapMap[wrap[0]]!==undefined)texture.wrapS=wrapMap[wrap[0]];if(wrapMap[wrap[1]]!==undefined)texture.wrapT=wrapMap[wrap[1]]}if(anisotropy){texture.anisotropy=anisotropy}where[name]=texture}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255}var mtype="MeshLambertMaterial";var mpars={};if(m.shading){var shading=m.shading.toLowerCase();if(shading==="phong")mtype="MeshPhongMaterial";else if(shading==="basic")mtype="MeshBasicMaterial"}if(m.blending!==undefined&&THREE[m.blending]!==undefined){mpars.blending=THREE[m.blending]}if(m.transparent!==undefined){mpars.transparent=m.transparent}if(m.opacity!==undefined&&m.opacity<1){mpars.transparent=true}if(m.depthTest!==undefined){mpars.depthTest=m.depthTest}if(m.depthWrite!==undefined){mpars.depthWrite=m.depthWrite}if(m.visible!==undefined){mpars.visible=m.visible}if(m.flipSided!==undefined){mpars.side=THREE.BackSide}if(m.doubleSided!==undefined){mpars.side=THREE.DoubleSide}if(m.wireframe!==undefined){mpars.wireframe=m.wireframe}if(m.vertexColors!==undefined){if(m.vertexColors==="face"){mpars.vertexColors=THREE.FaceColors}else if(m.vertexColors){mpars.vertexColors=THREE.VertexColors}}if(m.colorDiffuse){mpars.color=rgb2hex(m.colorDiffuse)}else if(m.DbgColor){mpars.color=m.DbgColor}if(m.colorEmissive){mpars.emissive=rgb2hex(m.colorEmissive)}if(mtype==="MeshPhongMaterial"){if(m.colorSpecular){mpars.specular=rgb2hex(m.colorSpecular)}if(m.specularCoef){mpars.shininess=m.specularCoef}}if(m.transparency!==undefined){console.warn("THREE.Loader: transparency has been renamed to opacity");m.opacity=m.transparency}if(m.opacity!==undefined){mpars.opacity=m.opacity}if(texturePath){if(m.mapDiffuse){create_texture(mpars,"map",m.mapDiffuse,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy)}if(m.mapLight){create_texture(mpars,"lightMap",m.mapLight,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy)}if(m.mapAO){create_texture(mpars,"aoMap",m.mapAO,m.mapAORepeat,m.mapAOOffset,m.mapAOWrap,m.mapAOAnisotropy)}if(m.mapBump){create_texture(mpars,"bumpMap",m.mapBump,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy)}if(m.mapNormal){create_texture(mpars,"normalMap",m.mapNormal,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy)}if(m.mapSpecular){create_texture(mpars,"specularMap",m.mapSpecular,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy)}if(m.mapAlpha){create_texture(mpars,"alphaMap",m.mapAlpha,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy)}}if(m.mapBumpScale){mpars.bumpScale=m.mapBumpScale}if(m.mapNormalFactor){mpars.normalScale=new THREE.Vector2(m.mapNormalFactor,m.mapNormalFactor)}var material=new THREE[mtype](mpars);if(m.DbgName!==undefined)material.name=m.DbgName;return material}}()};THREE.Loader.Handlers={handlers:[],add:function(regex,loader){this.handlers.push(regex,loader)},get:function(file){for(var i=0,l=this.handlers.length;i<l;i+=2){var regex=this.handlers[i];var loader=this.handlers[i+1];if(regex.test(file)){return loader}}return null}};THREE.XHRLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=THREE.Cache.get(url);if(cached!==undefined){if(onLoad){setTimeout(function(){onLoad(cached)},0)}return cached}var request=new XMLHttpRequest;request.open("GET",url,true);request.addEventListener("load",function(event){THREE.Cache.add(url,this.response);if(onLoad)onLoad(this.response);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){request.addEventListener("progress",function(event){onProgress(event)},false)}request.addEventListener("error",function(event){if(onError)onError(event);scope.manager.itemError(url)},false);if(this.crossOrigin!==undefined)request.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)request.responseType=this.responseType;if(this.withCredentials!==undefined)request.withCredentials=this.withCredentials;request.send(null);scope.manager.itemStart(url);return request},setResponseType:function(value){this.responseType=value},setCrossOrigin:function(value){this.crossOrigin=value},setWithCredentials:function(value){this.withCredentials=value}};THREE.ImageLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=THREE.Cache.get(url);if(cached!==undefined){if(onLoad){setTimeout(function(){onLoad(cached)},0)}return cached}var image=document.createElement("img");image.addEventListener("load",function(event){THREE.Cache.add(url,this);if(onLoad)onLoad(this);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){image.addEventListener("progress",function(event){onProgress(event)},false)}image.addEventListener("error",function(event){if(onError)onError(event);scope.manager.itemError(url)},false);if(this.crossOrigin!==undefined)image.crossOrigin=this.crossOrigin;scope.manager.itemStart(url);image.src=url;return image},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.JSONLoader=function(manager){if(typeof manager==="boolean"){console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor.");manager=undefined}this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this.withCredentials=false};THREE.JSONLoader.prototype={constructor:THREE.JSONLoader,get statusDomElement(){if(this._statusDomElement===undefined){this._statusDomElement=document.createElement("div")}console.warn("THREE.JSONLoader: .statusDomElement has been removed.");return this._statusDomElement},load:function(url,onLoad,onProgress,onError){var scope=this;var texturePath=this.texturePath&&typeof this.texturePath==="string"?this.texturePath:THREE.Loader.prototype.extractUrlBase(url);var loader=new THREE.XHRLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setWithCredentials(this.withCredentials);loader.load(url,function(text){var json=JSON.parse(text);var metadata=json.metadata;if(metadata!==undefined){if(metadata.type==="object"){console.error("THREE.JSONLoader: "+url+" should be loaded with THREE.ObjectLoader instead.");return}if(metadata.type==="scene"){console.error("THREE.JSONLoader: "+url+" should be loaded with THREE.SceneLoader instead.");return}}var object=scope.parse(json,texturePath);onLoad(object.geometry,object.materials)})},setCrossOrigin:function(value){this.crossOrigin=value},setTexturePath:function(value){this.texturePath=value},parse:function(json,texturePath){var geometry=new THREE.Geometry,scale=json.scale!==undefined?1/json.scale:1;parseModel(scale);parseSkin();parseMorphing(scale);geometry.computeFaceNormals();geometry.computeBoundingSphere();function parseModel(scale){function isBitSet(value,position){return value&1<<position}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,nUvLayers=0;if(json.uvs!==undefined){for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length)nUvLayers++}for(i=0;i<nUvLayers;i++){geometry.faceVertexUvs[i]=[]}}offset=0;zLength=vertices.length;while(offset<zLength){vertex=new THREE.Vector3;vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex)}offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);if(isQuad){faceA=new THREE.Face3;faceA.a=faces[offset];faceA.b=faces[offset+1];faceA.c=faces[offset+3];faceB=new THREE.Face3;faceB.a=faces[offset+1];faceB.b=faces[offset+2];faceB.c=faces[offset+3];offset+=4;if(hasMaterial){materialIndex=faces[offset++];faceA.materialIndex=materialIndex;faceB.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];geometry.faceVertexUvs[i][fi+1]=[];for(j=0;j<4;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);if(j!==2)geometry.faceVertexUvs[i][fi].push(uv);if(j!==0)geometry.faceVertexUvs[i][fi+1].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);faceB.normal.copy(faceA.normal)}if(hasFaceVertexNormal){for(i=0;i<4;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);if(i!==2)faceA.vertexNormals.push(normal);if(i!==0)faceB.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];hex=colors[colorIndex];faceA.color.setHex(hex);faceB.color.setHex(hex)}if(hasFaceVertexColor){for(i=0;i<4;i++){colorIndex=faces[offset++];hex=colors[colorIndex];if(i!==2)faceA.vertexColors.push(new THREE.Color(hex));if(i!==0)faceB.vertexColors.push(new THREE.Color(hex))}}geometry.faces.push(faceA);geometry.faces.push(faceB)}else{face=new THREE.Face3;face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];for(j=0;j<3;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);geometry.faceVertexUvs[i][fi].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex])}if(hasFaceVertexNormal){for(i=0;i<3;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);face.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];face.color.setHex(colors[colorIndex])}if(hasFaceVertexColor){for(i=0;i<3;i++){colorIndex=faces[offset++];face.vertexColors.push(new THREE.Color(colors[colorIndex]))}}geometry.faces.push(face)}}}function parseSkin(){var influencesPerVertex=json.influencesPerVertex!==undefined?json.influencesPerVertex:2;if(json.skinWeights){for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i];var y=influencesPerVertex>1?json.skinWeights[i+1]:0;var z=influencesPerVertex>2?json.skinWeights[i+2]:0;var w=influencesPerVertex>3?json.skinWeights[i+3]:0;geometry.skinWeights.push(new THREE.Vector4(x,y,z,w))}}if(json.skinIndices){for(var i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i];var b=influencesPerVertex>1?json.skinIndices[i+1]:0;var c=influencesPerVertex>2?json.skinIndices[i+2]:0;var d=influencesPerVertex>3?json.skinIndices[i+3]:0;geometry.skinIndices.push(new THREE.Vector4(a,b,c,d))}}geometry.bones=json.bones;if(geometry.bones&&geometry.bones.length>0&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)){console.warn("When skinning, number of vertices ("+geometry.vertices.length+"), skinIndices ("+geometry.skinIndices.length+"), and skinWeights ("+geometry.skinWeights.length+") should match.")}geometry.animation=json.animation;geometry.animations=json.animations}function parseMorphing(scale){if(json.morphTargets!==undefined){var i,l,v,vl,dstVertices,srcVertices;for(i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];dstVertices=geometry.morphTargets[i].vertices;srcVertices=json.morphTargets[i].vertices;for(v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new THREE.Vector3;vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex)}}}if(json.morphColors!==undefined){var i,l,c,cl,dstColors,srcColors,color;for(i=0,l=json.morphColors.length;i<l;i++){geometry.morphColors[i]={};geometry.morphColors[i].name=json.morphColors[i].name;geometry.morphColors[i].colors=[];dstColors=geometry.morphColors[i].colors;srcColors=json.morphColors[i].colors;for(c=0,cl=srcColors.length;c<cl;c+=3){color=new THREE.Color(16755200);color.setRGB(srcColors[c],srcColors[c+1],srcColors[c+2]);dstColors.push(color)}}}}if(json.materials===undefined||json.materials.length===0){return{geometry:geometry}}else{var materials=THREE.Loader.prototype.initMaterials(json.materials,texturePath,this.crossOrigin);return{geometry:geometry,materials:materials}}}};THREE.LoadingManager=function(onLoad,onProgress,onError){var scope=this;var isLoading=false,itemsLoaded=0,itemsTotal=0;this.onStart=undefined;this.onLoad=onLoad;this.onProgress=onProgress;this.onError=onError;this.itemStart=function(url){itemsTotal++;if(isLoading===false){if(scope.onStart!==undefined){scope.onStart(url,itemsLoaded,itemsTotal)}}isLoading=true};this.itemEnd=function(url){itemsLoaded++;if(scope.onProgress!==undefined){scope.onProgress(url,itemsLoaded,itemsTotal)}if(itemsLoaded===itemsTotal){isLoading=false;if(scope.onLoad!==undefined){scope.onLoad()}}};this.itemError=function(url){if(scope.onError!==undefined){scope.onError(url)}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var geometry=new THREE.BufferGeometry;var index=json.data.index;if(index!==undefined){var typedArray=new self[index.type](index.array);geometry.setIndex(new THREE.BufferAttribute(typedArray,1))}var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key];var typedArray=new self[attribute.type](attribute.array);geometry.addAttribute(key,new THREE.BufferAttribute(typedArray,attribute.itemSize))}var groups=json.data.groups||json.data.drawcalls||json.data.offsets;if(groups!==undefined){for(var i=0,n=groups.length;i!==n;++i){var group=groups[i];geometry.addGroup(group.start,group.count)}}var boundingSphere=json.data.boundingSphere;if(boundingSphere!==undefined){var center=new THREE.Vector3;if(boundingSphere.center!==undefined){center.fromArray(boundingSphere.center)}geometry.boundingSphere=new THREE.Sphere(center,boundingSphere.radius)}return geometry}};THREE.MaterialLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this.textures={}};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},setTextures:function(value){this.textures=value},getTexture:function(name){var textures=this.textures;if(textures[name]===undefined){console.warn("THREE.MaterialLoader: Undefined texture",name)}return textures[name]},parse:function(json){var material=new THREE[json.type];material.uuid=json.uuid;if(json.name!==undefined)material.name=json.name;if(json.color!==undefined)material.color.setHex(json.color);if(json.emissive!==undefined)material.emissive.setHex(json.emissive);if(json.specular!==undefined)material.specular.setHex(json.specular);if(json.shininess!==undefined)material.shininess=json.shininess;if(json.uniforms!==undefined)material.uniforms=json.uniforms;if(json.vertexShader!==undefined)material.vertexShader=json.vertexShader;if(json.fragmentShader!==undefined)material.fragmentShader=json.fragmentShader;if(json.vertexColors!==undefined)material.vertexColors=json.vertexColors;if(json.shading!==undefined)material.shading=json.shading;if(json.blending!==undefined)material.blending=json.blending;if(json.side!==undefined)material.side=json.side;if(json.opacity!==undefined)material.opacity=json.opacity;if(json.transparent!==undefined)material.transparent=json.transparent;if(json.alphaTest!==undefined)material.alphaTest=json.alphaTest;if(json.depthTest!==undefined)material.depthTest=json.depthTest;if(json.depthWrite!==undefined)material.depthWrite=json.depthWrite;if(json.wireframe!==undefined)material.wireframe=json.wireframe;if(json.wireframeLinewidth!==undefined)material.wireframeLinewidth=json.wireframeLinewidth;if(json.size!==undefined)material.size=json.size;if(json.sizeAttenuation!==undefined)material.sizeAttenuation=json.sizeAttenuation;if(json.map!==undefined)material.map=this.getTexture(json.map);if(json.alphaMap!==undefined){material.alphaMap=this.getTexture(json.alphaMap);material.transparent=true}if(json.bumpMap!==undefined)material.bumpMap=this.getTexture(json.bumpMap);if(json.bumpScale!==undefined)material.bumpScale=json.bumpScale;if(json.normalMap!==undefined)material.normalMap=this.getTexture(json.normalMap);if(json.normalScale)material.normalScale=new THREE.Vector2(json.normalScale,json.normalScale);if(json.displacementMap!==undefined)material.displacementMap=this.getTexture(json.displacementMap);if(json.displacementScale!==undefined)material.displacementScale=json.displacementScale;if(json.displacementBias!==undefined)material.displacementBias=json.displacementBias;if(json.specularMap!==undefined)material.specularMap=this.getTexture(json.specularMap);if(json.envMap!==undefined){material.envMap=this.getTexture(json.envMap);material.combine=THREE.MultiplyOperation}if(json.reflectivity)material.reflectivity=json.reflectivity;if(json.lightMap!==undefined)material.lightMap=this.getTexture(json.lightMap);if(json.lightMapIntensity!==undefined)material.lightMapIntensity=json.lightMapIntensity;if(json.aoMap!==undefined)material.aoMap=this.getTexture(json.aoMap);if(json.aoMapIntensity!==undefined)material.aoMapIntensity=json.aoMapIntensity;if(json.materials!==undefined){for(var i=0,l=json.materials.length;i<l;i++){material.materials.push(this.parse(json.materials[i]))}}return material}};THREE.ObjectLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this.texturePath=""};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(url,onLoad,onProgress,onError){if(this.texturePath===""){this.texturePath=url.substring(0,url.lastIndexOf("/")+1)}var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){scope.parse(JSON.parse(text),onLoad)},onProgress,onError)},setTexturePath:function(value){this.texturePath=value},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json,onLoad){var geometries=this.parseGeometries(json.geometries);var images=this.parseImages(json.images,function(){if(onLoad!==undefined)onLoad(object)});var textures=this.parseTextures(json.textures,images);var materials=this.parseMaterials(json.materials,textures);var object=this.parseObject(json.object,geometries,materials);if(json.images===undefined||json.images.length===0){if(onLoad!==undefined)onLoad(object)}return object},parseGeometries:function(json){var geometries={};if(json!==undefined){var geometryLoader=new THREE.JSONLoader;var bufferGeometryLoader=new THREE.BufferGeometryLoader;for(var i=0,l=json.length;i<l;i++){var geometry;var data=json[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":geometry=new THREE[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"CubeGeometry":geometry=new THREE.BoxGeometry(data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleBufferGeometry":geometry=new THREE.CircleBufferGeometry(data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CircleGeometry":geometry=new THREE.CircleGeometry(data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CylinderGeometry":geometry=new THREE.CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"SphereGeometry":geometry=new THREE.SphereGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"SphereBufferGeometry":geometry=new THREE.SphereBufferGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"DodecahedronGeometry":geometry=new THREE.DodecahedronGeometry(data.radius,data.detail);break;case"IcosahedronGeometry":geometry=new THREE.IcosahedronGeometry(data.radius,data.detail);break;case"OctahedronGeometry":geometry=new THREE.OctahedronGeometry(data.radius,data.detail);break;case"TetrahedronGeometry":geometry=new THREE.TetrahedronGeometry(data.radius,data.detail);break;case"RingGeometry":geometry=new THREE.RingGeometry(data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case"TorusGeometry":geometry=new THREE.TorusGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":geometry=new THREE.TorusKnotGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.p,data.q,data.heightScale);break;case"TextGeometry":geometry=new THREE.TextGeometry(data.text,data.data);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data);break;case"Geometry":geometry=geometryLoader.parse(data.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+data.type+'"');continue}geometry.uuid=data.uuid;if(data.name!==undefined)geometry.name=data.name;geometries[data.uuid]=geometry}}return geometries},parseMaterials:function(json,textures){var materials={};if(json!==undefined){var loader=new THREE.MaterialLoader;loader.setTextures(textures);for(var i=0,l=json.length;i<l;i++){var material=loader.parse(json[i]);materials[material.uuid]=material}}return materials},parseImages:function(json,onLoad){var scope=this;var images={};function loadImage(url){scope.manager.itemStart(url);return loader.load(url,function(){scope.manager.itemEnd(url)})}if(json!==undefined&&json.length>0){var manager=new THREE.LoadingManager(onLoad);var loader=new THREE.ImageLoader(manager);loader.setCrossOrigin(this.crossOrigin);for(var i=0,l=json.length;i<l;i++){var image=json[i];var path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.texturePath+image.url;images[image.uuid]=loadImage(path)}}return images},parseTextures:function(json,images){function parseConstant(value){if(typeof value==="number")return value;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",value);return THREE[value]}var textures={};if(json!==undefined){for(var i=0,l=json.length;i<l;i++){var data=json[i];if(data.image===undefined){console.warn('THREE.ObjectLoader: No "image" specified for',data.uuid)}if(images[data.image]===undefined){console.warn("THREE.ObjectLoader: Undefined image",data.image)}var texture=new THREE.Texture(images[data.image]);texture.needsUpdate=true;texture.uuid=data.uuid;if(data.name!==undefined)texture.name=data.name;if(data.mapping!==undefined)texture.mapping=parseConstant(data.mapping);if(data.offset!==undefined)texture.offset=new THREE.Vector2(data.offset[0],data.offset[1]);if(data.repeat!==undefined)texture.repeat=new THREE.Vector2(data.repeat[0],data.repeat[1]);if(data.minFilter!==undefined)texture.minFilter=parseConstant(data.minFilter);if(data.magFilter!==undefined)texture.magFilter=parseConstant(data.magFilter);if(data.anisotropy!==undefined)texture.anisotropy=data.anisotropy;if(Array.isArray(data.wrap)){texture.wrapS=parseConstant(data.wrap[0]);texture.wrapT=parseConstant(data.wrap[1])}textures[data.uuid]=texture}}return textures},parseObject:function(){var matrix=new THREE.Matrix4;return function(data,geometries,materials){var object;var getGeometry=function(name){if(geometries[name]===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",name)}return geometries[name]};var getMaterial=function(name){if(materials[name]===undefined){console.warn("THREE.ObjectLoader: Undefined material",name)}return materials[name]};switch(data.type){case"Scene":object=new THREE.Scene;break;case"PerspectiveCamera":object=new THREE.PerspectiveCamera(data.fov,data.aspect,data.near,data.far);break;case"OrthographicCamera":object=new THREE.OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new THREE.AmbientLight(data.color);break;case"DirectionalLight":object=new THREE.DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new THREE.PointLight(data.color,data.intensity,data.distance,data.decay);break;case"SpotLight":object=new THREE.SpotLight(data.color,data.intensity,data.distance,data.angle,data.exponent,data.decay);break;case"HemisphereLight":object=new THREE.HemisphereLight(data.color,data.groundColor,data.intensity);break;case"Mesh":object=new THREE.Mesh(getGeometry(data.geometry),getMaterial(data.material));break;case"LOD":object=new THREE.LOD;break;case"Line":object=new THREE.Line(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case"PointCloud":case"Points":object=new THREE.Points(getGeometry(data.geometry),getMaterial(data.material));break;case"Sprite":object=new THREE.Sprite(getMaterial(data.material));break;case"Group":object=new THREE.Group;break;default:object=new THREE.Object3D}object.uuid=data.uuid;if(data.name!==undefined)object.name=data.name;if(data.matrix!==undefined){matrix.fromArray(data.matrix);matrix.decompose(object.position,object.quaternion,object.scale)}else{if(data.position!==undefined)object.position.fromArray(data.position);if(data.rotation!==undefined)object.rotation.fromArray(data.rotation);if(data.scale!==undefined)object.scale.fromArray(data.scale)}if(data.castShadow!==undefined)object.castShadow=data.castShadow;if(data.receiveShadow!==undefined)object.receiveShadow=data.receiveShadow;if(data.visible!==undefined)object.visible=data.visible;if(data.userData!==undefined)object.userData=data.userData;if(data.children!==undefined){for(var child in data.children){object.add(this.parseObject(data.children[child],geometries,materials))}}if(data.type==="LOD"){var levels=data.levels;for(var l=0;l<levels.length;l++){var level=levels[l];var child=object.getObjectByProperty("uuid",level.object);if(child!==undefined){object.addLevel(child,level.distance)}}}return object}}()};THREE.TextureLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.ImageLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(image){var texture=new THREE.Texture(image);texture.needsUpdate=true;if(onLoad!==undefined){onLoad(texture)}},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this._parser=null};THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var texture=new THREE.DataTexture;var loader=new THREE.XHRLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setResponseType("arraybuffer");loader.load(url,function(buffer){var texData=scope._parser(buffer);if(!texData)return;if(undefined!==texData.image){texture.image=texData.image}else if(undefined!==texData.data){texture.image.width=texData.width;texture.image.height=texData.height;texture.image.data=texData.data}texture.wrapS=undefined!==texData.wrapS?texData.wrapS:THREE.ClampToEdgeWrapping;texture.wrapT=undefined!==texData.wrapT?texData.wrapT:THREE.ClampToEdgeWrapping;texture.magFilter=undefined!==texData.magFilter?texData.magFilter:THREE.LinearFilter;texture.minFilter=undefined!==texData.minFilter?texData.minFilter:THREE.LinearMipMapLinearFilter;texture.anisotropy=undefined!==texData.anisotropy?texData.anisotropy:1;if(undefined!==texData.format){texture.format=texData.format}if(undefined!==texData.type){texture.type=texData.type}if(undefined!==texData.mipmaps){texture.mipmaps=texData.mipmaps}if(1===texData.mipmapCount){texture.minFilter=THREE.LinearFilter}texture.needsUpdate=true;if(onLoad)onLoad(texture,texData)},onProgress,onError);return texture},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.CompressedTextureLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var images=[];var texture=new THREE.CompressedTexture;texture.image=images;var loader=new THREE.XHRLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setResponseType("arraybuffer");if(Array.isArray(url)){var loaded=0;var loadTexture=function(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,true);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps};loaded+=1;if(loaded===6){if(texDatas.mipmapCount===1)texture.minFilter=THREE.LinearFilter;texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)}},onProgress,onError)};for(var i=0,il=url.length;i<il;++i){loadTexture(i)}}else{loader.load(url,function(buffer){var texDatas=scope._parser(buffer,true);if(texDatas.isCubemap){var faces=texDatas.mipmaps.length/texDatas.mipmapCount;for(var f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++){images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]);images[f].format=texDatas.format;images[f].width=texDatas.width;images[f].height=texDatas.height}}}else{texture.image.width=texDatas.width;texture.image.height=texDatas.height;texture.mipmaps=texDatas.mipmaps}if(texDatas.mipmapCount===1){texture.minFilter=THREE.LinearFilter}texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)},onProgress,onError)}return texture},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=THREE.LessEqualDepth;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.precision=null;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value},setValues:function(values){if(values===undefined)return;for(var key in values){var newValue=values[key];if(newValue===undefined){console.warn("THREE.Material: '"+key+"' parameter is undefined.");continue}var currentValue=this[key];if(currentValue===undefined){console.warn("THREE."+this.type+": '"+key+"' is not a property of this material.");continue}if(currentValue instanceof THREE.Color){currentValue.set(newValue)}else if(currentValue instanceof THREE.Vector3&&newValue instanceof THREE.Vector3){currentValue.copy(newValue)}else if(key==="overdraw"){this[key]=Number(newValue)}else{this[key]=newValue}}},toJSON:function(meta){var data={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};data.uuid=this.uuid;data.type=this.type;if(this.name!=="")data.name=this.name;if(this.color instanceof THREE.Color)data.color=this.color.getHex();if(this.emissive instanceof THREE.Color)data.emissive=this.emissive.getHex();if(this.specular instanceof THREE.Color)data.specular=this.specular.getHex();if(this.shininess!==undefined)data.shininess=this.shininess;if(this.map instanceof THREE.Texture)data.map=this.map.toJSON(meta).uuid;if(this.alphaMap instanceof THREE.Texture)data.alphaMap=this.alphaMap.toJSON(meta).uuid;if(this.lightMap instanceof THREE.Texture)data.lightMap=this.lightMap.toJSON(meta).uuid;if(this.bumpMap instanceof THREE.Texture){data.bumpMap=this.bumpMap.toJSON(meta).uuid;data.bumpScale=this.bumpScale}if(this.normalMap instanceof THREE.Texture){data.normalMap=this.normalMap.toJSON(meta).uuid;data.normalScale=this.normalScale}if(this.displacementMap instanceof THREE.Texture){data.displacementMap=this.displacementMap.toJSON(meta).uuid;data.displacementScale=this.displacementScale;data.displacementBias=this.displacementBias}if(this.specularMap instanceof THREE.Texture)data.specularMap=this.specularMap.toJSON(meta).uuid;if(this.envMap instanceof THREE.Texture){data.envMap=this.envMap.toJSON(meta).uuid;data.reflectivity=this.reflectivity}if(this.size!==undefined)data.size=this.size;if(this.sizeAttenuation!==undefined)data.sizeAttenuation=this.sizeAttenuation;if(this.vertexColors!==undefined&&this.vertexColors!==THREE.NoColors)data.vertexColors=this.vertexColors;if(this.shading!==undefined&&this.shading!==THREE.SmoothShading)data.shading=this.shading;if(this.blending!==undefined&&this.blending!==THREE.NormalBlending)data.blending=this.blending;if(this.side!==undefined&&this.side!==THREE.FrontSide)data.side=this.side;if(this.opacity<1)data.opacity=this.opacity;if(this.transparent===true)data.transparent=this.transparent;if(this.alphaTest>0)data.alphaTest=this.alphaTest;if(this.wireframe===true)data.wireframe=this.wireframe;if(this.wireframeLinewidth>1)data.wireframeLinewidth=this.wireframeLinewidth;return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.name=source.name;this.side=source.side;this.opacity=source.opacity;this.transparent=source.transparent;this.blending=source.blending;this.blendSrc=source.blendSrc;this.blendDst=source.blendDst;this.blendEquation=source.blendEquation;this.blendSrcAlpha=source.blendSrcAlpha;this.blendDstAlpha=source.blendDstAlpha;this.blendEquationAlpha=source.blendEquationAlpha;this.depthFunc=source.depthFunc;this.depthTest=source.depthTest;this.depthWrite=source.depthWrite;this.precision=source.precision;this.polygonOffset=source.polygonOffset;this.polygonOffsetFactor=source.polygonOffsetFactor;this.polygonOffsetUnits=source.polygonOffsetUnits;this.alphaTest=source.alphaTest;this.overdraw=source.overdraw;this.visible=source.visible;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(boolean){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new THREE.Color}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(parameters){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.LineBasicMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.linewidth=source.linewidth;this.linecap=source.linecap;this.linejoin=source.linejoin;this.vertexColors=source.vertexColors;this.fog=source.fog;return this};THREE.LineDashedMaterial=function(parameters){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(parameters)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.linewidth=source.linewidth;this.scale=source.scale;this.dashSize=source.dashSize;this.gapSize=source.gapSize;this.vertexColors=source.vertexColors;this.fog=source.fog;return this};THREE.MeshBasicMaterial=function(parameters){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.map=null;this.aoMap=null;this.aoMapIntensity=1;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(parameters)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshBasicMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.fog=source.fog;this.shading=source.shading;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.vertexColors=source.vertexColors;this.skinning=source.skinning;this.morphTargets=source.morphTargets;return this};THREE.MeshLambertMaterial=function(parameters){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.map=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshLambertMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.emissive.copy(source.emissive);this.map=source.map;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.fog=source.fog;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.vertexColors=source.vertexColors;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this};THREE.MeshPhongMaterial=function(parameters){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshPhongMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.emissive.copy(source.emissive);this.specular.copy(source.specular);this.shininess=source.shininess;this.metal=source.metal;this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissiveMap=source.emissiveMap;this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.fog=source.fog;this.shading=source.shading;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.vertexColors=source.vertexColors;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this};THREE.MeshDepthMaterial=function(parameters){THREE.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(parameters)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;return this};THREE.MeshNormalMaterial=function(parameters){THREE.Material.call(this,parameters);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(parameters)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;return this};THREE.MultiMaterial=function(materials){this.uuid=THREE.Math.generateUUID();this.type="MultiMaterial";this.materials=materials instanceof Array?materials:[];this.visible=true};THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var i=0,l=this.materials.length;i<l;i++){output.materials.push(this.materials[i].toJSON())}output.visible=this.visible;return output},clone:function(){var material=new this.constructor;for(var i=0;i<this.materials.length;i++){material.materials.push(this.materials[i].clone())}material.visible=this.visible;return material}};THREE.MeshFaceMaterial=THREE.MultiMaterial;THREE.PointsMaterial=function(parameters){THREE.Material.call(this);this.type="PointsMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial;THREE.PointsMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.size=source.size;this.sizeAttenuation=source.sizeAttenuation;this.vertexColors=source.vertexColors;this.fog=source.fog;return this};THREE.PointCloudMaterial=function(parameters){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(parameters)};THREE.ParticleBasicMaterial=function(parameters){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(parameters)};THREE.ParticleSystemMaterial=function(parameters){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new THREE.PointsMaterial(parameters)};THREE.ShaderMaterial=function(parameters){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.derivatives=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;if(parameters!==undefined){if(parameters.attributes!==undefined){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}this.setValues(parameters)}};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.ShaderMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.fragmentShader=source.fragmentShader;this.vertexShader=source.vertexShader;this.uniforms=THREE.UniformsUtils.clone(source.uniforms);this.attributes=source.attributes;this.defines=source.defines;this.shading=source.shading;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.fog=source.fog;this.lights=source.lights;this.vertexColors=source.vertexColors;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;this.derivatives=source.derivatives;return this};THREE.ShaderMaterial.prototype.toJSON=function(meta){var data=THREE.Material.prototype.toJSON.call(this,meta);data.uniforms=this.uniforms;data.attributes=this.attributes;data.vertexShader=this.vertexShader;data.fragmentShader=this.fragmentShader;return data};THREE.RawShaderMaterial=function(parameters){THREE.ShaderMaterial.call(this,parameters);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.SpriteMaterial=function(parameters){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(parameters)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.copy=function(source){THREE.Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.rotation=source.rotation;this.fog=source.fog;return this};THREE.Texture=function(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.sourceFile="";this.image=image!==undefined?image:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=mapping!==undefined?mapping:THREE.Texture.DEFAULT_MAPPING;this.wrapS=wrapS!==undefined?wrapS:THREE.ClampToEdgeWrapping;this.wrapT=wrapT!==undefined?wrapT:THREE.ClampToEdgeWrapping;this.magFilter=magFilter!==undefined?magFilter:THREE.LinearFilter;this.minFilter=minFilter!==undefined?minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=anisotropy!==undefined?anisotropy:1;this.format=format!==undefined?format:THREE.RGBAFormat;this.type=type!==undefined?type:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.version=0;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=undefined;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(value){if(value===true)this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.image=source.image;this.mipmaps=source.mipmaps.slice(0);this.mapping=source.mapping;this.wrapS=source.wrapS;this.wrapT=source.wrapT;this.magFilter=source.magFilter;this.minFilter=source.minFilter;this.anisotropy=source.anisotropy;this.format=source.format;this.type=source.type;this.offset.copy(source.offset);this.repeat.copy(source.repeat);this.generateMipmaps=source.generateMipmaps;this.premultiplyAlpha=source.premultiplyAlpha;this.flipY=source.flipY;this.unpackAlignment=source.unpackAlignment;return this},toJSON:function(meta){if(meta.textures[this.uuid]!==undefined){return meta.textures[this.uuid]}function getDataURL(image){var canvas;if(image.toDataURL!==undefined){canvas=image}else{canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;canvas.getContext("2d").drawImage(image,0,0,image.width,image.height)}if(canvas.width>2048||canvas.height>2048){return canvas.toDataURL("image/jpeg",.6)}else{return canvas.toDataURL("image/png")}}var output={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(this.image!==undefined){var image=this.image;if(image.uuid===undefined){image.uuid=THREE.Math.generateUUID()}if(meta.images[image.uuid]===undefined){meta.images[image.uuid]={uuid:image.uuid,url:getDataURL(image)}}output.image=image.uuid}meta.textures[this.uuid]=output;return output},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(uv){if(this.mapping!==THREE.UVMapping)return;uv.multiply(this.repeat);uv.add(this.offset);if(uv.x<0||uv.x>1){switch(this.wrapS){case THREE.RepeatWrapping:uv.x=uv.x-Math.floor(uv.x);break;case THREE.ClampToEdgeWrapping:uv.x=uv.x<0?0:1;break;case THREE.MirroredRepeatWrapping:if(Math.abs(Math.floor(uv.x)%2)===1){uv.x=Math.ceil(uv.x)-uv.x}else{uv.x=uv.x-Math.floor(uv.x)}break}}if(uv.y<0||uv.y>1){switch(this.wrapT){case THREE.RepeatWrapping:uv.y=uv.y-Math.floor(uv.y);break;case THREE.ClampToEdgeWrapping:uv.y=uv.y<0?0:1;break;case THREE.MirroredRepeatWrapping:if(Math.abs(Math.floor(uv.y)%2)===1){uv.y=Math.ceil(uv.y)-uv.y}else{uv.y=uv.y-Math.floor(uv.y)}break}}if(this.flipY){uv.y=1-uv.y}}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CanvasTexture=function(canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.Texture.call(this,canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.needsUpdate=true};THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture;THREE.CubeTexture=function(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){mapping=mapping!==undefined?mapping:THREE.CubeReflectionMapping;THREE.Texture.call(this,images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.images=images;this.flipY=false};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;THREE.CubeTexture.prototype.copy=function(source){THREE.Texture.prototype.copy.call(this,source);this.images=source.images;return this};THREE.CompressedTexture=function(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={width:width,height:height};this.mipmaps=mipmaps;this.flipY=false;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.DataTexture=function(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={data:data,width:width,height:height};this.magFilter=magFilter!==undefined?magFilter:THREE.NearestFilter;this.minFilter=minFilter!==undefined?minFilter:THREE.NearestFilter;this.flipY=false;this.generateMipmaps=false};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.VideoTexture=function(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.generateMipmaps=false;var scope=this;var update=function(){requestAnimationFrame(update);if(video.readyState===video.HAVE_ENOUGH_DATA){scope.needsUpdate=true}};update()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.Group.prototype.constructor=THREE.Group;THREE.Points=function(geometry,material){THREE.Object3D.call(this);this.type="Points";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.PointsMaterial({color:Math.random()*16777215})};THREE.Points.prototype=Object.create(THREE.Object3D.prototype);THREE.Points.prototype.constructor=THREE.Points;THREE.Points.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;return function raycast(raycaster,intersects){var object=this;var geometry=object.geometry;var threshold=raycaster.params.Points.threshold;inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);var localThresholdSq=localThreshold*localThreshold;var position=new THREE.Vector3;function testPoint(point,index){var rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThresholdSq){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,distanceToRay:Math.sqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object})}}if(geometry instanceof THREE.BufferGeometry){var index=geometry.index;var attributes=geometry.attributes;var positions=attributes.position.array;if(index!==null){var indices=index.array;for(var i=0,il=indices.length;i<il;i++){var a=indices[i];position.fromArray(positions,a*3);testPoint(position,a)}}else{for(var i=0,l=positions.length/3;i<l;i++){position.fromArray(positions,i*3);testPoint(position,i)}}}else{var vertices=geometry.vertices;for(var i=0,l=vertices.length;i<l;i++){testPoint(vertices[i],i)}}}}();THREE.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};THREE.Points.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);if(meta.geometries[this.geometry.uuid]===undefined){meta.geometries[this.geometry.uuid]=this.geometry.toJSON()}if(meta.materials[this.material.uuid]===undefined){meta.materials[this.material.uuid]=this.material.toJSON()}data.object.geometry=this.geometry.uuid;data.object.material=this.material.uuid;return data};THREE.PointCloud=function(geometry,material){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new THREE.Points(geometry,material)};THREE.ParticleSystem=function(geometry,material){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new THREE.Points(geometry,material)};THREE.Line=function(geometry,material,mode){if(mode===1){console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.");return new THREE.LineSegments(geometry,material)}THREE.Object3D.call(this);this.type="Line";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.LineBasicMaterial({color:Math.random()*16777215})};THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.constructor=THREE.Line;THREE.Line.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;return function raycast(raycaster,intersects){var precision=raycaster.linePrecision;var precisionSq=precision*precision;var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var vStart=new THREE.Vector3;var vEnd=new THREE.Vector3;var interSegment=new THREE.Vector3;var interRay=new THREE.Vector3;var step=this instanceof THREE.LineSegments?2:1;if(geometry instanceof THREE.BufferGeometry){var index=geometry.index;var attributes=geometry.attributes;if(index!==null){var indices=index.array;var positions=attributes.position.array;for(var i=0,l=indices.length-1;i<l;i+=step){var a=indices[i];var b=indices[i+1];vStart.fromArray(positions,a*3);vEnd.fromArray(positions,b*3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;interRay.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{var positions=attributes.position.array;for(var i=0,l=positions.length/3-1;i<l;i+=step){vStart.fromArray(positions,3*i);vEnd.fromArray(positions,3*i+3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;interRay.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var nbVertices=vertices.length;for(var i=0;i<nbVertices-1;i+=step){var distSq=ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment);if(distSq>precisionSq)continue;interRay.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}}();THREE.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};THREE.Line.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);if(meta.geometries[this.geometry.uuid]===undefined){meta.geometries[this.geometry.uuid]=this.geometry.toJSON()}if(meta.materials[this.material.uuid]===undefined){meta.materials[this.material.uuid]=this.material.toJSON()}data.object.geometry=this.geometry.uuid;data.object.material=this.material.uuid;return data};THREE.LineStrip=0;THREE.LinePieces=1;THREE.LineSegments=function(geometry,material){THREE.Line.call(this,geometry,material);this.type="LineSegments"};THREE.LineSegments.prototype=Object.create(THREE.Line.prototype);THREE.LineSegments.prototype.constructor=THREE.LineSegments;THREE.Mesh=function(geometry,material){THREE.Object3D.call(this);this.type="Mesh";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var m=0,ml=this.geometry.morphTargets.length;m<ml;m++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[m].name]=m}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(name){if(this.morphTargetDictionary[name]!==undefined){return this.morphTargetDictionary[name]}console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+name+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;var vA=new THREE.Vector3;var vB=new THREE.Vector3;var vC=new THREE.Vector3;var tempA=new THREE.Vector3;var tempB=new THREE.Vector3;var tempC=new THREE.Vector3;var uvA=new THREE.Vector2;var uvB=new THREE.Vector2;var uvC=new THREE.Vector2;var barycoord=new THREE.Vector3;var intersectionPoint=new THREE.Vector3;var intersectionPointWorld=new THREE.Vector3;function uvIntersection(point,p1,p2,p3,uv1,uv2,uv3){THREE.Triangle.barycoordFromPoint(point,p1,p2,p3,barycoord);uv1.multiplyScalar(barycoord.x);uv2.multiplyScalar(barycoord.y);uv3.multiplyScalar(barycoord.z);uv1.add(uv2).add(uv3);return uv1.clone()}return function raycast(raycaster,intersects){var geometry=this.geometry;var material=this.material;if(material===undefined)return;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}var a,b,c;if(geometry instanceof THREE.BufferGeometry){var index=geometry.index;var attributes=geometry.attributes;if(index!==null){var indices=index.array;var positions=attributes.position.array;for(var i=0,l=indices.length;i<l;i+=3){a=indices[i];b=indices[i+1];c=indices[i+2];vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);if(material.side===THREE.BackSide){if(ray.intersectTriangle(vC,vB,vA,true,intersectionPoint)===null)continue}else{if(ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide,intersectionPoint)===null)continue}intersectionPointWorld.copy(intersectionPoint);intersectionPointWorld.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);if(distance<raycaster.near||distance>raycaster.far)continue;var uv;if(attributes.uv!==undefined){var uvs=attributes.uv.array;uvA.fromArray(uvs,a*2);uvB.fromArray(uvs,b*2);uvC.fromArray(uvs,c*2);uv=uvIntersection(intersectionPoint,vA,vB,vC,uvA,uvB,uvC)}intersects.push({distance:distance,point:intersectionPointWorld.clone(),uv:uv,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:Math.floor(i/3),object:this})}}else{var positions=attributes.position.array;for(var i=0,l=positions.length;i<l;i+=9){vA.fromArray(positions,i);vB.fromArray(positions,i+3);vC.fromArray(positions,i+6);if(material.side===THREE.BackSide){if(ray.intersectTriangle(vC,vB,vA,true,intersectionPoint)===null)continue}else{if(ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide,intersectionPoint)===null)continue}intersectionPointWorld.copy(intersectionPoint);intersectionPointWorld.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);if(distance<raycaster.near||distance>raycaster.far)continue;var uv;if(attributes.uv!==undefined){var uvs=attributes.uv.array;uvA.fromArray(uvs,i);uvB.fromArray(uvs,i+2);uvC.fromArray(uvs,i+4);uv=uvIntersection(intersectionPoint,vA,vB,vC,uvA,uvB,uvC)}a=i/3;b=a+1;c=a+2;intersects.push({distance:distance,point:intersectionPointWorld.clone(),uv:uv,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),index:a,object:this})}}}else if(geometry instanceof THREE.Geometry){var isFaceMaterial=material instanceof THREE.MeshFaceMaterial;var materials=isFaceMaterial===true?material.materials:null;var vertices=geometry.vertices;var faces=geometry.faces;for(var f=0,fl=faces.length;f<fl;f++){var face=faces[f];var faceMaterial=isFaceMaterial===true?materials[face.materialIndex]:material;if(faceMaterial===undefined)continue;a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];if(faceMaterial.morphTargets===true){var morphTargets=geometry.morphTargets;var morphInfluences=this.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(influence===0)continue;var targets=morphTargets[t].vertices;vA.addScaledVector(tempA.subVectors(targets[face.a],a),influence);vB.addScaledVector(tempB.subVectors(targets[face.b],b),influence);vC.addScaledVector(tempC.subVectors(targets[face.c],c),influence)}vA.add(a);vB.add(b);vC.add(c);a=vA;b=vB;c=vC}if(faceMaterial.side===THREE.BackSide){if(ray.intersectTriangle(c,b,a,true,intersectionPoint)===null)continue}else{if(ray.intersectTriangle(a,b,c,faceMaterial.side!==THREE.DoubleSide,intersectionPoint)===null)continue}intersectionPointWorld.copy(intersectionPoint);intersectionPointWorld.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);if(distance<raycaster.near||distance>raycaster.far)continue;var uv;if(geometry.faceVertexUvs[0].length>0){var uvs=geometry.faceVertexUvs[0][f];uvA.copy(uvs[0]);uvB.copy(uvs[1]);uvC.copy(uvs[2]);uv=uvIntersection(intersectionPoint,a,b,c,uvA,uvB,uvC)}intersects.push({distance:distance,point:intersectionPointWorld.clone(),uv:uv,face:face,faceIndex:f,object:this})}}}}();THREE.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)};THREE.Mesh.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);if(meta.geometries[this.geometry.uuid]===undefined){meta.geometries[this.geometry.uuid]=this.geometry.toJSON(meta)}if(meta.materials[this.material.uuid]===undefined){meta.materials[this.material.uuid]=this.material.toJSON(meta)}data.object.geometry=this.geometry.uuid;data.object.material=this.material.uuid;return data};THREE.Bone=function(skin){THREE.Object3D.call(this);this.type="Bone";this.skin=skin};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.copy=function(source){THREE.Object3D.prototype.copy.call(this,source);this.skin=source.skin;return this};THREE.Skeleton=function(bones,boneInverses,useVertexTexture){this.useVertexTexture=useVertexTexture!==undefined?useVertexTexture:true;this.identityMatrix=new THREE.Matrix4;bones=bones||[];this.bones=bones.slice(0);if(this.useVertexTexture){var size=Math.sqrt(this.bones.length*4);size=THREE.Math.nextPowerOfTwo(Math.ceil(size));size=Math.max(size,4);this.boneTextureWidth=size;this.boneTextureHeight=size;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(boneInverses===undefined){this.calculateInverses()}else{if(this.bones.length===boneInverses.length){this.boneInverses=boneInverses.slice(0)}else{console.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){var inverse=new THREE.Matrix4;if(this.bones[b]){inverse.getInverse(this.bones[b].matrixWorld)}this.boneInverses.push(inverse)}};THREE.Skeleton.prototype.pose=function(){var bone;for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){bone.matrixWorld.getInverse(this.boneInverses[b])}}for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){if(bone.parent){bone.matrix.getInverse(bone.parent.matrixWorld);bone.matrix.multiply(bone.matrixWorld)}else{bone.matrix.copy(bone.matrixWorld)}bone.matrix.decompose(bone.position,bone.quaternion,bone.scale)}}};THREE.Skeleton.prototype.update=function(){var offsetMatrix=new THREE.Matrix4;return function update(){for(var b=0,bl=this.bones.length;b<bl;b++){var matrix=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;offsetMatrix.multiplyMatrices(matrix,this.boneInverses[b]);offsetMatrix.flattenToArrayOffset(this.boneMatrices,b*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.Skeleton.prototype.clone=function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)};THREE.SkinnedMesh=function(geometry,material,useVertexTexture){THREE.Mesh.call(this,geometry,material);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;var bones=[];if(this.geometry&&this.geometry.bones!==undefined){var bone,gbone;for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];bone=new THREE.Bone(this);bones.push(bone);bone.name=gbone.name;bone.position.fromArray(gbone.pos);bone.quaternion.fromArray(gbone.rotq);if(gbone.scl!==undefined)bone.scale.fromArray(gbone.scl)}for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];if(gbone.parent!==-1){bones[gbone.parent].add(bones[b])}else{this.add(bones[b])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new THREE.Skeleton(bones,undefined,useVertexTexture),this.matrixWorld)};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.bind=function(skeleton,bindMatrix){this.skeleton=skeleton;if(bindMatrix===undefined){this.updateMatrixWorld(true);this.skeleton.calculateInverses();bindMatrix=this.matrixWorld}this.bindMatrix.copy(bindMatrix);this.bindMatrixInverse.getInverse(bindMatrix)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var i=0;i<this.geometry.skinIndices.length;i++){var sw=this.geometry.skinWeights[i];var scale=1/sw.lengthManhattan();if(scale!==Infinity){sw.multiplyScalar(scale)}else{sw.set(1)}}}else{}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(force){THREE.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)}};THREE.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)};THREE.MorphAnimMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(start,end){this.startKeyframe=start;this.endKeyframe=end;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var geometry=this.geometry;if(!geometry.animations)geometry.animations={};var firstAnimation,animations=geometry.animations;var pattern=/([a-z]+)_?(\d+)/;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var parts=morph.name.match(pattern);if(parts&&parts.length>1){var label=parts[1];if(!animations[label])animations[label]={start:Infinity,end:-Infinity};var animation=animations[label];if(i<animation.start)animation.start=i;if(i>animation.end)animation.end=i;if(!firstAnimation)firstAnimation=label}}geometry.firstAnimation=firstAnimation};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(label,start,end){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[label]={start:start,end:end}};THREE.MorphAnimMesh.prototype.playAnimation=function(label,fps){var animation=this.geometry.animations[label];if(animation){this.setFrameRange(animation.start,animation.end);this.duration=1e3*((animation.end-animation.start)/fps);this.time=0}else{console.warn("THREE.MorphAnimMesh: animation["+label+"] undefined in .playAnimation()")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(delta){var frameTime=this.duration/this.length;this.time+=this.direction*delta;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var keyframe=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/frameTime),0,this.length-1);var influences=this.morphTargetInfluences;if(keyframe!==this.currentKeyframe){influences[this.lastKeyframe]=0;influences[this.currentKeyframe]=1;influences[keyframe]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=keyframe}var mix=this.time%frameTime/frameTime;if(this.directionBackwards){mix=1-mix}influences[this.currentKeyframe]=mix;influences[this.lastKeyframe]=1-mix};THREE.MorphAnimMesh.prototype.interpolateTargets=function(a,b,t){var influences=this.morphTargetInfluences;for(var i=0,l=influences.length;i<l;i++){influences[i]=0}if(a>-1)influences[a]=1-t;if(b>-1)influences[b]=t};THREE.MorphAnimMesh.prototype.copy=function(source){THREE.Mesh.prototype.copy.call(this,source);this.duration=source.duration;this.mirroredLoop=source.mirroredLoop;this.time=source.time;this.lastKeyframe=source.lastKeyframe;this.currentKeyframe=source.currentKeyframe;this.direction=source.direction;this.directionBackwards=source.directionBackwards;return this};THREE.LOD=function(){THREE.Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:true,value:[]},objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}})};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.addLevel=function(object,distance){if(distance===undefined)distance=0;distance=Math.abs(distance);var levels=this.levels;for(var l=0;l<levels.length;l++){if(distance<levels[l].distance){break}}levels.splice(l,0,{distance:distance,object:object});this.add(object)};THREE.LOD.prototype.getObjectForDistance=function(distance){var levels=this.levels;for(var i=1,l=levels.length;i<l;i++){if(distance<levels[i].distance){break}}return levels[i-1].object};THREE.LOD.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function raycast(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}}();THREE.LOD.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function update(camera){var levels=this.levels;if(levels.length>1){v1.setFromMatrixPosition(camera.matrixWorld);v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);levels[0].object.visible=true;for(var i=1,l=levels.length;i<l;i++){if(distance>=levels[i].distance){levels[i-1].object.visible=false;levels[i].object.visible=true}else{break}}for(;i<l;i++){levels[i].object.visible=false}}}}();THREE.LOD.prototype.copy=function(source){THREE.Object3D.prototype.copy.call(this,source,false);var levels=source.levels;for(var i=0,l=levels.length;i<l;i++){var level=levels[i];this.addLevel(level.object.clone(),level.distance)}return this};THREE.LOD.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);data.object.levels=[];var levels=this.levels;for(var i=0,l=levels.length;i<l;i++){var level=levels[i];data.object.levels.push({object:level.object.uuid,distance:level.distance})}return data};THREE.Sprite=function(){var indices=new Uint16Array([0,1,2,0,2,3]);var vertices=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var uvs=new Float32Array([0,0,1,0,1,1,0,1]);var geometry=new THREE.BufferGeometry;geometry.setIndex(new THREE.BufferAttribute(indices,1));geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("uv",new THREE.BufferAttribute(uvs,2));return function Sprite(material){THREE.Object3D.call(this);this.type="Sprite";this.geometry=geometry;this.material=material!==undefined?material:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function raycast(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distanceSq=raycaster.ray.distanceSqToPoint(matrixPosition);var guessSizeSq=this.scale.x*this.scale.y;if(distanceSq>guessSizeSq){return}intersects.push({distance:Math.sqrt(distanceSq),point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)};THREE.Sprite.prototype.toJSON=function(meta){var data=THREE.Object3D.prototype.toJSON.call(this,meta);if(meta.materials[this.material.uuid]===undefined){meta.materials[this.material.uuid]=this.material.toJSON()}data.object.material=this.material.uuid;return data};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(texture,size,distance,blending,color){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(texture!==undefined){this.add(texture,size,distance,blending,color)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.add=function(texture,size,distance,blending,color,opacity){if(size===undefined)size=-1;if(distance===undefined)distance=0;if(opacity===undefined)opacity=1;if(color===undefined)color=new THREE.Color(16777215);if(blending===undefined)blending=THREE.NormalBlending;distance=Math.min(distance,Math.max(0,distance));this.lensFlares.push({texture:texture,size:size,distance:distance,x:0,y:0,z:0,scale:1,rotation:0,opacity:opacity,color:color,blending:blending})};THREE.LensFlare.prototype.updateLensFlares=function(){var f,fl=this.lensFlares.length;var flare;var vecX=-this.positionScreen.x*2;var vecY=-this.positionScreen.y*2;for(f=0;f<fl;f++){flare=this.lensFlares[f];flare.x=this.positionScreen.x+vecX*flare.distance;flare.y=this.positionScreen.y+vecY*flare.distance;flare.wantedRotation=flare.x*Math.PI*.25;flare.rotation+=(flare.wantedRotation-flare.rotation)*.25}};THREE.LensFlare.prototype.copy=function(source){THREE.Object3D.prototype.copy.call(this,source);this.positionScreen.copy(source.positionScreen);this.customUpdateCallback=source.customUpdateCallback;for(var i=0,l=source.lensFlares.length;i<l;i++){this.lensFlares.push(source.lensFlares[i])}return this};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.copy=function(source){THREE.Object3D.prototype.copy.call(this,source);if(source.fog!==null)this.fog=source.fog.clone();if(source.overrideMaterial!==null)this.overrideMaterial=source.overrideMaterial.clone();this.autoUpdate=source.autoUpdate;this.matrixAutoUpdate=source.matrixAutoUpdate;return this};THREE.Fog=function(color,near,far){this.name="";this.color=new THREE.Color(color);this.near=near!==undefined?near:1;this.far=far!==undefined?far:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(color,density){this.name="";this.color=new THREE.Color(color);this.density=density!==undefined?density:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";THREE.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk["aomap_fragment"]="#ifdef USE_AOMAP\n\n\ttotalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n";THREE.ShaderChunk["aomap_pars_fragment"]="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif";THREE.ShaderChunk["begin_vertex"]="\nvec3 transformed = vec3( position );\n";THREE.ShaderChunk["beginnormal_vertex"]="\nvec3 objectNormal = vec3( normal );\n";THREE.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif";THREE.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";THREE.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif";THREE.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n\tif ( decayExponent > 0.0 ) {\n\n\t  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t//;float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\tfloat fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n\t// geometry term is (nl)(nv) / 4(nl)(nv)\n\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n\t// factor of 1/PI in distribution term omitted\n\n\treturn ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\t//float dotNL = saturate( dot( normal, lightDir ) );\n\t//float dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( lightDir, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n\t#ifdef GAMMA_INPUT\n\n\t\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n\t#else\n\n\t\treturn a;\n\n\t#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n\t#else\n\n\t\treturn a;\n\n\t#endif\n\n}\n";THREE.ShaderChunk["defaultnormal_vertex"]="#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk["displacementmap_vertex"]="#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n";THREE.ShaderChunk["displacementmap_pars_vertex"]="#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n";THREE.ShaderChunk["emissivemap_fragment"]="#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n\ttotalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n";THREE.ShaderChunk["emissivemap_pars_fragment"]="#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n";THREE.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";THREE.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";THREE.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n\ttotalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n";THREE.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif";THREE.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n";THREE.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = pointLightColor[ i ];\n\n\t\tvec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\t// attenuation\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = spotLightColor[ i ];\n\n\t\tvec3 lightPosition = spotLightPosition[ i ];\n\t\tvec3 lVector = lightPosition - mvPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\t\t\t// attenuation\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tattenuation *= spotEffect;\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = directionalLightColor[ i ];\n\n\t\tvec3 lightDir = directionalLightDirection[ i ];\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tvLightFront += lightColor * saturate( dotProduct );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += lightColor * saturate( - dotProduct );\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tfloat hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n";THREE.ShaderChunk["lights_phong_fragment"]="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = pointLightColor[ i ];\n\n\t\tvec3 lightPosition = pointLightPosition[ i ];\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\t// attenuation\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\t// diffuse\n\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\t\t// specular\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = spotLightColor[ i ];\n\n\t\tvec3 lightPosition = spotLightPosition[ i ];\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\t\t\t// attenuation\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tattenuation *= spotEffect;\n\n\t\t\t// diffuse\n\n\t\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\t\t\t// specular\n\n\t\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = directionalLightColor[ i ];\n\n\t\tvec3 lightDir = directionalLightDirection[ i ];\n\n\t\t// diffuse\n\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\ttotalDiffuseLight += lightColor * cosineTerm;\n\n\t\t// specular\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += lightColor;\n\n\t\t// specular (sky term only)\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * max( dotProduct, 0.0 );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n";THREE.ShaderChunk["linear_to_gamma_fragment"]="\n\toutgoingLight = linearToOutput( outgoingLight );\n";THREE.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif\n";THREE.ShaderChunk["map_pars_fragment"]="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";THREE.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n";THREE.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n";THREE.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";THREE.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["project_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t#endif\n\n\t}\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n";THREE.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";THREE.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";THREE.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n";THREE.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk["uv2_pars_fragment"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["uv2_pars_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["uv2_vertex"]="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif";THREE.ShaderChunk["uv_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvarying vec2 vUv;\n\n#endif";THREE.ShaderChunk["uv_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk["uv_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#endif\n\n#endif\n";THREE.UniformsUtils={merge:function(uniforms){var merged={};for(var u=0;u<uniforms.length;u++){var tmp=this.clone(uniforms[u]);for(var p in tmp){merged[p]=tmp[p]}}return merged},clone:function(uniforms_src){var uniforms_dst={};for(var u in uniforms_src){uniforms_dst[u]={};for(var p in uniforms_src[u]){var parameter_src=uniforms_src[u][p];if(parameter_src instanceof THREE.Color||parameter_src instanceof THREE.Vector2||parameter_src instanceof THREE.Vector3||parameter_src instanceof THREE.Vector4||parameter_src instanceof THREE.Matrix3||parameter_src instanceof THREE.Matrix4||parameter_src instanceof THREE.Texture){uniforms_dst[u][p]=parameter_src.clone()}else if(Array.isArray(parameter_src)){uniforms_dst[u][p]=parameter_src.slice()}else{uniforms_dst[u][p]=parameter_src}}}return uniforms_dst}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["aomap"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["uv_pars_vertex"],THREE.ShaderChunk["uv2_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["uv_vertex"],THREE.ShaderChunk["uv2_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"\t#ifdef USE_ENVMAP",THREE.ShaderChunk["beginnormal_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"\t#endif",THREE.ShaderChunk["begin_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["project_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["uv_pars_fragment"],THREE.ShaderChunk["uv2_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["aomap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = vec3( 1.0 );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["aomap_fragment"],"\toutgoingLight = diffuseColor.rgb * totalAmbientLight;",THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["uv_pars_vertex"],THREE.ShaderChunk["uv2_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["uv_vertex"],THREE.ShaderChunk["uv2_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["beginnormal_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["begin_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["project_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["uv_pars_fragment"],THREE.ShaderChunk["uv2_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["aomap"],THREE.UniformsLib["lightmap"],THREE.UniformsLib["emissivemap"],THREE.UniformsLib["bumpmap"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["displacementmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["uv_pars_vertex"],THREE.ShaderChunk["uv2_pars_vertex"],THREE.ShaderChunk["displacementmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["uv_vertex"],THREE.ShaderChunk["uv2_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["beginnormal_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk["begin_vertex"],THREE.ShaderChunk["displacementmap_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["project_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"\tvViewPosition = - mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["uv_pars_fragment"],THREE.ShaderChunk["uv2_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["aomap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["emissivemap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = ambientLightColor;","\tvec3 totalEmissiveLight = emissive;",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["aomap_fragment"],THREE.ShaderChunk["emissivemap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["points"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphatest_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["color_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["begin_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["project_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["begin_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["project_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["begin_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["project_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}};THREE.WebGLRenderer=function(parameters){console.log("THREE.WebGLRenderer",THREE.REVISION);parameters=parameters||{};var _canvas=parameters.canvas!==undefined?parameters.canvas:document.createElement("canvas"),_context=parameters.context!==undefined?parameters.context:null,_width=_canvas.width,_height=_canvas.height,pixelRatio=1,_alpha=parameters.alpha!==undefined?parameters.alpha:false,_depth=parameters.depth!==undefined?parameters.depth:true,_stencil=parameters.stencil!==undefined?parameters.stencil:true,_antialias=parameters.antialias!==undefined?parameters.antialias:false,_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,_clearColor=new THREE.Color(0),_clearAlpha=0;var lights=[];var opaqueObjects=[];var opaqueObjectsLastIndex=-1;var transparentObjects=[];var transparentObjectsLastIndex=-1;var opaqueImmediateObjects=[];var opaqueImmediateObjectsLastIndex=-1;var transparentImmediateObjects=[];var transparentImmediateObjectsLastIndex=-1;var morphInfluences=new Float32Array(8);var sprites=[];var lensFlares=[];this.domElement=_canvas;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;var _this=this,_currentProgram=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram="",_currentCamera=null,_usedTextureUnits=0,_viewportX=0,_viewportY=0,_viewportWidth=_canvas.width,_viewportHeight=_canvas.height,_currentWidth=0,_currentHeight=0,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_vector3=new THREE.Vector3,_direction=new THREE.Vector3,_lightsNeedUpdate=true,_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},_infoMemory={geometries:0,textures:0},_infoRender={calls:0,vertices:0,faces:0,points:0};this.info={render:_infoRender,memory:_infoMemory,programs:null};var _gl;try{var attributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer};_gl=_context||_canvas.getContext("webgl",attributes)||_canvas.getContext("experimental-webgl",attributes);if(_gl===null){if(_canvas.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}_canvas.addEventListener("webglcontextlost",onContextLost,false)}catch(error){console.error("THREE.WebGLRenderer: "+error)}var extensions=new THREE.WebGLExtensions(_gl);extensions.get("OES_texture_float");extensions.get("OES_texture_float_linear");extensions.get("OES_texture_half_float");extensions.get("OES_texture_half_float_linear");extensions.get("OES_standard_derivatives");extensions.get("ANGLE_instanced_arrays");if(extensions.get("OES_element_index_uint")){THREE.BufferGeometry.MaxIndex=4294967296}var capabilities=new THREE.WebGLCapabilities(_gl,extensions,parameters);var state=new THREE.WebGLState(_gl,extensions,paramThreeToGL);var properties=new THREE.WebGLProperties;var objects=new THREE.WebGLObjects(_gl,properties,this.info);var programCache=new THREE.WebGLPrograms(this,capabilities);this.info.programs=programCache.programs;var bufferRenderer=new THREE.WebGLBufferRenderer(_gl,extensions,_infoRender);var indexedBufferRenderer=new THREE.WebGLIndexedBufferRenderer(_gl,extensions,_infoRender);function glClearColor(r,g,b,a){if(_premultipliedAlpha===true){r*=a;g*=a;b*=a}_gl.clearColor(r,g,b,a)}function setDefaultGLState(){state.init();_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight);glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)}function resetGLState(){_currentProgram=null;_currentCamera=null;_currentGeometryProgram="";_currentMaterialId=-1;_lightsNeedUpdate=true;state.reset()}setDefaultGLState();this.context=_gl;this.capabilities=capabilities;this.extensions=extensions;this.state=state;var shadowMap=new THREE.WebGLShadowMap(this,lights,objects);this.shadowMap=shadowMap;var spritePlugin=new THREE.SpritePlugin(this,sprites);var lensFlarePlugin=new THREE.LensFlarePlugin(this,lensFlares);this.getContext=function(){return _gl};this.getContextAttributes=function(){return _gl.getContextAttributes()};this.forceContextLoss=function(){extensions.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){var value;return function getMaxAnisotropy(){if(value!==undefined)return value;var extension=extensions.get("EXT_texture_filter_anisotropic");if(extension!==null){value=_gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{value=0}return value}}();this.getPrecision=function(){return capabilities.precision};this.getPixelRatio=function(){return pixelRatio};this.setPixelRatio=function(value){if(value!==undefined)pixelRatio=value};this.getSize=function(){return{width:_width,height:_height}};this.setSize=function(width,height,updateStyle){_width=width;_height=height;_canvas.width=width*pixelRatio;_canvas.height=height*pixelRatio;if(updateStyle!==false){_canvas.style.width=width+"px";_canvas.style.height=height+"px"}this.setViewport(0,0,width,height)};this.setViewport=function(x,y,width,height){_viewportX=x*pixelRatio;_viewportY=y*pixelRatio;_viewportWidth=width*pixelRatio;_viewportHeight=height*pixelRatio;_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight)};this.setScissor=function(x,y,width,height){_gl.scissor(x*pixelRatio,y*pixelRatio,width*pixelRatio,height*pixelRatio)};this.enableScissorTest=function(boolean){state.setScissorTest(boolean)};this.getClearColor=function(){return _clearColor};this.setClearColor=function(color,alpha){_clearColor.set(color);_clearAlpha=alpha!==undefined?alpha:1;glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.getClearAlpha=function(){return _clearAlpha};this.setClearAlpha=function(alpha){_clearAlpha=alpha;glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.clear=function(color,depth,stencil){var bits=0;if(color===undefined||color)bits|=_gl.COLOR_BUFFER_BIT;if(depth===undefined||depth)bits|=_gl.DEPTH_BUFFER_BIT;if(stencil===undefined||stencil)bits|=_gl.STENCIL_BUFFER_BIT;_gl.clear(bits)};this.clearColor=function(){_gl.clear(_gl.COLOR_BUFFER_BIT)};this.clearDepth=function(){_gl.clear(_gl.DEPTH_BUFFER_BIT)};this.clearStencil=function(){_gl.clear(_gl.STENCIL_BUFFER_BIT)};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil)};this.resetGLState=resetGLState;this.dispose=function(){_canvas.removeEventListener("webglcontextlost",onContextLost,false)};function onContextLost(event){event.preventDefault();resetGLState();setDefaultGLState();properties.clear()}function onTextureDispose(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose);deallocateTexture(texture);_infoMemory.textures--}function onRenderTargetDispose(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose);deallocateRenderTarget(renderTarget);_infoMemory.textures--}function onMaterialDispose(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose);deallocateMaterial(material)}function deallocateTexture(texture){var textureProperties=properties.get(texture);if(texture.image&&textureProperties.__image__webglTextureCube){_gl.deleteTexture(textureProperties.__image__webglTextureCube)}else{if(textureProperties.__webglInit===undefined)return;_gl.deleteTexture(textureProperties.__webglTexture)}properties.delete(texture)}function deallocateRenderTarget(renderTarget){var renderTargetProperties=properties.get(renderTarget);if(!renderTarget||renderTargetProperties.__webglTexture===undefined)return;_gl.deleteTexture(renderTargetProperties.__webglTexture);if(renderTarget instanceof THREE.WebGLRenderTargetCube){for(var i=0;i<6;i++){_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]);_gl.deleteRenderbuffer(renderTargetProperties.__webglRenderbuffer[i])}}else{_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer);_gl.deleteRenderbuffer(renderTargetProperties.__webglRenderbuffer)}properties.delete(renderTarget)}function deallocateMaterial(material){releaseMaterialProgramReference(material);properties.delete(material)}function releaseMaterialProgramReference(material){var programInfo=properties.get(material).program;material.program=undefined;if(programInfo!==undefined){programCache.releaseProgram(programInfo)}}this.renderBufferImmediate=function(object,program,material){state.initAttributes();var buffers=properties.get(object);if(object.hasPositions&&!buffers.position)buffers.position=_gl.createBuffer();if(object.hasNormals&&!buffers.normal)buffers.normal=_gl.createBuffer();if(object.hasUvs&&!buffers.uv)buffers.uv=_gl.createBuffer();if(object.hasColors&&!buffers.color)buffers.color=_gl.createBuffer();var attributes=program.getAttributes();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.position);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.normal);if(material.type!=="MeshPhongMaterial"&&material.shading===THREE.FlatShading){for(var i=0,l=object.count*3;i<l;i+=9){var array=object.normalArray;var nx=(array[i+0]+array[i+3]+array[i+6])/3;var ny=(array[i+1]+array[i+4]+array[i+7])/3;var nz=(array[i+2]+array[i+5]+array[i+8])/3;array[i+0]=nx;array[i+1]=ny;array[i+2]=nz;array[i+3]=nx;array[i+4]=ny;array[i+5]=nz;array[i+6]=nx;array[i+7]=ny;array[i+8]=nz}}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);state.enableAttribute(attributes.normal);_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,false,0,0)}if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.uv);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);state.enableAttribute(attributes.uv);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,0,0)}if(object.hasColors&&material.vertexColors!==THREE.NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.color);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);state.enableAttribute(attributes.color);_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,false,0,0)}state.disableUnusedAttributes();_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0};this.renderBufferDirect=function(camera,lights,fog,geometry,material,object,group){setMaterial(material);var program=setProgram(camera,lights,fog,material,object);var updateBuffers=false;var geometryProgram=geometry.id+"_"+program.id+"_"+material.wireframe;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=true}var morphTargetInfluences=object.morphTargetInfluences;if(morphTargetInfluences!==undefined){var activeInfluences=[];for(var i=0,l=morphTargetInfluences.length;i<l;i++){var influence=morphTargetInfluences[i];activeInfluences.push([influence,i])}activeInfluences.sort(numericalSort);if(activeInfluences.length>8){activeInfluences.length=8}var morphAttributes=geometry.morphAttributes;for(var i=0,l=activeInfluences.length;i<l;i++){var influence=activeInfluences[i];morphInfluences[i]=influence[0];if(influence[0]!==0){var index=influence[1];if(material.morphTargets===true&&morphAttributes.position)geometry.addAttribute("morphTarget"+i,morphAttributes.position[index]);if(material.morphNormals===true&&morphAttributes.normal)geometry.addAttribute("morphNormal"+i,morphAttributes.normal[index])}else{if(material.morphTargets===true)geometry.removeAttribute("morphTarget"+i);if(material.morphNormals===true)geometry.removeAttribute("morphNormal"+i)}}var uniforms=program.getUniforms();if(uniforms.morphTargetInfluences!==null){_gl.uniform1fv(uniforms.morphTargetInfluences,morphInfluences)}updateBuffers=true}var index=geometry.index;var position=geometry.attributes.position;if(material.wireframe===true){index=objects.getWireframeAttribute(geometry)}var renderer;if(index!==null){renderer=indexedBufferRenderer;renderer.setIndex(index)}else{renderer=bufferRenderer}if(updateBuffers){setupVertexAttributes(material,program,geometry);if(index!==null){_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,objects.getAttributeBuffer(index))}}if(group===undefined){var count;if(index!==null){count=index.count}else if(position instanceof THREE.InterleavedBufferAttribute){count=position.data.array.length/3}else{count=position.count}var drawRange=geometry.drawRange;group={start:drawRange.start,count:Math.min(drawRange.count,count)}}if(object instanceof THREE.Mesh){if(material.wireframe===true){state.setLineWidth(material.wireframeLinewidth*pixelRatio);renderer.setMode(_gl.LINES)}else{renderer.setMode(_gl.TRIANGLES)}if(geometry instanceof THREE.InstancedBufferGeometry&&geometry.maxInstancedCount>0){renderer.renderInstances(geometry)}else{renderer.render(group.start,group.count)}}else if(object instanceof THREE.Line){var lineWidth=material.linewidth;if(lineWidth===undefined)lineWidth=1;state.setLineWidth(lineWidth*pixelRatio);if(object instanceof THREE.LineSegments){renderer.setMode(_gl.LINES)}else{renderer.setMode(_gl.LINE_STRIP)}renderer.render(group.start,group.count)}else if(object instanceof THREE.Points){renderer.setMode(_gl.POINTS);renderer.render(group.start,group.count)}};function setupVertexAttributes(material,program,geometry,startIndex){var extension;if(geometry instanceof THREE.InstancedBufferGeometry){extension=extensions.get("ANGLE_instanced_arrays");if(extension===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}if(startIndex===undefined)startIndex=0;state.initAttributes();var geometryAttributes=geometry.attributes;var programAttributes=program.getAttributes();var materialDefaultAttributeValues=material.defaultAttributeValues;for(var name in programAttributes){var programAttribute=programAttributes[name];if(programAttribute>=0){var geometryAttribute=geometryAttributes[name];if(geometryAttribute!==undefined){state.enableAttribute(programAttribute);var size=geometryAttribute.itemSize;var buffer=objects.getAttributeBuffer(geometryAttribute);if(geometryAttribute instanceof THREE.InterleavedBufferAttribute){var data=geometryAttribute.data;var stride=data.stride;var offset=geometryAttribute.offset;_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer);_gl.vertexAttribPointer(programAttribute,size,_gl.FLOAT,false,stride*data.array.BYTES_PER_ELEMENT,(startIndex*stride+offset)*data.array.BYTES_PER_ELEMENT);if(data instanceof THREE.InstancedInterleavedBuffer){if(extension===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.");return}extension.vertexAttribDivisorANGLE(programAttribute,data.meshPerAttribute);if(geometry.maxInstancedCount===undefined){geometry.maxInstancedCount=data.meshPerAttribute*data.count}}}else{_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer);_gl.vertexAttribPointer(programAttribute,size,_gl.FLOAT,false,0,startIndex*size*4);if(geometryAttribute instanceof THREE.InstancedBufferAttribute){if(extension===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferAttribute but hardware does not support extension ANGLE_instanced_arrays.");return}extension.vertexAttribDivisorANGLE(programAttribute,geometryAttribute.meshPerAttribute);if(geometry.maxInstancedCount===undefined){geometry.maxInstancedCount=geometryAttribute.meshPerAttribute*geometryAttribute.count}}}}else if(materialDefaultAttributeValues!==undefined){var value=materialDefaultAttributeValues[name];if(value!==undefined){switch(value.length){case 2:_gl.vertexAttrib2fv(programAttribute,value);break;case 3:_gl.vertexAttrib3fv(programAttribute,value);break;case 4:_gl.vertexAttrib4fv(programAttribute,value);break;default:_gl.vertexAttrib1fv(programAttribute,value)}}}}}state.disableUnusedAttributes()}function numericalSort(a,b){return b[0]-a[0]}function painterSortStable(a,b){if(a.object.renderOrder!==b.object.renderOrder){return a.object.renderOrder-b.object.renderOrder}else if(a.material.id!==b.material.id){return a.material.id-b.material.id}else if(a.z!==b.z){return a.z-b.z}else{return a.id-b.id}}function reversePainterSortStable(a,b){if(a.object.renderOrder!==b.object.renderOrder){return a.object.renderOrder-b.object.renderOrder}if(a.z!==b.z){return b.z-a.z}else{return a.id-b.id}}this.render=function(scene,camera,renderTarget,forceClear){if(camera instanceof THREE.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var fog=scene.fog;_currentGeometryProgram="";_currentMaterialId=-1;_currentCamera=null;_lightsNeedUpdate=true;if(scene.autoUpdate===true)scene.updateMatrixWorld();if(camera.parent===null)camera.updateMatrixWorld();camera.matrixWorldInverse.getInverse(camera.matrixWorld);_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);lights.length=0;opaqueObjectsLastIndex=-1;transparentObjectsLastIndex=-1;opaqueImmediateObjectsLastIndex=-1;transparentImmediateObjectsLastIndex=-1;sprites.length=0;lensFlares.length=0;projectObject(scene);opaqueObjects.length=opaqueObjectsLastIndex+1;transparentObjects.length=transparentObjectsLastIndex+1;opaqueImmediateObjects.length=opaqueImmediateObjectsLastIndex+1;transparentImmediateObjects.length=transparentImmediateObjectsLastIndex+1;if(_this.sortObjects===true){opaqueObjects.sort(painterSortStable);transparentObjects.sort(reversePainterSortStable)}shadowMap.render(scene,camera);_infoRender.calls=0;_infoRender.vertices=0;_infoRender.faces=0;_infoRender.points=0;this.setRenderTarget(renderTarget);if(this.autoClear||forceClear){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}if(scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;renderObjects(opaqueObjects,camera,lights,fog,overrideMaterial);renderObjects(transparentObjects,camera,lights,fog,overrideMaterial);renderObjectsImmediate(opaqueImmediateObjects,camera,lights,fog,overrideMaterial);renderObjectsImmediate(transparentImmediateObjects,camera,lights,fog,overrideMaterial)}else{state.setBlending(THREE.NoBlending);renderObjects(opaqueObjects,camera,lights,fog);renderObjectsImmediate(opaqueImmediateObjects,camera,lights,fog);renderObjects(transparentObjects,camera,lights,fog);renderObjectsImmediate(transparentImmediateObjects,camera,lights,fog)}spritePlugin.render(scene,camera);lensFlarePlugin.render(scene,camera,_currentWidth,_currentHeight);if(renderTarget&&renderTarget.generateMipmaps&&renderTarget.minFilter!==THREE.NearestFilter&&renderTarget.minFilter!==THREE.LinearFilter){updateRenderTargetMipmap(renderTarget)}state.setDepthTest(true);state.setDepthWrite(true);state.setColorWrite(true)};function pushImmediateRenderItem(object){var array,index;if(object.material.transparent){array=transparentImmediateObjects;index=++transparentImmediateObjectsLastIndex}else{array=opaqueImmediateObjects;index=++opaqueImmediateObjectsLastIndex}if(index<array.length){array[index]=object}else{array.push(object)}}function pushRenderItem(object,geometry,material,z,group){var array,index;if(material.transparent){array=transparentObjects;index=++transparentObjectsLastIndex}else{array=opaqueObjects;index=++opaqueObjectsLastIndex}var renderItem=array[index];if(renderItem!==undefined){renderItem.id=object.id;renderItem.object=object;renderItem.geometry=geometry;renderItem.material=material;renderItem.z=_vector3.z;renderItem.group=group}else{renderItem={id:object.id,object:object,geometry:geometry,material:material,z:_vector3.z,group:group};array.push(renderItem)}}function projectObject(object){if(object.visible===false)return;if(object instanceof THREE.Light){lights.push(object)}else if(object instanceof THREE.Sprite){sprites.push(object)}else if(object instanceof THREE.LensFlare){lensFlares.push(object)}else if(object instanceof THREE.ImmediateRenderObject){pushImmediateRenderItem(object)}else if(object instanceof THREE.Mesh||object instanceof THREE.Line||object instanceof THREE.Points){if(object instanceof THREE.SkinnedMesh){object.skeleton.update()}if(object.frustumCulled===false||_frustum.intersectsObject(object)===true){var material=object.material;if(material.visible===true){if(_this.sortObjects===true){_vector3.setFromMatrixPosition(object.matrixWorld);_vector3.applyProjection(_projScreenMatrix)}var geometry=objects.update(object);if(material instanceof THREE.MeshFaceMaterial){var groups=geometry.groups;var materials=material.materials;for(var i=0,l=groups.length;i<l;i++){var group=groups[i];var groupMaterial=materials[group.materialIndex];if(groupMaterial.visible===true){pushRenderItem(object,geometry,groupMaterial,_vector3.z,group)}}}else{pushRenderItem(object,geometry,material,_vector3.z)}}}}var children=object.children;for(var i=0,l=children.length;i<l;i++){projectObject(children[i])}}function renderObjects(renderList,camera,lights,fog,overrideMaterial){for(var i=0,l=renderList.length;i<l;i++){var renderItem=renderList[i];var object=renderItem.object;var geometry=renderItem.geometry;var material=overrideMaterial===undefined?renderItem.material:overrideMaterial;var group=renderItem.group;object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object.normalMatrix.getNormalMatrix(object.modelViewMatrix);_this.renderBufferDirect(camera,lights,fog,geometry,material,object,group)}}function renderObjectsImmediate(renderList,camera,lights,fog,overrideMaterial){var material=overrideMaterial;for(var i=0,l=renderList.length;i<l;i++){var object=renderList[i];object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object.normalMatrix.getNormalMatrix(object.modelViewMatrix);if(overrideMaterial===undefined)material=object.material;setMaterial(material);var program=setProgram(camera,lights,fog,material,object);_currentGeometryProgram="";object.render(function(object){_this.renderBufferImmediate(object,program,material)})}}function initMaterial(material,lights,fog,object){var materialProperties=properties.get(material);var parameters=programCache.getParameters(material,lights,fog,object);var code=programCache.getProgramCode(material,parameters);var program=materialProperties.program;var programChange=true;if(program===undefined){material.addEventListener("dispose",onMaterialDispose)}else if(program.code!==code){releaseMaterialProgramReference(material)}else if(parameters.shaderID!==undefined){return}else{programChange=false}if(programChange){if(parameters.shaderID){var shader=THREE.ShaderLib[parameters.shaderID];materialProperties.__webglShader={name:material.type,uniforms:THREE.UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else{materialProperties.__webglShader={name:material.type,uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader}}material.__webglShader=materialProperties.__webglShader;program=programCache.acquireProgram(material,parameters,code);materialProperties.program=program;material.program=program}var attributes=program.getAttributes();if(material.morphTargets){material.numSupportedMorphTargets=0;for(var i=0;i<_this.maxMorphTargets;i++){if(attributes["morphTarget"+i]>=0){material.numSupportedMorphTargets++}}}if(material.morphNormals){material.numSupportedMorphNormals=0;for(i=0;i<_this.maxMorphNormals;i++){if(attributes["morphNormal"+i]>=0){material.numSupportedMorphNormals++}}}materialProperties.uniformsList=[];var uniformLocations=materialProperties.program.getUniforms();for(var u in materialProperties.__webglShader.uniforms){var location=uniformLocations[u];if(location){materialProperties.uniformsList.push([materialProperties.__webglShader.uniforms[u],location])}}}function setMaterial(material){setMaterialFaces(material);if(material.transparent===true){state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha)}else{state.setBlending(THREE.NoBlending)}state.setDepthFunc(material.depthFunc);state.setDepthTest(material.depthTest);state.setDepthWrite(material.depthWrite);state.setColorWrite(material.colorWrite);state.setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)}function setMaterialFaces(material){material.side!==THREE.DoubleSide?state.enable(_gl.CULL_FACE):state.disable(_gl.CULL_FACE);state.setFlipSided(material.side===THREE.BackSide)}function setProgram(camera,lights,fog,material,object){_usedTextureUnits=0;var materialProperties=properties.get(material);if(material.needsUpdate||!materialProperties.program){initMaterial(material,lights,fog,object);material.needsUpdate=false}var refreshProgram=false;var refreshMaterial=false;var refreshLights=false;var program=materialProperties.program,p_uniforms=program.getUniforms(),m_uniforms=materialProperties.__webglShader.uniforms;if(program.id!==_currentProgram){_gl.useProgram(program.program);_currentProgram=program.id;refreshProgram=true;refreshMaterial=true;refreshLights=true}if(material.id!==_currentMaterialId){if(_currentMaterialId===-1)refreshLights=true;_currentMaterialId=material.id;refreshMaterial=true}if(refreshProgram||camera!==_currentCamera){_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,false,camera.projectionMatrix.elements);if(capabilities.logarithmicDepthBuffer){_gl.uniform1f(p_uniforms.logDepthBufFC,2/(Math.log(camera.far+1)/Math.LN2))}if(camera!==_currentCamera)_currentCamera=camera;if(material instanceof THREE.ShaderMaterial||material instanceof THREE.MeshPhongMaterial||material.envMap){if(p_uniforms.cameraPosition!==undefined){_vector3.setFromMatrixPosition(camera.matrixWorld);_gl.uniform3f(p_uniforms.cameraPosition,_vector3.x,_vector3.y,_vector3.z)}}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshBasicMaterial||material instanceof THREE.ShaderMaterial||material.skinning){if(p_uniforms.viewMatrix!==undefined){_gl.uniformMatrix4fv(p_uniforms.viewMatrix,false,camera.matrixWorldInverse.elements)}}}if(material.skinning){if(object.bindMatrix&&p_uniforms.bindMatrix!==undefined){_gl.uniformMatrix4fv(p_uniforms.bindMatrix,false,object.bindMatrix.elements)}if(object.bindMatrixInverse&&p_uniforms.bindMatrixInverse!==undefined){_gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse,false,object.bindMatrixInverse.elements)}if(capabilities.floatVertexTextures&&object.skeleton&&object.skeleton.useVertexTexture){if(p_uniforms.boneTexture!==undefined){var textureUnit=getTextureUnit();_gl.uniform1i(p_uniforms.boneTexture,textureUnit);_this.setTexture(object.skeleton.boneTexture,textureUnit)}if(p_uniforms.boneTextureWidth!==undefined){_gl.uniform1i(p_uniforms.boneTextureWidth,object.skeleton.boneTextureWidth)}if(p_uniforms.boneTextureHeight!==undefined){_gl.uniform1i(p_uniforms.boneTextureHeight,object.skeleton.boneTextureHeight)}}else if(object.skeleton&&object.skeleton.boneMatrices){if(p_uniforms.boneGlobalMatrices!==undefined){_gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices,false,object.skeleton.boneMatrices)}}}if(refreshMaterial){if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog)}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material.lights){if(_lightsNeedUpdate){refreshLights=true;setupLights(lights,camera);_lightsNeedUpdate=false}if(refreshLights){refreshUniformsLights(m_uniforms,_lights);markUniformsLightsNeedsUpdate(m_uniforms,true)}else{markUniformsLightsNeedsUpdate(m_uniforms,false)}}if(material instanceof THREE.MeshBasicMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){refreshUniformsCommon(m_uniforms,material)}if(material instanceof THREE.LineBasicMaterial){refreshUniformsLine(m_uniforms,material)}else if(material instanceof THREE.LineDashedMaterial){refreshUniformsLine(m_uniforms,material);refreshUniformsDash(m_uniforms,material)}else if(material instanceof THREE.PointsMaterial){refreshUniformsParticle(m_uniforms,material)}else if(material instanceof THREE.MeshPhongMaterial){refreshUniformsPhong(m_uniforms,material)}else if(material instanceof THREE.MeshDepthMaterial){m_uniforms.mNear.value=camera.near;m_uniforms.mFar.value=camera.far;m_uniforms.opacity.value=material.opacity}else if(material instanceof THREE.MeshNormalMaterial){m_uniforms.opacity.value=material.opacity}if(object.receiveShadow&&!material._shadowPass){refreshUniformsShadow(m_uniforms,lights)}loadUniformsGeneric(materialProperties.uniformsList)}loadUniformsMatrices(p_uniforms,object);if(p_uniforms.modelMatrix!==undefined){_gl.uniformMatrix4fv(p_uniforms.modelMatrix,false,object.matrixWorld.elements)}return program}function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;uniforms.diffuse.value=material.color;if(material.emissive){uniforms.emissive.value=material.emissive}uniforms.map.value=material.map;uniforms.specularMap.value=material.specularMap;uniforms.alphaMap.value=material.alphaMap;if(material.aoMap){uniforms.aoMap.value=material.aoMap;uniforms.aoMapIntensity.value=material.aoMapIntensity}var uvScaleMap;if(material.map){uvScaleMap=material.map}else if(material.specularMap){uvScaleMap=material.specularMap}else if(material.displacementMap){uvScaleMap=material.displacementMap}else if(material.normalMap){uvScaleMap=material.normalMap}else if(material.bumpMap){uvScaleMap=material.bumpMap}else if(material.alphaMap){uvScaleMap=material.alphaMap}else if(material.emissiveMap){uvScaleMap=material.emissiveMap}if(uvScaleMap!==undefined){var offset=uvScaleMap.offset;var repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}uniforms.envMap.value=material.envMap;uniforms.flipEnvMap.value=material.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;uniforms.reflectivity.value=material.reflectivity;uniforms.refractionRatio.value=material.refractionRatio}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity}function refreshUniformsDash(uniforms,material){uniforms.dashSize.value=material.dashSize;uniforms.totalSize.value=material.dashSize+material.gapSize;uniforms.scale.value=material.scale}function refreshUniformsParticle(uniforms,material){uniforms.psColor.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size;uniforms.scale.value=_canvas.height/2;uniforms.map.value=material.map;if(material.map!==null){var offset=material.map.offset;var repeat=material.map.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}}function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog instanceof THREE.Fog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far}else if(fog instanceof THREE.FogExp2){uniforms.fogDensity.value=fog.density}}function refreshUniformsPhong(uniforms,material){uniforms.specular.value=material.specular;uniforms.shininess.value=material.shininess;if(material.lightMap){uniforms.lightMap.value=material.lightMap;uniforms.lightMapIntensity.value=material.lightMapIntensity}if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap}if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias}}function refreshUniformsLights(uniforms,lights){uniforms.ambientLightColor.value=lights.ambient;uniforms.directionalLightColor.value=lights.directional.colors;uniforms.directionalLightDirection.value=lights.directional.positions;uniforms.pointLightColor.value=lights.point.colors;uniforms.pointLightPosition.value=lights.point.positions;uniforms.pointLightDistance.value=lights.point.distances;uniforms.pointLightDecay.value=lights.point.decays;uniforms.spotLightColor.value=lights.spot.colors;uniforms.spotLightPosition.value=lights.spot.positions;uniforms.spotLightDistance.value=lights.spot.distances;uniforms.spotLightDirection.value=lights.spot.directions;uniforms.spotLightAngleCos.value=lights.spot.anglesCos;uniforms.spotLightExponent.value=lights.spot.exponents;uniforms.spotLightDecay.value=lights.spot.decays;uniforms.hemisphereLightSkyColor.value=lights.hemi.skyColors;uniforms.hemisphereLightGroundColor.value=lights.hemi.groundColors;uniforms.hemisphereLightDirection.value=lights.hemi.positions}function markUniformsLightsNeedsUpdate(uniforms,value){uniforms.ambientLightColor.needsUpdate=value;uniforms.directionalLightColor.needsUpdate=value;uniforms.directionalLightDirection.needsUpdate=value;uniforms.pointLightColor.needsUpdate=value;uniforms.pointLightPosition.needsUpdate=value;uniforms.pointLightDistance.needsUpdate=value;uniforms.pointLightDecay.needsUpdate=value;uniforms.spotLightColor.needsUpdate=value;uniforms.spotLightPosition.needsUpdate=value;uniforms.spotLightDistance.needsUpdate=value;uniforms.spotLightDirection.needsUpdate=value;uniforms.spotLightAngleCos.needsUpdate=value;uniforms.spotLightExponent.needsUpdate=value;uniforms.spotLightDecay.needsUpdate=value;uniforms.hemisphereLightSkyColor.needsUpdate=value;uniforms.hemisphereLightGroundColor.needsUpdate=value;uniforms.hemisphereLightDirection.needsUpdate=value}function refreshUniformsShadow(uniforms,lights){if(uniforms.shadowMatrix){var j=0;for(var i=0,il=lights.length;i<il;i++){var light=lights[i];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight||light instanceof THREE.DirectionalLight){uniforms.shadowMap.value[j]=light.shadowMap;uniforms.shadowMapSize.value[j]=light.shadowMapSize;uniforms.shadowMatrix.value[j]=light.shadowMatrix;uniforms.shadowDarkness.value[j]=light.shadowDarkness;uniforms.shadowBias.value[j]=light.shadowBias;j++}}}}function loadUniformsMatrices(uniforms,object){_gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,object.modelViewMatrix.elements);if(uniforms.normalMatrix){_gl.uniformMatrix3fv(uniforms.normalMatrix,false,object.normalMatrix.elements)}}function getTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=capabilities.maxTextures){console.warn("WebGLRenderer: trying to use "+textureUnit+" texture units while this GPU supports only "+capabilities.maxTextures)}_usedTextureUnits+=1;return textureUnit}function loadUniformsGeneric(uniforms){var texture,textureUnit;for(var j=0,jl=uniforms.length;j<jl;j++){var uniform=uniforms[j][0];if(uniform.needsUpdate===false)continue;var type=uniform.type;var value=uniform.value;var location=uniforms[j][1];switch(type){case"1i":_gl.uniform1i(location,value);break;case"1f":_gl.uniform1f(location,value);break;case"2f":_gl.uniform2f(location,value[0],value[1]);break;case"3f":_gl.uniform3f(location,value[0],value[1],value[2]);break;case"4f":_gl.uniform4f(location,value[0],value[1],value[2],value[3]);break;case"1iv":_gl.uniform1iv(location,value);break;case"3iv":_gl.uniform3iv(location,value);break;case"1fv":_gl.uniform1fv(location,value);break;case"2fv":_gl.uniform2fv(location,value);break;case"3fv":_gl.uniform3fv(location,value);break;case"4fv":_gl.uniform4fv(location,value);break;case"Matrix3fv":_gl.uniformMatrix3fv(location,false,value);break;case"Matrix4fv":_gl.uniformMatrix4fv(location,false,value);break;case"i":_gl.uniform1i(location,value);break;case"f":_gl.uniform1f(location,value);break;case"v2":_gl.uniform2f(location,value.x,value.y);break;case"v3":_gl.uniform3f(location,value.x,value.y,value.z);break;case"v4":_gl.uniform4f(location,value.x,value.y,value.z,value.w);break;case"c":_gl.uniform3f(location,value.r,value.g,value.b);break;case"iv1":_gl.uniform1iv(location,value);break;case"iv":_gl.uniform3iv(location,value);break;case"fv1":_gl.uniform1fv(location,value);break;case"fv":_gl.uniform3fv(location,value);break;case"v2v":if(uniform._array===undefined){uniform._array=new Float32Array(2*value.length)}for(var i=0,i2=0,il=value.length;i<il;i++,i2+=2){uniform._array[i2+0]=value[i].x;uniform._array[i2+1]=value[i].y}_gl.uniform2fv(location,uniform._array);break;case"v3v":if(uniform._array===undefined){uniform._array=new Float32Array(3*value.length)}for(var i=0,i3=0,il=value.length;i<il;i++,i3+=3){uniform._array[i3+0]=value[i].x;uniform._array[i3+1]=value[i].y;uniform._array[i3+2]=value[i].z}_gl.uniform3fv(location,uniform._array);break;case"v4v":if(uniform._array===undefined){uniform._array=new Float32Array(4*value.length)}for(var i=0,i4=0,il=value.length;i<il;i++,i4+=4){uniform._array[i4+0]=value[i].x;uniform._array[i4+1]=value[i].y;uniform._array[i4+2]=value[i].z;uniform._array[i4+3]=value[i].w}_gl.uniform4fv(location,uniform._array);break;case"m3":_gl.uniformMatrix3fv(location,false,value.elements);break;case"m3v":if(uniform._array===undefined){uniform._array=new Float32Array(9*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*9)}_gl.uniformMatrix3fv(location,false,uniform._array);break;case"m4":_gl.uniformMatrix4fv(location,false,value.elements);break;case"m4v":if(uniform._array===undefined){uniform._array=new Float32Array(16*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*16)}_gl.uniformMatrix4fv(location,false,uniform._array);break;case"t":texture=value;textureUnit=getTextureUnit();_gl.uniform1i(location,textureUnit);if(!texture)continue;if(texture instanceof THREE.CubeTexture||Array.isArray(texture.image)&&texture.image.length===6){setCubeTexture(texture,textureUnit)}else if(texture instanceof THREE.WebGLRenderTargetCube){setCubeTextureDynamic(texture,textureUnit)}else{_this.setTexture(texture,textureUnit)}break;case"tv":if(uniform._array===undefined){uniform._array=[]}for(var i=0,il=uniform.value.length;i<il;i++){uniform._array[i]=getTextureUnit()}_gl.uniform1iv(location,uniform._array);for(var i=0,il=uniform.value.length;i<il;i++){texture=uniform.value[i];textureUnit=uniform._array[i];if(!texture)continue;_this.setTexture(texture,textureUnit)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+type)}}}function setColorLinear(array,offset,color,intensity){array[offset+0]=color.r*intensity;array[offset+1]=color.g*intensity;array[offset+2]=color.b*intensity}function setupLights(lights,camera){var l,ll,light,r=0,g=0,b=0,color,skyColor,groundColor,intensity,distance,zlights=_lights,viewMatrix=camera.matrixWorldInverse,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,pointColors=zlights.point.colors,pointPositions=zlights.point.positions,pointDistances=zlights.point.distances,pointDecays=zlights.point.decays,spotColors=zlights.spot.colors,spotPositions=zlights.spot.positions,spotDistances=zlights.spot.distances,spotDirections=zlights.spot.directions,spotAnglesCos=zlights.spot.anglesCos,spotExponents=zlights.spot.exponents,spotDecays=zlights.spot.decays,hemiSkyColors=zlights.hemi.skyColors,hemiGroundColors=zlights.hemi.groundColors,hemiPositions=zlights.hemi.positions,dirLength=0,pointLength=0,spotLength=0,hemiLength=0,dirCount=0,pointCount=0,spotCount=0,hemiCount=0,dirOffset=0,pointOffset=0,spotOffset=0,hemiOffset=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(light.onlyShadow)continue;color=light.color;intensity=light.intensity;distance=light.distance;if(light instanceof THREE.AmbientLight){if(!light.visible)continue;r+=color.r;g+=color.g;b+=color.b}else if(light instanceof THREE.DirectionalLight){dirCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.transformDirection(viewMatrix);dirOffset=dirLength*3;dirPositions[dirOffset+0]=_direction.x;dirPositions[dirOffset+1]=_direction.y;dirPositions[dirOffset+2]=_direction.z;setColorLinear(dirColors,dirOffset,color,intensity);dirLength+=1}else if(light instanceof THREE.PointLight){pointCount+=1;if(!light.visible)continue;pointOffset=pointLength*3;setColorLinear(pointColors,pointOffset,color,intensity);_vector3.setFromMatrixPosition(light.matrixWorld);_vector3.applyMatrix4(viewMatrix);pointPositions[pointOffset+0]=_vector3.x;pointPositions[pointOffset+1]=_vector3.y;pointPositions[pointOffset+2]=_vector3.z;pointDistances[pointLength]=distance;pointDecays[pointLength]=light.distance===0?0:light.decay;pointLength+=1}else if(light instanceof THREE.SpotLight){spotCount+=1;if(!light.visible)continue;spotOffset=spotLength*3;setColorLinear(spotColors,spotOffset,color,intensity);_direction.setFromMatrixPosition(light.matrixWorld);_vector3.copy(_direction).applyMatrix4(viewMatrix);spotPositions[spotOffset+0]=_vector3.x;spotPositions[spotOffset+1]=_vector3.y;spotPositions[spotOffset+2]=_vector3.z;spotDistances[spotLength]=distance;_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.transformDirection(viewMatrix);spotDirections[spotOffset+0]=_direction.x;spotDirections[spotOffset+1]=_direction.y;spotDirections[spotOffset+2]=_direction.z;spotAnglesCos[spotLength]=Math.cos(light.angle);spotExponents[spotLength]=light.exponent;spotDecays[spotLength]=light.distance===0?0:light.decay;spotLength+=1}else if(light instanceof THREE.HemisphereLight){hemiCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_direction.transformDirection(viewMatrix);hemiOffset=hemiLength*3;hemiPositions[hemiOffset+0]=_direction.x;hemiPositions[hemiOffset+1]=_direction.y;hemiPositions[hemiOffset+2]=_direction.z;skyColor=light.color;groundColor=light.groundColor;setColorLinear(hemiSkyColors,hemiOffset,skyColor,intensity);setColorLinear(hemiGroundColors,hemiOffset,groundColor,intensity);hemiLength+=1}}for(l=dirLength*3,ll=Math.max(dirColors.length,dirCount*3);l<ll;l++)dirColors[l]=0;for(l=pointLength*3,ll=Math.max(pointColors.length,pointCount*3);l<ll;l++)pointColors[l]=0;for(l=spotLength*3,ll=Math.max(spotColors.length,spotCount*3);l<ll;l++)spotColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiSkyColors.length,hemiCount*3);l<ll;l++)hemiSkyColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiGroundColors.length,hemiCount*3);l<ll;l++)hemiGroundColors[l]=0;zlights.directional.length=dirLength;zlights.point.length=pointLength;zlights.spot.length=spotLength;zlights.hemi.length=hemiLength;zlights.ambient[0]=r;zlights.ambient[1]=g;zlights.ambient[2]=b}this.setFaceCulling=function(cullFace,frontFaceDirection){if(cullFace===THREE.CullFaceNone){state.disable(_gl.CULL_FACE)}else{if(frontFaceDirection===THREE.FrontFaceDirectionCW){_gl.frontFace(_gl.CW)}else{_gl.frontFace(_gl.CCW)}if(cullFace===THREE.CullFaceBack){_gl.cullFace(_gl.BACK)}else if(cullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.FRONT_AND_BACK)}state.enable(_gl.CULL_FACE)}};function setTextureParameters(textureType,texture,isImagePowerOfTwo){var extension;if(isImagePowerOfTwo){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramThreeToGL(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramThreeToGL(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramThreeToGL(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramThreeToGL(texture.minFilter))}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);if(texture.wrapS!==THREE.ClampToEdgeWrapping||texture.wrapT!==THREE.ClampToEdgeWrapping){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+texture.sourceFile+" )")}_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter));if(texture.minFilter!==THREE.NearestFilter&&texture.minFilter!==THREE.LinearFilter){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+texture.sourceFile+" )")}}extension=extensions.get("EXT_texture_filter_anisotropic");if(extension){if(texture.type===THREE.FloatType&&extensions.get("OES_texture_float_linear")===null)return;if(texture.type===THREE.HalfFloatType&&extensions.get("OES_texture_half_float_linear")===null)return;if(texture.anisotropy>1||properties.get(texture).__currentAnisotropy){_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,_this.getMaxAnisotropy()));properties.get(texture).__currentAnisotropy=texture.anisotropy}}}function uploadTexture(textureProperties,texture,slot){if(textureProperties.__webglInit===undefined){textureProperties.__webglInit=true;texture.__webglInit=true;texture.addEventListener("dispose",onTextureDispose);textureProperties.__webglTexture=_gl.createTexture();_infoMemory.textures++}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);texture.image=clampToMaxSize(texture.image,capabilities.maxTextureSize);var image=texture.image,isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isImagePowerOfTwo);var mipmap,mipmaps=texture.mipmaps;if(texture instanceof THREE.DataTexture){if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}texture.generateMipmaps=false}else{state.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data)}}else if(texture instanceof THREE.CompressedTexture){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(state.getCompressedTextureFormats().indexOf(glFormat)>-1){state.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}else{if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];state.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap)}texture.generateMipmaps=false}else{state.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image)}}if(texture.generateMipmaps&&isImagePowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D);textureProperties.__version=texture.version;if(texture.onUpdate)texture.onUpdate(texture)}this.setTexture=function(texture,slot){var textureProperties=properties.get(texture);if(texture.version>0&&textureProperties.__version!==texture.version){var image=texture.image;if(image===undefined){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",texture);return}if(image.complete===false){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",texture);return}uploadTexture(textureProperties,texture,slot);return}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture)};function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){var scale=maxSize/Math.max(image.width,image.height);var canvas=document.createElement("canvas");canvas.width=Math.floor(image.width*scale);canvas.height=Math.floor(image.height*scale);var context=canvas.getContext("2d");context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);console.warn("THREE.WebGLRenderer: image is too big ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height,image);return canvas}return image}function setCubeTexture(texture,slot){var textureProperties=properties.get(texture);if(texture.image.length===6){if(texture.version>0&&textureProperties.__version!==texture.version){if(!textureProperties.__image__webglTextureCube){texture.addEventListener("dispose",onTextureDispose);textureProperties.__image__webglTextureCube=_gl.createTexture();_infoMemory.textures++}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);var isCompressed=texture instanceof THREE.CompressedTexture;var isDataTexture=texture.image[0]instanceof THREE.DataTexture;var cubeImage=[];for(var i=0;i<6;i++){if(_this.autoScaleCubemaps&&!isCompressed&&!isDataTexture){cubeImage[i]=clampToMaxSize(texture.image[i],capabilities.maxCubemapSize)}else{cubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i]}}var image=cubeImage[0],isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isImagePowerOfTwo);for(var i=0;i<6;i++){if(!isCompressed){if(isDataTexture){state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data)}else{state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i])}}else{var mipmap,mipmaps=cubeImage[i].mipmaps;for(var j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(state.getCompressedTextureFormats().indexOf(glFormat)>-1){state.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}}if(texture.generateMipmaps&&isImagePowerOfTwo){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}textureProperties.__version=texture.version;if(texture.onUpdate)texture.onUpdate(texture)}else{state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube)}}}function setCubeTextureDynamic(texture,slot){state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,properties.get(texture).__webglTexture)}function setupFrameBuffer(framebuffer,renderTarget,textureTarget){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,textureTarget,properties.get(renderTarget).__webglTexture,0)}function setupRenderBuffer(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else{_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height)}}this.setRenderTarget=function(renderTarget){var isCube=renderTarget instanceof THREE.WebGLRenderTargetCube;if(renderTarget&&properties.get(renderTarget).__webglFramebuffer===undefined){var renderTargetProperties=properties.get(renderTarget);if(renderTarget.depthBuffer===undefined)renderTarget.depthBuffer=true;if(renderTarget.stencilBuffer===undefined)renderTarget.stencilBuffer=true;renderTarget.addEventListener("dispose",onRenderTargetDispose);renderTargetProperties.__webglTexture=_gl.createTexture();_infoMemory.textures++;var isTargetPowerOfTwo=THREE.Math.isPowerOfTwo(renderTarget.width)&&THREE.Math.isPowerOfTwo(renderTarget.height),glFormat=paramThreeToGL(renderTarget.format),glType=paramThreeToGL(renderTarget.type);if(isCube){renderTargetProperties.__webglFramebuffer=[];renderTargetProperties.__webglRenderbuffer=[];state.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTargetProperties.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget,isTargetPowerOfTwo);for(var i=0;i<6;i++){renderTargetProperties.__webglFramebuffer[i]=_gl.createFramebuffer();renderTargetProperties.__webglRenderbuffer[i]=_gl.createRenderbuffer();state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTargetProperties.__webglFramebuffer[i],renderTarget,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);setupRenderBuffer(renderTargetProperties.__webglRenderbuffer[i],renderTarget)}if(renderTarget.generateMipmaps&&isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}else{renderTargetProperties.__webglFramebuffer=_gl.createFramebuffer();if(renderTarget.shareDepthFrom){renderTargetProperties.__webglRenderbuffer=renderTarget.shareDepthFrom.__webglRenderbuffer}else{renderTargetProperties.__webglRenderbuffer=_gl.createRenderbuffer()}state.bindTexture(_gl.TEXTURE_2D,renderTargetProperties.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget,isTargetPowerOfTwo);state.texImage2D(_gl.TEXTURE_2D,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTargetProperties.__webglFramebuffer,renderTarget,_gl.TEXTURE_2D);if(renderTarget.shareDepthFrom){if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderTargetProperties.__webglRenderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderTargetProperties.__webglRenderbuffer)}}else{setupRenderBuffer(renderTargetProperties.__webglRenderbuffer,renderTarget)}if(renderTarget.generateMipmaps&&isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D)}if(isCube){state.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{state.bindTexture(_gl.TEXTURE_2D,null)}_gl.bindRenderbuffer(_gl.RENDERBUFFER,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}var framebuffer,width,height,vx,vy;if(renderTarget){var renderTargetProperties=properties.get(renderTarget);if(isCube){framebuffer=renderTargetProperties.__webglFramebuffer[renderTarget.activeCubeFace]}else{framebuffer=renderTargetProperties.__webglFramebuffer}width=renderTarget.width;height=renderTarget.height;vx=0;vy=0}else{framebuffer=null;width=_viewportWidth;height=_viewportHeight;vx=_viewportX;vy=_viewportY}if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.viewport(vx,vy,width,height);_currentFramebuffer=framebuffer}_currentWidth=width;_currentHeight=height};this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(!(renderTarget instanceof THREE.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(properties.get(renderTarget).__webglFramebuffer){if(renderTarget.format!==THREE.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");return}var restore=false;if(properties.get(renderTarget).__webglFramebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,properties.get(renderTarget).__webglFramebuffer);restore=true}if(_gl.checkFramebufferStatus(_gl.FRAMEBUFFER)===_gl.FRAMEBUFFER_COMPLETE){_gl.readPixels(x,y,width,height,_gl.RGBA,_gl.UNSIGNED_BYTE,buffer)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}if(restore){_gl.bindFramebuffer(_gl.FRAMEBUFFER,_currentFramebuffer)}}};function updateRenderTargetMipmap(renderTarget){if(renderTarget instanceof THREE.WebGLRenderTargetCube){state.bindTexture(_gl.TEXTURE_CUBE_MAP,properties.get(renderTarget).__webglTexture);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);state.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{state.bindTexture(_gl.TEXTURE_2D,properties.get(renderTarget).__webglTexture);_gl.generateMipmap(_gl.TEXTURE_2D);state.bindTexture(_gl.TEXTURE_2D,null)}}function filterFallback(f){if(f===THREE.NearestFilter||f===THREE.NearestMipMapNearestFilter||f===THREE.NearestMipMapLinearFilter){return _gl.NEAREST}return _gl.LINEAR}function paramThreeToGL(p){var extension;if(p===THREE.RepeatWrapping)return _gl.REPEAT;if(p===THREE.ClampToEdgeWrapping)return _gl.CLAMP_TO_EDGE;if(p===THREE.MirroredRepeatWrapping)return _gl.MIRRORED_REPEAT;if(p===THREE.NearestFilter)return _gl.NEAREST;if(p===THREE.NearestMipMapNearestFilter)return _gl.NEAREST_MIPMAP_NEAREST;if(p===THREE.NearestMipMapLinearFilter)return _gl.NEAREST_MIPMAP_LINEAR;if(p===THREE.LinearFilter)return _gl.LINEAR;if(p===THREE.LinearMipMapNearestFilter)return _gl.LINEAR_MIPMAP_NEAREST;if(p===THREE.LinearMipMapLinearFilter)return _gl.LINEAR_MIPMAP_LINEAR;if(p===THREE.UnsignedByteType)return _gl.UNSIGNED_BYTE;if(p===THREE.UnsignedShort4444Type)return _gl.UNSIGNED_SHORT_4_4_4_4;if(p===THREE.UnsignedShort5551Type)return _gl.UNSIGNED_SHORT_5_5_5_1;if(p===THREE.UnsignedShort565Type)return _gl.UNSIGNED_SHORT_5_6_5;if(p===THREE.ByteType)return _gl.BYTE;if(p===THREE.ShortType)return _gl.SHORT;if(p===THREE.UnsignedShortType)return _gl.UNSIGNED_SHORT;if(p===THREE.IntType)return _gl.INT;if(p===THREE.UnsignedIntType)return _gl.UNSIGNED_INT;if(p===THREE.FloatType)return _gl.FLOAT;extension=extensions.get("OES_texture_half_float");if(extension!==null){if(p===THREE.HalfFloatType)return extension.HALF_FLOAT_OES}if(p===THREE.AlphaFormat)return _gl.ALPHA;if(p===THREE.RGBFormat)return _gl.RGB;if(p===THREE.RGBAFormat)return _gl.RGBA;if(p===THREE.LuminanceFormat)return _gl.LUMINANCE;if(p===THREE.LuminanceAlphaFormat)return _gl.LUMINANCE_ALPHA;if(p===THREE.AddEquation)return _gl.FUNC_ADD;if(p===THREE.SubtractEquation)return _gl.FUNC_SUBTRACT;if(p===THREE.ReverseSubtractEquation)return _gl.FUNC_REVERSE_SUBTRACT;if(p===THREE.ZeroFactor)return _gl.ZERO;if(p===THREE.OneFactor)return _gl.ONE;if(p===THREE.SrcColorFactor)return _gl.SRC_COLOR;if(p===THREE.OneMinusSrcColorFactor)return _gl.ONE_MINUS_SRC_COLOR;if(p===THREE.SrcAlphaFactor)return _gl.SRC_ALPHA;if(p===THREE.OneMinusSrcAlphaFactor)return _gl.ONE_MINUS_SRC_ALPHA;if(p===THREE.DstAlphaFactor)return _gl.DST_ALPHA;if(p===THREE.OneMinusDstAlphaFactor)return _gl.ONE_MINUS_DST_ALPHA;if(p===THREE.DstColorFactor)return _gl.DST_COLOR;if(p===THREE.OneMinusDstColorFactor)return _gl.ONE_MINUS_DST_COLOR;if(p===THREE.SrcAlphaSaturateFactor)return _gl.SRC_ALPHA_SATURATE;extension=extensions.get("WEBGL_compressed_texture_s3tc");if(extension!==null){if(p===THREE.RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===THREE.RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}extension=extensions.get("WEBGL_compressed_texture_pvrtc");if(extension!==null){if(p===THREE.RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===THREE.RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===THREE.RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===THREE.RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}extension=extensions.get("EXT_blend_minmax");if(extension!==null){if(p===THREE.MinEquation)return extension.MIN_EXT;if(p===THREE.MaxEquation)return extension.MAX_EXT}return 0}this.supportsFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return extensions.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return extensions.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return extensions.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return extensions.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return extensions.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return extensions.get("EXT_blend_minmax")};this.supportsVertexTextures=function(){return capabilities.vertexTextures};this.supportsInstancedArrays=function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return extensions.get("ANGLE_instanced_arrays")};this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Object.defineProperties(this,{shadowMapEnabled:{get:function(){return shadowMap.enabled},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");shadowMap.enabled=value}},shadowMapType:{get:function(){return shadowMap.type},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");shadowMap.type=value}},shadowMapCullFace:{get:function(){return shadowMap.cullFace},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");shadowMap.cullFace=value}},shadowMapDebug:{get:function(){return shadowMap.debug},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug.");shadowMap.debug=value}}})};THREE.WebGLRenderTarget=function(width,height,options){this.uuid=THREE.Math.generateUUID();this.width=width;this.height=height;options=options||{};this.wrapS=options.wrapS!==undefined?options.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=options.wrapT!==undefined?options.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=options.magFilter!==undefined?options.magFilter:THREE.LinearFilter;this.minFilter=options.minFilter!==undefined?options.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=options.anisotropy!==undefined?options.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=options.format!==undefined?options.format:THREE.RGBAFormat;this.type=options.type!==undefined?options.type:THREE.UnsignedByteType;this.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;this.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=options.shareDepthFrom!==undefined?options.shareDepthFrom:null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(width,height){if(this.width!==width||this.height!==height){this.width=width;this.height=height;this.dispose()}},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.width=source.width;this.height=source.height;this.wrapS=source.wrapS;this.wrapT=source.wrapT;this.magFilter=source.magFilter;this.minFilter=source.minFilter;this.anisotropy=source.anisotropy;this.offset.copy(source.offset);this.repeat.copy(source.repeat);this.format=source.format;this.type=source.type;this.depthBuffer=source.depthBuffer;this.stencilBuffer=source.stencilBuffer;this.generateMipmaps=source.generateMipmaps;this.shareDepthFrom=source.shareDepthFrom;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(width,height,options){THREE.WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.WebGLBufferRenderer=function(_gl,extensions,_infoRender){var mode;function setMode(value){mode=value}function render(start,count){_gl.drawArrays(mode,start,count);_infoRender.calls++;_infoRender.vertices+=count;if(mode===_gl.TRIANGLES)_infoRender.faces+=count/3}function renderInstances(geometry){var extension=extensions.get("ANGLE_instanced_arrays");if(extension===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var position=geometry.attributes.position;if(position instanceof THREE.InterleavedBufferAttribute){extension.drawArraysInstancedANGLE(mode,0,position.data.count,geometry.maxInstancedCount)}else{extension.drawArraysInstancedANGLE(mode,0,position.count,geometry.maxInstancedCount)}}this.setMode=setMode;this.render=render;this.renderInstances=renderInstances};THREE.WebGLIndexedBufferRenderer=function(_gl,extensions,_infoRender){var mode;function setMode(value){mode=value}var type,size;function setIndex(index){if(index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}}function render(start,count){_gl.drawElements(mode,count,type,start*size);_infoRender.calls++;_infoRender.vertices+=count;if(mode===_gl.TRIANGLES)_infoRender.faces+=count/3}function renderInstances(geometry){var extension=extensions.get("ANGLE_instanced_arrays");if(extension===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var index=geometry.index;extension.drawElementsInstancedANGLE(mode,index.array.length,type,0,geometry.maxInstancedCount)}this.setMode=setMode;this.setIndex=setIndex;this.render=render;this.renderInstances=renderInstances};THREE.WebGLExtensions=function(gl){var extensions={};this.get=function(name){if(extensions[name]!==undefined){return extensions[name]}var extension;switch(name){case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:extension=gl.getExtension(name)}if(extension===null){console.warn("THREE.WebGLRenderer: "+name+" extension not supported.")}extensions[name]=extension;return extension}};THREE.WebGLCapabilities=function(gl,extensions,parameters){function getMaxPrecision(precision){if(precision==="highp"){if(gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT).precision>0&&gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT).precision>0){return"highp"}precision="mediump"}if(precision==="mediump"){if(gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.MEDIUM_FLOAT).precision>0&&gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.MEDIUM_FLOAT).precision>0){return"mediump"}}return"lowp"}this.getMaxPrecision=getMaxPrecision;this.precision=parameters.precision!==undefined?parameters.precision:"highp",this.logarithmicDepthBuffer=parameters.logarithmicDepthBuffer!==undefined?parameters.logarithmicDepthBuffer:false;this.maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.maxVertexTextures=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);this.maxCubemapSize=gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);this.maxAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.maxVertexUniforms=gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS);this.maxFragmentUniforms=gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.vertexTextures=this.maxVertexTextures>0;this.floatFragmentTextures=!!extensions.get("OES_texture_float");this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var _maxPrecision=getMaxPrecision(this.precision);if(_maxPrecision!==this.precision){console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",_maxPrecision,"instead.");this.precision=_maxPrecision}if(this.logarithmicDepthBuffer){this.logarithmicDepthBuffer=!!extensions.get("EXT_frag_depth")}};THREE.WebGLGeometries=function(gl,properties,info){var geometries={};function get(object){var geometry=object.geometry;if(geometries[geometry.id]!==undefined){return geometries[geometry.id]}geometry.addEventListener("dispose",onGeometryDispose);var buffergeometry;if(geometry instanceof THREE.BufferGeometry){buffergeometry=geometry}else if(geometry instanceof THREE.Geometry){if(geometry._bufferGeometry===undefined){geometry._bufferGeometry=(new THREE.BufferGeometry).setFromObject(object)}buffergeometry=geometry._bufferGeometry}geometries[geometry.id]=buffergeometry;info.memory.geometries++;return buffergeometry}function onGeometryDispose(event){var geometry=event.target;var buffergeometry=geometries[geometry.id];deleteAttributes(buffergeometry.attributes);geometry.removeEventListener("dispose",onGeometryDispose);delete geometries[geometry.id];var property=properties.get(geometry);if(property.wireframe)deleteAttribute(property.wireframe);info.memory.geometries--}function getAttributeBuffer(attribute){if(attribute instanceof THREE.InterleavedBufferAttribute){return properties.get(attribute.data).__webglBuffer}return properties.get(attribute).__webglBuffer}function deleteAttribute(attribute){var buffer=getAttributeBuffer(attribute);if(buffer!==undefined){gl.deleteBuffer(buffer);removeAttributeBuffer(attribute)}}function deleteAttributes(attributes){for(var name in attributes){deleteAttribute(attributes[name])}}function removeAttributeBuffer(attribute){if(attribute instanceof THREE.InterleavedBufferAttribute){properties.delete(attribute.data)}else{properties.delete(attribute)}}this.get=get};THREE.WebGLObjects=function(gl,properties,info){var geometries=new THREE.WebGLGeometries(gl,properties,info);function update(object){var geometry=geometries.get(object);if(object.geometry instanceof THREE.Geometry){geometry.updateFromObject(object)}var index=geometry.index;var attributes=geometry.attributes;if(index!==null){updateAttribute(index,gl.ELEMENT_ARRAY_BUFFER)}for(var name in attributes){updateAttribute(attributes[name],gl.ARRAY_BUFFER)}var morphAttributes=geometry.morphAttributes;for(var name in morphAttributes){var array=morphAttributes[name];for(var i=0,l=array.length;i<l;i++){updateAttribute(array[i],gl.ARRAY_BUFFER)}}return geometry}function updateAttribute(attribute,bufferType){var data=attribute instanceof THREE.InterleavedBufferAttribute?attribute.data:attribute;var attributeProperties=properties.get(data);if(attributeProperties.__webglBuffer===undefined){createBuffer(attributeProperties,data,bufferType)}else if(attributeProperties.version!==data.version){updateBuffer(attributeProperties,data,bufferType)}}function createBuffer(attributeProperties,data,bufferType){attributeProperties.__webglBuffer=gl.createBuffer();gl.bindBuffer(bufferType,attributeProperties.__webglBuffer);var usage=data.dynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW;gl.bufferData(bufferType,data.array,usage);attributeProperties.version=data.version}function updateBuffer(attributeProperties,data,bufferType){gl.bindBuffer(bufferType,attributeProperties.__webglBuffer);if(data.dynamic===false||data.updateRange.count===-1){gl.bufferSubData(bufferType,0,data.array)}else if(data.updateRange.count===0){console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.")}else{gl.bufferSubData(bufferType,data.updateRange.offset*data.array.BYTES_PER_ELEMENT,data.array.subarray(data.updateRange.offset,data.updateRange.offset+data.updateRange.count));data.updateRange.count=0}attributeProperties.version=data.version}function getAttributeBuffer(attribute){if(attribute instanceof THREE.InterleavedBufferAttribute){return properties.get(attribute.data).__webglBuffer}return properties.get(attribute).__webglBuffer}function getWireframeAttribute(geometry){var property=properties.get(geometry);if(property.wireframe!==undefined){return property.wireframe}var indices=[];var index=geometry.index;var attributes=geometry.attributes;var position=attributes.position;if(index!==null){var edges={};var array=index.array;for(var i=0,l=array.length;i<l;i+=3){var a=array[i+0];var b=array[i+1];var c=array[i+2];if(checkEdge(edges,a,b))indices.push(a,b);if(checkEdge(edges,b,c))indices.push(b,c);if(checkEdge(edges,c,a))indices.push(c,a)}}else{var array=attributes.position.array;for(var i=0,l=array.length/3-1;i<l;i+=3){var a=i+0;var b=i+1;var c=i+2;indices.push(a,b,b,c,c,a)}}var TypeArray=position.count>65535?Uint32Array:Uint16Array;var attribute=new THREE.BufferAttribute(new TypeArray(indices),1);updateAttribute(attribute,gl.ELEMENT_ARRAY_BUFFER);property.wireframe=attribute;return attribute}function checkEdge(edges,a,b){if(a>b){var tmp=a;a=b;b=tmp}var list=edges[a];if(list===undefined){edges[a]=[b];return true}else if(list.indexOf(b)===-1){list.push(b);return true}return false}this.getAttributeBuffer=getAttributeBuffer;this.getWireframeAttribute=getWireframeAttribute;this.update=update};THREE.WebGLProgram=function(){var programIdCount=0;function generateDefines(defines){var chunks=[];for(var name in defines){var value=defines[name];if(value===false)continue;chunks.push("#define "+name+" "+value)}return chunks.join("\n")}function fetchUniformLocations(gl,program,identifiers){var uniforms={};var n=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<n;i++){var info=gl.getActiveUniform(program,i);var name=info.name;var location=gl.getUniformLocation(program,name);var suffixPos=name.lastIndexOf("[0]");if(suffixPos!==-1&&suffixPos===name.length-3){uniforms[name.substr(0,suffixPos)]=location}uniforms[name]=location}return uniforms}function fetchAttributeLocations(gl,program,identifiers){var attributes={};var n=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES);for(var i=0;i<n;i++){var info=gl.getActiveAttrib(program,i);var name=info.name;attributes[name]=gl.getAttribLocation(program,name)}return attributes}function filterEmptyLine(string){return string!==""}return function WebGLProgram(renderer,code,material,parameters){var gl=renderer.context;var defines=material.defines;var vertexShader=material.__webglShader.vertexShader;var fragmentShader=material.__webglShader.fragmentShader;var shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";if(parameters.shadowMapType===THREE.PCFShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF"}else if(parameters.shadowMapType===THREE.PCFSoftShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"}var envMapTypeDefine="ENVMAP_TYPE_CUBE";var envMapModeDefine="ENVMAP_MODE_REFLECTION";var envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";if(parameters.envMap){switch(material.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:envMapTypeDefine="ENVMAP_TYPE_SPHERE";break}switch(material.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:envMapModeDefine="ENVMAP_MODE_REFRACTION";break}switch(material.combine){case THREE.MultiplyOperation:envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:envMapBlendingDefine="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:envMapBlendingDefine="ENVMAP_BLENDING_ADD";break}}var gammaFactorDefine=renderer.gammaFactor>0?renderer.gammaFactor:1;var customDefines=generateDefines(defines);var program=gl.createProgram();var prefixVertex,prefixFragment;if(material instanceof THREE.RawShaderMaterial){prefixVertex="";prefixFragment=""}else{prefixVertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+material.__webglShader.name,customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"",renderer.gammaInput?"#define GAMMA_INPUT":"",renderer.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+gammaFactorDefine,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,"#define MAX_BONES "+parameters.maxBones,parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.displacementMap&&parameters.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals&&parameters.flatShading===false?"#define USE_MORPHNORMALS":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&renderer.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n");prefixFragment=[parameters.bumpMap||parameters.normalMap||parameters.flatShading||material.derivatives?"#extension GL_OES_standard_derivatives : enable":"",parameters.logarithmicDepthBuffer&&renderer.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+material.__webglShader.name,customDefines,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"",renderer.gammaInput?"#define GAMMA_INPUT":"",renderer.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+gammaFactorDefine,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapTypeDefine:"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.envMap?"#define "+envMapBlendingDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.metal?"#define METAL":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&renderer.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(filterEmptyLine).join("\n")}var vertexGlsl=prefixVertex+vertexShader;var fragmentGlsl=prefixFragment+fragmentShader;var glVertexShader=THREE.WebGLShader(gl,gl.VERTEX_SHADER,vertexGlsl);var glFragmentShader=THREE.WebGLShader(gl,gl.FRAGMENT_SHADER,fragmentGlsl);gl.attachShader(program,glVertexShader);gl.attachShader(program,glFragmentShader);if(material.index0AttributeName!==undefined){gl.bindAttribLocation(program,0,material.index0AttributeName)}else if(parameters.morphTargets===true){gl.bindAttribLocation(program,0,"position")}gl.linkProgram(program);var programLog=gl.getProgramInfoLog(program);var vertexLog=gl.getShaderInfoLog(glVertexShader);var fragmentLog=gl.getShaderInfoLog(glFragmentShader);var runnable=true;var haveDiagnostics=true;if(gl.getProgramParameter(program,gl.LINK_STATUS)===false){runnable=false;console.error("THREE.WebGLProgram: shader error: ",gl.getError(),"gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS),"gl.getProgramInfoLog",programLog,vertexLog,fragmentLog)}else if(programLog!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",programLog)}else if(vertexLog===""||fragmentLog===""){haveDiagnostics=false}if(haveDiagnostics){this.diagnostics={runnable:runnable,material:material,programLog:programLog,vertexShader:{log:vertexLog,prefix:prefixVertex},fragmentShader:{log:fragmentLog,prefix:prefixFragment}}}gl.deleteShader(glVertexShader);gl.deleteShader(glFragmentShader);var cachedUniforms;this.getUniforms=function(){if(cachedUniforms===undefined){cachedUniforms=fetchUniformLocations(gl,program)}return cachedUniforms};var cachedAttributes;this.getAttributes=function(){if(cachedAttributes===undefined){cachedAttributes=fetchAttributeLocations(gl,program)}return cachedAttributes};this.destroy=function(){gl.deleteProgram(program);this.program=undefined};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=programIdCount++;this.code=code;this.usedTimes=1;this.program=program;this.vertexShader=glVertexShader;this.fragmentShader=glFragmentShader;return this}}();THREE.WebGLPrograms=function(renderer,capabilities){var programs=[];var shaderIDs={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"};var parameterNames=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];function allocateBones(object){if(capabilities.floatVertexTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture){return 1024}else{var nVertexUniforms=capabilities.maxVertexUniforms;var nVertexMatrices=Math.floor((nVertexUniforms-20)/4);var maxBones=nVertexMatrices;if(object!==undefined&&object instanceof THREE.SkinnedMesh){maxBones=Math.min(object.skeleton.bones.length,maxBones);if(maxBones<object.skeleton.bones.length){console.warn("WebGLRenderer: too many bones - "+object.skeleton.bones.length+", this GPU supports just "+maxBones+" (try OpenGL instead of ANGLE)")}}return maxBones}}function allocateLights(lights){var dirLights=0;var pointLights=0;var spotLights=0;var hemiLights=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(light.onlyShadow||light.visible===false)continue;if(light instanceof THREE.DirectionalLight)dirLights++;if(light instanceof THREE.PointLight)pointLights++;if(light instanceof THREE.SpotLight)spotLights++;if(light instanceof THREE.HemisphereLight)hemiLights++}return{directional:dirLights,point:pointLights,spot:spotLights,hemi:hemiLights}}function allocateShadows(lights){var maxShadows=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight)maxShadows++;if(light instanceof THREE.DirectionalLight)maxShadows++}return maxShadows}this.getParameters=function(material,lights,fog,object){var shaderID=shaderIDs[material.type];var maxLightCount=allocateLights(lights);var maxShadows=allocateShadows(lights);var maxBones=allocateBones(object);var precision=renderer.getPrecision();if(material.precision!==null){precision=capabilities.getMaxPrecision(material.precision);if(precision!==material.precision){console.warn("THREE.WebGLRenderer.initMaterial:",material.precision,"not supported, using",precision,"instead.")}}var parameters={shaderID:shaderID,precision:precision,supportsVertexTextures:capabilities.vertexTextures,map:!!material.map,envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,lightMap:!!material.lightMap,aoMap:!!material.aoMap,emissiveMap:!!material.emissiveMap,bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,displacementMap:!!material.displacementMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,combine:material.combine,vertexColors:material.vertexColors,fog:fog,useFog:material.fog,fogExp:fog instanceof THREE.FogExp2,flatShading:material.shading===THREE.FlatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:capabilities.logarithmicDepthBuffer,skinning:material.skinning,maxBones:maxBones,useVertexTexture:capabilities.floatVertexTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:renderer.maxMorphTargets,maxMorphNormals:renderer.maxMorphNormals,maxDirLights:maxLightCount.directional,maxPointLights:maxLightCount.point,maxSpotLights:maxLightCount.spot,maxHemiLights:maxLightCount.hemi,maxShadows:maxShadows,shadowMapEnabled:renderer.shadowMap.enabled&&object.receiveShadow&&maxShadows>0,shadowMapType:renderer.shadowMap.type,shadowMapDebug:renderer.shadowMap.debug,alphaTest:material.alphaTest,metal:material.metal,doubleSided:material.side===THREE.DoubleSide,flipSided:material.side===THREE.BackSide};return parameters};this.getProgramCode=function(material,parameters){var chunks=[];if(parameters.shaderID){chunks.push(parameters.shaderID)}else{chunks.push(material.fragmentShader);chunks.push(material.vertexShader)}if(material.defines!==undefined){for(var name in material.defines){chunks.push(name);chunks.push(material.defines[name])}}for(var i=0;i<parameterNames.length;i++){var parameterName=parameterNames[i];chunks.push(parameterName);chunks.push(parameters[parameterName])}return chunks.join()};this.acquireProgram=function(material,parameters,code){var program;for(var p=0,pl=programs.length;p<pl;p++){var programInfo=programs[p];if(programInfo.code===code){program=programInfo;++program.usedTimes;break}}if(program===undefined){program=new THREE.WebGLProgram(renderer,code,material,parameters);programs.push(program)}return program};this.releaseProgram=function(program){if(--program.usedTimes===0){var i=programs.indexOf(program);programs[i]=programs[programs.length-1];programs.pop();program.destroy()}};this.programs=programs};THREE.WebGLProperties=function(){var properties={};this.get=function(object){var uuid=object.uuid;var map=properties[uuid];if(map===undefined){map={};properties[uuid]=map}return map};this.delete=function(object){delete properties[object.uuid]};this.clear=function(){properties={}}};THREE.WebGLShader=function(){var addLineNumbers=function(string){var lines=string.split("\n");for(var i=0;i<lines.length;i++){lines[i]=i+1+": "+lines[i]}return lines.join("\n")};return function WebGLShader(gl,type,string){var shader=gl.createShader(type);gl.shaderSource(shader,string);gl.compileShader(shader);if(gl.getShaderParameter(shader,gl.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(gl.getShaderInfoLog(shader)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",type===gl.VERTEX_SHADER?"vertex":"fragment",gl.getShaderInfoLog(shader),addLineNumbers(string))}return shader}}();THREE.WebGLShadowMap=function(_renderer,_lights,_objects){var _gl=_renderer.context,_state=_renderer.state,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_min=new THREE.Vector3,_max=new THREE.Vector3,_matrixPosition=new THREE.Vector3,_renderList=[];var depthShader=THREE.ShaderLib["depthRGBA"];var depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);var _depthMaterial=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader});var _depthMaterialMorph=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true});var _depthMaterialSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,skinning:true});var _depthMaterialMorphSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true,skinning:true});_depthMaterial._shadowPass=true;_depthMaterialMorph._shadowPass=true;_depthMaterialSkin._shadowPass=true;_depthMaterialMorphSkin._shadowPass=true;var scope=this;this.enabled=false;this.autoUpdate=true;this.needsUpdate=false;this.type=THREE.PCFShadowMap;this.cullFace=THREE.CullFaceFront;this.render=function(scene,camera){if(scope.enabled===false)return;if(scope.autoUpdate===false&&scope.needsUpdate===false)return;_gl.clearColor(1,1,1,1);_state.disable(_gl.BLEND);_state.enable(_gl.CULL_FACE);_gl.frontFace(_gl.CCW);if(scope.cullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.BACK)}_state.setDepthTest(true);for(var i=0,il=_lights.length;i<il;i++){var light=_lights[i];if(!light.castShadow)continue;if(!light.shadowMap){var shadowFilter=THREE.LinearFilter;if(scope.type===THREE.PCFSoftShadowMap){shadowFilter=THREE.NearestFilter}var pars={minFilter:shadowFilter,magFilter:shadowFilter,format:THREE.RGBAFormat};light.shadowMap=new THREE.WebGLRenderTarget(light.shadowMapWidth,light.shadowMapHeight,pars);light.shadowMapSize=new THREE.Vector2(light.shadowMapWidth,light.shadowMapHeight);light.shadowMatrix=new THREE.Matrix4}if(!light.shadowCamera){if(light instanceof THREE.SpotLight){light.shadowCamera=new THREE.PerspectiveCamera(light.shadowCameraFov,light.shadowMapWidth/light.shadowMapHeight,light.shadowCameraNear,light.shadowCameraFar)}else if(light instanceof THREE.DirectionalLight){light.shadowCamera=new THREE.OrthographicCamera(light.shadowCameraLeft,light.shadowCameraRight,light.shadowCameraTop,light.shadowCameraBottom,light.shadowCameraNear,light.shadowCameraFar)}else{console.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",light);continue}scene.add(light.shadowCamera);if(scene.autoUpdate===true)scene.updateMatrixWorld()}if(light.shadowCameraVisible&&!light.cameraHelper){light.cameraHelper=new THREE.CameraHelper(light.shadowCamera);scene.add(light.cameraHelper)}var shadowMap=light.shadowMap;var shadowMatrix=light.shadowMatrix;var shadowCamera=light.shadowCamera;shadowCamera.position.setFromMatrixPosition(light.matrixWorld);_matrixPosition.setFromMatrixPosition(light.target.matrixWorld);shadowCamera.lookAt(_matrixPosition);shadowCamera.updateMatrixWorld();shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);if(light.cameraHelper)light.cameraHelper.visible=light.shadowCameraVisible;if(light.shadowCameraVisible)light.cameraHelper.update();shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);shadowMatrix.multiply(shadowCamera.projectionMatrix);shadowMatrix.multiply(shadowCamera.matrixWorldInverse);_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_renderer.setRenderTarget(shadowMap);_renderer.clear();_renderList.length=0;projectObject(scene,shadowCamera);for(var j=0,jl=_renderList.length;j<jl;j++){var object=_renderList[j];var geometry=_objects.update(object);var material=object.material;if(material instanceof THREE.MeshFaceMaterial){var groups=geometry.groups;var materials=material.materials;for(var k=0,kl=groups.length;k<kl;k++){var group=groups[k];var groupMaterial=materials[group.materialIndex];if(groupMaterial.visible===true){_renderer.renderBufferDirect(shadowCamera,_lights,null,geometry,getDepthMaterial(object,groupMaterial),object,group)}}}else{_renderer.renderBufferDirect(shadowCamera,_lights,null,geometry,getDepthMaterial(object,material),object)}}}var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_renderer.setClearColor(clearColor,clearAlpha);_state.enable(_gl.BLEND);if(scope.cullFace===THREE.CullFaceFront){_gl.cullFace(_gl.BACK)}_renderer.resetGLState();scope.needsUpdate=false};function getDepthMaterial(object,material){var geometry=object.geometry;var useMorphing=geometry.morphTargets!==undefined&&geometry.morphTargets.length>0&&material.morphTargets;var useSkinning=object instanceof THREE.SkinnedMesh&&material.skinning;var depthMaterial;if(object.customDepthMaterial){depthMaterial=object.customDepthMaterial}else if(useSkinning){depthMaterial=useMorphing?_depthMaterialMorphSkin:_depthMaterialSkin}else if(useMorphing){depthMaterial=_depthMaterialMorph}else{depthMaterial=_depthMaterial}depthMaterial.visible=material.visible;depthMaterial.wireframe=material.wireframe;depthMaterial.wireframeLinewidth=material.wireframeLinewidth;return depthMaterial}function projectObject(object,camera){if(object.visible===false)return;if(object instanceof THREE.Mesh||object instanceof THREE.Line||object instanceof THREE.Points){if(object.castShadow&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){var material=object.material;if(material.visible===true){object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);_renderList.push(object)}}}var children=object.children;for(var i=0,l=children.length;i<l;i++){projectObject(children[i],camera)}}};THREE.WebGLState=function(gl,extensions,paramThreeToGL){var _this=this;var newAttributes=new Uint8Array(16);var enabledAttributes=new Uint8Array(16);var capabilities={};var compressedTextureFormats=null;var currentBlending=null;var currentBlendEquation=null;var currentBlendSrc=null;var currentBlendDst=null;var currentBlendEquationAlpha=null;var currentBlendSrcAlpha=null;var currentBlendDstAlpha=null;var currentDepthFunc=null;var currentDepthWrite=null;var currentColorWrite=null;var currentFlipSided=null;var currentLineWidth=null;var currentPolygonOffsetFactor=null;var currentPolygonOffsetUnits=null;var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);var currentTextureSlot=undefined;var currentBoundTextures={};this.init=function(){gl.clearColor(0,0,0,1);gl.clearDepth(1);gl.clearStencil(0);this.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.frontFace(gl.CCW);gl.cullFace(gl.BACK);this.enable(gl.CULL_FACE);this.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)};this.initAttributes=function(){for(var i=0,l=newAttributes.length;i<l;i++){newAttributes[i]=0}};this.enableAttribute=function(attribute){newAttributes[attribute]=1;if(enabledAttributes[attribute]===0){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1}};this.disableUnusedAttributes=function(){for(var i=0,l=enabledAttributes.length;i<l;i++){if(enabledAttributes[i]!==newAttributes[i]){gl.disableVertexAttribArray(i);enabledAttributes[i]=0}}};this.enable=function(id){if(capabilities[id]!==true){gl.enable(id);capabilities[id]=true}};this.disable=function(id){if(capabilities[id]!==false){gl.disable(id);capabilities[id]=false}};this.getCompressedTextureFormats=function(){if(compressedTextureFormats===null){compressedTextureFormats=[];if(extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")){var formats=gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS);for(var i=0;i<formats.length;i++){compressedTextureFormats.push(formats[i])}}}return compressedTextureFormats};this.setBlending=function(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha){if(blending!==currentBlending){if(blending===THREE.NoBlending){this.disable(gl.BLEND)}else if(blending===THREE.AdditiveBlending){this.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE)}else if(blending===THREE.SubtractiveBlending){this.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR)}else if(blending===THREE.MultiplyBlending){this.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.SRC_COLOR)}else if(blending===THREE.CustomBlending){this.enable(gl.BLEND)}else{this.enable(gl.BLEND);gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}currentBlending=blending}if(blending===THREE.CustomBlending){blendEquationAlpha=blendEquationAlpha||blendEquation;blendSrcAlpha=blendSrcAlpha||blendSrc;blendDstAlpha=blendDstAlpha||blendDst;if(blendEquation!==currentBlendEquation||blendEquationAlpha!==currentBlendEquationAlpha){gl.blendEquationSeparate(paramThreeToGL(blendEquation),paramThreeToGL(blendEquationAlpha));currentBlendEquation=blendEquation;currentBlendEquationAlpha=blendEquationAlpha}if(blendSrc!==currentBlendSrc||blendDst!==currentBlendDst||blendSrcAlpha!==currentBlendSrcAlpha||blendDstAlpha!==currentBlendDstAlpha){gl.blendFuncSeparate(paramThreeToGL(blendSrc),paramThreeToGL(blendDst),paramThreeToGL(blendSrcAlpha),paramThreeToGL(blendDstAlpha));currentBlendSrc=blendSrc;currentBlendDst=blendDst;currentBlendSrcAlpha=blendSrcAlpha;currentBlendDstAlpha=blendDstAlpha}}else{currentBlendEquation=null;currentBlendSrc=null;currentBlendDst=null;currentBlendEquationAlpha=null;currentBlendSrcAlpha=null;currentBlendDstAlpha=null}};this.setDepthFunc=function(depthFunc){if(currentDepthFunc!==depthFunc){if(depthFunc){switch(depthFunc){case THREE.NeverDepth:gl.depthFunc(gl.NEVER);break;case THREE.AlwaysDepth:gl.depthFunc(gl.ALWAYS);break;case THREE.LessDepth:gl.depthFunc(gl.LESS);break;case THREE.LessEqualDepth:gl.depthFunc(gl.LEQUAL);break;case THREE.EqualDepth:gl.depthFunc(gl.EQUAL);break;case THREE.GreaterEqualDepth:gl.depthFunc(gl.GEQUAL);break;case THREE.GreaterDepth:gl.depthFunc(gl.GREATER);break;case THREE.NotEqualDepth:gl.depthFunc(gl.NOTEQUAL);break;default:gl.depthFunc(gl.LEQUAL)}}else{gl.depthFunc(gl.LEQUAL)}currentDepthFunc=depthFunc}};this.setDepthTest=function(depthTest){if(depthTest){this.enable(gl.DEPTH_TEST)}else{this.disable(gl.DEPTH_TEST)}};this.setDepthWrite=function(depthWrite){if(currentDepthWrite!==depthWrite){gl.depthMask(depthWrite);currentDepthWrite=depthWrite}};this.setColorWrite=function(colorWrite){if(currentColorWrite!==colorWrite){gl.colorMask(colorWrite,colorWrite,colorWrite,colorWrite);currentColorWrite=colorWrite}};this.setFlipSided=function(flipSided){if(currentFlipSided!==flipSided){if(flipSided){gl.frontFace(gl.CW)}else{gl.frontFace(gl.CCW)}currentFlipSided=flipSided}};this.setLineWidth=function(width){if(width!==currentLineWidth){gl.lineWidth(width);currentLineWidth=width}};this.setPolygonOffset=function(polygonOffset,factor,units){if(polygonOffset){this.enable(gl.POLYGON_OFFSET_FILL)}else{this.disable(gl.POLYGON_OFFSET_FILL)}if(polygonOffset&&(currentPolygonOffsetFactor!==factor||currentPolygonOffsetUnits!==units)){gl.polygonOffset(factor,units);currentPolygonOffsetFactor=factor;currentPolygonOffsetUnits=units}};this.setScissorTest=function(scissorTest){if(scissorTest){this.enable(gl.SCISSOR_TEST)}else{this.disable(gl.SCISSOR_TEST)}};this.activeTexture=function(webglSlot){if(webglSlot===undefined)webglSlot=gl.TEXTURE0+maxTextures-1;if(currentTextureSlot!==webglSlot){gl.activeTexture(webglSlot);currentTextureSlot=webglSlot}};this.bindTexture=function(webglType,webglTexture){if(currentTextureSlot===undefined){_this.activeTexture()}var boundTexture=currentBoundTextures[currentTextureSlot];if(boundTexture===undefined){boundTexture={type:undefined,texture:undefined};currentBoundTextures[currentTextureSlot]=boundTexture}if(boundTexture.type!==webglType||boundTexture.texture!==webglTexture){gl.bindTexture(webglType,webglTexture);boundTexture.type=webglType;boundTexture.texture=webglTexture}};this.compressedTexImage2D=function(){try{gl.compressedTexImage2D.apply(gl,arguments)}catch(error){console.error(error)}};this.texImage2D=function(){try{gl.texImage2D.apply(gl,arguments)}catch(error){console.error(error)}};this.reset=function(){for(var i=0;i<enabledAttributes.length;i++){if(enabledAttributes[i]===1){gl.disableVertexAttribArray(i);enabledAttributes[i]=0}}capabilities={};compressedTextureFormats=null;currentBlending=null;currentDepthWrite=null;currentColorWrite=null;currentFlipSided=null}};THREE.LensFlarePlugin=function(renderer,flares){var gl=renderer.context;var state=renderer.state;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var hasVertexTexture;var tempTexture,occlusionTexture;var init=function(){var vertices=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);tempTexture=gl.createTexture();occlusionTexture=gl.createTexture();state.bindTexture(gl.TEXTURE_2D,tempTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,16,16,0,gl.RGB,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);state.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,16,16,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);hasVertexTexture=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var shader;if(hasVertexTexture){shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}program=createProgram(shader);attributes={vertex:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={renderType:gl.getUniformLocation(program,"renderType"),map:gl.getUniformLocation(program,"map"),occlusionMap:gl.getUniformLocation(program,"occlusionMap"),opacity:gl.getUniformLocation(program,"opacity"),color:gl.getUniformLocation(program,"color"),scale:gl.getUniformLocation(program,"scale"),rotation:gl.getUniformLocation(program,"rotation"),screenPosition:gl.getUniformLocation(program,"screenPosition")}};this.render=function(scene,camera,viewportWidth,viewportHeight){if(flares.length===0)return;var tempPosition=new THREE.Vector3;var invAspect=viewportHeight/viewportWidth,halfViewportWidth=viewportWidth*.5,halfViewportHeight=viewportHeight*.5;var size=16/viewportHeight,scale=new THREE.Vector2(size*invAspect,size);var screenPosition=new THREE.Vector3(1,1,0),screenPositionPixels=new THREE.Vector2(1,1);if(program===undefined){init()}gl.useProgram(program);state.initAttributes();state.enableAttribute(attributes.vertex);state.enableAttribute(attributes.uv);state.disableUnusedAttributes();gl.uniform1i(uniforms.occlusionMap,0);gl.uniform1i(uniforms.map,1);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.vertex,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);state.disable(gl.CULL_FACE);gl.depthMask(false);for(var i=0,l=flares.length;i<l;i++){size=16/viewportHeight;scale.set(size*invAspect,size);var flare=flares[i];tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]);tempPosition.applyMatrix4(camera.matrixWorldInverse);tempPosition.applyProjection(camera.projectionMatrix);screenPosition.copy(tempPosition);screenPositionPixels.x=screenPosition.x*halfViewportWidth+halfViewportWidth;screenPositionPixels.y=screenPosition.y*halfViewportHeight+halfViewportHeight;if(hasVertexTexture||screenPositionPixels.x>0&&screenPositionPixels.x<viewportWidth&&screenPositionPixels.y>0&&screenPositionPixels.y<viewportHeight){state.activeTexture(gl.TEXTURE0);state.bindTexture(gl.TEXTURE_2D,null);state.activeTexture(gl.TEXTURE1);state.bindTexture(gl.TEXTURE_2D,tempTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGB,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,0);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);state.disable(gl.BLEND);state.enable(gl.DEPTH_TEST);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);state.activeTexture(gl.TEXTURE0);state.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,1);state.disable(gl.DEPTH_TEST);state.activeTexture(gl.TEXTURE1);state.bindTexture(gl.TEXTURE_2D,tempTexture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);flare.positionScreen.copy(screenPosition);if(flare.customUpdateCallback){flare.customUpdateCallback(flare)}else{flare.updateLensFlares()}gl.uniform1i(uniforms.renderType,2);state.enable(gl.BLEND);for(var j=0,jl=flare.lensFlares.length;j<jl;j++){var sprite=flare.lensFlares[j];if(sprite.opacity>.001&&sprite.scale>.001){screenPosition.x=sprite.x;screenPosition.y=sprite.y;screenPosition.z=sprite.z;size=sprite.size*sprite.scale/viewportHeight;scale.x=size*invAspect;scale.y=size;gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform1f(uniforms.rotation,sprite.rotation);gl.uniform1f(uniforms.opacity,sprite.opacity);gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);state.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);renderer.setTexture(sprite.texture,1);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}}}}state.enable(gl.CULL_FACE);state.enable(gl.DEPTH_TEST);gl.depthMask(true);renderer.resetGLState()};function createProgram(shader){var program=gl.createProgram();var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);var vertexShader=gl.createShader(gl.VERTEX_SHADER);var prefix="precision "+renderer.getPrecision()+" float;\n";gl.shaderSource(fragmentShader,prefix+shader.fragmentShader);gl.shaderSource(vertexShader,prefix+shader.vertexShader);gl.compileShader(fragmentShader);gl.compileShader(vertexShader);gl.attachShader(program,fragmentShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);return program}};THREE.SpritePlugin=function(renderer,sprites){var gl=renderer.context;var state=renderer.state;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var texture;var spritePosition=new THREE.Vector3;var spriteRotation=new THREE.Quaternion;var spriteScale=new THREE.Vector3;var init=function(){var vertices=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);program=createProgram();attributes={position:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={uvOffset:gl.getUniformLocation(program,"uvOffset"),uvScale:gl.getUniformLocation(program,"uvScale"),rotation:gl.getUniformLocation(program,"rotation"),scale:gl.getUniformLocation(program,"scale"),color:gl.getUniformLocation(program,"color"),map:gl.getUniformLocation(program,"map"),opacity:gl.getUniformLocation(program,"opacity"),modelViewMatrix:gl.getUniformLocation(program,"modelViewMatrix"),projectionMatrix:gl.getUniformLocation(program,"projectionMatrix"),fogType:gl.getUniformLocation(program,"fogType"),fogDensity:gl.getUniformLocation(program,"fogDensity"),fogNear:gl.getUniformLocation(program,"fogNear"),fogFar:gl.getUniformLocation(program,"fogFar"),fogColor:gl.getUniformLocation(program,"fogColor"),alphaTest:gl.getUniformLocation(program,"alphaTest")};var canvas=document.createElement("canvas");canvas.width=8;canvas.height=8;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,8,8);texture=new THREE.Texture(canvas);texture.needsUpdate=true};this.render=function(scene,camera){if(sprites.length===0)return;if(program===undefined){init()}gl.useProgram(program);state.initAttributes();state.enableAttribute(attributes.position);state.enableAttribute(attributes.uv);state.disableUnusedAttributes();state.disable(gl.CULL_FACE);state.enable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.uniformMatrix4fv(uniforms.projectionMatrix,false,camera.projectionMatrix.elements);state.activeTexture(gl.TEXTURE0);gl.uniform1i(uniforms.map,0);var oldFogType=0;var sceneFogType=0;var fog=scene.fog;if(fog){gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b);if(fog instanceof THREE.Fog){gl.uniform1f(uniforms.fogNear,fog.near);gl.uniform1f(uniforms.fogFar,fog.far);gl.uniform1i(uniforms.fogType,1);oldFogType=1;sceneFogType=1}else if(fog instanceof THREE.FogExp2){gl.uniform1f(uniforms.fogDensity,fog.density);gl.uniform1i(uniforms.fogType,2);oldFogType=2;sceneFogType=2}}else{gl.uniform1i(uniforms.fogType,0);oldFogType=0;sceneFogType=0}for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];sprite.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld);sprite.z=-sprite.modelViewMatrix.elements[14]}sprites.sort(painterSortStable);var scale=[];for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];var material=sprite.material;gl.uniform1f(uniforms.alphaTest,material.alphaTest);gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,sprite.modelViewMatrix.elements);sprite.matrixWorld.decompose(spritePosition,spriteRotation,spriteScale);scale[0]=spriteScale.x;scale[1]=spriteScale.y;var fogType=0;if(scene.fog&&material.fog){fogType=sceneFogType}if(oldFogType!==fogType){gl.uniform1i(uniforms.fogType,fogType);oldFogType=fogType}if(material.map!==null){gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y);gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y)}else{gl.uniform2f(uniforms.uvOffset,0,0);gl.uniform2f(uniforms.uvScale,1,1)}gl.uniform1f(uniforms.opacity,material.opacity);gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b);gl.uniform1f(uniforms.rotation,material.rotation);gl.uniform2fv(uniforms.scale,scale);state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);state.setDepthTest(material.depthTest);state.setDepthWrite(material.depthWrite);if(material.map&&material.map.image&&material.map.image.width){renderer.setTexture(material.map,0)}else{renderer.setTexture(texture,0)}gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}state.enable(gl.CULL_FACE);renderer.resetGLState()};function createProgram(){var program=gl.createProgram();var vertexShader=gl.createShader(gl.VERTEX_SHADER);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vertexShader,["precision "+renderer.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));gl.shaderSource(fragmentShader,["precision "+renderer.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));gl.compileShader(vertexShader);gl.compileShader(fragmentShader);gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);return program}function painterSortStable(a,b){if(a.z!==b.z){return b.z-a.z}else{return b.id-a.id}}};THREE.GeometryUtils={merge:function(geometry1,geometry2,materialIndexOffset){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var matrix;if(geometry2 instanceof THREE.Mesh){geometry2.matrixAutoUpdate&&geometry2.updateMatrix();matrix=geometry2.matrix;geometry2=geometry2.geometry}geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function(geometry){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return geometry.center()}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(url,mapping,onLoad,onError){var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.Texture(undefined,mapping);loader.load(url,function(image){texture.image=image;texture.needsUpdate=true;if(onLoad)onLoad(texture)},undefined,function(event){if(onError)onError(event)});texture.sourceFile=url;return texture},loadTextureCube:function(array,mapping,onLoad,onError){var images=[];var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.CubeTexture(images,mapping);var loaded=0;var loadTexture=function(i){loader.load(array[i],function(image){texture.images[i]=image;loaded+=1;if(loaded===6){texture.needsUpdate=true;if(onLoad)onLoad(texture)}},undefined,onError)};for(var i=0,il=array.length;i<il;++i){loadTexture(i)}return texture},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(image,depth){var cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};var subtract=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};var normalize=function(a){var l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/l,a[1]/l,a[2]/l]};depth=depth|1;var width=image.width;var height=image.height;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0);var data=context.getImageData(0,0,width,height).data;var imageData=context.createImageData(width,height);var output=imageData.data;for(var x=0;x<width;x++){for(var y=0;y<height;y++){var ly=y-1<0?0:y-1;var uy=y+1>height-1?height-1:y+1;var lx=x-1<0?0:x-1;var ux=x+1>width-1?width-1:x+1;var points=[];var origin=[0,0,data[(y*width+x)*4]/255*depth];points.push([-1,0,data[(y*width+lx)*4]/255*depth]);points.push([-1,-1,data[(ly*width+lx)*4]/255*depth]);points.push([0,-1,data[(ly*width+x)*4]/255*depth]);points.push([1,-1,data[(ly*width+ux)*4]/255*depth]);points.push([1,0,data[(y*width+ux)*4]/255*depth]);points.push([1,1,data[(uy*width+ux)*4]/255*depth]);points.push([0,1,data[(uy*width+x)*4]/255*depth]);points.push([-1,1,data[(uy*width+lx)*4]/255*depth]);var normals=[];var num_points=points.length;for(var i=0;i<num_points;i++){var v1=points[i];var v2=points[(i+1)%num_points];v1=subtract(v1,origin);v2=subtract(v2,origin);normals.push(normalize(cross(v1,v2)))}var normal=[0,0,0];for(var i=0;i<normals.length;i++){normal[0]+=normals[i][0];normal[1]+=normals[i][1];normal[2]+=normals[i][2]}normal[0]/=normals.length;normal[1]/=normals.length;normal[2]/=normals.length;var idx=(y*width+x)*4;output[idx]=(normal[0]+1)/2*255|0;output[idx+1]=(normal[1]+1)/2*255|0;output[idx+2]=normal[2]*255|0;output[idx+3]=255}}context.putImageData(imageData,0,0);return canvas},generateDataTexture:function(width,height,color){var size=width*height;var data=new Uint8Array(3*size);var r=Math.floor(color.r*255);var g=Math.floor(color.g*255);var b=Math.floor(color.b*255);for(var i=0;i<size;i++){data[i*3]=r;data[i*3+1]=g;data[i*3+2]=b}var texture=new THREE.DataTexture(data,width,height,THREE.RGBFormat);texture.needsUpdate=true;return texture}};THREE.SceneUtils={createMultiMaterialObject:function(geometry,materials){var group=new THREE.Group;for(var i=0,l=materials.length;i<l;i++){group.add(new THREE.Mesh(geometry,materials[i]))}return group},detach:function(child,parent,scene){child.applyMatrix(parent.matrixWorld);parent.remove(child);scene.add(child)},attach:function(child,scene,parent){var matrixWorldInverse=new THREE.Matrix4;matrixWorldInverse.getInverse(parent.matrixWorld);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face.toLowerCase()][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(data){var family=data.familyName.toLowerCase();var ThreeFont=this;ThreeFont.faces[family]=ThreeFont.faces[family]||{};ThreeFont.faces[family][data.cssFontWeight]=ThreeFont.faces[family][data.cssFontWeight]||{};ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;return data},drawText:function(text){var i,face=this.getFace(),scale=this.size/face.resolution,offset=0,chars=String(text).split(""),length=chars.length;var fontPaths=[];for(i=0;i<length;i++){var path=new THREE.Path;var ret=this.extractGlyphPoints(chars[i],face,scale,offset,path);offset+=ret.offset;fontPaths.push(ret.path)}var width=offset/2;return{paths:fontPaths,offset:width}},extractGlyphPoints:function(c,face,scale,offset,path){var pts=[];var i,i2,divisions,outline,action,length,scaleX,scaleY,x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste,glyph=face.glyphs[c]||face.glyphs["?"];if(!glyph)return;if(glyph.o){outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));length=outline.length;scaleX=scale;scaleY=scale;for(i=0;i<length;){action=outline[i++];switch(action){case"m":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.moveTo(x,y);break;case"l":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.lineTo(x,y);break;case"q":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy)}}break;case"b":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;cpx2=outline[i++]*scaleX+offset;cpy2=outline[i++]*scaleY;path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy)}}break}}}return{offset:glyph.ha*scale,path:path}}};THREE.FontUtils.generateShapes=function(text,parameters){parameters=parameters||{};var size=parameters.size!==undefined?parameters.size:100;var curveSegments=parameters.curveSegments!==undefined?parameters.curveSegments:4;var font=parameters.font!==undefined?parameters.font:"helvetiker";var weight=parameters.weight!==undefined?parameters.weight:"normal";var style=parameters.style!==undefined?parameters.style:"normal";THREE.FontUtils.size=size;THREE.FontUtils.divisions=curveSegments;THREE.FontUtils.face=font;THREE.FontUtils.weight=weight;THREE.FontUtils.style=style;var data=THREE.FontUtils.drawText(text);var paths=data.paths;var shapes=[];for(var p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes())}return shapes};(function(namespace){var EPSILON=1e-10;var process=function(contour,indices){var n=contour.length;if(n<3)return null;var result=[],verts=[],vertIndices=[];var u,v,w;if(area(contour)>0){for(v=0;v<n;v++)verts[v]=v}else{for(v=0;v<n;v++)verts[v]=n-1-v}var nv=n;var count=2*nv;for(v=nv-1;nv>2;){if(count--<=0){console.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");if(indices)return vertIndices;return result}u=v;if(nv<=u)u=0;v=u+1;if(nv<=v)v=0;w=v+1;if(nv<=w)w=0;if(snip(contour,u,v,w,nv,verts)){var a,b,c,s,t;a=verts[u];b=verts[v];c=verts[w];result.push([contour[a],contour[b],contour[c]]);vertIndices.push([verts[u],verts[v],verts[w]]);for(s=v,t=v+1;t<nv;s++,t++){verts[s]=verts[t]}nv--;count=2*nv}}if(indices)return vertIndices;return result};var area=function(contour){var n=contour.length;var a=0;for(var p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y}return a*.5};var snip=function(contour,u,v,w,n,verts){var p;var ax,ay,bx,by;var cx,cy,px,py;ax=contour[verts[u]].x;ay=contour[verts[u]].y;bx=contour[verts[v]].x;by=contour[verts[v]].y;cx=contour[verts[w]].x;cy=contour[verts[w]].y;if(EPSILON>(bx-ax)*(cy-ay)-(by-ay)*(cx-ax))return false;var aX,aY,bX,bY,cX,cY;var apx,apy,bpx,bpy,cpx,cpy;var cCROSSap,bCROSScp,aCROSSbp;aX=cx-bx;aY=cy-by;bX=ax-cx;bY=ay-cy;cX=bx-ax;cY=by-ay;for(p=0;p<n;p++){px=contour[verts[p]].x;py=contour[verts[p]].y;if(px===ax&&py===ay||px===bx&&py===by||px===cx&&py===cy)continue;apx=px-ax;apy=py-ay;bpx=px-bx;bpy=py-by;cpx=px-cx;cpy=py-cy;aCROSSbp=aX*bpy-aY*bpx;cCROSSap=cX*apy-cY*apx;bCROSScp=bX*cpy-bY*cpx;if(aCROSSbp>=-EPSILON&&bCROSScp>=-EPSILON&&cCROSSap>=-EPSILON)return false}return true};namespace.Triangulate=process;namespace.Triangulate.area=area;return namespace})(THREE.FontUtils);THREE.typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};if(typeof self!=="undefined")self._typeface_js=THREE.typeface_js;THREE.Audio=function(listener){THREE.Object3D.call(this);this.type="Audio";this.context=listener.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.playbackRate=1;this.isPlaying=false};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.constructor=THREE.Audio;THREE.Audio.prototype.load=function(file){var scope=this;var request=new XMLHttpRequest;request.open("GET",file,true);request.responseType="arraybuffer";request.onload=function(e){scope.context.decodeAudioData(this.response,function(buffer){scope.source.buffer=buffer;if(scope.autoplay)scope.play()})};request.send();return this};THREE.Audio.prototype.play=function(){if(this.isPlaying===true){console.warn("THREE.Audio: Audio is already playing.");return}var source=this.context.createBufferSource();source.buffer=this.source.buffer;source.loop=this.source.loop;source.onended=this.source.onended;source.start(0,this.startTime);source.playbackRate.value=this.playbackRate;this.isPlaying=true;this.source=source;this.connect()};THREE.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};THREE.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};THREE.Audio.prototype.connect=function(){if(this.filter!==undefined){this.source.connect(this.filter);this.filter.connect(this.panner)}else{this.source.connect(this.panner)}};THREE.Audio.prototype.disconnect=function(){if(this.filter!==undefined){this.source.disconnect(this.filter);this.filter.disconnect(this.panner)}else{this.source.disconnect(this.panner)}};THREE.Audio.prototype.setFilter=function(value){if(this.isPlaying===true){this.disconnect();this.filter=value;this.connect()}else{this.filter=value}};THREE.Audio.prototype.getFilter=function(){return this.filter};THREE.Audio.prototype.setPlaybackRate=function(value){this.playbackRate=value;if(this.isPlaying===true){this.source.playbackRate.value=this.playbackRate}};THREE.Audio.prototype.getPlaybackRate=function(){return this.playbackRate};THREE.Audio.prototype.onEnded=function(){this.isPlaying=false};THREE.Audio.prototype.setLoop=function(value){this.source.loop=value};THREE.Audio.prototype.getLoop=function(){return this.source.loop};THREE.Audio.prototype.setRefDistance=function(value){this.panner.refDistance=value};THREE.Audio.prototype.getRefDistance=function(){return this.panner.refDistance};THREE.Audio.prototype.setRolloffFactor=function(value){this.panner.rolloffFactor=value};THREE.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor};THREE.Audio.prototype.setVolume=function(value){this.gain.gain.value=value};THREE.Audio.prototype.getVolume=function(){return this.gain.gain.value};THREE.Audio.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;return function updateMatrixWorld(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);position.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(position.x,position.y,position.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.constructor=THREE.AudioListener;THREE.AudioListener.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3;var orientation=new THREE.Vector3;return function updateMatrixWorld(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener;var up=this.up;this.matrixWorld.decompose(position,quaternion,scale);orientation.set(0,0,-1).applyQuaternion(quaternion);listener.setPosition(position.x,position.y,position.z);listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(t){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(u){var t=this.getUtoTmapping(u);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPoint(d/divisions))}return pts};THREE.Curve.prototype.getSpacedPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPointAt(d/divisions))}return pts};THREE.Curve.prototype.getLength=function(){var lengths=this.getLengths();return lengths[lengths.length-1]};THREE.Curve.prototype.getLengths=function(divisions){if(!divisions)divisions=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length===divisions+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var cache=[];var current,last=this.getPoint(0);var p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current}this.cacheArcLengths=cache;return cache};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(u,distance){var arcLengths=this.getLengths();var i=0,il=arcLengths.length;var targetArcLength;if(distance){targetArcLength=distance}else{targetArcLength=u*arcLengths[il-1]}var low=0,high=il-1,comparison;while(low<=high){i=Math.floor(low+(high-low)/2);comparison=arcLengths[i]-targetArcLength;if(comparison<0){low=i+1}else if(comparison>0){high=i-1}else{high=i;break}}i=high;if(arcLengths[i]===targetArcLength){var t=i/(il-1);return t}var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;var segmentFraction=(targetArcLength-lengthBefore)/segmentLength;var t=(i+segmentFraction)/(il-1);return t};THREE.Curve.prototype.getTangent=function(t){var delta=1e-4;var t1=t-delta;var t2=t+delta;if(t1<0)t1=0;if(t2>1)t2=1;var pt1=this.getPoint(t1);var pt2=this.getPoint(t2);var vec=pt2.clone().sub(pt1);return vec.normalize()};THREE.Curve.prototype.getTangentAt=function(u){var t=this.getUtoTmapping(u);return this.getTangent(t)};THREE.Curve.Utils={tangentQuadraticBezier:function(t,p0,p1,p2){return 2*(1-t)*(p1-p0)+2*t*(p2-p1)},tangentCubicBezier:function(t,p0,p1,p2,p3){return-3*p0*(1-t)*(1-t)+3*p1*(1-t)*(1-t)-6*t*p1*(1-t)+6*t*p2*(1-t)-3*t*t*p2+3*t*t*p3},tangentSpline:function(t,p0,p1,p2,p3){var h00=6*t*t-6*t;var h10=3*t*t-4*t+1;var h01=-6*t*t+6*t;var h11=3*t*t-2*t;return h00+h10+h01+h11},interpolate:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5;var v1=(p3-p1)*.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}};THREE.Curve.create=function(constructor,getPointFunc){constructor.prototype=Object.create(THREE.Curve.prototype);constructor.prototype.constructor=constructor;constructor.prototype.getPoint=getPointFunc;return constructor};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(curve){this.curves.push(curve)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new THREE.LineCurve(endPoint,startPoint))}};THREE.CurvePath.prototype.getPoint=function(t){var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0,diff,curve;while(i<curveLengths.length){if(curveLengths[i]>=d){diff=curveLengths[i]-d;curve=this.curves[i];var u=1-diff/curve.getLength();return curve.getPointAt(u)}i++}return null};THREE.CurvePath.prototype.getLength=function(){var lens=this.getCurveLengths();return lens[lens.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}var lengths=[],sums=0;var i,il=this.curves.length;for(i=0;i<il;i++){sums+=this.curves[i].getLength();lengths.push(sums)}this.cacheLengths=lengths;return lengths};THREE.CurvePath.prototype.getBoundingBox=function(){var points=this.getPoints();var maxX,maxY,maxZ;var minX,minY,minZ;maxX=maxY=Number.NEGATIVE_INFINITY;minX=minY=Number.POSITIVE_INFINITY;var p,i,il,sum;var v3=points[0]instanceof THREE.Vector3;sum=v3?new THREE.Vector3:new THREE.Vector2;for(i=0,il=points.length;i<il;i++){p=points[i];if(p.x>maxX)maxX=p.x;else if(p.x<minX)minX=p.x;if(p.y>maxY)maxY=p.y;else if(p.y<minY)minY=p.y;if(v3){if(p.z>maxZ)maxZ=p.z;else if(p.z<minZ)minZ=p.z}sum.add(p)}var ret={minX:minX,minY:minY,maxX:maxX,maxY:maxY};if(v3){ret.maxZ=maxZ;ret.minZ=minZ}return ret};THREE.CurvePath.prototype.createPointsGeometry=function(divisions){var pts=this.getPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(divisions){var pts=this.getSpacedPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createGeometry=function(points){var geometry=new THREE.Geometry;for(var i=0;i<points.length;i++){geometry.vertices.push(new THREE.Vector3(points[i].x,points[i].y,points[i].z||0))}return geometry};THREE.CurvePath.prototype.addWrapPath=function(bendpath){this.bends.push(bendpath)};THREE.CurvePath.prototype.getTransformedPoints=function(segments,bends){var oldPts=this.getPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(segments,bends){var oldPts=this.getSpacedPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getWrapPoints=function(oldPts,path){var bounds=this.getBoundingBox();var i,il,p,oldX,oldY,xNorm;for(i=0,il=oldPts.length;i<il;i++){p=oldPts[i];oldX=p.x;oldY=p.y;xNorm=oldX/bounds.maxX;xNorm=path.getUtoTmapping(xNorm,oldX);var pathPt=path.getPoint(xNorm);var normal=path.getTangent(xNorm);normal.set(-normal.y,normal.x).multiplyScalar(oldY);p.x=pathPt.x+normal.x;p.y=pathPt.y+normal.y}return oldPts};THREE.Path=function(points){THREE.CurvePath.call(this);this.actions=[];if(points){this.fromPoints(points)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(vectors){this.moveTo(vectors[0].x,vectors[0].y);for(var v=1,vlen=vectors.length;v<vlen;v++){this.lineTo(vectors[v].x,vectors[v].y)}};THREE.Path.prototype.moveTo=function(x,y){var args=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:args})};THREE.Path.prototype.lineTo=function(x,y){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.LineCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(x,y));this.curves.push(curve);this.actions.push({action:THREE.PathActions.LINE_TO,args:args})};THREE.Path.prototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.QuadraticBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCPx,aCPy),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:args})};THREE.Path.prototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.CubicBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCP1x,aCP1y),new THREE.Vector2(aCP2x,aCP2y),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:args})};THREE.Path.prototype.splineThru=function(pts){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var npts=[new THREE.Vector2(x0,y0)];Array.prototype.push.apply(npts,pts);var curve=new THREE.SplineCurve(npts);this.curves.push(curve);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:args})};THREE.Path.prototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absarc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.ellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation)};THREE.Path.prototype.absellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var args=[aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation||0];var curve=new THREE.EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);this.curves.push(curve);var lastPoint=curve.getPoint(1);args.push(lastPoint.x);args.push(lastPoint.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:args})};THREE.Path.prototype.getSpacedPoints=function(divisions,closedPath){if(!divisions)divisions=40;var points=[];for(var i=0;i<divisions;i++){points.push(this.getPoint(i/divisions))}return points};THREE.Path.prototype.getPoints=function(divisions,closedPath){if(this.useSpacedPoints){return this.getSpacedPoints(divisions,closedPath)}divisions=divisions||12;var points=[];var i,il,item,action,args;var cpx,cpy,cpx2,cpy2,cpx1,cpy1,cpx0,cpy0,laste,j,t,tx,ty;for(i=0,il=this.actions.length;i<il;i++){item=this.actions[i];action=item.action;args=item.args;switch(action){case THREE.PathActions.MOVE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.LINE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:cpx=args[2];cpy=args[3];cpx1=args[0];cpy1=args[1];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.BEZIER_CURVE_TO:cpx=args[4];cpy=args[5];cpx1=args[0];cpy1=args[1];cpx2=args[2];cpy2=args[3];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.CSPLINE_THRU:laste=this.actions[i-1].args;var last=new THREE.Vector2(laste[laste.length-2],laste[laste.length-1]);var spts=[last];var n=divisions*args[0].length;spts=spts.concat(args[0]);var spline=new THREE.SplineCurve(spts);for(j=1;j<=n;j++){points.push(spline.getPointAt(j/n))}break;case THREE.PathActions.ARC:var aX=args[0],aY=args[1],aRadius=args[2],aStartAngle=args[3],aEndAngle=args[4],aClockwise=!!args[5];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+aRadius*Math.cos(angle);ty=aY+aRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.ELLIPSE:var aX=args[0],aY=args[1],xRadius=args[2],yRadius=args[3],aStartAngle=args[4],aEndAngle=args[5],aClockwise=!!args[6],aRotation=args[7];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;var cos,sin;if(aRotation!==0){cos=Math.cos(aRotation);sin=Math.sin(aRotation)}for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+xRadius*Math.cos(angle);ty=aY+yRadius*Math.sin(angle);if(aRotation!==0){var x=tx,y=ty;tx=(x-aX)*cos-(y-aY)*sin+aX;ty=(x-aX)*sin+(y-aY)*cos+aY}points.push(new THREE.Vector2(tx,ty))}break}}var lastPoint=points[points.length-1];var EPSILON=1e-10;if(Math.abs(lastPoint.x-points[0].x)<EPSILON&&Math.abs(lastPoint.y-points[0].y)<EPSILON)points.splice(points.length-1,1);if(closedPath){points.push(points[0])}return points};THREE.Path.prototype.toShapes=function(isCCW,noHoles){function extractSubpaths(inActions){var i,il,item,action,args;var subPaths=[],lastPath=new THREE.Path;for(i=0,il=inActions.length;i<il;i++){item=inActions[i];args=item.args;action=item.action;if(action===THREE.PathActions.MOVE_TO){if(lastPath.actions.length!==0){subPaths.push(lastPath);lastPath=new THREE.Path}}lastPath[action].apply(lastPath,args)}if(lastPath.actions.length!==0){subPaths.push(lastPath)}return subPaths}function toShapesNoHoles(inSubpaths){var shapes=[];for(var i=0,il=inSubpaths.length;i<il;i++){var tmpPath=inSubpaths[i];var tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){var EPSILON=1e-10;var polyLen=inPolygon.length;var inside=false;for(var p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p];var edgeHighPt=inPolygon[q];var edgeDx=edgeHighPt.x-edgeLowPt.x;var edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>EPSILON){if(edgeDy<0){edgeLowPt=inPolygon[q];edgeDx=-edgeDx;edgeHighPt=inPolygon[p];edgeDy=-edgeDy}if(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y===edgeLowPt.y){if(inPt.x===edgeLowPt.x)return true}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(perpEdge===0)return true;if(perpEdge<0)continue;inside=!inside}}else{if(inPt.y!==edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return true}}return inside}var subPaths=extractSubpaths(this.actions);if(subPaths.length===0)return[];if(noHoles===true)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(subPaths.length===1){tmpPath=subPaths[0];tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes}var holesFirst=!THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var betterShapeHoles=[];var newShapes=[];var newShapeHoles=[];var mainIdx=0;var tmpPoints;newShapes[mainIdx]=undefined;newShapeHoles[mainIdx]=[];var i,il;for(i=0,il=subPaths.length;i<il;i++){tmpPath=subPaths[i];tmpPoints=tmpPath.getPoints();solid=THREE.Shape.Utils.isClockWise(tmpPoints);solid=isCCW?!solid:solid;if(solid){if(!holesFirst&&newShapes[mainIdx])mainIdx++;newShapes[mainIdx]={s:new THREE.Shape,p:tmpPoints};newShapes[mainIdx].s.actions=tmpPath.actions;newShapes[mainIdx].s.curves=tmpPath.curves;if(holesFirst)mainIdx++;newShapeHoles[mainIdx]=[]}else{newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]})}}if(!newShapes[0])return toShapesNoHoles(subPaths);if(newShapes.length>1){var ambiguous=false;var toChange=[];for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){betterShapeHoles[sIdx]=[]}for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){var sho=newShapeHoles[sIdx];for(var hIdx=0;hIdx<sho.length;hIdx++){var ho=sho[hIdx];var hole_unassigned=true;for(var s2Idx=0;s2Idx<newShapes.length;s2Idx++){if(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){if(sIdx!==s2Idx)toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx});if(hole_unassigned){hole_unassigned=false;betterShapeHoles[s2Idx].push(ho)}else{ambiguous=true}}}if(hole_unassigned){betterShapeHoles[sIdx].push(ho)}}}if(toChange.length>0){if(!ambiguous)newShapeHoles=betterShapeHoles}}var tmpHoles,j,jl;for(i=0,il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s;shapes.push(tmpShape);tmpHoles=newShapeHoles[i];for(j=0,jl=tmpHoles.length;j<jl;j++){tmpShape.holes.push(tmpHoles[j].h)}}return shapes};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(options){var extruded=new THREE.ExtrudeGeometry(this,options);return extruded};THREE.Shape.prototype.makeGeometry=function(options){var geometry=new THREE.ShapeGeometry(this,options);return geometry};THREE.Shape.prototype.getPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.getSpacedPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedSpacedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.extractAllPoints=function(divisions){return{shape:this.getTransformedPoints(divisions),holes:this.getPointsHoles(divisions)}};THREE.Shape.prototype.extractPoints=function(divisions){if(this.useSpacedPoints){return this.extractAllSpacedPoints(divisions)}return this.extractAllPoints(divisions)};THREE.Shape.prototype.extractAllSpacedPoints=function(divisions){return{shape:this.getTransformedSpacedPoints(divisions),holes:this.getSpacedPointsHoles(divisions)}};THREE.Shape.Utils={triangulateShape:function(contour,holes){function point_in_segment_2D_colin(inSegPt1,inSegPt2,inOtherPt){if(inSegPt1.x!==inSegPt2.x){if(inSegPt1.x<inSegPt2.x){return inSegPt1.x<=inOtherPt.x&&inOtherPt.x<=inSegPt2.x}else{return inSegPt2.x<=inOtherPt.x&&inOtherPt.x<=inSegPt1.x}}else{if(inSegPt1.y<inSegPt2.y){return inSegPt1.y<=inOtherPt.y&&inOtherPt.y<=inSegPt2.y}else{return inSegPt2.y<=inOtherPt.y&&inOtherPt.y<=inSegPt1.y}}}function intersect_segments_2D(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1,inSeg2Pt2,inExcludeAdjacentSegs){var EPSILON=1e-10;var seg1dx=inSeg1Pt2.x-inSeg1Pt1.x,seg1dy=inSeg1Pt2.y-inSeg1Pt1.y;var seg2dx=inSeg2Pt2.x-inSeg2Pt1.x,seg2dy=inSeg2Pt2.y-inSeg2Pt1.y;var seg1seg2dx=inSeg1Pt1.x-inSeg2Pt1.x;var seg1seg2dy=inSeg1Pt1.y-inSeg2Pt1.y;var limit=seg1dy*seg2dx-seg1dx*seg2dy;var perpSeg1=seg1dy*seg1seg2dx-seg1dx*seg1seg2dy;if(Math.abs(limit)>EPSILON){var perpSeg2;if(limit>0){if(perpSeg1<0||perpSeg1>limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2<0||perpSeg2>limit)return[]}else{if(perpSeg1>0||perpSeg1<limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2>0||perpSeg2<limit)return[]}if(perpSeg2===0){if(inExcludeAdjacentSegs&&(perpSeg1===0||perpSeg1===limit))return[];return[inSeg1Pt1]}if(perpSeg2===limit){if(inExcludeAdjacentSegs&&(perpSeg1===0||perpSeg1===limit))return[];return[inSeg1Pt2]}if(perpSeg1===0)return[inSeg2Pt1];if(perpSeg1===limit)return[inSeg2Pt2];var factorSeg1=perpSeg2/limit;return[{x:inSeg1Pt1.x+factorSeg1*seg1dx,y:inSeg1Pt1.y+factorSeg1*seg1dy}]}else{if(perpSeg1!==0||seg2dy*seg1seg2dx!==seg2dx*seg1seg2dy)return[];var seg1Pt=seg1dx===0&&seg1dy===0;var seg2Pt=seg2dx===0&&seg2dy===0;if(seg1Pt&&seg2Pt){if(inSeg1Pt1.x!==inSeg2Pt1.x||inSeg1Pt1.y!==inSeg2Pt1.y)return[];return[inSeg1Pt1]}if(seg1Pt){if(!point_in_segment_2D_colin(inSeg2Pt1,inSeg2Pt2,inSeg1Pt1))return[];return[inSeg1Pt1]}if(seg2Pt){if(!point_in_segment_2D_colin(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1))return[];return[inSeg2Pt1]}var seg1min,seg1max,seg1minVal,seg1maxVal;var seg2min,seg2max,seg2minVal,seg2maxVal;if(seg1dx!==0){if(inSeg1Pt1.x<inSeg1Pt2.x){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.x;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.x}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.x;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.x}if(inSeg2Pt1.x<inSeg2Pt2.x){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.x;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.x}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.x;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.x}}else{if(inSeg1Pt1.y<inSeg1Pt2.y){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.y;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.y}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.y;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.y}if(inSeg2Pt1.y<inSeg2Pt2.y){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.y;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.y}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.y;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.y}}if(seg1minVal<=seg2minVal){if(seg1maxVal<seg2minVal)return[];if(seg1maxVal===seg2minVal){if(inExcludeAdjacentSegs)return[];return[seg2min]}if(seg1maxVal<=seg2maxVal)return[seg2min,seg1max];return[seg2min,seg2max]}else{if(seg1minVal>seg2maxVal)return[];if(seg1minVal===seg2maxVal){if(inExcludeAdjacentSegs)return[];return[seg1min]}if(seg1maxVal<=seg2maxVal)return[seg1min,seg1max];return[seg1min,seg2max]}}}function isPointInsideAngle(inVertex,inLegFromPt,inLegToPt,inOtherPt){var EPSILON=1e-10;var legFromPtX=inLegFromPt.x-inVertex.x,legFromPtY=inLegFromPt.y-inVertex.y;var legToPtX=inLegToPt.x-inVertex.x,legToPtY=inLegToPt.y-inVertex.y;var otherPtX=inOtherPt.x-inVertex.x,otherPtY=inOtherPt.y-inVertex.y;var from2toAngle=legFromPtX*legToPtY-legFromPtY*legToPtX;var from2otherAngle=legFromPtX*otherPtY-legFromPtY*otherPtX;if(Math.abs(from2toAngle)>EPSILON){var other2toAngle=otherPtX*legToPtY-otherPtY*legToPtX;if(from2toAngle>0){return from2otherAngle>=0&&other2toAngle>=0}else{return from2otherAngle>=0||other2toAngle>=0}}else{return from2otherAngle>0}}function removeHoles(contour,holes){var shape=contour.concat();var hole;function isCutLineInsideAngles(inShapeIdx,inHoleIdx){var lastShapeIdx=shape.length-1;var prevShapeIdx=inShapeIdx-1;if(prevShapeIdx<0)prevShapeIdx=lastShapeIdx;var nextShapeIdx=inShapeIdx+1;if(nextShapeIdx>lastShapeIdx)nextShapeIdx=0;var insideAngle=isPointInsideAngle(shape[inShapeIdx],shape[prevShapeIdx],shape[nextShapeIdx],hole[inHoleIdx]);if(!insideAngle){return false}var lastHoleIdx=hole.length-1;var prevHoleIdx=inHoleIdx-1;if(prevHoleIdx<0)prevHoleIdx=lastHoleIdx;var nextHoleIdx=inHoleIdx+1;if(nextHoleIdx>lastHoleIdx)nextHoleIdx=0;insideAngle=isPointInsideAngle(hole[inHoleIdx],hole[prevHoleIdx],hole[nextHoleIdx],shape[inShapeIdx]);if(!insideAngle){return false}return true}function intersectsShapeEdge(inShapePt,inHolePt){var sIdx,nextIdx,intersection;for(sIdx=0;sIdx<shape.length;sIdx++){nextIdx=sIdx+1;nextIdx%=shape.length;intersection=intersect_segments_2D(inShapePt,inHolePt,shape[sIdx],shape[nextIdx],true);if(intersection.length>0)return true}return false}var indepHoles=[];function intersectsHoleEdge(inShapePt,inHolePt){var ihIdx,chkHole,hIdx,nextIdx,intersection;for(ihIdx=0;ihIdx<indepHoles.length;ihIdx++){chkHole=holes[indepHoles[ihIdx]];for(hIdx=0;hIdx<chkHole.length;hIdx++){nextIdx=hIdx+1;nextIdx%=chkHole.length;intersection=intersect_segments_2D(inShapePt,inHolePt,chkHole[hIdx],chkHole[nextIdx],true);if(intersection.length>0)return true}}return false}var holeIndex,shapeIndex,shapePt,holePt,holeIdx,cutKey,failedCuts=[],tmpShape1,tmpShape2,tmpHole1,tmpHole2;for(var h=0,hl=holes.length;h<hl;h++){indepHoles.push(h)}var minShapeIndex=0;var counter=indepHoles.length*2;while(indepHoles.length>0){counter--;if(counter<0){console.log("Infinite Loop! Holes left:"+indepHoles.length+", Probably Hole outside Shape!");break}for(shapeIndex=minShapeIndex;shapeIndex<shape.length;shapeIndex++){shapePt=shape[shapeIndex];holeIndex=-1;for(var h=0;h<indepHoles.length;h++){holeIdx=indepHoles[h];cutKey=shapePt.x+":"+shapePt.y+":"+holeIdx;if(failedCuts[cutKey]!==undefined)continue;hole=holes[holeIdx];for(var h2=0;h2<hole.length;h2++){holePt=hole[h2];if(!isCutLineInsideAngles(shapeIndex,h2))continue;if(intersectsShapeEdge(shapePt,holePt))continue;if(intersectsHoleEdge(shapePt,holePt))continue;holeIndex=h2;indepHoles.splice(h,1);tmpShape1=shape.slice(0,shapeIndex+1);tmpShape2=shape.slice(shapeIndex);tmpHole1=hole.slice(holeIndex);tmpHole2=hole.slice(0,holeIndex+1);shape=tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);minShapeIndex=shapeIndex;break}if(holeIndex>=0)break;failedCuts[cutKey]=true}if(holeIndex>=0)break}}return shape}var i,il,f,face,key,index,allPointsMap={};var allpoints=contour.concat();for(var h=0,hl=holes.length;h<hl;h++){Array.prototype.push.apply(allpoints,holes[h])}for(i=0,il=allpoints.length;i<il;i++){key=allpoints[i].x+":"+allpoints[i].y;if(allPointsMap[key]!==undefined){console.warn("THREE.Shape: Duplicate point",key)}allPointsMap[key]=i}var shapeWithoutHoles=removeHoles(contour,holes);var triangles=THREE.FontUtils.Triangulate(shapeWithoutHoles,false);for(i=0,il=triangles.length;i<il;i++){face=triangles[i];for(f=0;f<3;f++){key=face[f].x+":"+face[f].y;index=allPointsMap[key];if(index!==undefined){face[f]=index}}}return triangles.concat()},isClockWise:function(pts){return THREE.FontUtils.Triangulate.area(pts)<0},b2p0:function(t,p){var k=1-t;return k*k*p},b2p1:function(t,p){return 2*(1-t)*t*p},b2p2:function(t,p){return t*t*p},b2:function(t,p0,p1,p2){return this.b2p0(t,p0)+this.b2p1(t,p1)+this.b2p2(t,p2)},b3p0:function(t,p){var k=1-t;return k*k*k*p},b3p1:function(t,p){var k=1-t;return 3*k*k*t*p},b3p2:function(t,p){var k=1-t;return 3*k*t*t*p},b3p3:function(t,p){return t*t*t*p},b3:function(t,p0,p1,p2,p3){return this.b3p0(t,p0)+this.b3p1(t,p1)+this.b3p2(t,p2)+this.b3p3(t,p3)}};THREE.LineCurve=function(v1,v2){this.v1=v1;this.v2=v2};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(t){var point=this.v2.clone().sub(this.v1);point.multiplyScalar(t).add(this.v1);return point};THREE.LineCurve.prototype.getPointAt=function(u){return this.getPoint(u)};THREE.LineCurve.prototype.getTangent=function(t){var tangent=this.v2.clone().sub(this.v1);return tangent.normalize()};THREE.QuadraticBezierCurve=function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var vector=new THREE.Vector2;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);return vector};THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y);return vector.normalize()};THREE.CubicBezierCurve=function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(t){var tx,ty;tx=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(tx,ty)};THREE.CubicBezierCurve.prototype.getTangent=function(t){var tx,ty;tx=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var tangent=new THREE.Vector2(tx,ty);tangent.normalize();return tangent};THREE.SplineCurve=function(points){this.points=points==undefined?[]:points};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint===0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);return vector};THREE.EllipseCurve=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){this.aX=aX;this.aY=aY;this.xRadius=xRadius;this.yRadius=yRadius;this.aStartAngle=aStartAngle;this.aEndAngle=aEndAngle;this.aClockwise=aClockwise;this.aRotation=aRotation||0};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(t){var deltaAngle=this.aEndAngle-this.aStartAngle;if(deltaAngle<0)deltaAngle+=Math.PI*2;if(deltaAngle>Math.PI*2)deltaAngle-=Math.PI*2;var angle;if(this.aClockwise===true){angle=this.aEndAngle+(1-t)*(Math.PI*2-deltaAngle)}else{angle=this.aStartAngle+t*deltaAngle}var x=this.aX+this.xRadius*Math.cos(angle);var y=this.aY+this.yRadius*Math.sin(angle);if(this.aRotation!==0){var cos=Math.cos(this.aRotation);var sin=Math.sin(this.aRotation);var tx=x,ty=y;x=(tx-this.aX)*cos-(ty-this.aY)*sin+this.aX;y=(tx-this.aX)*sin+(ty-this.aY)*cos+this.aY}return new THREE.Vector2(x,y)};THREE.ArcCurve=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){THREE.EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(v1,v2){this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.subVectors(this.v2,this.v1);vector.multiplyScalar(t);vector.add(this.v1);return vector});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);vector.z=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z);return vector});THREE.CubicBezierCurve3=THREE.Curve.create(function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);vector.y=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);vector.z=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return vector});THREE.SplineCurve3=THREE.Curve.create(function(points){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.CatmullRomCurve3=function(){var tmp=new THREE.Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CubicPoly(){}CubicPoly.prototype.init=function(x0,x1,t0,t1){this.c0=x0;this.c1=t0;this.c2=-3*x0+3*x1-2*t0-t1;this.c3=2*x0-2*x1+t0+t1};CubicPoly.prototype.initNonuniformCatmullRom=function(x0,x1,x2,x3,dt0,dt1,dt2){var t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1;var t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;t1*=dt1;t2*=dt1;this.init(x1,x2,t1,t2)};CubicPoly.prototype.initCatmullRom=function(x0,x1,x2,x3,tension){this.init(x1,x2,tension*(x2-x0),tension*(x3-x1))};CubicPoly.prototype.calc=function(t){var t2=t*t;var t3=t2*t;return this.c0+this.c1*t+this.c2*t2+this.c3*t3};return THREE.Curve.create(function(p){this.points=p||[]},function(t){var points=this.points,point,intPoint,weight,l;l=points.length;if(l<2)console.log("duh, you need at least 2 points");point=(l-1)*t;intPoint=Math.floor(point);weight=point-intPoint;if(weight===0&&intPoint===l-1){intPoint=l-2;weight=1}var p0,p1,p2,p3;if(intPoint===0){tmp.subVectors(points[0],points[1]).add(points[0]);p0=tmp}else{p0=points[intPoint-1]}p1=points[intPoint];p2=points[intPoint+1];if(intPoint+2<l){p3=points[intPoint+2]}else{tmp.subVectors(points[l-1],points[l-2]).add(points[l-2]);p3=tmp}if(this.type===undefined||this.type==="centripetal"||this.type==="chordal"){var pow=this.type==="chordal"?.5:.25;var dt0=Math.pow(p0.distanceToSquared(p1),pow);var dt1=Math.pow(p1.distanceToSquared(p2),pow);var dt2=Math.pow(p2.distanceToSquared(p3),pow);if(dt1<1e-4)dt1=1;if(dt0<1e-4)dt0=dt1;if(dt2<1e-4)dt2=dt1;px.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2);py.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2);pz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2)}else if(this.type==="catmullrom"){var tension=this.tension!==undefined?this.tension:.5;px.initCatmullRom(p0.x,p1.x,p2.x,p3.x,tension);py.initCatmullRom(p0.y,p1.y,p2.y,p3.y,tension);pz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,tension)}var v=new THREE.Vector3(px.calc(weight),py.calc(weight),pz.calc(weight));return v})}();THREE.ClosedSplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-0)*t;var intPoint=Math.floor(point);var weight=point-intPoint;intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length;var point0=points[(intPoint-1)%points.length];var point1=points[intPoint%points.length];var point2=points[(intPoint+1)%points.length];var point3=points[(intPoint+2)%points.length];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(data){if(data.initialized===true)return data;for(var h=0;h<data.hierarchy.length;h++){for(var k=0;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time<0){data.hierarchy[h].keys[k].time=0}if(data.hierarchy[h].keys[k].rot!==undefined&&!(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)){var quat=data.hierarchy[h].keys[k].rot;data.hierarchy[h].keys[k].rot=(new THREE.Quaternion).fromArray(quat)}}if(data.hierarchy[h].keys.length&&data.hierarchy[h].keys[0].morphTargets!==undefined){var usedMorphTargets={};for(var k=0;k<data.hierarchy[h].keys.length;k++){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){var morphTargetName=data.hierarchy[h].keys[k].morphTargets[m];usedMorphTargets[morphTargetName]=-1}}data.hierarchy[h].usedMorphTargets=usedMorphTargets;for(var k=0;k<data.hierarchy[h].keys.length;k++){var influences={};for(var morphTargetName in usedMorphTargets){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){if(data.hierarchy[h].keys[k].morphTargets[m]===morphTargetName){influences[morphTargetName]=data.hierarchy[h].keys[k].morphTargetsInfluences[m];break}}if(m===data.hierarchy[h].keys[k].morphTargets.length){influences[morphTargetName]=0}}data.hierarchy[h].keys[k].morphTargetsInfluences=influences}}for(var k=1;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time===data.hierarchy[h].keys[k-1].time){data.hierarchy[h].keys.splice(k,1);k--}}for(var k=0;k<data.hierarchy[h].keys.length;k++){data.hierarchy[h].keys[k].index=k}}data.initialized=true;return data},parse:function(root){var parseRecurseHierarchy=function(root,hierarchy){hierarchy.push(root);for(var c=0;c<root.children.length;c++)parseRecurseHierarchy(root.children[c],hierarchy)};var hierarchy=[];if(root instanceof THREE.SkinnedMesh){for(var b=0;b<root.skeleton.bones.length;b++){hierarchy.push(root.skeleton.bones[b])}}else{parseRecurseHierarchy(root,hierarchy)}return hierarchy},play:function(animation){if(this.animations.indexOf(animation)===-1){this.animations.push(animation)}},stop:function(animation){var index=this.animations.indexOf(animation);if(index!==-1){this.animations.splice(index,1)}},update:function(deltaTimeMS){for(var i=0;i<this.animations.length;i++){this.animations[i].resetBlendWeights()}for(var i=0;i<this.animations.length;i++){this.animations[i].update(deltaTimeMS)}}};THREE.Animation=function(root,data){this.root=root;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(root);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(startTime,weight){this.currentTime=startTime!==undefined?startTime:0;this.weight=weight!==undefined?weight:1;this.isPlaying=true;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;THREE.AnimationHandler.stop(this)},reset:function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];if(object.animationCache===undefined){object.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}var name=this.data.name;var animations=object.animationCache.animations;var animationCache=animations[name];if(animationCache===undefined){animationCache={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:object.matrix};animations[name]=animationCache}for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=this.data.hierarchy[h].keys[0];var nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}}},resetBlendWeights:function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache;if(animationCache!==undefined){var blending=animationCache.blending;blending.positionWeight=0;blending.quaternionWeight=0;blending.scaleWeight=0}}},update:function(){var points=[];var target=new THREE.Vector3;var newVector=new THREE.Vector3;var newQuat=new THREE.Quaternion;var interpolateCatmullRom=function(points,scale){var c=[],v3=[],point,intPoint,weight,w2,w3,pa,pb,pc,pd;point=(points.length-1)*scale;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?intPoint:intPoint+1;c[3]=intPoint>points.length-3?intPoint:intPoint+2;pa=points[c[0]];pb=points[c[1]];pc=points[c[2]];pd=points[c[3]];w2=weight*weight;w3=weight*w2;v3[0]=interpolate(pa[0],pb[0],pc[0],pd[0],weight,w2,w3);v3[1]=interpolate(pa[1],pb[1],pc[1],pd[1],weight,w2,w3);v3[2]=interpolate(pa[2],pb[2],pc[2],pd[2],weight,w2,w3);return v3};var interpolate=function(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1};return function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;if(this.weight===0)return;var duration=this.data.length;if(this.currentTime>duration||this.currentTime<0){if(this.loop){this.currentTime%=duration;if(this.currentTime<0)this.currentTime+=duration;this.reset()}else{this.stop()}}for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache.animations[this.data.name];var blending=object.animationCache.blending;for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=animationCache.prevKey[type];var nextKey=animationCache.nextKey[type];if(this.timeScale>0&&nextKey.time<=this.currentTime||this.timeScale<0&&prevKey.time>=this.currentTime){prevKey=this.data.hierarchy[h].keys[0];nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}var scale=(this.currentTime-prevKey.time)/(nextKey.time-prevKey.time);var prevXYZ=prevKey[type];var nextXYZ=nextKey[type];if(scale<0)scale=0;if(scale>1)scale=1;if(type==="pos"){if(this.interpolationType===THREE.AnimationHandler.LINEAR){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.positionWeight);object.position.lerp(newVector,proportionalWeight);blending.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){points[0]=this.getPrevKeyWith("pos",h,prevKey.index-1)["pos"];points[1]=prevXYZ;points[2]=nextXYZ;points[3]=this.getNextKeyWith("pos",h,nextKey.index+1)["pos"];scale=scale*.33+.33;var currentPoint=interpolateCatmullRom(points,scale);var proportionalWeight=this.weight/(this.weight+blending.positionWeight);blending.positionWeight+=this.weight;var vector=object.position;vector.x=vector.x+(currentPoint[0]-vector.x)*proportionalWeight;vector.y=vector.y+(currentPoint[1]-vector.y)*proportionalWeight;vector.z=vector.z+(currentPoint[2]-vector.z)*proportionalWeight;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var forwardPoint=interpolateCatmullRom(points,scale*1.01);target.set(forwardPoint[0],forwardPoint[1],forwardPoint[2]);target.sub(vector);target.y=0;target.normalize();var angle=Math.atan2(target.x,target.z);object.rotation.set(0,angle,0)}}}else if(type==="rot"){THREE.Quaternion.slerp(prevXYZ,nextXYZ,newQuat,scale);if(blending.quaternionWeight===0){object.quaternion.copy(newQuat);blending.quaternionWeight=this.weight}else{var proportionalWeight=this.weight/(this.weight+blending.quaternionWeight);THREE.Quaternion.slerp(object.quaternion,newQuat,object.quaternion,proportionalWeight);blending.quaternionWeight+=this.weight}}else if(type==="scl"){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.scaleWeight);object.scale.lerp(newVector,proportionalWeight);blending.scaleWeight+=this.weight}}}return true}}(),getNextKeyWith:function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key<keys.length-1?key:keys.length-1}else{key=key%keys.length}for(;key<keys.length;key++){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[0]},getPrevKeyWith:function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key>0?key:0}else{key=key>=0?key:key+keys.length}for(;key>=0;key--){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[keys.length-1]}};THREE.KeyFrameAnimation=function(data){this.root=data.node;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var h=0,hl=this.hierarchy.length;h<hl;h++){var keys=this.data.hierarchy[h].keys,sids=this.data.hierarchy[h].sids,obj=this.hierarchy[h];if(keys.length&&sids){for(var s=0;s<sids.length;s++){var sid=sids[s],next=this.getNextKeyWith(sid,h,0);if(next){next.apply(sid)}}obj.matrixAutoUpdate=false;this.data.hierarchy[h].node.updateMatrix();obj.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(startTime){this.currentTime=startTime!==undefined?startTime:0;if(this.isPlaying===false){this.isPlaying=true;var h,hl=this.hierarchy.length,object,node;for(h=0;h<hl;h++){object=this.hierarchy[h];node=this.data.hierarchy[h];if(node.animationCache===undefined){node.animationCache={};node.animationCache.prevKey=null;node.animationCache.nextKey=null;node.animationCache.originalMatrix=object.matrix}var keys=this.data.hierarchy[h].keys;if(keys.length){node.animationCache.prevKey=keys[0];node.animationCache.nextKey=keys[1];this.startTime=Math.min(keys[0].time,this.startTime);this.endTime=Math.max(keys[keys.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.stop(this);for(var h=0;h<this.data.hierarchy.length;h++){var obj=this.hierarchy[h];var node=this.data.hierarchy[h];if(node.animationCache!==undefined){var original=node.animationCache.originalMatrix;original.copy(obj.matrix);obj.matrix=original;delete node.animationCache}}},update:function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;var duration=this.data.length;if(this.loop===true&&this.currentTime>duration){this.currentTime%=duration}this.currentTime=Math.min(this.currentTime,duration);for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var node=this.data.hierarchy[h];var keys=node.keys,animationCache=node.animationCache;if(keys.length){var prevKey=animationCache.prevKey;var nextKey=animationCache.nextKey;if(nextKey.time<=this.currentTime){while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=keys[prevKey.index+1]}animationCache.prevKey=prevKey;animationCache.nextKey=nextKey}if(nextKey.time>=this.currentTime){prevKey.interpolate(nextKey,this.currentTime)}else{prevKey.interpolate(nextKey,nextKey.time)}this.data.hierarchy[h].node.updateMatrix();object.matrixWorldNeedsUpdate=true}}},getNextKeyWith:function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key%keys.length;for(;key<keys.length;key++){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[0]},getPrevKeyWith:function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key>=0?key:key+keys.length;for(;key>=0;key--){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[keys.length-1]}};THREE.MorphAnimation=function(mesh){this.mesh=mesh;this.frames=mesh.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(delta){if(this.isPlaying===false)return;this.currentTime+=delta;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var frameTime=this.duration/this.frames;var frame=Math.floor(this.currentTime/frameTime);var influences=this.mesh.morphTargetInfluences;if(frame!==this.currentFrame){influences[this.lastFrame]=0;influences[this.currentFrame]=1;influences[frame]=0;this.lastFrame=this.currentFrame;this.currentFrame=frame}var mix=this.currentTime%frameTime/frameTime;influences[frame]=mix;influences[this.lastFrame]=1-mix}};THREE.BoxGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};this.widthSegments=widthSegments||1;this.heightSegments=heightSegments||1;this.depthSegments=depthSegments||1;var scope=this;var width_half=width/2;var height_half=height/2;var depth_half=depth/2;buildPlane("z","y",-1,-1,depth,height,width_half,0);buildPlane("z","y",1,-1,depth,height,-width_half,1);buildPlane("x","z",1,1,width,depth,height_half,2);buildPlane("x","z",1,-1,width,depth,-height_half,3);buildPlane("x","y",1,-1,width,height,depth_half,4);buildPlane("x","y",-1,-1,width,height,-depth_half,5);function buildPlane(u,v,udir,vdir,width,height,depth,materialIndex){var w,ix,iy,gridX=scope.widthSegments,gridY=scope.heightSegments,width_half=width/2,height_half=height/2,offset=scope.vertices.length;if(u==="x"&&v==="y"||u==="y"&&v==="x"){w="z"}else if(u==="x"&&v==="z"||u==="z"&&v==="x"){w="y";gridY=scope.depthSegments}else if(u==="z"&&v==="y"||u==="y"&&v==="z"){w="x";gridX=scope.depthSegments}var gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,normal=new THREE.Vector3;normal[w]=depth>0?1:-1;for(iy=0;iy<gridY1;iy++){for(ix=0;ix<gridX1;ix++){var vector=new THREE.Vector3;vector[u]=(ix*segment_width-width_half)*udir;vector[v]=(iy*segment_height-height_half)*vdir;vector[w]=depth;scope.vertices.push(vector)}}for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;var uva=new THREE.Vector2(ix/gridX,1-iy/gridY);var uvb=new THREE.Vector2(ix/gridX,1-(iy+1)/gridY);var uvc=new THREE.Vector2((ix+1)/gridX,1-(iy+1)/gridY);var uvd=new THREE.Vector2((ix+1)/gridX,1-iy/gridY);var face=new THREE.Face3(a+offset,b+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uva,uvb,uvd]);face=new THREE.Face3(b+offset,c+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}}this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.BoxGeometry.prototype.clone=function(){var geometry=new THREE.BoxGeometry(this.parameters.width,this.parameters.height,this.parameters.depth,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.depthSegments);return geometry};THREE.CubeGeometry=THREE.BoxGeometry;THREE.CircleGeometry=function(radius,segments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;segments=segments!==undefined?Math.max(3,segments):8;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;var i,uvs=[],center=new THREE.Vector3,centerUV=new THREE.Vector2(.5,.5);this.vertices.push(center);uvs.push(centerUV);for(i=0;i<=segments;i++){var vertex=new THREE.Vector3;var segment=thetaStart+i/segments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/radius+1)/2,(vertex.y/radius+1)/2))}var n=new THREE.Vector3(0,0,1);for(i=1;i<=segments;i++){this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[i].clone(),uvs[i+1].clone(),centerUV.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;THREE.CircleGeometry.prototype.clone=function(){var geometry=new THREE.CircleGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);return geometry};THREE.CircleBufferGeometry=function(radius,segments,thetaStart,thetaLength){THREE.BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;segments=segments!==undefined?Math.max(3,segments):8;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;var vertices=segments+2;var positions=new Float32Array(vertices*3);var normals=new Float32Array(vertices*3);var uvs=new Float32Array(vertices*2);normals[3]=1;uvs[0]=.5;uvs[1]=.5;for(var s=0,i=3,ii=2;s<=segments;s++,i+=3,ii+=2){var segment=thetaStart+s/segments*thetaLength;positions[i]=radius*Math.cos(segment);positions[i+1]=radius*Math.sin(segment);normals[i+2]=1;uvs[ii]=(positions[i]/radius+1)/2;uvs[ii+1]=(positions[i+1]/radius+1)/2}var indices=[];for(var i=1;i<=segments;i++){indices.push(i);indices.push(i+1);indices.push(0)}this.setIndex(new THREE.BufferAttribute(new Uint16Array(indices),1));this.addAttribute("position",new THREE.BufferAttribute(positions,3));this.addAttribute("normal",new THREE.BufferAttribute(normals,3));this.addAttribute("uv",new THREE.BufferAttribute(uvs,2));this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry;THREE.CircleBufferGeometry.prototype.clone=function(){var geometry=new THREE.CircleBufferGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);geometry.copy(this);return geometry};THREE.CylinderGeometry=function(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};radiusTop=radiusTop!==undefined?radiusTop:20;radiusBottom=radiusBottom!==undefined?radiusBottom:20;height=height!==undefined?height:100;radialSegments=radialSegments||8;heightSegments=heightSegments||1;openEnded=openEnded!==undefined?openEnded:false;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:2*Math.PI;var heightHalf=height/2;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];var v=y/heightSegments;var radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments;var vertex=new THREE.Vector3;vertex.x=radius*Math.sin(u*thetaLength+thetaStart);vertex.y=-v*height+heightHalf;vertex.z=radius*Math.cos(u*thetaLength+thetaStart);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}var tanTheta=(radiusBottom-radiusTop)/height;var na,nb;for(x=0;x<radialSegments;x++){if(radiusTop!==0){na=this.vertices[vertices[0][x]].clone();nb=this.vertices[vertices[0][x+1]].clone()}else{na=this.vertices[vertices[1][x]].clone();nb=this.vertices[vertices[1][x+1]].clone()}na.setY(Math.sqrt(na.x*na.x+na.z*na.z)*tanTheta).normalize();nb.setY(Math.sqrt(nb.x*nb.x+nb.z*nb.z)*tanTheta).normalize();for(y=0;y<heightSegments;y++){var v1=vertices[y][x];var v2=vertices[y+1][x];var v3=vertices[y+1][x+1];var v4=vertices[y][x+1];var n1=na.clone();var n2=na.clone();var n3=nb.clone();var n4=nb.clone();var uv1=uvs[y][x].clone();var uv2=uvs[y+1][x].clone();var uv3=uvs[y+1][x+1].clone();var uv4=uvs[y][x+1].clone();this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}if(openEnded===false&&radiusTop>0){this.vertices.push(new THREE.Vector3(0,heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[0][x];var v2=vertices[0][x+1];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,1,0);var n2=new THREE.Vector3(0,1,0);var n3=new THREE.Vector3(0,1,0);var uv1=uvs[0][x].clone();var uv2=uvs[0][x+1].clone();var uv3=new THREE.Vector2(uv2.x,0);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3],undefined,1));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}if(openEnded===false&&radiusBottom>0){this.vertices.push(new THREE.Vector3(0,-heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[heightSegments][x+1];var v2=vertices[heightSegments][x];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,-1,0);var n2=new THREE.Vector3(0,-1,0);var n3=new THREE.Vector3(0,-1,0);var uv1=uvs[heightSegments][x+1].clone();var uv2=uvs[heightSegments][x].clone();var uv3=new THREE.Vector2(uv2.x,1);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3],undefined,2));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.CylinderGeometry.prototype.clone=function(){var geometry=new THREE.CylinderGeometry(this.parameters.radiusTop,this.parameters.radiusBottom,this.parameters.height,this.parameters.radialSegments,this.parameters.heightSegments,this.parameters.openEnded,this.parameters.thetaStart,this.parameters.thetaLength);return geometry};THREE.EdgesGeometry=function(geometry,thresholdAngle){THREE.BufferGeometry.call(this);thresholdAngle=thresholdAngle!==undefined?thresholdAngle:1;var thresholdDot=Math.cos(THREE.Math.degToRad(thresholdAngle));var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry2;if(geometry instanceof THREE.BufferGeometry){geometry2=new THREE.Geometry;geometry2.fromBufferGeometry(geometry)}else{geometry2=geometry.clone()}geometry2.mergeVertices();geometry2.computeFaceNormals();var vertices=geometry2.vertices;var faces=geometry2.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){hash[key]={vert1:edge[0],vert2:edge[1],face1:i,face2:undefined}}else{hash[key].face2=i}}}var coords=[];for(var key in hash){var h=hash[key];if(h.face2===undefined||faces[h.face1].normal.dot(faces[h.face2].normal)<=thresholdDot){var vertex=vertices[h.vert1];coords.push(vertex.x);coords.push(vertex.y);coords.push(vertex.z);vertex=vertices[h.vert2];coords.push(vertex.x);coords.push(vertex.y);coords.push(vertex.z)}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(coords),3))};THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry;THREE.ExtrudeGeometry=function(shapes,options){if(typeof shapes==="undefined"){shapes=[];return}THREE.Geometry.call(this);this.type="ExtrudeGeometry";shapes=Array.isArray(shapes)?shapes:[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(shapes,options){var sl=shapes.length;for(var s=0;s<sl;s++){var shape=shapes[s];this.addShape(shape,options)}};THREE.ExtrudeGeometry.prototype.addShape=function(shape,options){var amount=options.amount!==undefined?options.amount:100;var bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:6;var bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-2;var bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;var bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var steps=options.steps!==undefined?options.steps:1;var extrudePath=options.extrudePath;var extrudePts,extrudeByPath=false;var uvgen=options.UVGenerator!==undefined?options.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=true;bevelEnabled=false;splineTube=options.frames!==undefined?options.frames:new THREE.TubeGeometry.FrenetFrames(extrudePath,steps,false);binormal=new THREE.Vector3;normal=new THREE.Vector3;position2=new THREE.Vector3}if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0}var ahole,h,hl;var scope=this;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];if(THREE.Shape.Utils.isClockWise(ahole)){holes[h]=ahole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole)}function scalePt2(pt,vec,size){if(!vec)console.error("THREE.ExtrudeGeometry: vec does not exist");return vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var EPSILON=1e-10;var v_trans_x,v_trans_y,shrink_by=1;var v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y;var v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y;var v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;var collinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(collinear0)>EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq);var v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y);var ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len;var ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len;var ptNextShift_x=inNext.x-v_next_y/v_next_len;var ptNextShift_y=inNext.y+v_next_x/v_next_len;var sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-(ptNextShift_y-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x);v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;var v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;if(v_trans_lensq<=2){return new THREE.Vector2(v_trans_x,v_trans_y)}else{shrink_by=Math.sqrt(v_trans_lensq/2)}}else{var direction_eq=false;if(v_prev_x>EPSILON){if(v_next_x>EPSILON){direction_eq=true}}else{if(v_prev_x<-EPSILON){if(v_next_x<-EPSILON){direction_eq=true}}else{if(Math.sign(v_prev_y)===Math.sign(v_next_y)){direction_eq=true}}}if(direction_eq){v_trans_x=-v_prev_y;v_trans_y=v_prev_x;shrink_by=Math.sqrt(v_prev_lensq)}else{v_trans_x=v_prev_x;v_trans_y=v_prev_y;shrink_by=Math.sqrt(v_prev_lensq/2)}}return new THREE.Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}var contourMovements=[];for(var i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k])}var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0,il=ahole.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k])}holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z)}}}bs=bevelSize;for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0)}else{normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s)}else{normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}}for(b=bevelSegments-1;b>=0;b--){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z)}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z)}}}}buildLidFaces();buildSideFaces();function buildLidFaces(){if(bevelEnabled){var layer=0;var offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset)}layer=steps+bevelSegments*2;offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset)}}else{for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0])}for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}}function buildSideFaces(){var layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);layeroffset+=ahole.length}}function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(--i>=0){j=i;k=i-1;if(k<0)k=contour.length-1;var s=0,sl=steps+bevelSegments*2;for(s=0;s<sl;s++){var slen1=vlen*s;var slen2=vlen*(s+1);var a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d,contour,s,sl,j,k)}}}function v(x,y,z){scope.vertices.push(new THREE.Vector3(x,y,z))}function f3(a,b,c){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,c));var uvs=uvgen.generateTopUV(scope,a,b,c);scope.faceVertexUvs[0].push(uvs)}function f4(a,b,c,d,wallContour,stepIndex,stepsLength,contourIndex1,contourIndex2){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;d+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,d));scope.faces.push(new THREE.Face3(b,c,d));var uvs=uvgen.generateSideWallUV(scope,a,b,c,d);scope.faceVertexUvs[0].push([uvs[0],uvs[1],uvs[3]]);scope.faceVertexUvs[0].push([uvs[1],uvs[2],uvs[3]])}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(geometry,indexA,indexB,indexC){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y)]},generateSideWallUV:function(geometry,indexA,indexB,indexC,indexD){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];var d=vertices[indexD];if(Math.abs(a.y-b.y)<.01){return[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z)]}else{return[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,1-d.z)]}}};THREE.ShapeGeometry=function(shapes,options){THREE.Geometry.call(this);this.type="ShapeGeometry";if(Array.isArray(shapes)===false)shapes=[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(shapes,options){for(var i=0,l=shapes.length;i<l;i++){this.addShape(shapes[i],options)}return this};THREE.ShapeGeometry.prototype.addShape=function(shape,options){if(options===undefined)options={};var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var material=options.material;var uvgen=options.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:options.UVGenerator;var i,l,hole;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(i=0,l=holes.length;i<l;i++){hole=holes[i];if(THREE.Shape.Utils.isClockWise(hole)){holes[i]=hole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);for(i=0,l=holes.length;i<l;i++){hole=holes[i];vertices=vertices.concat(hole)}var vert,vlen=vertices.length;var face,flen=faces.length;for(i=0;i<vlen;i++){vert=vertices[i];this.vertices.push(new THREE.Vector3(vert.x,vert.y,0))}for(i=0;i<flen;i++){face=faces[i];var a=face[0]+shapesOffset;var b=face[1]+shapesOffset;var c=face[2]+shapesOffset;this.faces.push(new THREE.Face3(a,b,c,null,null,material));this.faceVertexUvs[0].push(uvgen.generateTopUV(this,a,b,c))}};THREE.LatheGeometry=function(points,segments,phiStart,phiLength){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};segments=segments||12;phiStart=phiStart||0;phiLength=phiLength||2*Math.PI;var inversePointLength=1/(points.length-1);var inverseSegments=1/segments;for(var i=0,il=segments;i<=il;i++){var phi=phiStart+i*inverseSegments*phiLength;var c=Math.cos(phi),s=Math.sin(phi);for(var j=0,jl=points.length;j<jl;j++){var pt=points[j];var vertex=new THREE.Vector3;vertex.x=c*pt.x-s*pt.y;vertex.y=s*pt.x+c*pt.y;vertex.z=pt.z;this.vertices.push(vertex)}}var np=points.length;for(var i=0,il=segments;i<il;i++){for(var j=0,jl=points.length-1;j<jl;j++){var base=j+np*i;var a=base;var b=base+np;var c=base+1+np;var d=base+1;var u0=i*inverseSegments;var v0=j*inversePointLength;var u1=u0+inverseSegments;var v1=v0+inversePointLength;this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([new THREE.Vector2(u0,v0),new THREE.Vector2(u1,v0),new THREE.Vector2(u0,v1)]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([new THREE.Vector2(u1,v0),new THREE.Vector2(u1,v1),new THREE.Vector2(u0,v1)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(width,height,widthSegments,heightSegments){THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width,height,widthSegments,heightSegments))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.PlaneGeometry.prototype.clone=function(){var geometry=new THREE.PlaneGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);return geometry};THREE.PlaneBufferGeometry=function(width,height,widthSegments,heightSegments){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};var width_half=width/2;var height_half=height/2;var gridX=Math.floor(widthSegments)||1;var gridY=Math.floor(heightSegments)||1;var gridX1=gridX+1;var gridY1=gridY+1;var segment_width=width/gridX;var segment_height=height/gridY;var vertices=new Float32Array(gridX1*gridY1*3);var normals=new Float32Array(gridX1*gridY1*3);var uvs=new Float32Array(gridX1*gridY1*2);var offset=0;var offset2=0;for(var iy=0;iy<gridY1;iy++){var y=iy*segment_height-height_half;for(var ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices[offset]=x;vertices[offset+1]=-y;normals[offset+2]=1;uvs[offset2]=ix/gridX;uvs[offset2+1]=1-iy/gridY;offset+=3;offset2+=2}}offset=0;var indices=new(vertices.length/3>65535?Uint32Array:Uint16Array)(gridX*gridY*6);for(var iy=0;iy<gridY;iy++){for(var ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;indices[offset]=a;indices[offset+1]=b;indices[offset+2]=d;indices[offset+3]=b;indices[offset+4]=c;indices[offset+5]=d;offset+=6}}this.setIndex(new THREE.BufferAttribute(indices,1));this.addAttribute("position",new THREE.BufferAttribute(vertices,3));this.addAttribute("normal",new THREE.BufferAttribute(normals,3));this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;THREE.PlaneBufferGeometry.prototype.clone=function(){var geometry=new THREE.PlaneBufferGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);geometry.copy(this);return geometry};THREE.RingGeometry=function(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};innerRadius=innerRadius||0;outerRadius=outerRadius||50;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;thetaSegments=thetaSegments!==undefined?Math.max(3,thetaSegments):8;phiSegments=phiSegments!==undefined?Math.max(1,phiSegments):8;var i,o,uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments;for(i=0;i<phiSegments+1;i++){for(o=0;o<thetaSegments+1;o++){var vertex=new THREE.Vector3;var segment=thetaStart+o/thetaSegments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/outerRadius+1)/2,(vertex.y/outerRadius+1)/2))}radius+=radiusStep}var n=new THREE.Vector3(0,0,1);for(i=0;i<phiSegments;i++){var thetaSegment=i*(thetaSegments+1);for(o=0;o<thetaSegments;o++){var segment=o+thetaSegment;var v1=segment;var v2=segment+thetaSegments+1;var v3=segment+thetaSegments+2;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()]);v1=segment;v2=segment+thetaSegments+2;v3=segment+1;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.RingGeometry.prototype.clone=function(){var geometry=new THREE.RingGeometry(this.parameters.innerRadius,this.parameters.outerRadius,this.parameters.thetaSegments,this.parameters.phiSegments,this.parameters.thetaStart,this.parameters.thetaLength);return geometry};THREE.SphereGeometry=function(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new THREE.SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength))};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.SphereGeometry.prototype.clone=function(){var geometry=new THREE.SphereGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);return geometry};THREE.SphereBufferGeometry=function(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){THREE.BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;widthSegments=Math.max(3,Math.floor(widthSegments)||8);heightSegments=Math.max(2,Math.floor(heightSegments)||6);phiStart=phiStart!==undefined?phiStart:0;phiLength=phiLength!==undefined?phiLength:Math.PI*2;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI;var thetaEnd=thetaStart+thetaLength;var vertexCount=(widthSegments+1)*(heightSegments+1);var positions=new THREE.BufferAttribute(new Float32Array(vertexCount*3),3);var normals=new THREE.BufferAttribute(new Float32Array(vertexCount*3),3);var uvs=new THREE.BufferAttribute(new Float32Array(vertexCount*2),2);var index=0,vertices=[],normal=new THREE.Vector3;for(var y=0;y<=heightSegments;y++){var verticesRow=[];var v=y/heightSegments;for(var x=0;x<=widthSegments;x++){var u=x/widthSegments;var px=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);var py=radius*Math.cos(thetaStart+v*thetaLength);var pz=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);normal.set(px,py,pz).normalize();positions.setXYZ(index,px,py,pz);normals.setXYZ(index,normal.x,normal.y,normal.z);uvs.setXY(index,u,1-v);verticesRow.push(index);index++}vertices.push(verticesRow)}var indices=[];for(var y=0;y<heightSegments;y++){for(var x=0;x<widthSegments;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=vertices[y+1][x];var v4=vertices[y+1][x+1];if(y!==0||thetaStart>0)indices.push(v1,v2,v4);if(y!==heightSegments-1||thetaEnd<Math.PI)indices.push(v2,v3,v4)}}this.setIndex(new THREE.BufferAttribute(new Uint16Array(indices),1));this.addAttribute("position",positions);this.addAttribute("normal",normals);this.addAttribute("uv",uvs);this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;THREE.SphereBufferGeometry.prototype.clone=function(){var geometry=new THREE.SphereBufferGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);geometry.copy(this);return geometry};THREE.TextGeometry=function(text,parameters){parameters=parameters||{};var textShapes=THREE.FontUtils.generateShapes(text,parameters);parameters.amount=parameters.height!==undefined?parameters.height:50;if(parameters.bevelThickness===undefined)parameters.bevelThickness=10;if(parameters.bevelSize===undefined)parameters.bevelSize=8;if(parameters.bevelEnabled===undefined)parameters.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,textShapes,parameters);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TorusGeometry=function(radius,tube,radialSegments,tubularSegments,arc){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};radius=radius||100;tube=tube||40;radialSegments=radialSegments||8;tubularSegments=tubularSegments||6;arc=arc||Math.PI*2;var center=new THREE.Vector3,uvs=[],normals=[];for(var j=0;j<=radialSegments;j++){for(var i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc;var v=j/radialSegments*Math.PI*2;center.x=radius*Math.cos(u);center.y=radius*Math.sin(u);var vertex=new THREE.Vector3;vertex.x=(radius+tube*Math.cos(v))*Math.cos(u);vertex.y=(radius+tube*Math.cos(v))*Math.sin(u);vertex.z=tube*Math.sin(v);this.vertices.push(vertex);uvs.push(new THREE.Vector2(i/tubularSegments,j/radialSegments));normals.push(vertex.clone().sub(center).normalize())}}for(var j=1;j<=radialSegments;j++){for(var i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1;var b=(tubularSegments+1)*(j-1)+i-1;var c=(tubularSegments+1)*(j-1)+i;var d=(tubularSegments+1)*j+i;var face=new THREE.Face3(a,b,d,[normals[a].clone(),normals[b].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[a].clone(),uvs[b].clone(),uvs[d].clone()]);face=new THREE.Face3(b,c,d,[normals[b].clone(),normals[c].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[b].clone(),uvs[c].clone(),uvs[d].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusGeometry.prototype.clone=function(){var geometry=new THREE.TorusGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.arc);return geometry};THREE.TorusKnotGeometry=function(radius,tube,radialSegments,tubularSegments,p,q,heightScale){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,p:p,q:q,heightScale:heightScale};radius=radius||100;tube=tube||40;radialSegments=radialSegments||64;tubularSegments=tubularSegments||8;p=p||2;q=q||3;heightScale=heightScale||1;var grid=new Array(radialSegments);var tang=new THREE.Vector3;var n=new THREE.Vector3;var bitan=new THREE.Vector3;for(var i=0;i<radialSegments;++i){grid[i]=new Array(tubularSegments);var u=i/radialSegments*2*p*Math.PI;var p1=getPos(u,q,p,radius,heightScale);var p2=getPos(u+.01,q,p,radius,heightScale);tang.subVectors(p2,p1);n.addVectors(p2,p1);bitan.crossVectors(tang,n);n.crossVectors(bitan,tang);bitan.normalize();n.normalize();for(var j=0;j<tubularSegments;++j){var v=j/tubularSegments*2*Math.PI;var cx=-tube*Math.cos(v);var cy=tube*Math.sin(v);var pos=new THREE.Vector3;pos.x=p1.x+cx*n.x+cy*bitan.x;pos.y=p1.y+cx*n.y+cy*bitan.y;pos.z=p1.z+cx*n.z+cy*bitan.z;grid[i][j]=this.vertices.push(pos)-1}}for(var i=0;i<radialSegments;++i){for(var j=0;j<tubularSegments;++j){var ip=(i+1)%radialSegments;var jp=(j+1)%tubularSegments;var a=grid[i][j];var b=grid[ip][j];var c=grid[ip][jp];var d=grid[i][jp];var uva=new THREE.Vector2(i/radialSegments,j/tubularSegments);var uvb=new THREE.Vector2((i+1)/radialSegments,j/tubularSegments);var uvc=new THREE.Vector2((i+1)/radialSegments,(j+1)/tubularSegments);var uvd=new THREE.Vector2(i/radialSegments,(j+1)/tubularSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function getPos(u,in_q,in_p,radius,heightScale){var cu=Math.cos(u);var su=Math.sin(u);var quOverP=in_q/in_p*u;var cs=Math.cos(quOverP);var tx=radius*(2+cs)*.5*cu;var ty=radius*(2+cs)*su*.5;var tz=heightScale*radius*Math.sin(quOverP)*.5;return new THREE.Vector3(tx,ty,tz)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TorusKnotGeometry.prototype.clone=function(){var geometry=new THREE.TorusKnotGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.p,this.parameters.q,this.parameters.heightScale);return geometry};THREE.TubeGeometry=function(path,segments,radius,radialSegments,closed,taper){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:path,segments:segments,radius:radius,radialSegments:radialSegments,closed:closed};segments=segments||64;radius=radius||1;radialSegments=radialSegments||8;closed=closed||false;taper=taper||THREE.TubeGeometry.NoTaper;var grid=[];var scope=this,tangent,normal,binormal,numpoints=segments+1,u,v,r,cx,cy,pos,pos2=new THREE.Vector3,i,j,ip,jp,a,b,c,d,uva,uvb,uvc,uvd;var frames=new THREE.TubeGeometry.FrenetFrames(path,segments,closed),tangents=frames.tangents,normals=frames.normals,binormals=frames.binormals;this.tangents=tangents;this.normals=normals;this.binormals=binormals;function vert(x,y,z){return scope.vertices.push(new THREE.Vector3(x,y,z))-1}for(i=0;i<numpoints;i++){grid[i]=[];u=i/(numpoints-1);pos=path.getPointAt(u);tangent=tangents[i];normal=normals[i];binormal=binormals[i];r=radius*taper(u);for(j=0;j<radialSegments;j++){v=j/radialSegments*2*Math.PI;cx=-r*Math.cos(v);cy=r*Math.sin(v);pos2.copy(pos);pos2.x+=cx*normal.x+cy*binormal.x;pos2.y+=cx*normal.y+cy*binormal.y;pos2.z+=cx*normal.z+cy*binormal.z;grid[i][j]=vert(pos2.x,pos2.y,pos2.z)}}for(i=0;i<segments;i++){for(j=0;j<radialSegments;j++){ip=closed?(i+1)%segments:i+1;jp=(j+1)%radialSegments;a=grid[i][j];b=grid[ip][j];c=grid[ip][jp];d=grid[i][jp];uva=new THREE.Vector2(i/segments,j/radialSegments);uvb=new THREE.Vector2((i+1)/segments,j/radialSegments);uvc=new THREE.Vector2((i+1)/segments,(j+1)/radialSegments);uvd=new THREE.Vector2(i/segments,(j+1)/radialSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(u){return 1};THREE.TubeGeometry.SinusoidalTaper=function(u){return Math.sin(Math.PI*u)};THREE.TubeGeometry.FrenetFrames=function(path,segments,closed){var normal=new THREE.Vector3,tangents=[],normals=[],binormals=[],vec=new THREE.Vector3,mat=new THREE.Matrix4,numpoints=segments+1,theta,epsilon=1e-4,smallest,tx,ty,tz,i,u;this.tangents=tangents;this.normals=normals;this.binormals=binormals;for(i=0;i<numpoints;i++){u=i/(numpoints-1);tangents[i]=path.getTangentAt(u);tangents[i].normalize()}initialNormal3();function initialNormal3(){normals[0]=new THREE.Vector3;binormals[0]=new THREE.Vector3;smallest=Number.MAX_VALUE;tx=Math.abs(tangents[0].x);ty=Math.abs(tangents[0].y);tz=Math.abs(tangents[0].z);if(tx<=smallest){smallest=tx;normal.set(1,0,0)}if(ty<=smallest){smallest=ty;normal.set(0,1,0)}if(tz<=smallest){normal.set(0,0,1)}vec.crossVectors(tangents[0],normal).normalize();normals[0].crossVectors(tangents[0],vec);binormals[0].crossVectors(tangents[0],normals[0])}for(i=1;i<numpoints;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.crossVectors(tangents[i-1],tangents[i]);if(vec.length()>epsilon){vec.normalize();theta=Math.acos(THREE.Math.clamp(tangents[i-1].dot(tangents[i]),-1,1));normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))}binormals[i].crossVectors(tangents[i],normals[i])}if(closed){theta=Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints-1]),-1,1));theta/=numpoints-1;if(tangents[0].dot(vec.crossVectors(normals[0],normals[numpoints-1]))>0){theta=-theta}for(i=1;i<numpoints;i++){normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i));binormals[i].crossVectors(tangents[i],normals[i])}}};THREE.PolyhedronGeometry=function(vertices,indices,radius,detail){THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};radius=radius||1;detail=detail||0;var that=this;for(var i=0,l=vertices.length;i<l;i+=3){prepare(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]))}var p=this.vertices;var faces=[];for(var i=0,j=0,l=indices.length;i<l;i+=3,j++){var v1=p[indices[i]];var v2=p[indices[i+1]];var v3=p[indices[i+2]];faces[j]=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()],undefined,j)}var centroid=new THREE.Vector3;for(var i=0,l=faces.length;i<l;i++){subdivide(faces[i],detail)}for(var i=0,l=this.faceVertexUvs[0].length;i<l;i++){var uvs=this.faceVertexUvs[0][i];var x0=uvs[0].x;var x1=uvs[1].x;var x2=uvs[2].x;var max=Math.max(x0,Math.max(x1,x2));var min=Math.min(x0,Math.min(x1,x2));if(max>.9&&min<.1){if(x0<.2)uvs[0].x+=1;if(x1<.2)uvs[1].x+=1;if(x2<.2)uvs[2].x+=1}}for(var i=0,l=this.vertices.length;i<l;i++){this.vertices[i].multiplyScalar(radius)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius);function prepare(vector){var vertex=vector.normalize().clone();vertex.index=that.vertices.push(vertex)-1;var u=azimuth(vector)/2/Math.PI+.5;var v=inclination(vector)/Math.PI+.5;vertex.uv=new THREE.Vector2(u,1-v);return vertex}function make(v1,v2,v3,materialIndex){var face=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()],undefined,materialIndex);that.faces.push(face);centroid.copy(v1).add(v2).add(v3).divideScalar(3);var azi=azimuth(centroid);that.faceVertexUvs[0].push([correctUV(v1.uv,v1,azi),correctUV(v2.uv,v2,azi),correctUV(v3.uv,v3,azi)])}function subdivide(face,detail){var cols=Math.pow(2,detail);var a=prepare(that.vertices[face.a]);var b=prepare(that.vertices[face.b]);var c=prepare(that.vertices[face.c]);var v=[];var materialIndex=face.materialIndex;for(var i=0;i<=cols;i++){v[i]=[];var aj=prepare(a.clone().lerp(c,i/cols));var bj=prepare(b.clone().lerp(c,i/cols));var rows=cols-i;for(var j=0;j<=rows;j++){if(j===0&&i===cols){v[i][j]=aj}else{v[i][j]=prepare(aj.clone().lerp(bj,j/rows))}}}for(var i=0;i<cols;i++){for(var j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);if(j%2===0){make(v[i][k+1],v[i+1][k],v[i][k],materialIndex)}else{make(v[i][k+1],v[i+1][k+1],v[i+1][k],materialIndex)}}}}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}function inclination(vector){return Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))}function correctUV(uv,vector,azimuth){if(azimuth<0&&uv.x===1)uv=new THREE.Vector2(uv.x-1,uv.y);if(vector.x===0&&vector.z===0)uv=new THREE.Vector2(azimuth/2/Math.PI+.5,uv.y);return uv.clone()}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.PolyhedronGeometry.prototype.clone=function(){var geometry=new THREE.PolyhedronGeometry(this.parameters.vertices,this.parameters.indices,this.parameters.radius,this.parameters.detail);return geometry.copy(this)};THREE.PolyhedronGeometry.prototype.copy=function(source){THREE.Geometry.prototype.copy.call(this,source);return this};THREE.DodecahedronGeometry=function(radius,detail){var t=(1+Math.sqrt(5))/2;var r=1/t;var vertices=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r];var indices=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="DodecahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;THREE.DodecahedronGeometry.prototype.clone=function(){var geometry=new THREE.DodecahedronGeometry(this.parameters.radius,this.parameters.detail);geometry.copy(this);return geometry};THREE.IcosahedronGeometry=function(radius,detail){var t=(1+Math.sqrt(5))/2;var vertices=[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1];var indices=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="IcosahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.IcosahedronGeometry.prototype.clone=function(){var geometry=new THREE.IcosahedronGeometry(this.parameters.radius,this.parameters.detail);geometry.copy(this);return geometry};THREE.OctahedronGeometry=function(radius,detail){var vertices=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var indices=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="OctahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.OctahedronGeometry.prototype.clone=function(){var geometry=new THREE.OctahedronGeometry(this.parameters.radius,this.parameters.detail);geometry.copy(this);return geometry};THREE.TetrahedronGeometry=function(radius,detail){var vertices=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var indices=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="TetrahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.TetrahedronGeometry.prototype.clone=function(){var geometry=new THREE.TetrahedronGeometry(this.parameters.radius,this.parameters.detail);geometry.copy(this);return geometry};THREE.ParametricGeometry=function(func,slices,stacks){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:func,slices:slices,stacks:stacks};var verts=this.vertices;var faces=this.faces;var uvs=this.faceVertexUvs[0];var i,j,p;var u,v;var sliceCount=slices+1;for(i=0;i<=stacks;i++){v=i/stacks;for(j=0;j<=slices;j++){u=j/slices;p=func(u,v);verts.push(p)}}var a,b,c,d;var uva,uvb,uvc,uvd;for(i=0;i<stacks;i++){for(j=0;j<slices;j++){a=i*sliceCount+j;b=i*sliceCount+j+1;c=(i+1)*sliceCount+j+1;d=(i+1)*sliceCount+j;uva=new THREE.Vector2(j/slices,i/stacks);uvb=new THREE.Vector2((j+1)/slices,i/stacks);uvc=new THREE.Vector2((j+1)/slices,(i+1)/stacks);uvd=new THREE.Vector2(j/slices,(i+1)/stacks);faces.push(new THREE.Face3(a,b,d));uvs.push([uva,uvb,uvd]);faces.push(new THREE.Face3(b,c,d));uvs.push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.WireframeGeometry=function(geometry){THREE.BufferGeometry.call(this);var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var faces=geometry.faces;var numEdges=0;var edges=new Uint32Array(6*faces.length);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var vertex=vertices[edges[2*i+j]];var index=6*i+3*j;coords[index+0]=vertex.x;coords[index+1]=vertex.y;coords[index+2]=vertex.z}}this.addAttribute("position",new THREE.BufferAttribute(coords,3))}else if(geometry instanceof THREE.BufferGeometry){if(geometry.index!==null){var indices=geometry.index.array;var vertices=geometry.attributes.position;var drawcalls=geometry.drawcalls;var numEdges=0;if(drawcalls.length===0){geometry.addDrawCall(0,indices.length)}var edges=new Uint32Array(2*indices.length);for(var o=0,ol=drawcalls.length;o<ol;++o){var drawcall=drawcalls[o];var start=drawcall.start;var count=drawcall.count;for(var i=start,il=start+count;i<il;i+=3){for(var j=0;j<3;j++){edge[0]=indices[i+j];edge[1]=indices[i+(j+1)%3];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var index=6*i+3*j;var index2=edges[2*i+j];coords[index+0]=vertices.getX(index2);coords[index+1]=vertices.getY(index2);coords[index+2]=vertices.getZ(index2)}}this.addAttribute("position",new THREE.BufferAttribute(coords,3))}else{var vertices=geometry.attributes.position.array;var numEdges=vertices.length/3;var numTris=numEdges/3;var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numTris;i<l;i++){for(var j=0;j<3;j++){var index=18*i+6*j;var index1=9*i+3*j;coords[index+0]=vertices[index1];coords[index+1]=vertices[index1+1];coords[index+2]=vertices[index1+2];var index2=9*i+3*((j+1)%3);coords[index+3]=vertices[index2];coords[index+4]=vertices[index2+1];coords[index+5]=vertices[index2+2]}}this.addAttribute("position",new THREE.BufferAttribute(coords,3))}}};THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry;THREE.AxisHelper=function(size){size=size||1;var vertices=new Float32Array([0,0,0,size,0,0,0,0,0,0,size,0,0,0,0,0,0,size]);var colors=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("color",new THREE.BufferAttribute(colors,3));var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,geometry,material)};THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(){var lineGeometry=new THREE.Geometry;lineGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var coneGeometry=new THREE.CylinderGeometry(0,.5,1,5,1);coneGeometry.translate(0,-.5,0);return function ArrowHelper(dir,origin,length,color,headLength,headWidth){THREE.Object3D.call(this);if(color===undefined)color=16776960;if(length===undefined)length=1;if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.position.copy(origin);if(headLength<length){this.line=new THREE.Line(lineGeometry,new THREE.LineBasicMaterial({color:color}));this.line.matrixAutoUpdate=false;this.add(this.line)}this.cone=new THREE.Mesh(coneGeometry,new THREE.MeshBasicMaterial({color:color}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(dir);this.setLength(length,headLength,headWidth)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var axis=new THREE.Vector3;var radians;return function setDirection(dir){if(dir.y>.99999){this.quaternion.set(0,0,0,1)}else if(dir.y<-.99999){this.quaternion.set(1,0,0,0)}else{axis.set(dir.z,0,-dir.x).normalize();radians=Math.acos(dir.y);this.quaternion.setFromAxisAngle(axis,radians)}}}();THREE.ArrowHelper.prototype.setLength=function(length,headLength,headWidth){if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;if(headLength<length){this.line.scale.set(1,length-headLength,1);this.line.updateMatrix()}this.cone.scale.set(headWidth,headLength,headWidth);this.cone.position.y=length;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(color){if(this.line!==undefined)this.line.material.color.set(color);this.cone.material.color.set(color)};THREE.BoxHelper=function(object){var indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var positions=new Float32Array(8*3);var geometry=new THREE.BufferGeometry;geometry.setIndex(new THREE.BufferAttribute(indices,1));geometry.addAttribute("position",new THREE.BufferAttribute(positions,3));THREE.LineSegments.call(this,geometry,new THREE.LineBasicMaterial({color:16776960}));if(object!==undefined){this.update(object)}};THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;THREE.BoxHelper.prototype.update=function(){var box=new THREE.Box3;return function(object){box.setFromObject(object);if(box.empty())return;var min=box.min;var max=box.max;var position=this.geometry.attributes.position;var array=position.array;array[0]=max.x;array[1]=max.y;array[2]=max.z;array[3]=min.x;array[4]=max.y;array[5]=max.z;array[6]=min.x;array[7]=min.y;array[8]=max.z;array[9]=max.x;array[10]=min.y;array[11]=max.z;array[12]=max.x;array[13]=max.y;array[14]=min.z;array[15]=min.x;array[16]=max.y;array[17]=min.z;array[18]=min.x;array[19]=min.y;array[20]=min.z;array[21]=max.x;array[22]=min.y;array[23]=min.z;position.needsUpdate=true;this.geometry.computeBoundingSphere()}}();THREE.BoundingBoxHelper=function(object,hex){var color=hex!==undefined?hex:8947848;this.object=object;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:color,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(camera){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var pointMap={};var hexFrustum=16755200;var hexCone=16711680;var hexUp=43775;var hexTarget=16777215;var hexCross=3355443;addLine("n1","n2",hexFrustum);addLine("n2","n4",hexFrustum);addLine("n4","n3",hexFrustum);addLine("n3","n1",hexFrustum);addLine("f1","f2",hexFrustum);addLine("f2","f4",hexFrustum);addLine("f4","f3",hexFrustum);addLine("f3","f1",hexFrustum);addLine("n1","f1",hexFrustum);addLine("n2","f2",hexFrustum);addLine("n3","f3",hexFrustum);addLine("n4","f4",hexFrustum);addLine("p","n1",hexCone);addLine("p","n2",hexCone);addLine("p","n3",hexCone);addLine("p","n4",hexCone);addLine("u1","u2",hexUp);addLine("u2","u3",hexUp);addLine("u3","u1",hexUp);addLine("c","t",hexTarget);addLine("p","c",hexCross);addLine("cn1","cn2",hexCross);addLine("cn3","cn4",hexCross);addLine("cf1","cf2",hexCross);addLine("cf3","cf4",hexCross);function addLine(a,b,hex){addPoint(a,hex);addPoint(b,hex)}function addPoint(id,hex){geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(hex));if(pointMap[id]===undefined){pointMap[id]=[]}pointMap[id].push(geometry.vertices.length-1)}THREE.LineSegments.call(this,geometry,material);this.camera=camera;this.matrix=camera.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=pointMap;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){var geometry,pointMap;var vector=new THREE.Vector3;var camera=new THREE.Camera;var setPoint=function(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(points!==undefined){for(var i=0,il=points.length;i<il;i++){geometry.vertices[points[i]].copy(vector)}}};return function(){geometry=this.geometry;pointMap=this.pointMap;var w=1,h=1;camera.projectionMatrix.copy(this.camera.projectionMatrix);setPoint("c",0,0,-1);setPoint("t",0,0,1);setPoint("n1",-w,-h,-1);setPoint("n2",w,-h,-1);setPoint("n3",-w,h,-1);setPoint("n4",w,h,-1);setPoint("f1",-w,-h,1);setPoint("f2",w,-h,1);setPoint("f3",-w,h,1);setPoint("f4",w,h,1);setPoint("u1",w*.7,h*1.1,-1);setPoint("u2",-w*.7,h*1.1,-1);setPoint("u3",0,h*2,-1);setPoint("cf1",-w,0,1);setPoint("cf2",w,0,1);setPoint("cf3",0,-h,1);setPoint("cf4",0,h,1);setPoint("cn1",-w,0,-1);setPoint("cn2",w,0,-1);setPoint("cn3",0,-h,-1);setPoint("cn4",0,h,-1);geometry.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(light,size){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;size=size||1;var geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3(-size,size,0),new THREE.Vector3(size,size,0),new THREE.Vector3(size,-size,0),new THREE.Vector3(-size,-size,0),new THREE.Vector3(-size,size,0));var material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(geometry,material);this.add(this.lightPlane);geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3,new THREE.Vector3);material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(geometry,material);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var v3=new THREE.Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld);v2.setFromMatrixPosition(this.light.target.matrixWorld);v3.subVectors(v2,v1);this.lightPlane.lookAt(v3);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(v3);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(object,hex,thresholdAngle){var color=hex!==undefined?hex:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(object.geometry,thresholdAngle),new THREE.LineBasicMaterial({color:color}));this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;THREE.FaceNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16776960;var width=linewidth!==undefined?linewidth:1;var nNormals=0;var objGeometry=this.object.geometry;if(objGeometry instanceof THREE.Geometry){nNormals=objGeometry.faces.length}else{console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.")}var geometry=new THREE.BufferGeometry;var positions=new THREE.Float32Attribute(nNormals*2*3,3);geometry.addAttribute("position",positions);THREE.LineSegments.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}));this.matrixAutoUpdate=false;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;THREE.FaceNormalsHelper.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var normalMatrix=new THREE.Matrix3;return function update(){this.object.updateMatrixWorld(true);normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld;var position=this.geometry.attributes.position;var objGeometry=this.object.geometry;var vertices=objGeometry.vertices;var faces=objGeometry.faces;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];var normal=face.normal;v1.copy(vertices[face.a]).add(vertices[face.b]).add(vertices[face.c]).divideScalar(3).applyMatrix4(matrixWorld);v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1}position.needsUpdate=true;return this}}();THREE.GridHelper=function(size,step){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var i=-size;i<=size;i+=step){geometry.vertices.push(new THREE.Vector3(-size,0,i),new THREE.Vector3(size,0,i),new THREE.Vector3(i,0,-size),new THREE.Vector3(i,0,size));var color=i===0?this.color1:this.color2;geometry.colors.push(color,color,color,color)}THREE.LineSegments.call(this,geometry,material)};THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(colorCenterLine,colorGrid){this.color1.set(colorCenterLine);this.color2.set(colorGrid);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(light,sphereSize){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color,new THREE.Color];var geometry=new THREE.SphereGeometry(sphereSize,4,2);geometry.rotateX(-Math.PI/2);for(var i=0,il=8;i<il;i++){geometry.faces[i].color=this.colors[i<4?0:1]}var material=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(geometry,material);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var vector=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(light,sphereSize){this.light=light;this.light.updateMatrixWorld();var geometry=new THREE.SphereGeometry(sphereSize,4,2);var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,geometry,material);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(object){this.bones=this.getBoneList(object);var geometry=new THREE.Geometry;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(0,0,1));geometry.colors.push(new THREE.Color(0,1,0))}}geometry.dynamic=true;var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:false,depthWrite:false,transparent:true});THREE.LineSegments.call(this,geometry,material);this.root=object;this.matrix=object.matrixWorld;this.matrixAutoUpdate=false;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(object){var boneList=[];if(object instanceof THREE.Bone){boneList.push(object)}for(var i=0;i<object.children.length;i++){boneList.push.apply(boneList,this.getBoneList(object.children[i]))}return boneList};THREE.SkeletonHelper.prototype.update=function(){var geometry=this.geometry;var matrixWorldInv=(new THREE.Matrix4).getInverse(this.root.matrixWorld);var boneMatrix=new THREE.Matrix4;var j=0;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld);geometry.vertices[j].setFromMatrixPosition(boneMatrix);boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld);geometry.vertices[j+1].setFromMatrixPosition(boneMatrix);j+=2}}geometry.verticesNeedUpdate=true;geometry.computeBoundingSphere()};THREE.SpotLightHelper=function(light){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;var geometry=new THREE.CylinderGeometry(0,1,1,8,1,true);geometry.translate(0,-.5,0);geometry.rotateX(-Math.PI/2);var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(geometry,material);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var vector=new THREE.Vector3;var vector2=new THREE.Vector3;return function(){var coneLength=this.light.distance?this.light.distance:1e4;var coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength);vector.setFromMatrixPosition(this.light.matrixWorld);vector2.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(vector2.sub(vector));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16711680;var width=linewidth!==undefined?linewidth:1;var nNormals=0;var objGeometry=this.object.geometry;if(objGeometry instanceof THREE.Geometry){nNormals=objGeometry.faces.length*3}else if(objGeometry instanceof THREE.BufferGeometry){nNormals=objGeometry.attributes.normal.count}var geometry=new THREE.BufferGeometry;var positions=new THREE.Float32Attribute(nNormals*2*3,3);geometry.addAttribute("position",positions);THREE.LineSegments.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}));this.matrixAutoUpdate=false;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;THREE.VertexNormalsHelper.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var normalMatrix=new THREE.Matrix3;return function update(){var keys=["a","b","c"];this.object.updateMatrixWorld(true);normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld;var position=this.geometry.attributes.position;var objGeometry=this.object.geometry;if(objGeometry instanceof THREE.Geometry){var vertices=objGeometry.vertices;var faces=objGeometry.faces;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){var vertex=vertices[face[keys[j]]];var normal=face.vertexNormals[j];v1.copy(vertex).applyMatrix4(matrixWorld);v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1}}}else if(objGeometry instanceof THREE.BufferGeometry){var objPos=objGeometry.attributes.position;var objNorm=objGeometry.attributes.normal;var idx=0;for(var j=0,jl=objPos.count;j<jl;j++){v1.set(objPos.getX(j),objPos.getY(j),objPos.getZ(j)).applyMatrix4(matrixWorld);v2.set(objNorm.getX(j),objNorm.getY(j),objNorm.getZ(j));v2.applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1}}position.needsUpdate=true;return this}}();THREE.WireframeHelper=function(object,hex){var color=hex!==undefined?hex:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(object.geometry),new THREE.LineBasicMaterial({color:color}));this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(renderCallback){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.animationsMap={};this.animationsList=[];var numFrames=this.geometry.morphTargets.length;var name="__default";var startFrame=0;var endFrame=numFrames-1;var fps=numFrames/1;this.createAnimation(name,startFrame,endFrame,fps);this.setAnimationWeight(name,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(name,start,end,fps){var animation={start:start,end:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[name]=animation;this.animationsList.push(animation)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(fps){var pattern=/([a-z]+)_?(\d+)/;var firstAnimation,frameRanges={};var geometry=this.geometry;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var chunks=morph.name.match(pattern);if(chunks&&chunks.length>1){var name=chunks[1];if(!frameRanges[name])frameRanges[name]={start:Infinity,end:-Infinity};var range=frameRanges[name];if(i<range.start)range.start=i;if(i>range.end)range.end=i;if(!firstAnimation)firstAnimation=name}}for(var name in frameRanges){var range=frameRanges[name];this.createAnimation(name,range.start,range.end,fps)}this.firstAnimation=firstAnimation};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=1;animation.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=-1;animation.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(name,fps){var animation=this.animationsMap[name];if(animation){animation.fps=fps;animation.duration=(animation.end-animation.start)/animation.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(name,duration){var animation=this.animationsMap[name];if(animation){animation.duration=duration;animation.fps=(animation.end-animation.start)/animation.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(name,weight){var animation=this.animationsMap[name];if(animation){animation.weight=weight}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(name,time){var animation=this.animationsMap[name];if(animation){animation.time=time}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(name){var time=0;var animation=this.animationsMap[name];if(animation){time=animation.time}return time};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(name){var duration=-1;var animation=this.animationsMap[name];if(animation){duration=animation.duration}return duration};THREE.MorphBlendMesh.prototype.playAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.time=0;animation.active=true}else{console.warn("THREE.MorphBlendMesh: animation["+name+"] undefined in .playAnimation()")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.active=false}};THREE.MorphBlendMesh.prototype.update=function(delta){for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this.animationsList[i];if(!animation.active)continue;var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta;if(animation.mirroredLoop){if(animation.time>animation.duration||animation.time<0){animation.direction*=-1;if(animation.time>animation.duration){animation.time=animation.duration;animation.directionBackwards=true}if(animation.time<0){animation.time=0;animation.directionBackwards=false}}}else{animation.time=animation.time%animation.duration;if(animation.time<0)animation.time+=animation.duration}var keyframe=animation.start+THREE.Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1);var weight=animation.weight;if(keyframe!==animation.currentFrame){this.morphTargetInfluences[animation.lastFrame]=0;this.morphTargetInfluences[animation.currentFrame]=1*weight;this.morphTargetInfluences[keyframe]=0;animation.lastFrame=animation.currentFrame;animation.currentFrame=keyframe}var mix=animation.time%frameTime/frameTime;if(animation.directionBackwards)mix=1-mix;if(animation.currentFrame!==animation.lastFrame){this.morphTargetInfluences[animation.currentFrame]=mix*weight;this.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight}else{this.morphTargetInfluences[animation.currentFrame]=weight}}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=THREE}exports.THREE=THREE}else{this["THREE"]=THREE}},{}],107:[function(require,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}],108:[function(require,module,exports){(function(root){"use strict";var Tone;function Main(func){Tone=func()}function Module(func){func(Tone)}Main(function(){function isUndef(val){return val===void 0}function isFunction(val){return typeof val==="function"}var audioContext;if(isUndef(window.AudioContext)){window.AudioContext=window.webkitAudioContext}if(isUndef(window.OfflineAudioContext)){window.OfflineAudioContext=window.webkitOfflineAudioContext}if(!isUndef(AudioContext)){audioContext=new AudioContext}else{throw new Error("Web Audio is not supported in this browser")}if(!isFunction(AudioContext.prototype.createGain)){AudioContext.prototype.createGain=AudioContext.prototype.createGainNode}if(!isFunction(AudioContext.prototype.createDelay)){AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode}if(!isFunction(AudioContext.prototype.createPeriodicWave)){AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable}if(!isFunction(AudioBufferSourceNode.prototype.start)){AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn}if(!isFunction(AudioBufferSourceNode.prototype.stop)){AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff}if(!isFunction(OscillatorNode.prototype.start)){OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn}if(!isFunction(OscillatorNode.prototype.stop)){OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff}if(!isFunction(OscillatorNode.prototype.setPeriodicWave)){OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable}AudioNode.prototype._nativeConnect=AudioNode.prototype.connect;AudioNode.prototype.connect=function(B,outNum,inNum){if(B.input){if(Array.isArray(B.input)){if(isUndef(inNum)){inNum=0}this.connect(B.input[inNum])}else{this.connect(B.input,outNum,inNum)}}else{try{if(B instanceof AudioNode){this._nativeConnect(B,outNum,inNum)}else{this._nativeConnect(B,outNum)}}catch(e){throw new Error("error connecting to node: "+B)}}};var Tone=function(inputs,outputs){if(isUndef(inputs)||inputs===1){this.input=this.context.createGain()}else if(inputs>1){this.input=new Array(inputs)}if(isUndef(outputs)||outputs===1){this.output=this.context.createGain()}else if(outputs>1){this.output=new Array(inputs)}};Tone.prototype.set=function(params,value,rampTime){if(typeof params==="object"){rampTime=value}else if(typeof params==="string"){var tmpObj={};tmpObj[params]=value;params=tmpObj}for(var attr in params){value=params[attr];var parent=this;if(attr.indexOf(".")!==-1){var attrSplit=attr.split(".");for(var i=0;i<attrSplit.length-1;i++){parent=parent[attrSplit[i]]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];if(isUndef(param)){continue}if(param instanceof Tone.Signal){if(param.value!==value){if(isUndef(rampTime)){param.value=value}else{param.rampTo(value,rampTime)}}}else if(param instanceof AudioParam){if(param.value!==value){param.value=value}}else if(param instanceof Tone){param.set(value)}else if(param!==value){parent[attr]=value}}return this};Tone.prototype.get=function(params){if(isUndef(params)){params=this._collectDefaults(this.constructor)}else if(typeof params==="string"){params=[params]}var ret={};for(var i=0;i<params.length;i++){var attr=params[i];var parent=this;var subRet=ret;if(attr.indexOf(".")!==-1){var attrSplit=attr.split(".");for(var j=0;j<attrSplit.length-1;j++){var subAttr=attrSplit[j];subRet[subAttr]=subRet[subAttr]||{};subRet=subRet[subAttr];parent=parent[subAttr]}attr=attrSplit[attrSplit.length-1]}var param=parent[attr];if(typeof params[attr]==="object"){subRet[attr]=param.get()}else if(param instanceof Tone.Signal){subRet[attr]=param.value}else if(param instanceof AudioParam){subRet[attr]=param.value}else if(param instanceof Tone){subRet[attr]=param.get()}else if(!isFunction(param)&&!isUndef(param)){subRet[attr]=param}}return ret};Tone.prototype._collectDefaults=function(constr){var ret=[];if(!isUndef(constr.defaults)){ret=Object.keys(constr.defaults)}if(!isUndef(constr._super)){var superDefs=this._collectDefaults(constr._super);for(var i=0;i<superDefs.length;i++){if(ret.indexOf(superDefs[i])===-1){ret.push(superDefs[i])}}}return ret};Tone.prototype.setPreset=function(presetName){if(!this.isUndef(this.preset)&&this.preset.hasOwnProperty(presetName)){this.set(this.preset[presetName])}return this};Tone.prototype.toString=function(){for(var className in Tone){var isLetter=className[0].match(/^[A-Z]$/);var sameConstructor=Tone[className]===this.constructor;if(isFunction(Tone[className])&&isLetter&&sameConstructor){return className}}return"Tone"};Tone.context=audioContext;Tone.prototype.context=Tone.context;Tone.prototype.bufferSize=2048;Tone.prototype.bufferTime=Tone.prototype.bufferSize/Tone.context.sampleRate;Tone.prototype.dispose=function(){if(!this.isUndef(this.input)){if(this.input instanceof AudioNode){this.input.disconnect()}this.input=null}if(!this.isUndef(this.output)){if(this.output instanceof AudioNode){this.output.disconnect()}this.output=null}return this};var _silentNode=null;Tone.prototype.noGC=function(){this.output.connect(_silentNode);return this};AudioNode.prototype.noGC=function(){this.connect(_silentNode);return this};Tone.prototype.connect=function(unit,outputNum,inputNum){if(Array.isArray(this.output)){outputNum=this.defaultArg(outputNum,0);this.output[outputNum].connect(unit,0,inputNum)}else{this.output.connect(unit,outputNum,inputNum)}return this};Tone.prototype.disconnect=function(outputNum){if(Array.isArray(this.output)){outputNum=this.defaultArg(outputNum,0);this.output[outputNum].disconnect()}else{this.output.disconnect()}return this};Tone.prototype.connectSeries=function(){if(arguments.length>1){var currentUnit=arguments[0];for(var i=1;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit);currentUnit=toUnit}}return this};Tone.prototype.connectParallel=function(){var connectFrom=arguments[0];if(arguments.length>1){for(var i=1;i<arguments.length;i++){var connectTo=arguments[i];connectFrom.connect(connectTo)}}return this};Tone.prototype.chain=function(){if(arguments.length>0){var currentUnit=this;for(var i=0;i<arguments.length;i++){var toUnit=arguments[i];currentUnit.connect(toUnit);currentUnit=toUnit}}return this};Tone.prototype.fan=function(){if(arguments.length>0){for(var i=0;i<arguments.length;i++){this.connect(arguments[i])}}return this};AudioNode.prototype.chain=Tone.prototype.chain;AudioNode.prototype.fan=Tone.prototype.fan;Tone.prototype.defaultArg=function(given,fallback){if(typeof given==="object"&&typeof fallback==="object"){var ret={};for(var givenProp in given){ret[givenProp]=this.defaultArg(given[givenProp],given[givenProp])}for(var prop in fallback){ret[prop]=this.defaultArg(given[prop],fallback[prop])}return ret}else{return isUndef(given)?fallback:given}};Tone.prototype.optionsObject=function(values,keys,defaults){var options={};if(values.length===1&&typeof values[0]==="object"){options=values[0]}else{for(var i=0;i<keys.length;i++){options[keys[i]]=values[i]}}if(!this.isUndef(defaults)){return this.defaultArg(options,defaults)}else{return options}};Tone.prototype.isUndef=isUndef;Tone.prototype.isFunction=isFunction;Tone.prototype._readOnly=function(property){if(Array.isArray(property)){for(var i=0;i<property.length;i++){this._readOnly(property[i])}}else{Object.defineProperty(this,property,{writable:false,enumerable:true})}};Tone.prototype._writable=function(property){if(Array.isArray(property)){for(var i=0;i<property.length;i++){this._writable(property[i])}}else{Object.defineProperty(this,property,{writable:true})}};Tone.prototype.equalPowerScale=function(percent){var piFactor=.5*Math.PI;return Math.sin(percent*piFactor)};Tone.prototype.dbToGain=function(db){return Math.pow(2,db/6)};Tone.prototype.gainToDb=function(gain){return 20*(Math.log(gain)/Math.LN10)};Tone.prototype.now=function(){return this.context.currentTime};Tone.prototype.samplesToSeconds=function(samples){return samples/this.context.sampleRate};Tone.prototype.toSamples=function(time){var seconds=this.toSeconds(time);return Math.round(seconds*this.context.sampleRate)};Tone.prototype.toSeconds=function(time,now){now=this.defaultArg(now,this.now());if(typeof time==="number"){return time}else if(typeof time==="string"){var plusTime=0;if(time.charAt(0)==="+"){time=time.slice(1);plusTime=now}return parseFloat(time)+plusTime}else{return now}};Tone.prototype.isFrequency=function(){var freqFormat=new RegExp(/\d*\.?\d+hz$/i);return function(freq){return freqFormat.test(freq)}}();Tone.prototype.frequencyToSeconds=function(freq){return 1/parseFloat(freq)};Tone.prototype.secondsToFrequency=function(seconds){return 1/seconds};Tone.extend=function(child,parent){if(isUndef(parent)){parent=Tone}function TempConstructor(){}TempConstructor.prototype=parent.prototype;child.prototype=new TempConstructor;child.prototype.constructor=child;child._super=parent};Tone.Type={Default:"number",Time:"time",Frequency:"frequency",Gain:"gain",NormalRange:"normalrange",AudioRange:"audiorange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transporttime"};Tone.State={Started:"started",Stopped:"stopped",Paused:"paused"};Tone.noOp=function(){};var newContextCallbacks=[];Tone._initAudioContext=function(callback){callback(Tone.context);newContextCallbacks.push(callback)};Tone.setContext=function(ctx){Tone.prototype.context=ctx;Tone.context=ctx;for(var i=0;i<newContextCallbacks.length;i++){newContextCallbacks[i](ctx)}};Tone.startMobile=function(){var osc=Tone.context.createOscillator();var silent=Tone.context.createGain();silent.gain.value=0;osc.connect(silent);silent.connect(Tone.context.destination);var now=Tone.context.currentTime;osc.start(now);osc.stop(now+1)};Tone._initAudioContext(function(audioContext){Tone.prototype.bufferTime=Tone.prototype.bufferSize/audioContext.sampleRate;_silentNode=audioContext.createGain();_silentNode.gain.value=0;_silentNode.connect(audioContext.destination)});Tone.version="r5";console.log("%c * Tone.js "+Tone.version+" * ","background: #000; color: #fff");return Tone});Module(function(Tone){Tone.SignalBase=function(){};Tone.extend(Tone.SignalBase);Tone.SignalBase.prototype.connect=function(node,outputNumber,inputNumber){if(node.constructor===Tone.Signal){node._value.cancelScheduledValues(0);node._value.value=0;node.overridden=true}else if(node instanceof AudioParam){node.cancelScheduledValues(0);node.value=0}Tone.prototype.connect.call(this,node,outputNumber,inputNumber);return this};return Tone.SignalBase});Module(function(Tone){Tone.WaveShaper=function(mapping,bufferLen){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;if(Array.isArray(mapping)){this.curve=mapping}else if(isFinite(mapping)||this.isUndef(mapping)){this._curve=new Float32Array(this.defaultArg(mapping,1024))}else if(this.isFunction(mapping)){this._curve=new Float32Array(this.defaultArg(bufferLen,1024));this.setMap(mapping)}};Tone.extend(Tone.WaveShaper,Tone.SignalBase);Tone.WaveShaper.prototype.setMap=function(mapping){for(var i=0,len=this._curve.length;i<len;i++){var normalized=i/len*2-1;this._curve[i]=mapping(normalized,i)}this._shaper.curve=this._curve;return this};Object.defineProperty(Tone.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(mapping){if(this._isSafari()){var first=mapping[0];mapping.unshift(first)}this._curve=new Float32Array(mapping);this._shaper.curve=this._curve}});Object.defineProperty(Tone.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}});Tone.WaveShaper.prototype._isSafari=function(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("safari")!==-1&&ua.indexOf("chrome")===-1};Tone.WaveShaper.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._shaper.disconnect();this._shaper=null;this._curve=null;return this};return Tone.WaveShaper});Module(function(Tone){Tone.Signal=function(){var options=this.optionsObject(arguments,["value","units"],Tone.Signal.defaults);this.units=options.units;this.convert=options.convert;this.overridden=false;this.output=this._scaler=this.context.createGain();this.input=this._value=this._scaler.gain;if(options.value instanceof AudioParam){this._scaler.connect(options.value);options.value.value=0}else{if(!this.isUndef(options.param)){this._scaler.connect(options.param);options.param.value=0}this.value=options.value}Tone.Signal._constant.chain(this._scaler)};Tone.extend(Tone.Signal,Tone.SignalBase);Tone.Signal.defaults={value:0,param:undefined,units:Tone.Type.Default,convert:true};Object.defineProperty(Tone.Signal.prototype,"value",{get:function(){return this._toUnits(this._value.value)},set:function(value){var convertedVal=this._fromUnits(value);this.cancelScheduledValues(0);this._value.value=convertedVal}});Tone.Signal.prototype._fromUnits=function(val){if(this.convert||this.isUndef(this.convert)){switch(this.units){case Tone.Type.Time:return this.toSeconds(val);case Tone.Type.Frequency:return this.toFrequency(val);case Tone.Type.Decibels:return this.dbToGain(val);case Tone.Type.NormalRange:return Math.min(Math.max(val,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(val,-1),1);case Tone.Type.Positive:return Math.max(val,0);default:return val}}else{return val}};Tone.Signal.prototype._toUnits=function(val){if(this.convert||this.isUndef(this.convert)){switch(this.units){case Tone.Type.Decibels:return this.gainToDb(val);default:return val}}else{return val}};Tone.Signal.prototype.setValueAtTime=function(value,time){value=this._fromUnits(value);this._value.setValueAtTime(value,this.toSeconds(time));return this};Tone.Signal.prototype.setCurrentValueNow=function(now){now=this.defaultArg(now,this.now());var currentVal=this._value.value;this.cancelScheduledValues(now);this._value.setValueAtTime(currentVal,now);return this};Tone.Signal.prototype.linearRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);this._value.linearRampToValueAtTime(value,this.toSeconds(endTime));return this};Tone.Signal.prototype.exponentialRampToValueAtTime=function(value,endTime){value=this._fromUnits(value);value=Math.max(1e-5,value);this._value.exponentialRampToValueAtTime(value,this.toSeconds(endTime));return this};Tone.Signal.prototype.exponentialRampToValueNow=function(value,rampTime){var now=this.now();var currentVal=this.value;this.setValueAtTime(Math.max(currentVal,1e-4),now);this.exponentialRampToValueAtTime(value,now+this.toSeconds(rampTime));return this};Tone.Signal.prototype.linearRampToValueNow=function(value,rampTime){var now=this.now();this.setCurrentValueNow(now);this.linearRampToValueAtTime(value,now+this.toSeconds(rampTime));return this};Tone.Signal.prototype.setTargetAtTime=function(value,startTime,timeConstant){value=this._fromUnits(value);timeConstant=Math.max(1e-5,timeConstant);this._value.setTargetAtTime(value,this.toSeconds(startTime),timeConstant);return this};Tone.Signal.prototype.setValueCurveAtTime=function(values,startTime,duration){for(var i=0;i<values.length;i++){values[i]=this._fromUnits(values[i])}this._value.setValueCurveAtTime(values,this.toSeconds(startTime),this.toSeconds(duration));return this};Tone.Signal.prototype.cancelScheduledValues=function(startTime){this._value.cancelScheduledValues(this.toSeconds(startTime));return this};Tone.Signal.prototype.rampTo=function(value,rampTime){rampTime=this.defaultArg(rampTime,0);if(this.units===Tone.Type.Frequency||this.units===Tone.Type.BPM){this.exponentialRampToValueNow(value,rampTime)}else{this.linearRampToValueNow(value,rampTime)}return this};Tone.Signal.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._value=null;this._scaler=null;return this};Tone.Signal._generator=null;Tone.Signal._constant=null;Tone._initAudioContext(function(audioContext){Tone.Signal._generator=audioContext.createOscillator();Tone.Signal._constant=new Tone.WaveShaper([1,1]);Tone.Signal._generator.connect(Tone.Signal._constant);Tone.Signal._generator.start(0);Tone.Signal._generator.noGC()});return Tone.Signal});Module(function(Tone){Tone.Pow=function(exp){this._exp=this.defaultArg(exp,1);this._expScaler=this.input=this.output=new Tone.WaveShaper(this._expFunc(this._exp),8192)};Tone.extend(Tone.Pow,Tone.SignalBase);Object.defineProperty(Tone.Pow.prototype,"value",{get:function(){return this._exp},set:function(exp){this._exp=exp;this._expScaler.setMap(this._expFunc(this._exp))}});Tone.Pow.prototype._expFunc=function(exp){return function(val){return Math.pow(Math.abs(val),exp)}};Tone.Pow.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._expScaler.dispose();this._expScaler=null;return this};return Tone.Pow});Module(function(Tone){Tone.Envelope=function(){var options=this.optionsObject(arguments,["attack","decay","sustain","release"],Tone.Envelope.defaults);this.attack=options.attack;this.decay=options.decay;this.sustain=options.sustain;this.release=options.release;this._nextAttack=Infinity;this._nextDecay=Infinity;this._nextSustain=Infinity;this._nextRelease=Infinity;this._nextStandby=Infinity;this._attackCurve=Tone.Envelope.Type.Linear;this._peakValue=1;this._minOutput=1e-4;this._sig=this.output=new Tone.Signal(0);this.attackCurve=options.attackCurve};Tone.extend(Tone.Envelope);Tone.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear"};Tone.Envelope.prototype._timeMult=.25;Object.defineProperty(Tone.Envelope.prototype,"value",{get:function(){return this._sig.value}});Object.defineProperty(Tone.Envelope.prototype,"attackCurve",{get:function(){return this._attackCurve},set:function(type){if(type===Tone.Envelope.Type.Linear||type===Tone.Envelope.Type.Exponential){this._attackCurve=type}else{throw Error('attackCurve must be either "linear" or "exponential". Invalid type: ',type)}}});Tone.Envelope.prototype._phaseAtTime=function(time){if(this._nextRelease>time){if(this._nextAttack<=time&&this._nextDecay>time){return Tone.Envelope.Phase.Attack}else if(this._nextDecay<=time&&this._nextSustain>time){return Tone.Envelope.Phase.Decay}else if(this._nextSustain<=time&&this._nextRelease>time){return Tone.Envelope.Phase.Sustain}else{return Tone.Envelope.Phase.Standby}}else if(this._nextRelease<time&&this._nextStandby>time){return Tone.Envelope.Phase.Release}else{return Tone.Envelope.Phase.Standby}};Tone.Envelope.prototype._exponentialApproach=function(t0,v0,v1,timeConstant,t){return v1+(v0-v1)*Math.exp(-(t-t0)/timeConstant)};Tone.Envelope.prototype._linearInterpolate=function(t0,v0,t1,v1,t){return v0+(v1-v0)*((t-t0)/(t1-t0))};Tone.Envelope.prototype._exponentialInterpolate=function(t0,v0,t1,v1,t){return v0*Math.pow(v1/v0,(t-t0)/(t1-t0))};Tone.Envelope.prototype._valueAtTime=function(time){var attack=this.toSeconds(this.attack);var decay=this.toSeconds(this.decay);var release=this.toSeconds(this.release);switch(this._phaseAtTime(time)){case Tone.Envelope.Phase.Attack:if(this._attackCurve===Tone.Envelope.Type.Linear){return this._linearInterpolate(this._nextAttack,this._minOutput,this._nextAttack+attack,this._peakValue,time)}else{return this._exponentialInterpolate(this._nextAttack,this._minOutput,this._nextAttack+attack,this._peakValue,time)}break;case Tone.Envelope.Phase.Decay:return this._exponentialApproach(this._nextDecay,this._peakValue,this.sustain*this._peakValue,decay*this._timeMult,time);case Tone.Envelope.Phase.Release:return this._exponentialApproach(this._nextRelease,this._peakValue,this._minOutput,release*this._timeMult,time);case Tone.Envelope.Phase.Sustain:return this.sustain*this._peakValue;case Tone.Envelope.Phase.Standby:return this._minOutput}};Tone.Envelope.prototype.triggerAttack=function(time,velocity){time=this.toSeconds(time);var attack=this.toSeconds(this.attack);var decay=this.toSeconds(this.decay);var valueAtTime=this._valueAtTime(time);var attackPast=valueAtTime*attack;this._nextAttack=time-attackPast;this._nextDecay=this._nextAttack+attack;this._nextSustain=this._nextDecay+decay;this._nextRelease=Infinity;this._peakValue=this.defaultArg(velocity,1);var scaledMax=this._peakValue;var sustainVal=this.sustain*scaledMax;this._sig.cancelScheduledValues(time);this._sig.setValueAtTime(valueAtTime,time);if(this._attackCurve===Tone.Envelope.Type.Linear){this._sig.linearRampToValueAtTime(scaledMax,this._nextDecay)}else{this._sig.exponentialRampToValueAtTime(scaledMax,this._nextDecay)}this._sig.setTargetAtTime(sustainVal,this._nextDecay,decay*this._timeMult);return this};Tone.Envelope.prototype.triggerRelease=function(time){time=this.toSeconds(time);var phase=this._phaseAtTime(time);var release=this.toSeconds(this.release);var valueAtTime=this._valueAtTime(time);this._peakValue=valueAtTime;this._nextRelease=time;this._nextStandby=this._nextRelease+release;this._sig.cancelScheduledValues(this._nextRelease);if(phase===Tone.Envelope.Phase.Attack){this._sig.setCurrentValueNow();if(this.attackCurve===Tone.Envelope.Type.Linear){this._sig.linearRampToValueAtTime(this._peakValue,this._nextRelease)}else{this._sig.exponentialRampToValueAtTime(this._peakValue,this._nextRelease)}}else{this._sig.setValueAtTime(this._peakValue,this._nextRelease)}this._sig.setTargetAtTime(this._minOutput,this._nextRelease,release*this._timeMult);return this};Tone.Envelope.prototype.triggerAttackRelease=function(duration,time,velocity){time=this.toSeconds(time);this.triggerAttack(time,velocity);this.triggerRelease(time+this.toSeconds(duration));return this};Tone.Envelope.prototype.connect=Tone.Signal.prototype.connect;Tone.Envelope.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sig.dispose();this._sig=null;return this};Tone.Envelope.Phase={Attack:"attack",Decay:"decay",Sustain:"sustain",Release:"release",Standby:"standby"};Tone.Envelope.Type={Linear:"linear",Exponential:"exponential"};return Tone.Envelope});Module(function(Tone){Tone.AmplitudeEnvelope=function(){Tone.Envelope.apply(this,arguments);this.input=this.output=this.context.createGain();this._sig.connect(this.output.gain)};Tone.extend(Tone.AmplitudeEnvelope,Tone.Envelope);return Tone.AmplitudeEnvelope});Module(function(Tone){Tone.Compressor=function(){var options=this.optionsObject(arguments,["threshold","ratio"],Tone.Compressor.defaults);this._compressor=this.input=this.output=this.context.createDynamicsCompressor();this.threshold=this._compressor.threshold;this.attack=new Tone.Signal(this._compressor.attack,Tone.Type.Time);this.release=new Tone.Signal(this._compressor.release,Tone.Type.Time);this.knee=this._compressor.knee;this.ratio=this._compressor.ratio;this._readOnly(["knee","release","attack","ratio","threshold"]);this.set(options)};Tone.extend(Tone.Compressor);Tone.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30};Tone.Compressor.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["knee","release","attack","ratio","threshold"]);this._compressor.disconnect();this._compressor=null;this.attack.dispose();this.attack=null;this.release.dispose();this.release=null;this.threshold=null;this.ratio=null;this.knee=null;return this};return Tone.Compressor});Module(function(Tone){Tone.Add=function(value){Tone.call(this,2,0);this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain();this._value=this.input[1]=new Tone.Signal(value);this._value.connect(this._sum)};Tone.extend(Tone.Add,Tone.Signal);Tone.Add.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sum.disconnect();this._sum=null;this._value.dispose();this._value=null;return this};return Tone.Add});Module(function(Tone){Tone.Multiply=function(value){Tone.call(this,2,0);this._mult=this.input[0]=this.output=this.context.createGain();this._value=this.input[1]=this.output.gain;this._value.value=this.defaultArg(value,0)};Tone.extend(Tone.Multiply,Tone.Signal);Tone.Multiply.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._mult.disconnect();this._mult=null;this._value=null;return this};return Tone.Multiply});Module(function(Tone){Tone.Negate=function(){this._multiply=this.input=this.output=new Tone.Multiply(-1)};Tone.extend(Tone.Negate,Tone.SignalBase);Tone.Negate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._multiply.dispose();this._multiply=null;return this};return Tone.Negate});Module(function(Tone){Tone.Subtract=function(value){Tone.call(this,2,0);this._sum=this.input[0]=this.output=this.context.createGain();this._neg=new Tone.Negate;this._value=this.input[1]=new Tone.Signal(value);this._value.chain(this._neg,this._sum)};Tone.extend(Tone.Subtract,Tone.Signal);Tone.Subtract.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._neg.dispose();this._neg=null;this._sum.disconnect();this._sum=null;this._value.dispose();this._value=null;return this};return Tone.Subtract});Module(function(Tone){Tone.GreaterThanZero=function(){this._thresh=this.output=new Tone.WaveShaper(function(val){if(val<=0){return 0}else{return 1}});this._scale=this.input=new Tone.Multiply(1e4);this._scale.connect(this._thresh)};Tone.extend(Tone.GreaterThanZero,Tone.SignalBase);Tone.GreaterThanZero.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._thresh.dispose();this._thresh=null;return this};return Tone.GreaterThanZero});Module(function(Tone){Tone.EqualZero=function(){this._scale=this.input=new Tone.Multiply(1e4);this._thresh=new Tone.WaveShaper(function(val){if(val===0){return 1}else{return 0}},128);this._gtz=this.output=new Tone.GreaterThanZero;this._scale.chain(this._thresh,this._gtz)};Tone.extend(Tone.EqualZero,Tone.SignalBase);Tone.EqualZero.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._gtz.dispose();this._gtz=null;this._scale.dispose();this._scale=null;this._thresh.dispose();this._thresh=null;return this};return Tone.EqualZero});Module(function(Tone){Tone.Equal=function(value){Tone.call(this,2,0);this._sub=this.input[0]=new Tone.Subtract(value);this._equals=this.output=new Tone.EqualZero;this._sub.connect(this._equals);this.input[1]=this._sub.input[1]};Tone.extend(Tone.Equal,Tone.SignalBase);Object.defineProperty(Tone.Equal.prototype,"value",{get:function(){return this._sub.value},set:function(value){this._sub.value=value}});Tone.Equal.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._equals.dispose();this._equals=null;this._sub.dispose();this._sub=null;return this};return Tone.Equal});Module(function(Tone){Tone.Select=function(sourceCount){sourceCount=this.defaultArg(sourceCount,2);Tone.call(this,sourceCount,1);this.gate=new Tone.Signal(0);this._readOnly("gate");for(var i=0;i<sourceCount;i++){var switchGate=new SelectGate(i);this.input[i]=switchGate;this.gate.connect(switchGate.selecter);switchGate.connect(this.output)}};Tone.extend(Tone.Select,Tone.SignalBase);Tone.Select.prototype.select=function(which,time){which=Math.floor(which);this.gate.setValueAtTime(which,this.toSeconds(time));return this};Tone.Select.prototype.dispose=function(){this._writable("gate");this.gate.dispose();this.gate=null;for(var i=0;i<this.input.length;i++){this.input[i].dispose();this.input[i]=null}Tone.prototype.dispose.call(this);return this};var SelectGate=function(num){this.selecter=new Tone.Equal(num);this.gate=this.input=this.output=this.context.createGain();this.selecter.connect(this.gate.gain)};Tone.extend(SelectGate);SelectGate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.selecter.dispose();this.gate.disconnect();this.selecter=null;this.gate=null};return Tone.Select});Module(function(Tone){Tone.IfThenElse=function(){Tone.call(this,3,0);this._selector=this.output=new Tone.Select(2);this.if=this.input[0]=this._selector.gate;this.then=this.input[1]=this._selector.input[1];this.else=this.input[2]=this._selector.input[0]};Tone.extend(Tone.IfThenElse,Tone.SignalBase);Tone.IfThenElse.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._selector.dispose();this._selector=null;this.if=null;this.then=null;this.else=null;return this};return Tone.IfThenElse});Module(function(Tone){Tone.OR=function(inputCount){inputCount=this.defaultArg(inputCount,2);Tone.call(this,inputCount,0);this._sum=this.context.createGain();this._gtz=this.output=new Tone.GreaterThanZero;for(var i=0;i<inputCount;i++){this.input[i]=this._sum}this._sum.connect(this._gtz)};Tone.extend(Tone.OR,Tone.SignalBase);Tone.OR.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._gtz.dispose();this._gtz=null;this._sum.disconnect();this._sum=null;return this};return Tone.OR});Module(function(Tone){Tone.AND=function(inputCount){inputCount=this.defaultArg(inputCount,2);Tone.call(this,inputCount,0);this._equals=this.output=new Tone.Equal(inputCount);for(var i=0;i<inputCount;i++){this.input[i]=this._equals}};Tone.extend(Tone.AND,Tone.SignalBase);Tone.AND.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._equals.dispose();this._equals=null;return this};return Tone.AND});Module(function(Tone){Tone.NOT=Tone.EqualZero;return Tone.NOT});Module(function(Tone){Tone.GreaterThan=function(value){Tone.call(this,2,0);this._value=this.input[0]=new Tone.Subtract(value);this.input[1]=this._value.input[1];this._gtz=this.output=new Tone.GreaterThanZero;this._value.connect(this._gtz)};Tone.extend(Tone.GreaterThan,Tone.Signal);Tone.GreaterThan.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._value.dispose();this._value=null;this._gtz.dispose();this._gtz=null;return this};return Tone.GreaterThan});Module(function(Tone){Tone.LessThan=function(value){Tone.call(this,2,0);this._neg=this.input[0]=new Tone.Negate;this._gt=this.output=new Tone.GreaterThan;this._rhNeg=new Tone.Negate;this._value=this.input[1]=new Tone.Signal(value);this._neg.connect(this._gt);this._value.connect(this._rhNeg);this._rhNeg.connect(this._gt,0,1)};Tone.extend(Tone.LessThan,Tone.Signal);Tone.LessThan.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._neg.dispose();this._neg=null;this._gt.dispose();this._gt=null;this._rhNeg.dispose();this._rhNeg=null;this._value.dispose();this._value=null;return this};return Tone.LessThan});Module(function(Tone){Tone.Abs=function(){Tone.call(this,1,0);this._ltz=new Tone.LessThan(0);this._switch=this.output=new Tone.Select(2);this._negate=new Tone.Negate;this.input.connect(this._switch,0,0);this.input.connect(this._negate);this._negate.connect(this._switch,0,1);this.input.chain(this._ltz,this._switch.gate)};Tone.extend(Tone.Abs,Tone.SignalBase);Tone.Abs.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._switch.dispose();this._switch=null;this._ltz.dispose();this._ltz=null;this._negate.dispose();this._negate=null;return this};return Tone.Abs});Module(function(Tone){Tone.Max=function(max){Tone.call(this,2,0);this.input[0]=this.context.createGain();this._value=this.input[1]=new Tone.Signal(max);this._ifThenElse=this.output=new Tone.IfThenElse;this._gt=new Tone.GreaterThan;this.input[0].chain(this._gt,this._ifThenElse.if);this.input[0].connect(this._ifThenElse.then);this._value.connect(this._ifThenElse.else);this._value.connect(this._gt,0,1)};Tone.extend(Tone.Max,Tone.Signal);Tone.Max.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._value.dispose();this._ifThenElse.dispose();this._gt.dispose();this._value=null;this._ifThenElse=null;this._gt=null;return this};return Tone.Max});Module(function(Tone){Tone.Min=function(min){Tone.call(this,2,0);this.input[0]=this.context.createGain();this._ifThenElse=this.output=new Tone.IfThenElse;this._lt=new Tone.LessThan;this._value=this.input[1]=new Tone.Signal(min);this.input[0].chain(this._lt,this._ifThenElse.if);this.input[0].connect(this._ifThenElse.then);this._value.connect(this._ifThenElse.else);this._value.connect(this._lt,0,1)};Tone.extend(Tone.Min,Tone.Signal);Tone.Min.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._value.dispose();this._ifThenElse.dispose();this._lt.dispose();this._value=null;this._ifThenElse=null;this._lt=null;return this};return Tone.Min});Module(function(Tone){Tone.Modulo=function(modulus){Tone.call(this,1,1);this._shaper=new Tone.WaveShaper(Math.pow(2,16));this._multiply=new Tone.Multiply;this._subtract=this.output=new Tone.Subtract;this._modSignal=new Tone.Signal(modulus);this.input.fan(this._shaper,this._subtract);this._modSignal.connect(this._multiply,0,0);this._shaper.connect(this._multiply,0,1);this._multiply.connect(this._subtract,0,1);this._setWaveShaper(modulus)};Tone.extend(Tone.Modulo,Tone.SignalBase);Tone.Modulo.prototype._setWaveShaper=function(mod){this._shaper.setMap(function(val){var multiple=Math.floor((val+1e-4)/mod);return multiple})};Object.defineProperty(Tone.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(mod){this._modSignal.value=mod;this._setWaveShaper(mod)}});Tone.Modulo.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;this._multiply.dispose();this._multiply=null;this._subtract.dispose();this._subtract=null;this._modSignal.dispose();this._modSignal=null;return this};return Tone.Modulo});Module(function(Tone){Tone.Expr=function(){var expr=this._replacements(Array.prototype.slice.call(arguments));var inputCount=this._parseInputs(expr);this._nodes=[];this.input=new Array(inputCount);for(var i=0;i<inputCount;i++){this.input[i]=this.context.createGain()}var tree=this._parseTree(expr);var result;try{result=this._eval(tree)}catch(e){this._disposeNodes();throw new Error("Could evaluate expression: "+expr)}this.output=result};Tone.extend(Tone.Expr,Tone.SignalBase);function applyBinary(Constructor,args,self){var op=new Constructor;self._eval(args[0]).connect(op,0,0);self._eval(args[1]).connect(op,0,1);return op}function applyUnary(Constructor,args,self){var op=new Constructor;self._eval(args[0]).connect(op,0,0);return op}function getNumber(arg){return arg?parseFloat(arg):undefined}function literalNumber(arg){return arg&&arg.args?parseFloat(arg.args):undefined}Tone.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(arg){var sig=new Tone.Signal(getNumber(arg));return sig}},input:{regexp:/^\$\d/,method:function(arg,self){return self.input[getNumber(arg.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:applyUnary.bind(this,Tone.Abs)},min:{regexp:/^min/,method:applyBinary.bind(this,Tone.Min)},max:{regexp:/^max/,method:applyBinary.bind(this,Tone.Max)},if:{regexp:/^if/,method:function(args,self){var op=new Tone.IfThenElse;self._eval(args[0]).connect(op.if);self._eval(args[1]).connect(op.then);self._eval(args[2]).connect(op.else);return op}},gt0:{regexp:/^gt0/,method:applyUnary.bind(this,Tone.GreaterThanZero)},eq0:{regexp:/^eq0/,method:applyUnary.bind(this,Tone.EqualZero)},mod:{regexp:/^mod/,method:function(args,self){var modulus=literalNumber(args[1]);var op=new Tone.Modulo(modulus);self._eval(args[0]).connect(op);return op}},pow:{regexp:/^pow/,method:function(args,self){var exp=literalNumber(args[1]);var op=new Tone.Pow(exp);self._eval(args[0]).connect(op);return op}}},binary:{"+":{regexp:/^\+/,precedence:1,method:applyBinary.bind(this,Tone.Add)},"-":{regexp:/^\-/,precedence:1,method:function(args,self){if(args.length===1){return applyUnary(Tone.Negate,args,self)}else{return applyBinary(Tone.Subtract,args,self)}}},"*":{regexp:/^\*/,precedence:0,method:applyBinary.bind(this,Tone.Multiply)},">":{regexp:/^\>/,precedence:2,method:applyBinary.bind(this,Tone.GreaterThan)},"<":{regexp:/^</,precedence:2,method:applyBinary.bind(this,Tone.LessThan)},"==":{regexp:/^==/,precedence:3,method:applyBinary.bind(this,Tone.Equal)},"&&":{regexp:/^&&/,precedence:4,method:applyBinary.bind(this,Tone.AND)},"||":{regexp:/^\|\|/,precedence:5,method:applyBinary.bind(this,Tone.OR)}},unary:{"-":{regexp:/^\-/,method:applyUnary.bind(this,Tone.Negate)},"!":{regexp:/^\!/,method:applyUnary.bind(this,Tone.NOT)}}};Tone.Expr.prototype._parseInputs=function(expr){var inputArray=expr.match(/\$\d/g);var inputMax=0;if(inputArray!==null){for(var i=0;i<inputArray.length;i++){var inputNum=parseInt(inputArray[i].substr(1))+1;inputMax=Math.max(inputMax,inputNum)}}return inputMax};Tone.Expr.prototype._replacements=function(args){var expr=args.shift();for(var i=0;i<args.length;i++){expr=expr.replace(/\%/i,args[i])}return expr};Tone.Expr.prototype._tokenize=function(expr){var position=-1;var tokens=[];while(expr.length>0){expr=expr.trim();var token=getNextToken(expr);tokens.push(token);expr=expr.substr(token.value.length)}function getNextToken(expr){for(var type in Tone.Expr._Expressions){var group=Tone.Expr._Expressions[type];for(var opName in group){var op=group[opName];var reg=op.regexp;var match=expr.match(reg);if(match!==null){return{type:type,value:match[0],method:op.method}}}}throw new SyntaxError("Unexpected token "+expr)}return{next:function(){return tokens[++position]},peek:function(){return tokens[position+1]}}};Tone.Expr.prototype._parseTree=function(expr){var lexer=this._tokenize(expr);var isUndef=this.isUndef.bind(this);function matchSyntax(token,syn){return!isUndef(token)&&token.type==="glue"&&token.value===syn}function matchGroup(token,groupName,prec){var ret=false;var group=Tone.Expr._Expressions[groupName];if(!isUndef(token)){for(var opName in group){var op=group[opName];if(op.regexp.test(token.value)){if(!isUndef(prec)){if(op.precedence===prec){return true}}else{return true}}}}return ret}function parseExpression(precedence){if(isUndef(precedence)){precedence=5}var expr;if(precedence<0){expr=parseUnary()}else{expr=parseExpression(precedence-1)}var token=lexer.peek();while(matchGroup(token,"binary",precedence)){token=lexer.next();expr={operator:token.value,method:token.method,args:[expr,parseExpression(precedence)]};token=lexer.peek()}return expr}function parseUnary(){var token,expr;token=lexer.peek();if(matchGroup(token,"unary")){token=lexer.next();expr=parseUnary();return{operator:token.value,method:token.method,args:[expr]}}return parsePrimary()}function parsePrimary(){var token,expr;token=lexer.peek();if(isUndef(token)){throw new SyntaxError("Unexpected termination of expression")}if(token.type==="func"){token=lexer.next();return parseFunctionCall(token)}if(token.type==="value"){token=lexer.next();return{method:token.method,args:token.value}}if(matchSyntax(token,"(")){lexer.next();expr=parseExpression();token=lexer.next();if(!matchSyntax(token,")")){throw new SyntaxError("Expected )")}return expr}throw new SyntaxError("Parse error, cannot process token "+token.value)}function parseFunctionCall(func){var token,args=[];token=lexer.next();if(!matchSyntax(token,"(")){throw new SyntaxError('Expected ( in a function call "'+func.value+'"')}token=lexer.peek();if(!matchSyntax(token,")")){args=parseArgumentList()}token=lexer.next();if(!matchSyntax(token,")")){throw new SyntaxError('Expected ) in a function call "'+func.value+'"')}return{method:func.method,args:args,name:name}}function parseArgumentList(){var token,expr,args=[];while(true){expr=parseExpression();if(isUndef(expr)){break}args.push(expr);token=lexer.peek();if(!matchSyntax(token,",")){break}lexer.next()}return args}return parseExpression()};Tone.Expr.prototype._eval=function(tree){if(!this.isUndef(tree)){var node=tree.method(tree.args,this);this._nodes.push(node);return node}};Tone.Expr.prototype._disposeNodes=function(){for(var i=0;i<this._nodes.length;i++){var node=this._nodes[i];if(this.isFunction(node.dispose)){node.dispose()}else if(this.isFunction(node.disconnect)){node.disconnect()}node=null;this._nodes[i]=null}this._nodes=null};Tone.Expr.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._disposeNodes()};return Tone.Expr});Module(function(Tone){Tone.EqualPowerGain=function(){this._eqPower=this.input=this.output=new Tone.WaveShaper(function(val){if(Math.abs(val)<.001){return 0}else{return this.equalPowerScale(val)}}.bind(this),4096)};Tone.extend(Tone.EqualPowerGain,Tone.SignalBase);Tone.EqualPowerGain.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._eqPower.dispose();this._eqPower=null;return this};return Tone.EqualPowerGain});Module(function(Tone){Tone.CrossFade=function(initialFade){Tone.call(this,2,1);this.a=this.input[0]=this.context.createGain();this.b=this.input[1]=this.context.createGain();this.fade=new Tone.Signal(this.defaultArg(initialFade,.5),Tone.Type.NormalRange);this._equalPowerA=new Tone.EqualPowerGain;this._equalPowerB=new Tone.EqualPowerGain;this._invert=new Tone.Expr("1 - $0");this.a.connect(this.output);this.b.connect(this.output);this.fade.chain(this._equalPowerB,this.b.gain);this.fade.chain(this._invert,this._equalPowerA,this.a.gain);this._readOnly("fade")};Tone.extend(Tone.CrossFade);Tone.CrossFade.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable("fade");this._equalPowerA.dispose();this._equalPowerA=null;this._equalPowerB.dispose();this._equalPowerB=null;this.fade.dispose();this.fade=null;this._invert.dispose();this._invert=null;this.a.disconnect();this.a=null;this.b.disconnect();this.b=null;return this};return Tone.CrossFade});Module(function(Tone){Tone.Filter=function(){Tone.call(this);var options=this.optionsObject(arguments,["frequency","type","rolloff"],Tone.Filter.defaults);this._filters=[];this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.detune=new Tone.Signal(0,Tone.Type.Cents);this.gain=new Tone.Signal({value:options.gain,units:Tone.Type.Decibels,convert:false});this.Q=new Tone.Signal(options.Q);this._type=options.type;this._rolloff=options.rolloff;this.rolloff=options.rolloff;this._readOnly(["detune","frequency","gain","Q"])};Tone.extend(Tone.Filter);Tone.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0};Object.defineProperty(Tone.Filter.prototype,"type",{get:function(){return this._type},set:function(type){var types=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(types.indexOf(type)===-1){throw new TypeError("Tone.Filter does not have filter type "+type)}this._type=type;for(var i=0;i<this._filters.length;i++){this._filters[i].type=type}}});Object.defineProperty(Tone.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(rolloff){var possibilities=[-12,-24,-48];var cascadingCount=possibilities.indexOf(rolloff);if(cascadingCount===-1){throw new RangeError("Filter rolloff can only be -12, -24, or -48")}cascadingCount++;this._rolloff=rolloff;this.input.disconnect();for(var i=0;i<this._filters.length;i++){this._filters[i].disconnect();this._filters[i]=null}this._filters=new Array(cascadingCount);for(var count=0;count<cascadingCount;count++){var filter=this.context.createBiquadFilter();filter.type=this._type;this.frequency.connect(filter.frequency);this.detune.connect(filter.detune);this.Q.connect(filter.Q);this.gain.connect(filter.gain);this._filters[count]=filter}var connectionChain=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,connectionChain)}});Tone.Filter.prototype.dispose=function(){Tone.prototype.dispose.call(this);for(var i=0;i<this._filters.length;i++){this._filters[i].disconnect();this._filters[i]=null}this._filters=null;this._writable(["detune","frequency","gain","Q"]);this.frequency.dispose();this.Q.dispose();this.frequency=null;this.Q=null;this.detune.dispose();this.detune=null;this.gain.dispose();this.gain=null;return this};return Tone.Filter});Module(function(Tone){Tone.MultibandSplit=function(){var options=this.optionsObject(arguments,["lowFrequency","highFrequency"],Tone.MultibandSplit.defaults);this.input=this.context.createGain();this.output=new Array(3);this.low=this.output[0]=new Tone.Filter(0,"lowpass");this._lowMidFilter=new Tone.Filter(0,"highpass");this.mid=this.output[1]=new Tone.Filter(0,"lowpass");this.high=this.output[2]=new Tone.Filter(0,"highpass");this.lowFrequency=new Tone.Signal(options.lowFrequency,Tone.Type.Frequency);this.highFrequency=new Tone.Signal(options.highFrequency,Tone.Type.Frequency);this.Q=new Tone.Signal(options.Q);this.input.fan(this.low,this.high);this.input.chain(this._lowMidFilter,this.mid);this.lowFrequency.connect(this.low.frequency);this.lowFrequency.connect(this._lowMidFilter.frequency);this.highFrequency.connect(this.mid.frequency);this.highFrequency.connect(this.high.frequency);this.Q.connect(this.low.Q);this.Q.connect(this._lowMidFilter.Q);this.Q.connect(this.mid.Q);this.Q.connect(this.high.Q);this._readOnly(["high","mid","low","highFrequency","lowFrequency"])};Tone.extend(Tone.MultibandSplit);Tone.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1};Tone.MultibandSplit.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["high","mid","low","highFrequency","lowFrequency"]);this.low.dispose();this.low=null;this._lowMidFilter.dispose();this._lowMidFilter=null;this.mid.dispose();this.mid=null;this.high.dispose();this.high=null;this.lowFrequency.dispose();this.lowFrequency=null;this.highFrequency.dispose();this.highFrequency=null;this.Q.dispose();this.Q=null;return this};return Tone.MultibandSplit});Module(function(Tone){Tone.EQ3=function(){var options=this.optionsObject(arguments,["low","mid","high"],Tone.EQ3.defaults);this.output=this.context.createGain();this._multibandSplit=this.input=new Tone.MultibandSplit({lowFrequency:options.lowFrequency,highFrequency:options.highFrequency});this._lowGain=this.context.createGain();this._midGain=this.context.createGain();this._highGain=this.context.createGain();this.low=new Tone.Signal(this._lowGain.gain,Tone.Type.Decibels);this.mid=new Tone.Signal(this._midGain.gain,Tone.Type.Decibels);this.high=new Tone.Signal(this._highGain.gain,Tone.Type.Decibels);this.Q=this._multibandSplit.Q;this.lowFrequency=this._multibandSplit.lowFrequency;this.highFrequency=this._multibandSplit.highFrequency;this._multibandSplit.low.chain(this._lowGain,this.output);this._multibandSplit.mid.chain(this._midGain,this.output);this._multibandSplit.high.chain(this._highGain,this.output);this.low.value=options.low;this.mid.value=options.mid;this.high.value=options.high;this._readOnly(["low","mid","high","lowFrequency","highFrequency"])};Tone.extend(Tone.EQ3);Tone.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500};Tone.EQ3.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["low","mid","high","lowFrequency","highFrequency"]);this._multibandSplit.dispose();this._multibandSplit=null;this.lowFrequency=null;this.highFrequency=null;this._lowGain.disconnect();this._lowGain=null;this._midGain.disconnect();this._midGain=null;this._highGain.disconnect();this._highGain=null;this.low.dispose();this.low=null;this.mid.dispose();this.mid=null;this.high.dispose();this.high=null;this.Q=null;return this};return Tone.EQ3});Module(function(Tone){Tone.Scale=function(outputMin,outputMax){this._outputMin=this.defaultArg(outputMin,0);this._outputMax=this.defaultArg(outputMax,1);this._scale=this.input=new Tone.Multiply(1);this._add=this.output=new Tone.Add(0);this._scale.connect(this._add);this._setRange()};Tone.extend(Tone.Scale,Tone.SignalBase);Object.defineProperty(Tone.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(min){this._outputMin=min;this._setRange()}});Object.defineProperty(Tone.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(max){this._outputMax=max;this._setRange()}});Tone.Scale.prototype._setRange=function(){this._add.value=this._outputMin;this._scale.value=this._outputMax-this._outputMin};Tone.Scale.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._add.dispose();this._add=null;this._scale.dispose();this._scale=null;return this};return Tone.Scale});Module(function(Tone){Tone.ScaleExp=function(outputMin,outputMax,exponent){this._scale=this.output=new Tone.Scale(outputMin,outputMax);this._exp=this.input=new Tone.Pow(this.defaultArg(exponent,2));this._exp.connect(this._scale)};Tone.extend(Tone.ScaleExp,Tone.SignalBase);Object.defineProperty(Tone.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}});Object.defineProperty(Tone.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(min){this._scale.min=min}});Object.defineProperty(Tone.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(max){this._scale.max=max}});Tone.ScaleExp.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._exp.dispose();this._exp=null;return this};return Tone.ScaleExp});Module(function(Tone){Tone.FeedbackCombFilter=function(){Tone.call(this);var options=this.optionsObject(arguments,["delayTime","resonance"],Tone.FeedbackCombFilter.defaults);this.resonance=new Tone.Signal(options.resonance,Tone.Type.NormalRange);this._delay=this.input=this.output=this.context.createDelay(1);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this._feedback=this.context.createGain();this._delay.chain(this._feedback,this._delay);this.resonance.connect(this._feedback.gain);this.delayTime.connect(this._delay.delayTime);this._readOnly(["resonance","delayTime"])};Tone.extend(Tone.FeedbackCombFilter);Tone.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5};Tone.FeedbackCombFilter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["resonance","delayTime"]);this._delay.disconnect();this._delay=null;this.delayTime.dispose();this.delayTime=null;this.resonance.dispose();this.resonance=null;this._feedback.disconnect();this._feedback=null;return this};return Tone.FeedbackCombFilter});Module(function(Tone){Tone.Follower=function(){Tone.call(this);var options=this.optionsObject(arguments,["attack","release"],Tone.Follower.defaults);this._abs=new Tone.Abs;this._filter=this.context.createBiquadFilter();this._filter.type="lowpass";this._filter.frequency.value=0;this._filter.Q.value=-100;this._frequencyValues=new Tone.WaveShaper;this._sub=new Tone.Subtract;this._delay=this.context.createDelay();this._delay.delayTime.value=this.bufferTime;this._mult=new Tone.Multiply(1e4);this._attack=options.attack;this._release=options.release;this.input.chain(this._abs,this._filter,this.output);this._abs.connect(this._sub,0,1);this._filter.chain(this._delay,this._sub);this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency);this._setAttackRelease(this._attack,this._release)};Tone.extend(Tone.Follower);Tone.Follower.defaults={attack:.05,release:.5};Tone.Follower.prototype._setAttackRelease=function(attack,release){var minTime=this.bufferTime;attack=this.secondsToFrequency(this.toSeconds(attack));release=this.secondsToFrequency(this.toSeconds(release));attack=Math.max(attack,minTime);release=Math.max(release,minTime);this._frequencyValues.setMap(function(val){if(val<=0){return attack}else{return release}})};Object.defineProperty(Tone.Follower.prototype,"attack",{get:function(){return this._attack},set:function(attack){this._attack=attack;this._setAttackRelease(this._attack,this._release)}});Object.defineProperty(Tone.Follower.prototype,"release",{get:function(){return this._release},set:function(release){this._release=release;this._setAttackRelease(this._attack,this._release)}});Tone.Follower.prototype.connect=Tone.Signal.prototype.connect;Tone.Follower.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._filter.disconnect();this._filter=null;this._frequencyValues.disconnect();this._frequencyValues=null;this._delay.disconnect();this._delay=null;this._sub.disconnect();this._sub=null;this._abs.dispose();this._abs=null;this._mult.dispose();this._mult=null;this._curve=null;return this};return Tone.Follower});Module(function(Tone){Tone.Gate=function(){Tone.call(this);var options=this.optionsObject(arguments,["threshold","attack","release"],Tone.Gate.defaults);this._follower=new Tone.Follower(options.attack,options.release);this._gt=new Tone.GreaterThan(this.dbToGain(options.threshold));this.input.connect(this.output);this.input.chain(this._gt,this._follower,this.output.gain)};Tone.extend(Tone.Gate);Tone.Gate.defaults={attack:.1,release:.1,threshold:-40};Object.defineProperty(Tone.Gate.prototype,"threshold",{get:function(){return this.gainToDb(this._gt.value)},set:function(thresh){this._gt.value=this.dbToGain(thresh)}});Object.defineProperty(Tone.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(attackTime){this._follower.attack=attackTime}});Object.defineProperty(Tone.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(releaseTime){this._follower.release=releaseTime}});Tone.Gate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._follower.dispose();this._gt.dispose();this._follower=null;this._gt=null;return this};return Tone.Gate});Module(function(Tone){Tone.Clock=function(frequency,callback){this._oscillator=null;this._jsNode=this.context.createScriptProcessor(this.bufferSize,1,1);this._jsNode.onaudioprocess=this._processBuffer.bind(this);this.frequency=new Tone.Signal(frequency,Tone.Type.Frequency);this._upTick=false;this.tick=callback;this.onended=Tone.noOp;this._jsNode.noGC()};Tone.extend(Tone.Clock);Tone.Clock.prototype.start=function(time){if(!this._oscillator){this._oscillator=this.context.createOscillator();this._oscillator.type="square";this._oscillator.connect(this._jsNode);this.frequency.connect(this._oscillator.frequency);this._upTick=false;var startTime=this.toSeconds(time);this._oscillator.start(startTime)}return this};Tone.Clock.prototype.stop=function(time){if(this._oscillator){var now=this.now();var stopTime=this.toSeconds(time,now);this._oscillator.stop(stopTime);this._oscillator=null;if(time){setTimeout(this.onended,(stopTime-now)*1e3)}else{this.onended()}}return this};Tone.Clock.prototype._processBuffer=function(event){var now=this.defaultArg(event.playbackTime,this.now());var bufferSize=this._jsNode.bufferSize;var incomingBuffer=event.inputBuffer.getChannelData(0);var upTick=this._upTick;var self=this;for(var i=0;i<bufferSize;i++){var sample=incomingBuffer[i];if(sample>0&&!upTick){upTick=true;setTimeout(function(){var tickTime=now+self.samplesToSeconds(i+bufferSize*2);return function(){if(self.tick){self.tick(tickTime)}}}(),0)}else if(sample<0&&upTick){upTick=false}}this._upTick=upTick};Tone.Clock.prototype.dispose=function(){this._jsNode.disconnect();this.frequency.dispose();this.frequency=null;if(this._oscillator){this._oscillator.disconnect();this._oscillator=null}this._jsNode.onaudioprocess=Tone.noOp;this._jsNode=null;this.tick=null;this.onended=Tone.noOp;return this};return Tone.Clock});Module(function(Tone){Tone.Transport=function(){this._clock=new Tone.Clock(0,this._processTick.bind(this));this._clock.onended=this._onended.bind(this);this.loop=false;this.bpm=new Tone.Signal(120,Tone.Type.BPM);this._bpmMult=new Tone.Multiply(1/60*tatum);this.state=Tone.State.Stopped;this.bpm.chain(this._bpmMult,this._clock.frequency)};Tone.extend(Tone.Transport);Tone.Transport.defaults={bpm:120,swing:0,swingSubdivision:"16n",timeSignature:4,loopStart:0,loopEnd:"4m"};var tatum=12;var timelineTicks=0;var transportTicks=0;var swingSubdivision="16n";var swingTatum=3;var swingAmount=0;var transportTimeSignature=4;var loopStart=0;var loopEnd=tatum*4;var intervals=[];var timeouts=[];var transportTimeline=[];var timelineProgress=0;var SyncedSources=[];var SyncedSignals=[];Tone.Transport.prototype._processTick=function(tickTime){if(this.state===Tone.State.Started){if(swingAmount>0&&timelineTicks%tatum!==0&&timelineTicks%swingTatum===0){tickTime+=this._ticksToSeconds(swingTatum)*swingAmount}processIntervals(tickTime);processTimeouts(tickTime);processTimeline(tickTime);transportTicks+=1;timelineTicks+=1;if(this.loop){if(timelineTicks===loopEnd){this._setTicks(loopStart)}}}};Tone.Transport.prototype._setTicks=function(ticks){timelineTicks=ticks;for(var i=0;i<transportTimeline.length;i++){var timeout=transportTimeline[i];if(timeout.callbackTick()>=ticks){timelineProgress=i;break}}};var processIntervals=function(time){for(var i=0,len=intervals.length;i<len;i++){var interval=intervals[i];if(interval.testInterval(transportTicks)){interval.doCallback(time)}}};var processTimeouts=function(time){var removeTimeouts=0;for(var i=0,len=timeouts.length;i<len;i++){var timeout=timeouts[i];var callbackTick=timeout.callbackTick();if(callbackTick<=transportTicks){timeout.doCallback(time);removeTimeouts++}else if(callbackTick>transportTicks){break}}timeouts.splice(0,removeTimeouts)};var processTimeline=function(time){for(var i=timelineProgress,len=transportTimeline.length;i<len;i++){var evnt=transportTimeline[i];var callbackTick=evnt.callbackTick();if(callbackTick===timelineTicks){timelineProgress=i;evnt.doCallback(time)}else if(callbackTick>timelineTicks){break}}};Tone.Transport.prototype.setInterval=function(callback,interval,ctx){var tickTime=this._toTicks(interval);var timeout=new TimelineEvent(callback,ctx,tickTime,transportTicks);intervals.push(timeout);return timeout.id};Tone.Transport.prototype.clearInterval=function(rmInterval){for(var i=0;i<intervals.length;i++){var interval=intervals[i];if(interval.id===rmInterval){intervals.splice(i,1);return true}}return false};Tone.Transport.prototype.clearIntervals=function(){var willRemove=intervals.length>0;intervals=[];return willRemove};Tone.Transport.prototype.setTimeout=function(callback,time,ctx){var ticks=this._toTicks(time);var timeout=new TimelineEvent(callback,ctx,ticks+transportTicks,0);for(var i=0,len=timeouts.length;i<len;i++){var testEvnt=timeouts[i];if(testEvnt.callbackTick()>timeout.callbackTick()){timeouts.splice(i,0,timeout);return timeout.id}}timeouts.push(timeout);return timeout.id};Tone.Transport.prototype.clearTimeout=function(timeoutID){for(var i=0;i<timeouts.length;i++){var testTimeout=timeouts[i];if(testTimeout.id===timeoutID){timeouts.splice(i,1);return true}}return false};Tone.Transport.prototype.clearTimeouts=function(){var willRemove=timeouts.length>0;timeouts=[];return willRemove};Tone.Transport.prototype.setTimeline=function(callback,timeout,ctx){var ticks=this._toTicks(timeout);var timelineEvnt=new TimelineEvent(callback,ctx,ticks,0);for(var i=timelineProgress,len=transportTimeline.length;i<len;i++){var testEvnt=transportTimeline[i];if(testEvnt.callbackTick()>timelineEvnt.callbackTick()){transportTimeline.splice(i,0,timelineEvnt);return timelineEvnt.id}}transportTimeline.push(timelineEvnt);return timelineEvnt.id};Tone.Transport.prototype.clearTimeline=function(timelineID){for(var i=0;i<transportTimeline.length;i++){var testTimeline=transportTimeline[i];if(testTimeline.id===timelineID){transportTimeline.splice(i,1);return true}}return false};Tone.Transport.prototype.clearTimelines=function(){timelineProgress=0;var willRemove=transportTimeline.length>0;transportTimeline=[];return willRemove};Tone.Transport.prototype._toTicks=function(time){var seconds=this.toSeconds(time);var quarter=this.notationToSeconds("4n");var quarters=seconds/quarter;var tickNum=quarters*tatum;return Math.round(tickNum)};Tone.Transport.prototype._ticksToSeconds=function(ticks,bpm,timeSignature){ticks=Math.floor(ticks);var quater=this.notationToSeconds("4n",bpm,timeSignature);return quater*ticks/tatum};Tone.Transport.prototype.nextBeat=function(subdivision){subdivision=this.defaultArg(subdivision,"4n");var tickNum=this._toTicks(subdivision);var remainingTicks=transportTicks%tickNum;var nextTick=remainingTicks;if(remainingTicks>0){nextTick=tickNum-remainingTicks}return this._ticksToSeconds(nextTick)};Tone.Transport.prototype.start=function(time,offset){if(this.state===Tone.State.Stopped||this.state===Tone.State.Paused){if(!this.isUndef(offset)){this._setTicks(this._toTicks(offset))}this.state=Tone.State.Started;var startTime=this.toSeconds(time);this._clock.start(startTime);for(var i=0;i<SyncedSources.length;i++){var source=SyncedSources[i].source;var delay=SyncedSources[i].delay;source.start(startTime+delay)}}return this};Tone.Transport.prototype.stop=function(time){if(this.state===Tone.State.Started||this.state===Tone.State.Paused){var stopTime=this.toSeconds(time);this._clock.stop(stopTime);for(var i=0;i<SyncedSources.length;i++){var source=SyncedSources[i].source;source.stop(stopTime)}}else{this._onended()}return this};Tone.Transport.prototype._onended=function(){transportTicks=0;this._setTicks(0);this.clearTimeouts();this.state=Tone.State.Stopped};Tone.Transport.prototype.pause=function(time){if(this.state===Tone.State.Started){this.state=Tone.State.Paused;var stopTime=this.toSeconds(time);this._clock.stop(stopTime);for(var i=0;i<SyncedSources.length;i++){var source=SyncedSources[i].source;source.pause(stopTime)}}return this};Object.defineProperty(Tone.Transport.prototype,"timeSignature",{get:function(){return transportTimeSignature},set:function(numerator){transportTimeSignature=numerator}});Object.defineProperty(Tone.Transport.prototype,"loopStart",{get:function(){return this._ticksToSeconds(loopStart)},set:function(startPosition){loopStart=this._toTicks(startPosition)}});Object.defineProperty(Tone.Transport.prototype,"loopEnd",{get:function(){return this._ticksToSeconds(loopEnd)},set:function(endPosition){loopEnd=this._toTicks(endPosition)}});Tone.Transport.prototype.setLoopPoints=function(startPosition,endPosition){this.loopStart=startPosition;this.loopEnd=endPosition;return this};Object.defineProperty(Tone.Transport.prototype,"swing",{get:function(){return swingAmount*2},set:function(amount){swingAmount=amount*.5}});Object.defineProperty(Tone.Transport.prototype,"swingSubdivision",{get:function(){return swingSubdivision},set:function(subdivision){swingSubdivision=subdivision;swingTatum=this._toTicks(subdivision)}});Object.defineProperty(Tone.Transport.prototype,"position",{get:function(){var quarters=timelineTicks/tatum;var measures=Math.floor(quarters/transportTimeSignature);var sixteenths=Math.floor(quarters%1*4);quarters=Math.floor(quarters)%transportTimeSignature;var progress=[measures,quarters,sixteenths];return progress.join(":")},set:function(progress){var ticks=this._toTicks(progress);this._setTicks(ticks)}});Tone.Transport.prototype.syncSource=function(source,startDelay){SyncedSources.push({source:source,delay:this.toSeconds(this.defaultArg(startDelay,0))});return this};Tone.Transport.prototype.unsyncSource=function(source){for(var i=0;i<SyncedSources.length;i++){if(SyncedSources[i].source===source){SyncedSources.splice(i,1)}}return this};Tone.Transport.prototype.syncSignal=function(signal,ratio){if(!ratio){if(signal._value.value!==0){ratio=signal._value.value/this.bpm.value}else{ratio=0}}var ratioSignal=this.context.createGain();ratioSignal.gain.value=ratio;this.bpm.chain(ratioSignal,signal._value);SyncedSignals.push({ratio:ratioSignal,signal:signal,initial:signal._value.value});signal._value.value=0;return this};Tone.Transport.prototype.unsyncSignal=function(signal){for(var i=0;i<SyncedSignals.length;i++){var syncedSignal=SyncedSignals[i];if(syncedSignal.signal===signal){syncedSignal.ratio.disconnect();syncedSignal.signal._value.value=syncedSignal.initial;SyncedSignals.splice(i,1)}}return this};Tone.Transport.prototype.dispose=function(){this._clock.dispose();this._clock=null;this.bpm.dispose();this.bpm=null;this._bpmMult.dispose();this._bpmMult=null;return this};var TimelineEventIDCounter=0;var TimelineEvent=function(callback,context,tickTime,startTicks){this.startTicks=startTicks;this.tickTime=tickTime;this.callback=callback;this.context=context;this.id=TimelineEventIDCounter++};TimelineEvent.prototype.doCallback=function(playbackTime){this.callback.call(this.context,playbackTime)};TimelineEvent.prototype.callbackTick=function(){return this.startTicks+this.tickTime};TimelineEvent.prototype.testInterval=function(tick){return(tick-this.startTicks)%this.tickTime===0};Tone.prototype.isNotation=function(){var notationFormat=new RegExp(/[0-9]+[mnt]$/i);return function(note){return notationFormat.test(note)}}();Tone.prototype.isTransportTime=function(){var transportTimeFormat=new RegExp(/^\d+(\.\d+)?:\d+(\.\d+)?(:\d+(\.\d+)?)?$/i);return function(transportTime){return transportTimeFormat.test(transportTime)}}();Tone.prototype.notationToSeconds=function(notation,bpm,timeSignature){bpm=this.defaultArg(bpm,Tone.Transport.bpm.value);timeSignature=this.defaultArg(timeSignature,transportTimeSignature);var beatTime=60/bpm;var subdivision=parseInt(notation,10);var beats=0;if(subdivision===0){beats=0}var lastLetter=notation.slice(-1);if(lastLetter==="t"){beats=4/subdivision*2/3}else if(lastLetter==="n"){beats=4/subdivision}else if(lastLetter==="m"){beats=subdivision*timeSignature}else{beats=0}return beatTime*beats};Tone.prototype.transportTimeToSeconds=function(transportTime,bpm,timeSignature){bpm=this.defaultArg(bpm,Tone.Transport.bpm.value);timeSignature=this.defaultArg(timeSignature,transportTimeSignature);var measures=0;var quarters=0;var sixteenths=0;var split=transportTime.split(":");if(split.length===2){measures=parseFloat(split[0]);quarters=parseFloat(split[1])}else if(split.length===1){quarters=parseFloat(split[0])}else if(split.length===3){measures=parseFloat(split[0]);quarters=parseFloat(split[1]);sixteenths=parseFloat(split[2])}var beats=measures*timeSignature+quarters+sixteenths/4;return beats*this.notationToSeconds("4n")};Tone.prototype.toTransportTime=function(time,bpm,timeSignature){var seconds=this.toSeconds(time,bpm,timeSignature);bpm=this.defaultArg(bpm,Tone.Transport.bpm.value);timeSignature=this.defaultArg(timeSignature,transportTimeSignature);var quarterTime=this.notationToSeconds("4n");var quarters=seconds/quarterTime;var measures=Math.floor(quarters/timeSignature);var sixteenths=Math.floor(quarters%1*4);quarters=Math.floor(quarters)%timeSignature;var progress=[measures,quarters,sixteenths];return progress.join(":")};Tone.prototype.toFrequency=function(freq,now){if(this.isFrequency(freq)){return parseFloat(freq)}else if(this.isNotation(freq)||this.isTransportTime(freq)){return this.secondsToFrequency(this.toSeconds(freq,now))}else{return freq}};Tone.prototype.toSeconds=function(time,now){now=this.defaultArg(now,this.now());if(typeof time==="number"){return time}else if(typeof time==="string"){var plusTime=0;if(time.charAt(0)==="+"){plusTime=now;time=time.slice(1)}var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){var originalTime=time;for(var i=0;i<components.length;i++){var symb=components[i].trim();if(symb!==""){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(e){throw new EvalError("problem evaluating Tone.Type.Time: "+originalTime)}}else if(this.isNotation(time)){time=this.notationToSeconds(time)}else if(this.isTransportTime(time)){time=this.transportTimeToSeconds(time)}else if(this.isFrequency(time)){time=this.frequencyToSeconds(time)}else{time=parseFloat(time)}return time+plusTime}else{return now}};var TransportConstructor=Tone.Transport;Tone._initAudioContext(function(){if(typeof Tone.Transport==="function"){Tone.Transport=new Tone.Transport}else{Tone.Transport.stop();var bpm=Tone.Transport.bpm.value;Tone.Transport._clock.dispose();TransportConstructor.call(Tone.Transport);Tone.Transport.bpm.value=bpm}});return Tone.Transport});Module(function(Tone){Tone.Master=function(){Tone.call(this);this._unmutedVolume=1;this._muted=false;this.volume=new Tone.Signal(this.output.gain,Tone.Type.Decibels);this.input.chain(this.output,this.context.destination)};Tone.extend(Tone.Master);Tone.Master.defaults={volume:0,mute:false};Object.defineProperty(Tone.Master.prototype,"mute",{get:function(){return this._muted},set:function(mute){if(!this._muted&&mute){this._unmutedVolume=this.volume.value;this.volume.value=-Infinity}else if(this._muted&&!mute){this.volume.value=this._unmutedVolume}this._muted=mute}});Tone.Master.prototype.chain=function(){this.input.disconnect();this.input.chain.apply(this.input,arguments);arguments[arguments.length-1].connect(this.output)};Tone.prototype.toMaster=function(){this.connect(Tone.Master);return this};AudioNode.prototype.toMaster=function(){this.connect(Tone.Master);return this};var MasterConstructor=Tone.Master;Tone._initAudioContext(function(){if(!Tone.prototype.isUndef(Tone.Master)){Tone.Master=new MasterConstructor}else{MasterConstructor.prototype.dispose.call(Tone.Master);MasterConstructor.call(Tone.Master)}});return Tone.Master});Module(function(Tone){Tone.Source=function(options){Tone.call(this,0,1);options=this.defaultArg(options,Tone.Source.defaults);this.onended=options.onended;this._nextStart=Infinity;this._nextStop=Infinity;this.volume=new Tone.Signal({param:this.output.gain,value:options.volume,units:Tone.Type.Decibels});this._readOnly("volume");this._timeout=-1;this.output.channelCount=2;this.output.channelCountMode="explicit"};Tone.extend(Tone.Source);Tone.Source.defaults={onended:Tone.noOp,volume:0};Object.defineProperty(Tone.Source.prototype,"state",{get:function(){return this._stateAtTime(this.now())}});Tone.Source.prototype._stateAtTime=function(time){time=this.toSeconds(time);if(this._nextStart<=time&&this._nextStop>time){return Tone.State.Started}else if(this._nextStop<=time){return Tone.State.Stopped}else{return Tone.State.Stopped}};Tone.Source.prototype.start=function(time){time=this.toSeconds(time);if(this._stateAtTime(time)!==Tone.State.Started||this.retrigger){this._nextStart=time;this._nextStop=Infinity;this._start.apply(this,arguments)}return this};Tone.Source.prototype.stop=function(time){var now=this.now();time=this.toSeconds(time,now);if(this._stateAtTime(time)===Tone.State.Started){this._nextStop=this.toSeconds(time);clearTimeout(this._timeout);var diff=time-now;if(diff>0){this._timeout=setTimeout(this.onended,diff*1e3+20)}else{this.onended()}this._stop.apply(this,arguments)}return this};Tone.Source.prototype.pause=function(time){this.stop(time);return this};Tone.Source.prototype.sync=function(delay){Tone.Transport.syncSource(this,delay);return this};Tone.Source.prototype.unsync=function(){Tone.Transport.unsyncSource(this);return this};Tone.Source.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.stop();clearTimeout(this._timeout);this.onended=Tone.noOp;this._writable("volume");this.volume.dispose();this.volume=null};return Tone.Source});Module(function(Tone){Tone.Oscillator=function(){var options=this.optionsObject(arguments,["frequency","type"],Tone.Oscillator.defaults);Tone.Source.call(this,options);this._oscillator=null;this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.detune=new Tone.Signal(options.detune,Tone.Type.Cents);this._wave=null;this._phase=options.phase;this._type=null;this.type=options.type;this.phase=this._phase;this._readOnly(["frequency","detune"])};Tone.extend(Tone.Oscillator,Tone.Source);Tone.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0};Tone.Oscillator.prototype._start=function(time){this._oscillator=this.context.createOscillator();this._oscillator.setPeriodicWave(this._wave);this._oscillator.connect(this.output);this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.start(this.toSeconds(time))};Tone.Oscillator.prototype._stop=function(time){if(this._oscillator){this._oscillator.stop(this.toSeconds(time));this._oscillator=null}return this};Tone.Oscillator.prototype.syncFrequency=function(){Tone.Transport.syncSignal(this.frequency);return this};Tone.Oscillator.prototype.unsyncFrequency=function(){Tone.Transport.unsyncSignal(this.frequency);return this};Object.defineProperty(Tone.Oscillator.prototype,"type",{get:function(){return this._type},set:function(type){var originalType=type;var fftSize=4096;var periodicWaveSize=fftSize/2;var real=new Float32Array(periodicWaveSize);var imag=new Float32Array(periodicWaveSize);var partialCount=1;var partial=/(sine|triangle|square|sawtooth)(\d+)$/.exec(type);if(partial){partialCount=parseInt(partial[2]);type=partial[1];partialCount=Math.max(partialCount,2);periodicWaveSize=partialCount}var shift=this._phase;for(var n=1;n<periodicWaveSize;++n){var piFactor=2/(n*Math.PI);var b;switch(type){case"sine":b=n<=partialCount?1:0;break;case"square":b=n&1?2*piFactor:0;break;case"sawtooth":b=piFactor*(n&1?1:-1);break;case"triangle":if(n&1){b=2*(piFactor*piFactor)*(n-1>>1&1?-1:1)}else{b=0}break;default:throw new TypeError("invalid oscillator type: "+type)}if(b!==0){real[n]=-b*Math.sin(shift*n);imag[n]=b*Math.cos(shift*n)}else{real[n]=0;imag[n]=0}}var periodicWave=this.context.createPeriodicWave(real,imag);this._wave=periodicWave;if(this._oscillator!==null){this._oscillator.setPeriodicWave(this._wave)}this._type=originalType}});Object.defineProperty(Tone.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(phase){this._phase=phase*Math.PI/180;this.type=this._type}});Tone.Oscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._oscillator!==null){this._oscillator.disconnect();this._oscillator=null}this._wave=null;this._writable(["frequency","detune"]);this.frequency.dispose();this.frequency=null;this.detune.dispose();this.detune=null;return this};return Tone.Oscillator});Module(function(Tone){Tone.AudioToGain=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return(x+1)/2})};Tone.extend(Tone.AudioToGain,Tone.SignalBase);Tone.AudioToGain.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._norm.dispose();this._norm=null;return this};return Tone.AudioToGain});Module(function(Tone){Tone.LFO=function(){var options=this.optionsObject(arguments,["frequency","min","max"],Tone.LFO.defaults);this.oscillator=new Tone.Oscillator({frequency:options.frequency,type:options.type,phase:options.phase+90});this.frequency=this.oscillator.frequency;this.amplitude=this.oscillator.volume;this.amplitude.units=Tone.Type.NormalRange;this.amplitude.value=options.amplitude;this._a2g=new Tone.AudioToGain;this._scaler=this.output=new Tone.Scale(options.min,options.max);this._units=Tone.Type.Default;this.oscillator.chain(this._a2g,this._scaler);this._readOnly(["amplitude","frequency","oscillator"])};Tone.extend(Tone.LFO,Tone.Oscillator);Tone.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1};Tone.LFO.prototype.start=function(time){this.oscillator.start(time);return this};Tone.LFO.prototype.stop=function(time){this.oscillator.stop(time);return this};Tone.LFO.prototype.sync=function(delay){this.oscillator.sync(delay);this.oscillator.syncFrequency();return this};Tone.LFO.prototype.unsync=function(){this.oscillator.unsync();this.oscillator.unsyncFrequency();return this};Object.defineProperty(Tone.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(min){min=this._fromUnits(min);this._scaler.min=min}});Object.defineProperty(Tone.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(max){max=this._fromUnits(max);this._scaler.max=max}});Object.defineProperty(Tone.LFO.prototype,"type",{get:function(){return this.oscillator.type},set:function(type){this.oscillator.type=type}});Object.defineProperty(Tone.LFO.prototype,"phase",{get:function(){return this.oscillator.phase-90},set:function(phase){this.oscillator.phase=phase+90}});Object.defineProperty(Tone.LFO.prototype,"units",{get:function(){return this._units},set:function(val){var currentMin=this.min;var currentMax=this.max;this._units=val;this.min=currentMin;this.max=currentMax}});Tone.LFO.prototype.connect=function(node){if(node.constructor===Tone.Signal){this.convert=node.convert;this.units=node.units}Tone.Signal.prototype.connect.apply(this,arguments);return this};Tone.LFO.prototype._fromUnits=Tone.Signal.prototype._fromUnits;Tone.LFO.prototype._toUnits=Tone.Signal.prototype._toUnits;Tone.LFO.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["amplitude","frequency","oscillator"]);this.oscillator.dispose();this.oscillator=null;this._scaler.dispose();this._scaler=null;this._a2g.dispose();this._a2g=null;this.frequency=null;this.amplitude=null;return this};return Tone.LFO});Module(function(Tone){Tone.Limiter=function(threshold){this._compressor=this.input=this.output=new Tone.Compressor({attack:.001,decay:.001,threshold:threshold});this.threshold=this._compressor.threshold;this._readOnly("threshold")};Tone.extend(Tone.Limiter);Tone.Limiter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._compressor.dispose();this._compressor=null;this._writable("threshold");this.threshold=null;return this};return Tone.Limiter});Module(function(Tone){Tone.LowpassCombFilter=function(){Tone.call(this);var options=this.optionsObject(arguments,["delayTime","resonance","dampening"],Tone.LowpassCombFilter.defaults);this._delay=this.input=this.context.createDelay(1);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this._lowpass=this.output=this.context.createBiquadFilter();this._lowpass.Q.value=0;this._lowpass.type="lowpass";this.dampening=new Tone.Signal(this._lowpass.frequency,Tone.Type.Frequency);this.dampening.value=options.dampening;this._feedback=this.context.createGain();this.resonance=new Tone.Signal(options.resonance,Tone.Type.NormalRange);this._delay.chain(this._lowpass,this._feedback,this._delay);this.delayTime.connect(this._delay.delayTime);this.resonance.connect(this._feedback.gain);this.dampening.connect(this._lowpass.frequency);this._readOnly(["dampening","resonance","delayTime"])};Tone.extend(Tone.LowpassCombFilter);Tone.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3};Tone.LowpassCombFilter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["dampening","resonance","delayTime"]);this.dampening.dispose();this.dampening=null;this.resonance.dispose();this.resonance=null;this._delay.disconnect();this._delay=null;this._lowpass.disconnect();this._lowpass=null;this._feedback.disconnect();this._feedback=null;this.delayTime.dispose();this.delayTime=null;return this};return Tone.LowpassCombFilter});Module(function(Tone){Tone.Merge=function(){Tone.call(this,2,0);this.left=this.input[0]=this.context.createGain();this.right=this.input[1]=this.context.createGain();this._merger=this.output=this.context.createChannelMerger(2);this.left.connect(this._merger,0,0);this.right.connect(this._merger,0,1)};Tone.extend(Tone.Merge);Tone.Merge.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.left.disconnect();this.left=null;this.right.disconnect();this.right=null;this._merger.disconnect();this._merger=null;return this};return Tone.Merge});Module(function(Tone){Tone.Meter=function(channels,smoothing,clipMemory){Tone.call(this);this._channels=this.defaultArg(channels,1);this._smoothing=this.defaultArg(smoothing,.8);this._clipMemory=this.defaultArg(clipMemory,.5)*1e3;this._volume=new Array(this._channels);this._values=new Array(this._channels);for(var i=0;i<this._channels;i++){this._volume[i]=0;this._values[i]=0}this._lastClip=0;this._jsNode=this.context.createScriptProcessor(this.bufferSize,this._channels,1);this._jsNode.onaudioprocess=this._onprocess.bind(this);this._jsNode.noGC();this.input.connect(this.output);this.input.connect(this._jsNode)};Tone.extend(Tone.Meter);Tone.Meter.prototype._onprocess=function(event){var bufferSize=this._jsNode.bufferSize;var smoothing=this._smoothing;for(var channel=0;channel<this._channels;channel++){var input=event.inputBuffer.getChannelData(channel);var sum=0;var total=0;var x;var clipped=false;for(var i=0;i<bufferSize;i++){x=input[i];if(!clipped&&x>.95){clipped=true;this._lastClip=Date.now()}total+=x;sum+=x*x}var average=total/bufferSize;var rms=Math.sqrt(sum/bufferSize);this._volume[channel]=Math.max(rms,this._volume[channel]*smoothing);this._values[channel]=average}};Tone.Meter.prototype.getLevel=function(channel){channel=this.defaultArg(channel,0);var vol=this._volume[channel];if(vol<1e-5){return 0}else{return vol}};Tone.Meter.prototype.getValue=function(channel){channel=this.defaultArg(channel,0);return this._values[channel]};Tone.Meter.prototype.getDb=function(channel){return this.gainToDb(this.getLevel(channel))};Tone.Meter.prototype.isClipped=function(){return Date.now()-this._lastClip<this._clipMemory};Tone.Meter.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._jsNode.disconnect();this._jsNode.onaudioprocess=null;this._volume=null;this._values=null;return this};return Tone.Meter});Module(function(Tone){Tone.Split=function(){Tone.call(this,0,2);this._splitter=this.input=this.context.createChannelSplitter(2);this.left=this.output[0]=this.context.createGain();this.right=this.output[1]=this.context.createGain();this._splitter.connect(this.left,0,0);this._splitter.connect(this.right,1,0)};Tone.extend(Tone.Split);Tone.Split.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._splitter.disconnect();this.left.disconnect();this.right.disconnect();this.left=null;this.right=null;this._splitter=null;return this};return Tone.Split});Module(function(Tone){Tone.MidSideSplit=function(){Tone.call(this,0,2);this._split=this.input=new Tone.Split;this.mid=this.output[0]=new Tone.Expr("($0 + $1) * $2");this.side=this.output[1]=new Tone.Expr("($0 - $1) * $2");this._split.connect(this.mid,0,0);this._split.connect(this.mid,1,1);this._split.connect(this.side,0,0);this._split.connect(this.side,1,1);sqrtTwo.connect(this.mid,0,2);sqrtTwo.connect(this.side,0,2)};Tone.extend(Tone.MidSideSplit);var sqrtTwo=null;Tone._initAudioContext(function(){sqrtTwo=new Tone.Signal(1/Math.sqrt(2))});Tone.MidSideSplit.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._split.dispose();this._split=null;return this};return Tone.MidSideSplit});Module(function(Tone){Tone.MidSideMerge=function(){Tone.call(this,2,0);this.mid=this.input[0]=this.context.createGain();this._left=new Tone.Expr("($0 + $1) * $2");this.side=this.input[1]=this.context.createGain();this._right=new Tone.Expr("($0 - $1) * $2");this._merge=this.output=new Tone.Merge;this.mid.connect(this._left,0,0);this.side.connect(this._left,0,1);this.mid.connect(this._right,0,0);this.side.connect(this._right,0,1);this._left.connect(this._merge,0,0);this._right.connect(this._merge,0,1);sqrtTwo.connect(this._left,0,2);sqrtTwo.connect(this._right,0,2)};Tone.extend(Tone.MidSideMerge);var sqrtTwo=null;Tone._initAudioContext(function(){sqrtTwo=new Tone.Signal(1/Math.sqrt(2))});Tone.MidSideMerge.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.mid.disconnect();this.mid=null;this.side.disconnect();this.side=null;this._left.dispose();this._left=null;this._right.dispose();this._right=null;this._merge.dispose();this._merge=null;return this};return Tone.MidSideMerge});Module(function(Tone){Tone.MidSideCompressor=function(options){options=this.defaultArg(options,Tone.MidSideCompressor.defaults);this._midSideSplit=this.input=new Tone.MidSideSplit;this._midSideMerge=this.output=new Tone.MidSideMerge;this.mid=new Tone.Compressor(options.mid);this.side=new Tone.Compressor(options.side);this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid);this._midSideSplit.side.chain(this.side,this._midSideMerge.side);this._readOnly(["mid","side"])};Tone.extend(Tone.MidSideCompressor);Tone.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}};Tone.MidSideCompressor.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["mid","side"]);this.mid.dispose();this.mid=null;this.side.dispose();this.side=null;this._midSideSplit.dispose();this._midSideSplit=null;this._midSideMerge.dispose();this._midSideMerge=null;return this};return Tone.MidSideCompressor});Module(function(Tone){Tone.Mono=function(){Tone.call(this,1,0);this._merge=this.output=new Tone.Merge;this.input.connect(this._merge,0,0);this.input.connect(this._merge,0,1);this.input.gain.value=this.dbToGain(-10)};Tone.extend(Tone.Mono);Tone.Mono.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._merge.dispose();this._merge=null;return this};return Tone.Mono});Module(function(Tone){Tone.MultibandCompressor=function(options){options=this.defaultArg(arguments,Tone.MultibandCompressor.defaults);this._splitter=this.input=new Tone.MultibandSplit({lowFrequency:options.lowFrequency,highFrequency:options.highFrequency});this.lowFrequency=this._splitter.lowFrequency;this.highFrequency=this._splitter.highFrequency;this.output=this.context.createGain();this.low=new Tone.Compressor(options.low);this.mid=new Tone.Compressor(options.mid);this.high=new Tone.Compressor(options.high);this._splitter.low.chain(this.low,this.output);this._splitter.mid.chain(this.mid,this.output);this._splitter.high.chain(this.high,this.output);this._readOnly(["high","mid","low","highFrequency","lowFrequency"])};Tone.extend(Tone.MultibandCompressor);Tone.MultibandCompressor.defaults={low:Tone.Compressor.defaults,mid:Tone.Compressor.defaults,high:Tone.Compressor.defaults,lowFrequency:250,highFrequency:2e3};Tone.MultibandCompressor.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._splitter.dispose();this._writable(["high","mid","low","highFrequency","lowFrequency"]);this.low.dispose();this.mid.dispose();this.high.dispose();this._splitter=null;this.low=null;this.mid=null;this.high=null;this.lowFrequency=null;this.highFrequency=null;return this};return Tone.MultibandCompressor});Module(function(Tone){Tone.GainToAudio=function(){this._norm=this.input=this.output=new Tone.WaveShaper(function(x){return Math.abs(x)*2-1})};Tone.extend(Tone.GainToAudio,Tone.SignalBase);Tone.GainToAudio.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._norm.dispose();this._norm=null;return this};return Tone.GainToAudio});Module(function(Tone){Tone.Panner=function(initialPan){Tone.call(this);this._hasStereoPanner=this.isFunction(this.context.createStereoPanner);if(this._hasStereoPanner){this._panner=this.input=this.output=this.context.createStereoPanner();this.pan=new Tone.Signal(0,Tone.Type.NormalRange);this._scalePan=new Tone.GainToAudio;this.pan.chain(this._scalePan,this._panner.pan)}else{this._crossFade=new Tone.CrossFade;this._merger=this.output=new Tone.Merge;this._splitter=this.input=new Tone.Split;this.pan=this._crossFade.fade;this._splitter.connect(this._crossFade,0,0);this._splitter.connect(this._crossFade,1,1);this._crossFade.a.connect(this._merger,0,0);this._crossFade.b.connect(this._merger,0,1)}this.pan.value=this.defaultArg(initialPan,.5);this._readOnly("pan")};Tone.extend(Tone.Panner);Tone.Panner.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable("pan");if(this._hasStereoPanner){this._panner.disconnect();this._panner=null;this.pan.dispose();this.pan=null;this._scalePan.dispose();this._scalePan=null}else{this._crossFade.dispose();this._crossFade=null;this._splitter.dispose();this._splitter=null;this._merger.dispose();this._merger=null;this.pan=null}return this};return Tone.Panner});Module(function(Tone){Tone.Volume=function(volume){this.output=this.input=this.context.createGain();this.volume=new Tone.Signal(this.output.gain,Tone.Type.Decibels);this.volume.value=this.defaultArg(volume,0);this._readOnly("volume")};Tone.extend(Tone.Volume);Tone.Volume.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable("volume");this.volume.dispose();this.volume=null;return this};return Tone.Volume});Module(function(Tone){Tone.PanVol=function(pan,volume){this._panner=this.input=new Tone.Panner(pan);this.pan=this._panner.pan;this._volume=this.output=new Tone.Volume(volume);this.volume=this._volume.volume;this._panner.connect(this._volume);this._readOnly(["pan","volume"])};Tone.extend(Tone.PanVol);Tone.PanVol.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["pan","volume"]);this._panner.dispose();this._panner=null;this._volume.dispose();this._volume=null;this.pan=null;this.volume=null;return this};return Tone.PanVol});Module(function(Tone){Tone.ScaledEnvelope=function(){var options=this.optionsObject(arguments,["attack","decay","sustain","release"],Tone.Envelope.defaults);Tone.Envelope.call(this,options);options=this.defaultArg(options,Tone.ScaledEnvelope.defaults);this._exp=this.output=new Tone.Pow(options.exponent);this._scale=this.output=new Tone.Scale(options.min,options.max);this._sig.chain(this._exp,this._scale)};Tone.extend(Tone.ScaledEnvelope,Tone.Envelope);Tone.ScaledEnvelope.defaults={min:0,max:1,exponent:1};Object.defineProperty(Tone.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(min){this._scale.min=min}});Object.defineProperty(Tone.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(max){this._scale.max=max}});Object.defineProperty(Tone.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(exp){this._exp.value=exp}});Tone.ScaledEnvelope.prototype.dispose=function(){Tone.Envelope.prototype.dispose.call(this);this._scale.dispose();this._scale=null;this._exp.dispose();this._exp=null;return this};return Tone.ScaledEnvelope});Module(function(Tone){Tone.Buffer=function(){var options=this.optionsObject(arguments,["url","onload"],Tone.Buffer.defaults);this._buffer=null;this._reversed=options.reverse;this.url=undefined;this.loaded=false;this.onload=options.onload.bind(this,this);if(options.url instanceof AudioBuffer){this._buffer.set(options.url);this.onload(this)}else if(typeof options.url==="string"){this.url=options.url;Tone.Buffer._addToQueue(options.url,this)}};Tone.extend(Tone.Buffer);Tone.Buffer.defaults={url:undefined,onload:Tone.noOp,reverse:false};Tone.Buffer.prototype.set=function(buffer){if(buffer instanceof Tone.Buffer){this._buffer=buffer.get()}else{this._buffer=buffer}this.loaded=true;return this};Tone.Buffer.prototype.get=function(){return this._buffer};Tone.Buffer.prototype.load=function(url,callback){this.url=url;this.onload=this.defaultArg(callback,this.onload);Tone.Buffer._addToQueue(url,this);return this};Tone.Buffer.prototype.dispose=function(){Tone.prototype.dispose.call(this);Tone.Buffer._removeFromQueue(this);this._buffer=null;this.onload=Tone.Buffer.defaults.onload;return this};Object.defineProperty(Tone.Buffer.prototype,"duration",{get:function(){if(this._buffer){return this._buffer.duration}else{return 0}}});Tone.Buffer.prototype._reverse=function(){if(this.loaded){for(var i=0;i<this._buffer.numberOfChannels;i++){Array.prototype.reverse.call(this._buffer.getChannelData(i))}}return this};Object.defineProperty(Tone.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(rev){if(this._reversed!==rev){this._reversed=rev;this._reverse()}}});Tone.Buffer._queue=[];Tone.Buffer._currentDownloads=[];Tone.Buffer._totalDownloads=0;Tone.Buffer.MAX_SIMULTANEOUS_DOWNLOADS=6;Tone.Buffer._addToQueue=function(url,buffer){Tone.Buffer._queue.push({url:url,Buffer:buffer,progress:0,xhr:null});this._totalDownloads++;Tone.Buffer._next()};Tone.Buffer._removeFromQueue=function(buffer){var i;for(i=0;i<Tone.Buffer._queue.length;i++){var q=Tone.Buffer._queue[i];if(q.Buffer===buffer){Tone.Buffer._queue.splice(i,1)}}for(i=0;i<Tone.Buffer._currentDownloads.length;i++){var dl=Tone.Buffer._currentDownloads[i];if(dl.Buffer===buffer){Tone.Buffer._currentDownloads.splice(i,1);dl.xhr.abort();dl.xhr.onprogress=null;dl.xhr.onload=null;dl.xhr.onerror=null}}};Tone.Buffer._next=function(){if(Tone.Buffer._queue.length>0){if(Tone.Buffer._currentDownloads.length<Tone.Buffer.MAX_SIMULTANEOUS_DOWNLOADS){var next=Tone.Buffer._queue.shift();Tone.Buffer._currentDownloads.push(next);next.xhr=Tone.Buffer.load(next.url,function(buffer){var index=Tone.Buffer._currentDownloads.indexOf(next);Tone.Buffer._currentDownloads.splice(index,1);next.Buffer.set(buffer);if(next.Buffer._reversed){next.Buffer._reverse()}next.Buffer.onload(next.Buffer);Tone.Buffer._onprogress();Tone.Buffer._next()});next.xhr.onprogress=function(event){next.progress=event.loaded/event.total;Tone.Buffer._onprogress()};next.xhr.onerror=Tone.Buffer.onerror}}else if(Tone.Buffer._currentDownloads.length===0){Tone.Buffer.onload();Tone.Buffer._totalDownloads=0}};Tone.Buffer._onprogress=function(){var curretDownloadsProgress=0;var currentDLLen=Tone.Buffer._currentDownloads.length;var inprogress=0;if(currentDLLen>0){for(var i=0;i<currentDLLen;i++){var dl=Tone.Buffer._currentDownloads[i];curretDownloadsProgress+=dl.progress}inprogress=curretDownloadsProgress}var currentDownloadProgress=currentDLLen-inprogress;var completed=Tone.Buffer._totalDownloads-Tone.Buffer._queue.length-currentDownloadProgress;Tone.Buffer.onprogress(completed/Tone.Buffer._totalDownloads)};Tone.Buffer.load=function(url,callback){var request=new XMLHttpRequest;request.open("GET",url,true);request.responseType="arraybuffer";request.onload=function(){Tone.context.decodeAudioData(request.response,function(buff){if(!buff){throw new Error("could not decode audio data:"+url)}callback(buff)})};request.send();return request};Tone.Buffer.onload=Tone.noOp;Tone.Buffer.onprogress=Tone.noOp;Tone.Buffer.onerror=Tone.noOp;return Tone.Buffer});Module(function(Tone){var Buses={};Tone.prototype.send=function(channelName,amount){if(!Buses.hasOwnProperty(channelName)){Buses[channelName]=this.context.createGain()}var sendKnob=this.context.createGain();sendKnob.gain.value=this.dbToGain(this.defaultArg(amount,1));this.output.chain(sendKnob,Buses[channelName]);return sendKnob};Tone.prototype.receive=function(channelName,input){if(!Buses.hasOwnProperty(channelName)){Buses[channelName]=this.context.createGain()}if(this.isUndef(input)){input=this.input}Buses[channelName].connect(input);return this};return Tone});Module(function(Tone){Tone.Note=function(channel,time,value){this.value=value;this._channel=channel;this._timelineID=Tone.Transport.setTimeline(this._trigger.bind(this),time)};Tone.Note.prototype._trigger=function(time){channelCallbacks(this._channel,time,this.value)};Tone.Note.prototype.dispose=function(){Tone.Tranport.clearTimeline(this._timelineID);this.value=null;return this};var NoteChannels={};function channelCallbacks(channel,time,value){if(NoteChannels.hasOwnProperty(channel)){var callbacks=NoteChannels[channel];for(var i=0,len=callbacks.length;i<len;i++){var callback=callbacks[i];if(Array.isArray(value)){callback.apply(window,[time].concat(value))}else{callback(time,value)}}}}Tone.Note.route=function(channel,callback){if(NoteChannels.hasOwnProperty(channel)){NoteChannels[channel].push(callback)}else{NoteChannels[channel]=[callback]}};Tone.Note.unroute=function(channel,callback){if(NoteChannels.hasOwnProperty(channel)){var channelCallback=NoteChannels[channel];var index=channelCallback.indexOf(callback);if(index!==-1){NoteChannels[channel].splice(index,1)}}};Tone.Note.parseScore=function(score){var notes=[];for(var inst in score){var part=score[inst];if(inst==="tempo"){Tone.Transport.bpm.value=part}else if(inst==="timeSignature"){Tone.Transport.timeSignature=part[0]/(part[1]/4)}else if(Array.isArray(part)){for(var i=0;i<part.length;i++){var noteDescription=part[i];var note;if(Array.isArray(noteDescription)){var time=noteDescription[0];var value=noteDescription.slice(1);note=new Tone.Note(inst,time,value)}else{note=new Tone.Note(inst,noteDescription)}notes.push(note)}}else{throw new TypeError("score parts must be Arrays")}}return notes};var noteToIndex={c:0,"c#":1,db:1,d:2,"d#":3,eb:3,e:4,f:5,"f#":6,gb:6,g:7,"g#":8,ab:8,a:9,"a#":10,bb:10,b:11};var noteIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var middleC=261.6255653005986;Tone.prototype.noteToFrequency=function(note){var parts=note.split(/(\d+)/);if(parts.length===3){var index=noteToIndex[parts[0].toLowerCase()];var octave=parts[1];var noteNumber=index+parseInt(octave,10)*12;return Math.pow(2,(noteNumber-48)/12)*middleC}else{return 0}};Tone.prototype.isNote=function(){var noteFormat=new RegExp(/[a-g]{1}([b#]{1}|[b#]{0})[0-9]+$/i);return function(note){if(typeof note==="string"){note=note.toLowerCase()}return noteFormat.test(note)}}();Tone.prototype._overwrittenToFrequency=Tone.prototype.toFrequency;Tone.prototype.toFrequency=function(note,now){if(this.isNote(note)){note=this.noteToFrequency(note)}return this._overwrittenToFrequency(note,now)};Tone.prototype.frequencyToNote=function(freq){var log=Math.log(freq/middleC)/Math.LN2;var noteNumber=Math.round(12*log)+48;var octave=Math.floor(noteNumber/12);var noteName=noteIndexToNote[noteNumber%12];return noteName+octave.toString()};Tone.prototype.intervalToFrequencyRatio=function(interval){return Math.pow(2,interval/12)};Tone.prototype.midiToNote=function(midiNumber){var octave=Math.floor(midiNumber/12)-2;var note=midiNumber%12;return noteIndexToNote[note]+octave};Tone.prototype.noteToMidi=function(note){var parts=note.split(/(\d+)/);if(parts.length===3){var index=noteToIndex[parts[0].toLowerCase()];var octave=parts[1];return index+(parseInt(octave,10)+2)*12}else{return 0}};return Tone.Note});Module(function(Tone){Tone.PulseOscillator=function(){var options=this.optionsObject(arguments,["frequency","width"],Tone.Oscillator.defaults);Tone.Source.call(this,options);this.width=new Tone.Signal(options.width,Tone.Type.NormalRange);this._widthGate=this.context.createGain();this._sawtooth=new Tone.Oscillator({frequency:options.frequency,detune:options.detune,type:"sawtooth",phase:options.phase});this.frequency=this._sawtooth.frequency;this.detune=this._sawtooth.detune;this._thresh=new Tone.WaveShaper(function(val){if(val<0){return-1}else{return 1}});this._sawtooth.chain(this._thresh,this.output);this.width.chain(this._widthGate,this._thresh);this._readOnly(["width","frequency","detune"])};Tone.extend(Tone.PulseOscillator,Tone.Oscillator);Tone.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2};Tone.PulseOscillator.prototype._start=function(time){time=this.toSeconds(time);this._sawtooth.start(time);this._widthGate.gain.setValueAtTime(1,time)};Tone.PulseOscillator.prototype._stop=function(time){time=this.toSeconds(time);this._sawtooth.stop(time);this._widthGate.gain.setValueAtTime(0,time)};Object.defineProperty(Tone.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(phase){this._sawtooth.phase=phase}});Object.defineProperty(Tone.PulseOscillator.prototype,"type",{get:function(){return"pulse"}});Tone.PulseOscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this._sawtooth.dispose();this._sawtooth=null;this._writable(["width","frequency","detune"]);this.width.dispose();this.width=null;this._widthGate.disconnect();this._widthGate=null;this._widthGate=null;this._thresh.disconnect();this._thresh=null;this.frequency=null;this.detune=null;return this};return Tone.PulseOscillator});Module(function(Tone){Tone.PWMOscillator=function(){var options=this.optionsObject(arguments,["frequency","modulationFrequency"],Tone.PWMOscillator.defaults);Tone.Source.call(this,options);this._pulse=new Tone.PulseOscillator(options.modulationFrequency);this._pulse._sawtooth.type="sine";this._modulator=new Tone.Oscillator({frequency:options.frequency,detune:options.detune});this._scale=new Tone.Multiply(1.01);this.frequency=this._modulator.frequency;this.detune=this._modulator.detune;this.modulationFrequency=this._pulse.frequency;this._modulator.chain(this._scale,this._pulse.width);this._pulse.connect(this.output);this._readOnly(["modulationFrequency","frequency","detune"])};Tone.extend(Tone.PWMOscillator,Tone.Oscillator);Tone.PWMOscillator.defaults={frequency:440,detune:0,modulationFrequency:.4};Tone.PWMOscillator.prototype._start=function(time){time=this.toSeconds(time);this._modulator.start(time);this._pulse.start(time)};Tone.PWMOscillator.prototype._stop=function(time){time=this.toSeconds(time);this._modulator.stop(time);this._pulse.stop(time)};Object.defineProperty(Tone.PWMOscillator.prototype,"type",{get:function(){return"pwm"}});Object.defineProperty(Tone.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(phase){this._modulator.phase=phase}});Tone.PWMOscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this._pulse.dispose();this._pulse=null;this._scale.dispose();this._scale=null;this._modulator.dispose();this._modulator=null;this._writable(["modulationFrequency","frequency","detune"]);this.frequency=null;this.detune=null;this.modulationFrequency=null;return this};return Tone.PWMOscillator});Module(function(Tone){Tone.OmniOscillator=function(){var options=this.optionsObject(arguments,["frequency","type"],Tone.OmniOscillator.defaults);Tone.Source.call(this,options);this.frequency=new Tone.Signal(options.frequency,Tone.Type.Frequency);this.detune=new Tone.Signal(options.detune,Tone.Type.Cents);this._sourceType=undefined;this._oscillator=null;this.type=options.type;this._readOnly(["frequency","detune"])};Tone.extend(Tone.OmniOscillator,Tone.Oscillator);Tone.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",width:.4,modulationFrequency:.4};var OmniOscType={PulseOscillator:"PulseOscillator",PWMOscillator:"PWMOscillator",Oscillator:"Oscillator"};Tone.OmniOscillator.prototype._start=function(time){this._oscillator.start(time)};Tone.OmniOscillator.prototype._stop=function(time){this._oscillator.stop(time)};Object.defineProperty(Tone.OmniOscillator.prototype,"type",{get:function(){return this._oscillator.type},set:function(type){if(type.indexOf("sine")===0||type.indexOf("square")===0||type.indexOf("triangle")===0||type.indexOf("sawtooth")===0){if(this._sourceType!==OmniOscType.Oscillator){this._sourceType=OmniOscType.Oscillator;this._createNewOscillator(Tone.Oscillator)}this._oscillator.type=type}else if(type==="pwm"){if(this._sourceType!==OmniOscType.PWMOscillator){this._sourceType=OmniOscType.PWMOscillator;this._createNewOscillator(Tone.PWMOscillator)}}else if(type==="pulse"){if(this._sourceType!==OmniOscType.PulseOscillator){this._sourceType=OmniOscType.PulseOscillator;this._createNewOscillator(Tone.PulseOscillator)}}else{throw new TypeError("Tone.OmniOscillator does not support type "+type)}}});Tone.OmniOscillator.prototype._createNewOscillator=function(OscillatorConstructor){var now=this.now()+this.bufferTime;if(this._oscillator!==null){var oldOsc=this._oscillator;oldOsc.stop(now);oldOsc.onended=function(){oldOsc.dispose();oldOsc=null}}this._oscillator=new OscillatorConstructor;this.frequency.connect(this._oscillator.frequency);this.detune.connect(this._oscillator.detune);this._oscillator.connect(this.output);if(this.state===Tone.State.Started){this._oscillator.start(now)}};Object.defineProperty(Tone.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(phase){this._oscillator.phase=phase}});Object.defineProperty(Tone.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===OmniOscType.PulseOscillator){return this._oscillator.width}}});Object.defineProperty(Tone.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===OmniOscType.PWMOscillator){return this._oscillator.modulationFrequency}}});Tone.OmniOscillator.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);this._writable(["frequency","detune"]);this.detune.dispose();this.detune=null;this.frequency.dispose();this.frequency=null;this._oscillator.dispose();this._oscillator=null;this._sourceType=null;return this};return Tone.OmniOscillator});Module(function(Tone){Tone.Instrument=function(options){options=this.defaultArg(options,Tone.Instrument.defaults);this.output=this.context.createGain();this.volume=new Tone.Signal({param:this.output.gain,units:Tone.Type.Decibels,value:options.volume});this._readOnly(["volume"])};Tone.extend(Tone.Instrument);Tone.Instrument.defaults={volume:0};Tone.Instrument.prototype.triggerAttack=Tone.noOp;Tone.Instrument.prototype.triggerRelease=Tone.noOp;Tone.Instrument.prototype.triggerAttackRelease=function(note,duration,time,velocity){time=this.toSeconds(time);duration=this.toSeconds(duration);this.triggerAttack(note,time,velocity);this.triggerRelease(time+duration);return this};Tone.Instrument.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable(["volume"]);this.volume.dispose();this.volume=null;return this};return Tone.Instrument});Module(function(Tone){Tone.Monophonic=function(options){options=this.defaultArg(options,Tone.Monophonic.defaults);Tone.Instrument.call(this,options);this.portamento=options.portamento};Tone.extend(Tone.Monophonic,Tone.Instrument);Tone.Monophonic.defaults={portamento:0};Tone.Monophonic.prototype.triggerAttack=function(note,time,velocity){time=this.toSeconds(time);this._triggerEnvelopeAttack(time,velocity);this.setNote(note,time);return this};Tone.Monophonic.prototype.triggerRelease=function(time){this._triggerEnvelopeRelease(time);return this};Tone.Monophonic.prototype._triggerEnvelopeAttack=function(){};Tone.Monophonic.prototype._triggerEnvelopeRelease=function(){};Tone.Monophonic.prototype.setNote=function(note,time){time=this.toSeconds(time);if(this.portamento>0){var currentNote=this.frequency.value;this.frequency.setValueAtTime(currentNote,time);var portTime=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(note,time+portTime)}else{this.frequency.setValueAtTime(note,time)}return this};return Tone.Monophonic});Module(function(Tone){Tone.MonoSynth=function(options){options=this.defaultArg(options,Tone.MonoSynth.defaults);Tone.Monophonic.call(this,options);this.oscillator=new Tone.OmniOscillator(options.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.filter=new Tone.Filter(options.filter);this.filterEnvelope=new Tone.ScaledEnvelope(options.filterEnvelope);this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.oscillator.chain(this.filter,this.envelope,this.output);this.oscillator.start();this.filterEnvelope.connect(this.filter.frequency);this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])};Tone.extend(Tone.MonoSynth,Tone.Monophonic);Tone.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,min:20,max:4e3,exponent:2}};Tone.MonoSynth.prototype._triggerEnvelopeAttack=function(time,velocity){this.envelope.triggerAttack(time,velocity);this.filterEnvelope.triggerAttack(time);return this};Tone.MonoSynth.prototype._triggerEnvelopeRelease=function(time){this.envelope.triggerRelease(time);this.filterEnvelope.triggerRelease(time);return this};Tone.MonoSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;this.filterEnvelope.dispose();this.filterEnvelope=null;this.filter.dispose();this.filter=null;this.frequency=null;this.detune=null;return this};return Tone.MonoSynth});Module(function(Tone){Tone.AMSynth=function(options){options=this.defaultArg(options,Tone.AMSynth.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.MonoSynth(options.carrier);this.carrier.volume.value=-10;this.modulator=new Tone.MonoSynth(options.modulator);this.modulator.volume.value=-10;this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this._modulationScale=new Tone.AudioToGain;this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.modulator.chain(this._modulationScale,this._modulationNode.gain);this.carrier.chain(this._modulationNode,this.output);this._readOnly(["carrier","modulator","frequency","harmonicity"])};Tone.extend(Tone.AMSynth,Tone.Monophonic);Tone.AMSynth.defaults={harmonicity:3,carrier:{volume:-10,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5,min:2e4,max:2e4},filter:{Q:6,type:"lowpass",rolloff:-24}},modulator:{volume:-10,oscillator:{type:"square"},envelope:{attack:2,decay:0,sustain:1,release:.5},filterEnvelope:{attack:4,decay:.2,sustain:.5,release:.5,min:20,max:1500},filter:{Q:6,type:"lowpass",rolloff:-24}}};Tone.AMSynth.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);this.carrier.filterEnvelope.triggerAttack(time);this.modulator.filterEnvelope.triggerAttack(time);return this};Tone.AMSynth.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.AMSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["carrier","modulator","frequency","harmonicity"]);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationScale.dispose();this._modulationScale=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.AMSynth});Module(function(Tone){Tone.DrumSynth=function(options){options=this.defaultArg(options,Tone.DrumSynth.defaults);Tone.Instrument.call(this,options);this.oscillator=new Tone.Oscillator(options.oscillator).start();this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.octaves=options.octaves;this.pitchDecay=options.pitchDecay;this.oscillator.chain(this.envelope,this.output);this._readOnly(["oscillator","envelope"])};Tone.extend(Tone.DrumSynth,Tone.Instrument);Tone.DrumSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}};Tone.DrumSynth.prototype.triggerAttack=function(note,time,velocity){time=this.toSeconds(time);note=this.toFrequency(note);var maxNote=note*this.octaves;this.oscillator.frequency.setValueAtTime(maxNote,time);this.oscillator.frequency.exponentialRampToValueAtTime(note,time+this.toSeconds(this.pitchDecay));this.envelope.triggerAttack(time,velocity);return this};Tone.DrumSynth.prototype.triggerRelease=function(time){this.envelope.triggerRelease(time);return this};Tone.DrumSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(["oscillator","envelope"]);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;return this};return Tone.DrumSynth});Module(function(Tone){Tone.DuoSynth=function(options){options=this.defaultArg(options,Tone.DuoSynth.defaults);Tone.Monophonic.call(this,options);this.voice0=new Tone.MonoSynth(options.voice0);this.voice0.volume.value=-10;this.voice1=new Tone.MonoSynth(options.voice1);this.voice1.volume.value=-10;this._vibrato=new Tone.LFO(options.vibratoRate,-50,50);this._vibrato.start();this.vibratoRate=this._vibrato.frequency;this._vibratoGain=this.context.createGain();this.vibratoAmount=new Tone.Signal(this._vibratoGain.gain,Tone.Type.Gain);this.vibratoAmount.value=options.vibratoAmount;this._vibratoDelay=this.toSeconds(options.vibratoDelay);this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this.frequency.connect(this.voice0.frequency);this.frequency.chain(this.harmonicity,this.voice1.frequency);this._vibrato.connect(this._vibratoGain);this._vibratoGain.fan(this.voice0.detune,this.voice1.detune);this.voice0.connect(this.output);this.voice1.connect(this.output);this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])};Tone.extend(Tone.DuoSynth,Tone.Monophonic);Tone.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,vibratoDelay:1,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}};Tone.DuoSynth.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.voice0.envelope.triggerAttack(time,velocity);this.voice1.envelope.triggerAttack(time,velocity);this.voice0.filterEnvelope.triggerAttack(time);this.voice1.filterEnvelope.triggerAttack(time);return this};Tone.DuoSynth.prototype._triggerEnvelopeRelease=function(time){this.voice0.triggerRelease(time);this.voice1.triggerRelease(time);return this};Tone.DuoSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]);this.voice0.dispose();this.voice0=null;this.voice1.dispose();this.voice1=null;this.frequency.dispose();this.frequency=null;this._vibrato.dispose();this._vibrato=null;this._vibratoGain.disconnect();this._vibratoGain=null;this.harmonicity.dispose();this.harmonicity=null;this.vibratoAmount.dispose();this.vibratoAmount=null;this.vibratoRate=null;return this};return Tone.DuoSynth});Module(function(Tone){Tone.FMSynth=function(options){options=this.defaultArg(options,Tone.FMSynth.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.MonoSynth(options.carrier);this.carrier.volume.value=-10;this.modulator=new Tone.MonoSynth(options.modulator);this.modulator.volume.value=-10;this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this.modulationIndex=new Tone.Multiply(options.modulationIndex);this.modulationIndex.units=Tone.Type.Positive;this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this.modulator.connect(this._modulationNode.gain);this._modulationNode.gain.value=0;this._modulationNode.connect(this.carrier.frequency);this.carrier.connect(this.output);this._readOnly(["carrier","modulator","frequency","harmonicity","modulationIndex"])};Tone.extend(Tone.FMSynth,Tone.Monophonic);Tone.FMSynth.defaults={harmonicity:3,modulationIndex:10,carrier:{volume:-10,portamento:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:0,sustain:1,release:.5},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5,min:2e4,max:2e4}},modulator:{volume:-10,portamento:0,oscillator:{type:"triangle"},envelope:{attack:.01,decay:0,sustain:1,release:.5},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5,min:2e4,max:2e4}}};Tone.FMSynth.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);this.carrier.filterEnvelope.triggerAttack(time);this.modulator.filterEnvelope.triggerAttack(time);return this};Tone.FMSynth.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.FMSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["carrier","modulator","frequency","harmonicity","modulationIndex"]);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.modulationIndex.dispose();this.modulationIndex=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.FMSynth});Module(function(Tone){Tone.Noise=function(){var options=this.optionsObject(arguments,["type"],Tone.Noise.defaults);Tone.Source.call(this,options);this._source=null;this._buffer=null;this.type=options.type};Tone.extend(Tone.Noise,Tone.Source);Tone.Noise.defaults={type:"white"};Object.defineProperty(Tone.Noise.prototype,"type",{get:function(){if(this._buffer===_whiteNoise){return"white"}else if(this._buffer===_brownNoise){return"brown"}else if(this._buffer===_pinkNoise){return"pink"}},set:function(type){if(this.type!==type){switch(type){case"white":this._buffer=_whiteNoise;break;case"pink":this._buffer=_pinkNoise;break;case"brown":this._buffer=_brownNoise;break;default:this._buffer=_whiteNoise}if(this.state===Tone.State.Started){var now=this.now()+this.bufferTime;this._source.onended=undefined;this._stop(now);this._start(now)}}}});Tone.Noise.prototype._start=function(time){this._source=this.context.createBufferSource();this._source.buffer=this._buffer;this._source.loop=true;this.connectSeries(this._source,this.output);this._source.start(this.toSeconds(time));this._source.onended=this.onended};Tone.Noise.prototype._stop=function(time){if(this._source){this._source.stop(this.toSeconds(time))}};Tone.Noise.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._source!==null){this._source.disconnect();this._source=null}this._buffer=null;return this};var _pinkNoise=null,_brownNoise=null,_whiteNoise=null;Tone._initAudioContext(function(audioContext){var sampleRate=audioContext.sampleRate;var bufferLength=sampleRate*4;_pinkNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);var b0,b1,b2,b3,b4,b5,b6;b0=b1=b2=b3=b4=b5=b6=0;for(var i=0;i<bufferLength;i++){var white=Math.random()*2-1;b0=.99886*b0+white*.0555179;b1=.99332*b1+white*.0750759;b2=.969*b2+white*.153852;b3=.8665*b3+white*.3104856;b4=.55*b4+white*.5329522;b5=-.7616*b5-white*.016898;channel[i]=b0+b1+b2+b3+b4+b5+b6+white*.5362;channel[i]*=.11;b6=white*.115926}}return buffer}();_brownNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);var lastOut=0;for(var i=0;i<bufferLength;i++){var white=Math.random()*2-1;channel[i]=(lastOut+.02*white)/1.02;lastOut=channel[i];channel[i]*=3.5}}return buffer}();_whiteNoise=function(){var buffer=audioContext.createBuffer(2,bufferLength,sampleRate);for(var channelNum=0;channelNum<buffer.numberOfChannels;channelNum++){var channel=buffer.getChannelData(channelNum);for(var i=0;i<bufferLength;i++){channel[i]=Math.random()*2-1}}return buffer}()});return Tone.Noise});Module(function(Tone){Tone.NoiseSynth=function(options){options=this.defaultArg(options,Tone.NoiseSynth.defaults);Tone.Instrument.call(this,options);this.noise=new Tone.Noise;this.filter=new Tone.Filter(options.filter);this.filterEnvelope=new Tone.ScaledEnvelope(options.filterEnvelope);this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.noise.chain(this.filter,this.envelope,this.output);this.noise.start();this.filterEnvelope.connect(this.filter.frequency);this._readOnly(["noise","filter","filterEnvelope","envelope"])};Tone.extend(Tone.NoiseSynth,Tone.Instrument);Tone.NoiseSynth.defaults={noise:{type:"white"},filter:{Q:6,type:"highpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:0},filterEnvelope:{attack:.06,decay:.2,sustain:0,release:2,min:20,max:4e3,exponent:2}};Tone.NoiseSynth.prototype.triggerAttack=function(time,velocity){this.envelope.triggerAttack(time,velocity);this.filterEnvelope.triggerAttack(time);return this};Tone.NoiseSynth.prototype.triggerRelease=function(time){this.envelope.triggerRelease(time);this.filterEnvelope.triggerRelease(time);return this};Tone.NoiseSynth.prototype.triggerAttackRelease=function(duration,time,velocity){time=this.toSeconds(time);duration=this.toSeconds(duration);this.triggerAttack(time,velocity);this.triggerRelease(time+duration);return this};Tone.NoiseSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(["noise","filter","filterEnvelope","envelope"]);this.noise.dispose();this.noise=null;this.envelope.dispose();this.envelope=null;this.filterEnvelope.dispose();this.filterEnvelope=null;this.filter.dispose();this.filter=null;return this};return Tone.NoiseSynth});Module(function(Tone){Tone.PluckSynth=function(options){options=this.defaultArg(options,Tone.PluckSynth.defaults);Tone.Instrument.call(this,options);this._noise=new Tone.Noise("pink");this.attackNoise=1;this._lfcf=new Tone.LowpassCombFilter({resonance:options.resonance,dampening:options.dampening});this.resonance=this._lfcf.resonance;this.dampening=this._lfcf.dampening;this._noise.connect(this._lfcf);this._lfcf.connect(this.output);this._readOnly(["resonance","dampening"])};Tone.extend(Tone.PluckSynth,Tone.Instrument);Tone.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.9};Tone.PluckSynth.prototype.triggerAttack=function(note,time){note=this.toFrequency(note);time=this.toSeconds(time);var delayAmount=1/note;this._lfcf.delayTime.setValueAtTime(delayAmount,time);this._noise.start(time);this._noise.stop(time+delayAmount*this.attackNoise);return this};Tone.PluckSynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._noise.dispose();this._lfcf.dispose();this._noise=null;this._lfcf=null;this._writable(["resonance","dampening"]);this.dampening=null;this.resonance=null;return this};return Tone.PluckSynth});Module(function(Tone){Tone.PolySynth=function(){Tone.Instrument.call(this);var options=this.optionsObject(arguments,["polyphony","voice"],Tone.PolySynth.defaults);this.voices=new Array(options.polyphony);this._freeVoices=[];this._activeVoices={};for(var i=0;i<options.polyphony;i++){var v=new options.voice(arguments[2],arguments[3]);this.voices[i]=v;v.connect(this.output)}this._freeVoices=this.voices.slice(0)};Tone.extend(Tone.PolySynth,Tone.Instrument);Tone.PolySynth.defaults={polyphony:4,voice:Tone.MonoSynth};Tone.PolySynth.prototype.triggerAttack=function(notes,time,velocity){if(!Array.isArray(notes)){notes=[notes]}for(var i=0;i<notes.length;i++){var val=notes[i];var stringified=JSON.stringify(val);if(this._activeVoices[stringified]){this._activeVoices[stringified].triggerAttack(val,time,velocity)}else if(this._freeVoices.length>0){var voice=this._freeVoices.shift();voice.triggerAttack(val,time,velocity);this._activeVoices[stringified]=voice}}return this};Tone.PolySynth.prototype.triggerAttackRelease=function(notes,duration,time,velocity){time=this.toSeconds(time);this.triggerAttack(notes,time,velocity);this.triggerRelease(notes,time+this.toSeconds(duration));return this};Tone.PolySynth.prototype.triggerRelease=function(notes,time){if(!Array.isArray(notes)){notes=[notes]}for(var i=0;i<notes.length;i++){var stringified=JSON.stringify(notes[i]);var voice=this._activeVoices[stringified];if(voice){voice.triggerRelease(time);this._freeVoices.push(voice);delete this._activeVoices[stringified];voice=null}}return this};Tone.PolySynth.prototype.set=function(params,value,rampTime){for(var i=0;i<this.voices.length;i++){this.voices[i].set(params,value,rampTime)}return this};Tone.PolySynth.prototype.get=function(params){return this.voices[0].get(params)};Tone.PolySynth.prototype.setPreset=function(presetName){for(var i=0;i<this.voices.length;i++){this.voices[i].setPreset(presetName)}return this};Tone.PolySynth.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);for(var i=0;i<this.voices.length;i++){this.voices[i].dispose();this.voices[i]=null}this.voices=null;this._activeVoices=null;this._freeVoices=null;return this};return Tone.PolySynth});Module(function(Tone){Tone.Player=function(){var options=this.optionsObject(arguments,["url","onload"],Tone.Player.defaults);Tone.Source.call(this,options);this._source=null;this.autostart=options.autostart;this._buffer=new Tone.Buffer({url:options.url,onload:this._onload.bind(this,options.onload),reverse:options.reverse});this._loop=options.loop;this._loopStart=options.loopStart;this._loopEnd=options.loopEnd;this._playbackRate=options.playbackRate;this.retrigger=options.retrigger};Tone.extend(Tone.Player,Tone.Source);Tone.Player.defaults={onload:Tone.noOp,playbackRate:1,loop:false,autostart:false,loopStart:0,loopEnd:0,retrigger:false,reverse:false};Tone.Player.prototype.load=function(url,callback){this._buffer.load(url,this._onload.bind(this,callback));return this};Tone.Player.prototype._onload=function(callback){callback(this);if(this.autostart){this.start()}};Tone.Player.prototype._start=function(startTime,offset,duration){if(this._buffer.loaded){if(this._loop){offset=this.defaultArg(offset,this._loopStart)}else{offset=this.defaultArg(offset,0)}offset=this.toSeconds(offset);duration=this.defaultArg(duration,this._buffer.duration-offset);startTime=this.toSeconds(startTime);duration=this.toSeconds(duration);this._source=this.context.createBufferSource();this._source.buffer=this._buffer.get();if(this._loop){this._source.loop=this._loop;this._source.loopStart=this.toSeconds(this._loopStart);this._source.loopEnd=this.toSeconds(this._loopEnd);duration=65536}else{this._nextStop=startTime+duration}this._source.playbackRate.value=this._playbackRate;this._source.onended=this.onended;this._source.connect(this.output);this._source.start(startTime,offset,duration)}else{throw Error("tried to start Player before the buffer was loaded")}return this};Tone.Player.prototype._stop=function(time){if(this._source){this._source.stop(this.toSeconds(time));this._source=null}return this};Tone.Player.prototype.setLoopPoints=function(loopStart,loopEnd){this.loopStart=loopStart;this.loopEnd=loopEnd;return this};Object.defineProperty(Tone.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(loopStart){this._loopStart=loopStart;if(this._source){this._source.loopStart=this.toSeconds(loopStart)}}});Object.defineProperty(Tone.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(loopEnd){this._loopEnd=loopEnd;if(this._source){this._source.loopEnd=this.toSeconds(loopEnd)}}});Object.defineProperty(Tone.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(buffer){this._buffer.set(buffer)}});Object.defineProperty(Tone.Player.prototype,"loop",{get:function(){return this._loop},set:function(loop){this._loop=loop;if(this._source){this._source.loop=loop}}});Object.defineProperty(Tone.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(rate){this._playbackRate=rate;if(this._source){this._source.playbackRate.value=rate}}});Object.defineProperty(Tone.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(rev){this._buffer.reverse=rev}});Tone.Player.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._source!==null){this._source.disconnect();this._source=null}this._buffer.dispose();this._buffer=null;return this};return Tone.Player});Module(function(Tone){Tone.Sampler=function(urls,options){options=this.defaultArg(options,Tone.Sampler.defaults);Tone.Instrument.call(this,options);this.player=new Tone.Player(options.player);this.player.retrigger=true;this._buffers={};this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.filterEnvelope=new Tone.ScaledEnvelope(options.filterEnvelope);this._sample=options.sample;this._pitch=options.pitch;this.filter=new Tone.Filter(options.filter);this._loadBuffers(urls);this.pitch=options.pitch;this.player.chain(this.filter,this.envelope,this.output);this.filterEnvelope.connect(this.filter.frequency);this._readOnly(["player","filterEnvelope","envelope","filter"])};Tone.extend(Tone.Sampler,Tone.Instrument);Tone.Sampler.defaults={sample:0,pitch:0,player:{loop:false},envelope:{attack:.001,decay:0,sustain:1,release:.1},filterEnvelope:{attack:.001,decay:.001,sustain:1,release:.5,min:20,max:2e4,exponent:2},filter:{type:"lowpass"}};Tone.Sampler.prototype._loadBuffers=function(urls){if(typeof urls==="string"){this._buffers["0"]=new Tone.Buffer(urls,function(){this.sample="0"}.bind(this))}else{urls=this._flattenUrls(urls);for(var buffName in urls){this._sample=buffName;var urlString=urls[buffName];this._buffers[buffName]=new Tone.Buffer(urlString)}}};Tone.Sampler.prototype._flattenUrls=function(ob){var toReturn={};for(var i in ob){if(!ob.hasOwnProperty(i))continue;if(typeof ob[i]=="object"){var flatObject=this._flattenUrls(ob[i]);for(var x in flatObject){if(!flatObject.hasOwnProperty(x))continue;toReturn[i+"."+x]=flatObject[x]}}else{toReturn[i]=ob[i]}}return toReturn};Tone.Sampler.prototype.triggerAttack=function(name,time,velocity){time=this.toSeconds(time);if(name){this.sample=name}this.player.start(time);this.envelope.triggerAttack(time,velocity);this.filterEnvelope.triggerAttack(time);return this};Tone.Sampler.prototype.triggerRelease=function(time){time=this.toSeconds(time);this.filterEnvelope.triggerRelease(time);this.envelope.triggerRelease(time);this.player.stop(this.toSeconds(this.envelope.release)+time);return this};Object.defineProperty(Tone.Sampler.prototype,"sample",{get:function(){return this._sample},set:function(name){if(this._buffers.hasOwnProperty(name)){this._sample=name;this.player.buffer=this._buffers[name]}else{throw new Error("Sampler does not have a sample named "+name)}}});Object.defineProperty(Tone.Sampler.prototype,"reverse",{get:function(){for(var i in this._buffers){return this._buffers[i].reverse}},set:function(rev){for(var i in this._buffers){this._buffers[i].reverse=rev}}});Object.defineProperty(Tone.Sampler.prototype,"pitch",{get:function(){return this._pitch},set:function(interval){this._pitch=interval;this.player.playbackRate=this.intervalToFrequencyRatio(interval)}});Tone.Sampler.prototype.dispose=function(){Tone.Instrument.prototype.dispose.call(this);this._writable(["player","filterEnvelope","envelope","filter"]);this.player.dispose();this.filterEnvelope.dispose();this.envelope.dispose();this.filter.dispose();this.player=null;this.filterEnvelope=null;this.envelope=null;this.filter=null;for(var sample in this._buffers){this._buffers[sample].dispose();this._buffers[sample]=null}this._buffers=null;return this};return Tone.Sampler});Module(function(Tone){Tone.SimpleSynth=function(options){options=this.defaultArg(options,Tone.SimpleSynth.defaults);Tone.Monophonic.call(this,options);this.oscillator=new Tone.OmniOscillator(options.oscillator);this.frequency=this.oscillator.frequency;this.detune=this.oscillator.detune;this.envelope=new Tone.AmplitudeEnvelope(options.envelope);this.oscillator.chain(this.envelope,this.output);this.oscillator.start();this._readOnly(["oscillator","frequency","detune","envelope"])};Tone.extend(Tone.SimpleSynth,Tone.Monophonic);Tone.SimpleSynth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}};Tone.SimpleSynth.prototype._triggerEnvelopeAttack=function(time,velocity){this.envelope.triggerAttack(time,velocity);return this};Tone.SimpleSynth.prototype._triggerEnvelopeRelease=function(time){this.envelope.triggerRelease(time);return this};Tone.SimpleSynth.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["oscillator","frequency","detune","envelope"]);this.oscillator.dispose();this.oscillator=null;this.envelope.dispose();this.envelope=null;this.frequency=null;this.detune=null;return this};return Tone.SimpleSynth});Module(function(Tone){Tone.SimpleAM=function(options){options=this.defaultArg(options,Tone.SimpleAM.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.SimpleSynth(options.carrier);this.modulator=new Tone.SimpleSynth(options.modulator);this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this._modulationScale=new Tone.AudioToGain;this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.modulator.chain(this._modulationScale,this._modulationNode.gain);this.carrier.chain(this._modulationNode,this.output);this._readOnly(["carrier","modulator","frequency","harmonicity"])};Tone.extend(Tone.SimpleAM,Tone.Monophonic);Tone.SimpleAM.defaults={harmonicity:3,carrier:{volume:-10,portamento:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5}},modulator:{volume:-10,portamento:0,oscillator:{type:"sine"},envelope:{attack:.5,decay:.1,sustain:1,release:.5}}};Tone.SimpleAM.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);return this};Tone.SimpleAM.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.SimpleAM.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["carrier","modulator","frequency","harmonicity"]);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationScale.dispose();this._modulationScale=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.SimpleAM});Module(function(Tone){Tone.SimpleFM=function(options){options=this.defaultArg(options,Tone.SimpleFM.defaults);Tone.Monophonic.call(this,options);this.carrier=new Tone.SimpleSynth(options.carrier);this.carrier.volume.value=-10;this.modulator=new Tone.SimpleSynth(options.modulator);this.modulator.volume.value=-10;this.frequency=new Tone.Signal(440,Tone.Type.Frequency);this.harmonicity=new Tone.Multiply(options.harmonicity);this.harmonicity.units=Tone.Type.Positive;this.modulationIndex=new Tone.Multiply(options.modulationIndex);this.modulationIndex.units=Tone.Type.Positive;this._modulationNode=this.context.createGain();this.frequency.connect(this.carrier.frequency);this.frequency.chain(this.harmonicity,this.modulator.frequency);this.frequency.chain(this.modulationIndex,this._modulationNode);this.modulator.connect(this._modulationNode.gain);this._modulationNode.gain.value=0;this._modulationNode.connect(this.carrier.frequency);this.carrier.connect(this.output);this._readOnly(["carrier","modulator","frequency","harmonicity","modulationIndex"])};Tone.extend(Tone.SimpleFM,Tone.Monophonic);Tone.SimpleFM.defaults={harmonicity:3,modulationIndex:10,carrier:{volume:-10,portamento:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:0,sustain:1,release:.5}},modulator:{volume:-10,portamento:0,oscillator:{type:"triangle"},envelope:{attack:.01,decay:0,sustain:1,release:.5}}};Tone.SimpleFM.prototype._triggerEnvelopeAttack=function(time,velocity){time=this.toSeconds(time);this.carrier.envelope.triggerAttack(time,velocity);this.modulator.envelope.triggerAttack(time);return this};Tone.SimpleFM.prototype._triggerEnvelopeRelease=function(time){this.carrier.triggerRelease(time);this.modulator.triggerRelease(time);return this};Tone.SimpleFM.prototype.dispose=function(){Tone.Monophonic.prototype.dispose.call(this);this._writable(["carrier","modulator","frequency","harmonicity","modulationIndex"]);this.carrier.dispose();this.carrier=null;this.modulator.dispose();this.modulator=null;this.frequency.dispose();this.frequency=null;this.modulationIndex.dispose();this.modulationIndex=null;this.harmonicity.dispose();this.harmonicity=null;this._modulationNode.disconnect();this._modulationNode=null;return this};return Tone.SimpleFM});Module(function(Tone){Tone.Effect=function(){Tone.call(this);var options=this.optionsObject(arguments,["wet"],Tone.Effect.defaults);this._dryWet=new Tone.CrossFade(options.wet);this.wet=this._dryWet.fade;this.effectSend=this.context.createGain();this.effectReturn=this.context.createGain();this.input.connect(this._dryWet.a);this.input.connect(this.effectSend);this.effectReturn.connect(this._dryWet.b);this._dryWet.connect(this.output);this._readOnly(["wet"])};Tone.extend(Tone.Effect);Tone.Effect.defaults={wet:1};Tone.Effect.prototype.connectEffect=function(effect){this.effectSend.chain(effect,this.effectReturn);return this};Tone.Effect.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._dryWet.dispose();this._dryWet=null;this.effectSend.disconnect();this.effectSend=null;this.effectReturn.disconnect();this.effectReturn=null;this._writable(["wet"]);this.wet=null;return this};return Tone.Effect});Module(function(Tone){Tone.AutoFilter=function(){var options=this.optionsObject(arguments,["frequency","min","max"],Tone.AutoFilter.defaults);Tone.Effect.call(this,options);this._lfo=new Tone.LFO({frequency:options.frequency,amplitude:options.depth,min:options.min,max:options.max});this.depth=this._lfo.amplitude;this.frequency=this._lfo.frequency;this.filter=new Tone.Filter(options.filter);this.connectEffect(this.filter);this._lfo.connect(this.filter.frequency);this.type=options.type;this._readOnly(["frequency","depth"])};Tone.extend(Tone.AutoFilter,Tone.Effect);Tone.AutoFilter.defaults={frequency:1,type:"sine",depth:1,min:200,max:1200,filter:{type:"lowpass",rolloff:-12,Q:1}};Tone.AutoFilter.prototype.start=function(time){this._lfo.start(time);return this};Tone.AutoFilter.prototype.stop=function(time){this._lfo.stop(time);return this};Tone.AutoFilter.prototype.sync=function(delay){this._lfo.sync(delay);return this};Tone.AutoFilter.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(Tone.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}});Object.defineProperty(Tone.AutoFilter.prototype,"min",{get:function(){return this._lfo.min},set:function(min){this._lfo.min=min}});Object.defineProperty(Tone.AutoFilter.prototype,"max",{get:function(){return this._lfo.max},set:function(max){this._lfo.max=max}});Tone.AutoFilter.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._lfo.dispose();this._lfo=null;this.filter.dispose();this.filter=null;this._writable(["frequency","depth"]);this.frequency=null;this.depth=null;return this};return Tone.AutoFilter});Module(function(Tone){Tone.AutoPanner=function(){var options=this.optionsObject(arguments,["frequency"],Tone.AutoPanner.defaults);Tone.Effect.call(this,options);this._lfo=new Tone.LFO({frequency:options.frequency,amplitude:options.depth,min:0,max:1,phase:90});this.depth=this._lfo.amplitude;this._panner=new Tone.Panner;this.frequency=this._lfo.frequency;this.connectEffect(this._panner);this._lfo.connect(this._panner.pan);this.type=options.type;this._readOnly(["depth","frequency"])};Tone.extend(Tone.AutoPanner,Tone.Effect);Tone.AutoPanner.defaults={frequency:1,type:"sine",depth:1};Tone.AutoPanner.prototype.start=function(time){this._lfo.start(time);return this};Tone.AutoPanner.prototype.stop=function(time){this._lfo.stop(time);return this};Tone.AutoPanner.prototype.sync=function(delay){this._lfo.sync(delay);return this};Tone.AutoPanner.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(Tone.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}});Tone.AutoPanner.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._lfo.dispose();this._lfo=null;this._panner.dispose();this._panner=null;this._writable(["depth","frequency"]);this.frequency=null;this.depth=null;return this};return Tone.AutoPanner});Module(function(Tone){Tone.AutoWah=function(){var options=this.optionsObject(arguments,["baseFrequency","octaves","sensitivity"],Tone.AutoWah.defaults);Tone.Effect.call(this,options);this.follower=new Tone.Follower(options.follower);this._sweepRange=new Tone.ScaleExp(0,1,.5);this._baseFrequency=options.baseFrequency;this._octaves=options.octaves;this._inputBoost=this.context.createGain();this._bandpass=new Tone.Filter({rolloff:-48,frequency:0,Q:options.Q});this._peaking=new Tone.Filter(0,"peaking");this._peaking.gain.value=options.gain;this.gain=this._peaking.gain;this.Q=this._bandpass.Q;this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange);this._sweepRange.connect(this._bandpass.frequency);this._sweepRange.connect(this._peaking.frequency);this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn);this._setSweepRange();this.sensitivity=options.sensitivity;this._readOnly(["gain","Q"])};Tone.extend(Tone.AutoWah,Tone.Effect);Tone.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}};Object.defineProperty(Tone.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(octaves){this._octaves=octaves;this._setSweepRange()}});Object.defineProperty(Tone.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(baseFreq){this._baseFrequency=baseFreq;this._setSweepRange()}});Object.defineProperty(Tone.AutoWah.prototype,"sensitivity",{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(sensitivy){this._inputBoost.gain.value=1/this.dbToGain(sensitivy)}});Tone.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency;this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)};Tone.AutoWah.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this.follower.dispose();this.follower=null;this._sweepRange.dispose();this._sweepRange=null;this._bandpass.dispose();this._bandpass=null;this._peaking.dispose();this._peaking=null;this._inputBoost.disconnect();this._inputBoost=null;this._writable(["gain","Q"]);this.gain=null;this.Q=null;return this};return Tone.AutoWah});Module(function(Tone){Tone.BitCrusher=function(){var options=this.optionsObject(arguments,["bits"],Tone.BitCrusher.defaults);Tone.Effect.call(this,options);var invStepSize=1/Math.pow(2,options.bits-1);this._subtract=new Tone.Subtract;this._modulo=new Tone.Modulo(invStepSize);this._bits=options.bits;this.effectSend.fan(this._subtract,this._modulo);this._modulo.connect(this._subtract,0,1);this._subtract.connect(this.effectReturn)};Tone.extend(Tone.BitCrusher,Tone.Effect);Tone.BitCrusher.defaults={bits:4};Object.defineProperty(Tone.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(bits){this._bits=bits;var invStepSize=1/Math.pow(2,bits-1);this._modulo.value=invStepSize}});Tone.BitCrusher.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._subtract.dispose();this._subtract=null;this._modulo.dispose();this._modulo=null;return this};return Tone.BitCrusher});Module(function(Tone){Tone.Chebyshev=function(){var options=this.optionsObject(arguments,["order"],Tone.Chebyshev.defaults);Tone.Effect.call(this);this._shaper=new Tone.WaveShaper(4096);this._order=options.order;this.connectEffect(this._shaper);this.order=options.order;this.oversample=options.oversample};Tone.extend(Tone.Chebyshev,Tone.Effect);Tone.Chebyshev.defaults={order:1,oversample:"none"};Tone.Chebyshev.prototype._getCoefficient=function(x,degree,memo){if(memo.hasOwnProperty(degree)){return memo[degree]}else if(degree===0){memo[degree]=0}else if(degree===1){memo[degree]=x}else{memo[degree]=2*x*this._getCoefficient(x,degree-1,memo)-this._getCoefficient(x,degree-2,memo)}return memo[degree]};Object.defineProperty(Tone.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(order){this._order=order;var curve=new Array(4096);var len=curve.length;for(var i=0;i<len;++i){var x=i*2/len-1;if(x===0){curve[i]=0}else{curve[i]=this._getCoefficient(x,order,{})}}this._shaper.curve=curve}});Object.defineProperty(Tone.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}});Tone.Chebyshev.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;return this};return Tone.Chebyshev});Module(function(Tone){Tone.StereoEffect=function(){Tone.call(this);var options=this.optionsObject(arguments,["wet"],Tone.Effect.defaults);this._dryWet=new Tone.CrossFade(options.wet);this.wet=this._dryWet.fade;this._split=new Tone.Split;this.effectSendL=this._split.left;this.effectSendR=this._split.right;this._merge=new Tone.Merge;this.effectReturnL=this._merge.left;this.effectReturnR=this._merge.right;this.input.connect(this._split);this.input.connect(this._dryWet,0,0);this._merge.connect(this._dryWet,0,1);this._dryWet.connect(this.output);this._readOnly(["wet"])};Tone.extend(Tone.StereoEffect,Tone.Effect);Tone.StereoEffect.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._dryWet.dispose();this._dryWet=null;this._split.dispose();this._split=null;this._merge.dispose();this._merge=null;this.effectSendL=null;this.effectSendR=null;this.effectReturnL=null;this.effectReturnR=null;this._writable(["wet"]);this.wet=null;return this};return Tone.StereoEffect});Module(function(Tone){Tone.FeedbackEffect=function(){var options=this.optionsObject(arguments,["feedback"]);options=this.defaultArg(options,Tone.FeedbackEffect.defaults);Tone.Effect.call(this,options);this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange);this._feedbackGain=this.context.createGain();this.effectReturn.chain(this._feedbackGain,this.effectSend);this.feedback.connect(this._feedbackGain.gain);this._readOnly(["feedback"])};Tone.extend(Tone.FeedbackEffect,Tone.Effect);Tone.FeedbackEffect.defaults={feedback:.125};Tone.FeedbackEffect.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._writable(["feedback"]);this.feedback.dispose();this.feedback=null;this._feedbackGain.disconnect();this._feedbackGain=null;return this};return Tone.FeedbackEffect});Module(function(Tone){Tone.StereoXFeedbackEffect=function(){var options=this.optionsObject(arguments,["feedback"],Tone.FeedbackEffect.defaults);Tone.StereoEffect.call(this,options);this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange);this._feedbackLR=this.context.createGain();this._feedbackRL=this.context.createGain();this.effectReturnL.chain(this._feedbackLR,this.effectSendR);this.effectReturnR.chain(this._feedbackRL,this.effectSendL);this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain);this._readOnly(["feedback"])};Tone.extend(Tone.StereoXFeedbackEffect,Tone.FeedbackEffect);Tone.StereoXFeedbackEffect.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(["feedback"]);this.feedback.dispose();this.feedback=null;this._feedbackLR.disconnect();this._feedbackLR=null;this._feedbackRL.disconnect();this._feedbackRL=null;return this};return Tone.StereoXFeedbackEffect});Module(function(Tone){Tone.Chorus=function(){var options=this.optionsObject(arguments,["frequency","delayTime","depth"],Tone.Chorus.defaults);Tone.StereoXFeedbackEffect.call(this,options);this._depth=options.depth;this._delayTime=options.delayTime/1e3;this._lfoL=new Tone.LFO(options.rate,0,1);this._lfoR=new Tone.LFO(options.rate,0,1);this._lfoR.phase=180;this._delayNodeL=this.context.createDelay();this._delayNodeR=this.context.createDelay();this.frequency=this._lfoL.frequency;this.connectSeries(this.effectSendL,this._delayNodeL,this.effectReturnL);this.connectSeries(this.effectSendR,this._delayNodeR,this.effectReturnR);this.input.connect(this.output);this._lfoL.connect(this._delayNodeL.delayTime);this._lfoR.connect(this._delayNodeR.delayTime);this._lfoL.start();this._lfoR.start();this._lfoL.frequency.connect(this._lfoR.frequency);this.depth=this._depth;this.frequency.value=options.frequency;this.type=options.type;this._readOnly(["frequency"])};Tone.extend(Tone.Chorus,Tone.StereoXFeedbackEffect);Tone.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine"};Object.defineProperty(Tone.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(depth){this._depth=depth;var deviation=this._delayTime*depth;this._lfoL.min=Math.max(this._delayTime-deviation,0);this._lfoL.max=this._delayTime+deviation;this._lfoR.min=Math.max(this._delayTime-deviation,0);this._lfoR.max=this._delayTime+deviation}});Object.defineProperty(Tone.Chorus.prototype,"delayTime",{get:function(){return this._delayTime*1e3},set:function(delayTime){this._delayTime=delayTime/1e3;this.depth=this._depth}});Object.defineProperty(Tone.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(type){this._lfoL.type=type;this._lfoR.type=type}});Tone.Chorus.prototype.dispose=function(){Tone.StereoXFeedbackEffect.prototype.dispose.call(this);this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;this._delayNodeL.disconnect();this._delayNodeL=null;this._delayNodeR.disconnect();this._delayNodeR=null;this._writable("frequency");this.frequency=null;return this};return Tone.Chorus});Module(function(Tone){Tone.Convolver=function(){var options=this.optionsObject(arguments,["url"],Tone.Convolver.defaults);Tone.Effect.call(this,options);this._convolver=this.context.createConvolver();this._buffer=new Tone.Buffer(options.url,function(buffer){this.buffer=buffer;options.onload()}.bind(this));this.connectEffect(this._convolver)};Tone.extend(Tone.Convolver,Tone.Effect);Tone.Convolver.defaults={url:"",onload:Tone.noOp};Object.defineProperty(Tone.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(buffer){this._buffer.set(buffer);this._convolver.buffer=this._buffer.get()}});Tone.Convolver.prototype.load=function(url,callback){this._buffer.load(url,function(buff){this.buffer=buff;if(callback){callback()}}.bind(this));return this};Tone.Convolver.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._convolver.disconnect();this._convolver=null;this._buffer.dispose();this._buffer=null;return this};return Tone.Convolver});Module(function(Tone){Tone.Distortion=function(){var options=this.optionsObject(arguments,["distortion"],Tone.Distortion.defaults);Tone.Effect.call(this,options);this._shaper=new Tone.WaveShaper(4096);this._distortion=options.distortion;this.connectEffect(this._shaper);this.distortion=options.distortion;this.oversample=options.oversample};Tone.extend(Tone.Distortion,Tone.Effect);Tone.Distortion.defaults={distortion:.4,oversample:"none"};Object.defineProperty(Tone.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(amount){this._distortion=amount;var k=amount*100;var deg=Math.PI/180;this._shaper.setMap(function(x){if(Math.abs(x)<.001){return 0}else{return(3+k)*x*20*deg/(Math.PI+k*Math.abs(x))}})}});Object.defineProperty(Tone.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(oversampling){this._shaper.oversample=oversampling}});Tone.Distortion.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._shaper.dispose();this._shaper=null;return this};return Tone.Distortion});Module(function(Tone){Tone.FeedbackDelay=function(){var options=this.optionsObject(arguments,["delayTime","feedback"],Tone.FeedbackDelay.defaults);Tone.FeedbackEffect.call(this,options);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this._delayNode=this.context.createDelay(4);this.connectEffect(this._delayNode);this.delayTime.connect(this._delayNode.delayTime);this._readOnly(["delayTime"])};Tone.extend(Tone.FeedbackDelay,Tone.FeedbackEffect);Tone.FeedbackDelay.defaults={delayTime:.25};Tone.FeedbackDelay.prototype.dispose=function(){Tone.FeedbackEffect.prototype.dispose.call(this);this.delayTime.dispose();this._delayNode.disconnect();this._delayNode=null;this._writable(["delayTime"]);this.delayTime=null;return this};return Tone.FeedbackDelay});Module(function(Tone){var combFilterTunings=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100];var allpassFilterFrequencies=[225,556,441,341];Tone.Freeverb=function(){var options=this.optionsObject(arguments,["roomSize","dampening"],Tone.Freeverb.defaults);Tone.StereoEffect.call(this,options);this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange);this.dampening=new Tone.Signal(options.dampening,Tone.Type.Frequency);this._combFilters=[];this._allpassFiltersL=[];this._allpassFiltersR=[];for(var l=0;l<allpassFilterFrequencies.length;l++){var allpassL=this.context.createBiquadFilter();allpassL.type="allpass";allpassL.frequency.value=allpassFilterFrequencies[l];this._allpassFiltersL.push(allpassL)}for(var r=0;r<allpassFilterFrequencies.length;r++){var allpassR=this.context.createBiquadFilter();allpassR.type="allpass";allpassR.frequency.value=allpassFilterFrequencies[r];this._allpassFiltersR.push(allpassR)}for(var c=0;c<combFilterTunings.length;c++){var lfpf=new Tone.LowpassCombFilter(combFilterTunings[c]);if(c<combFilterTunings.length/2){this.effectSendL.chain(lfpf,this._allpassFiltersL[0])}else{this.effectSendR.chain(lfpf,this._allpassFiltersR[0])}this.roomSize.connect(lfpf.resonance);this.dampening.connect(lfpf.dampening);this._combFilters.push(lfpf)}this.connectSeries.apply(this,this._allpassFiltersL);this.connectSeries.apply(this,this._allpassFiltersR);this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL);this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR);this._readOnly(["roomSize","dampening"])};Tone.extend(Tone.Freeverb,Tone.StereoEffect);Tone.Freeverb.defaults={roomSize:.7,dampening:3e3};Tone.Freeverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var al=0;al<this._allpassFiltersL.length;al++){this._allpassFiltersL[al].disconnect();this._allpassFiltersL[al]=null}this._allpassFiltersL=null;for(var ar=0;ar<this._allpassFiltersR.length;ar++){this._allpassFiltersR[ar].disconnect();this._allpassFiltersR[ar]=null}this._allpassFiltersR=null;for(var cf=0;cf<this._combFilters.length;cf++){this._combFilters[cf].dispose();this._combFilters[cf]=null}this._combFilters=null;this._writable(["roomSize","dampening"]);this.roomSize.dispose();this.roomSize=null;this.dampening.dispose();this.dampening=null;return this};return Tone.Freeverb});Module(function(Tone){var combFilterDelayTimes=[1687/25e3,1601/25e3,2053/25e3,2251/25e3];var combFilterResonances=[.773,.802,.753,.733];var allpassFilterFreqs=[347,113,37];Tone.JCReverb=function(){var options=this.optionsObject(arguments,["roomSize"],Tone.JCReverb.defaults);Tone.StereoEffect.call(this,options);this.roomSize=new Tone.Signal(options.roomSize,Tone.Type.NormalRange);this._scaleRoomSize=new Tone.Scale(-.733,.197);this._allpassFilters=[];this._feedbackCombFilters=[];for(var af=0;af<allpassFilterFreqs.length;af++){var allpass=this.context.createBiquadFilter();allpass.type="allpass";allpass.frequency.value=allpassFilterFreqs[af];this._allpassFilters.push(allpass)}for(var cf=0;cf<combFilterDelayTimes.length;cf++){var fbcf=new Tone.FeedbackCombFilter(combFilterDelayTimes[cf],.1);this._scaleRoomSize.connect(fbcf.resonance);fbcf.resonance.value=combFilterResonances[cf];this._allpassFilters[this._allpassFilters.length-1].connect(fbcf);if(cf<combFilterDelayTimes.length/2){fbcf.connect(this.effectReturnL)}else{fbcf.connect(this.effectReturnR)}this._feedbackCombFilters.push(fbcf)}this.roomSize.connect(this._scaleRoomSize);this.connectSeries.apply(this,this._allpassFilters);this.effectSendL.connect(this._allpassFilters[0]);this.effectSendR.connect(this._allpassFilters[0]);this._readOnly(["roomSize"])};Tone.extend(Tone.JCReverb,Tone.StereoEffect);Tone.JCReverb.defaults={roomSize:.5};Tone.JCReverb.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);for(var apf=0;apf<this._allpassFilters.length;apf++){this._allpassFilters[apf].disconnect();this._allpassFilters[apf]=null}this._allpassFilters=null;for(var fbcf=0;fbcf<this._feedbackCombFilters.length;fbcf++){this._feedbackCombFilters[fbcf].dispose();this._feedbackCombFilters[fbcf]=null}this._feedbackCombFilters=null;this._writable(["roomSize"]);this.roomSize.dispose();this.roomSize=null;this._scaleRoomSize.dispose();this._scaleRoomSize=null;return this};return Tone.JCReverb});Module(function(Tone){Tone.MidSideEffect=function(){Tone.Effect.call(this);this._midSideSplit=new Tone.MidSideSplit;this._midSideMerge=new Tone.MidSideMerge;this.midSend=this._midSideSplit.mid;this.sideSend=this._midSideSplit.side;this.midReturn=this._midSideMerge.mid;this.sideReturn=this._midSideMerge.side;this.effectSend.connect(this._midSideSplit);this._midSideMerge.connect(this.effectReturn)};Tone.extend(Tone.MidSideEffect,Tone.Effect);Tone.MidSideEffect.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._midSideSplit.dispose();this._midSideSplit=null;this._midSideMerge.dispose();this._midSideMerge=null;this.midSend=null;this.sideSend=null;this.midReturn=null;this.sideReturn=null;return this};return Tone.MidSideEffect});Module(function(Tone){Tone.Phaser=function(){var options=this.optionsObject(arguments,["frequency","depth","baseFrequency"],Tone.Phaser.defaults);Tone.StereoEffect.call(this,options);this._lfoL=new Tone.LFO(options.frequency,0,1);this._lfoR=new Tone.LFO(options.frequency,0,1);this._lfoR.phase=180;this._baseFrequency=options.baseFrequency;this._depth=options.depth;this.Q=new Tone.Signal(options.Q,Tone.Type.Positive);this._filtersL=this._makeFilters(options.stages,this._lfoL,this.Q);this._filtersR=this._makeFilters(options.stages,this._lfoR,this.Q);this.frequency=this._lfoL.frequency;this.frequency.value=options.frequency;this.effectSendL.connect(this._filtersL[0]);this.effectSendR.connect(this._filtersR[0]);this._filtersL[options.stages-1].connect(this.effectReturnL);this._filtersR[options.stages-1].connect(this.effectReturnR);this._lfoL.frequency.connect(this._lfoR.frequency);this.baseFrequency=options.baseFrequency;this.depth=options.depth;this._lfoL.start();this._lfoR.start();this._readOnly(["frequency","Q"])};Tone.extend(Tone.Phaser,Tone.StereoEffect);Tone.Phaser.defaults={frequency:.5,depth:10,stages:10,Q:10,baseFrequency:350};Tone.Phaser.prototype._makeFilters=function(stages,connectToFreq,Q){var filters=new Array(stages);for(var i=0;i<stages;i++){var filter=this.context.createBiquadFilter();filter.type="allpass";Q.connect(filter.Q);connectToFreq.connect(filter.frequency);filters[i]=filter}this.connectSeries.apply(this,filters);return filters};Object.defineProperty(Tone.Phaser.prototype,"depth",{get:function(){return this._depth},set:function(depth){this._depth=depth;var max=this._baseFrequency+this._baseFrequency*depth;this._lfoL.max=max;this._lfoR.max=max}});Object.defineProperty(Tone.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(freq){this._baseFrequency=freq;this._lfoL.min=freq;this._lfoR.min=freq;this.depth=this._depth}});Tone.Phaser.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(["frequency","Q"]);this.Q.dispose();this.Q=null;this._lfoL.dispose();this._lfoL=null;this._lfoR.dispose();this._lfoR=null;for(var i=0;i<this._filtersL.length;i++){this._filtersL[i].disconnect();this._filtersL[i]=null}this._filtersL=null;for(var j=0;j<this._filtersR.length;j++){this._filtersR[j].disconnect();this._filtersR[j]=null}this._filtersR=null;this.frequency=null;return this};return Tone.Phaser});Module(function(Tone){Tone.PingPongDelay=function(){var options=this.optionsObject(arguments,["delayTime","feedback"],Tone.PingPongDelay.defaults);Tone.StereoXFeedbackEffect.call(this,options);this._leftDelay=this.context.createDelay(options.maxDelayTime);this._rightDelay=this.context.createDelay(options.maxDelayTime);this._rightPreDelay=this.context.createDelay(options.maxDelayTime);this.delayTime=new Tone.Signal(options.delayTime,Tone.Type.Time);this.effectSendL.chain(this._leftDelay,this.effectReturnL);this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR);this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime);this._feedbackLR.disconnect();this._feedbackLR.connect(this._rightDelay);this._readOnly(["delayTime"])};Tone.extend(Tone.PingPongDelay,Tone.StereoXFeedbackEffect);Tone.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1};Tone.PingPongDelay.prototype.dispose=function(){Tone.StereoXFeedbackEffect.prototype.dispose.call(this);this._leftDelay.disconnect();this._leftDelay=null;this._rightDelay.disconnect();this._rightDelay=null;this._rightPreDelay.disconnect();this._rightPreDelay=null;this._writable(["delayTime"]);this.delayTime.dispose();this.delayTime=null;return this};return Tone.PingPongDelay});Module(function(Tone){Tone.StereoFeedbackEffect=function(){var options=this.optionsObject(arguments,["feedback"],Tone.FeedbackEffect.defaults);Tone.StereoEffect.call(this,options);this.feedback=new Tone.Signal(options.feedback,Tone.Type.NormalRange);this._feedbackL=this.context.createGain();this._feedbackR=this.context.createGain();this.effectReturnL.chain(this._feedbackL,this.effectSendL);this.effectReturnR.chain(this._feedbackR,this.effectSendR);this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain);this._readOnly(["feedback"])};Tone.extend(Tone.StereoFeedbackEffect,Tone.FeedbackEffect);Tone.StereoFeedbackEffect.prototype.dispose=function(){Tone.StereoEffect.prototype.dispose.call(this);this._writable(["feedback"]);this.feedback.dispose();this.feedback=null;this._feedbackL.disconnect();this._feedbackL=null;this._feedbackR.disconnect();this._feedbackR=null;return this};return Tone.StereoFeedbackEffect});Module(function(Tone){Tone.StereoWidener=function(){var options=this.optionsObject(arguments,["width"],Tone.StereoWidener.defaults);Tone.MidSideEffect.call(this,options);this.width=new Tone.Signal(.5,Tone.Type.NormalRange);this._midMult=new Tone.Expr("$0 * ($1 * (1 - $2))");this._sideMult=new Tone.Expr("$0 * ($1 * $2)");this._two=new Tone.Signal(2);this._two.connect(this._midMult,0,1);this.width.connect(this._midMult,0,2);this._two.connect(this._sideMult,0,1);this.width.connect(this._sideMult,0,2);this.midSend.chain(this._midMult,this.midReturn);this.sideSend.chain(this._sideMult,this.sideReturn);this._readOnly(["width"])};Tone.extend(Tone.StereoWidener,Tone.MidSideEffect);Tone.StereoWidener.defaults={width:.5};Tone.StereoWidener.prototype.dispose=function(){Tone.MidSideEffect.prototype.dispose.call(this);this._writable(["width"]);this.width.dispose();this.width=null;this._midMult.dispose();this._midMult=null;this._sideMult.dispose();this._sideMult=null;this._two.dispose();this._two=null;return this};return Tone.StereoWidener});Module(function(Tone){Tone.Tremolo=function(){var options=this.optionsObject(arguments,["frequency","depth"],Tone.Tremolo.defaults);Tone.Effect.call(this,options);this._lfo=new Tone.LFO({frequency:options.frequency,amplitude:options.depth,min:1,max:0});this._amplitude=this.context.createGain();this.frequency=this._lfo.frequency;this.depth=this._lfo.amplitude;this._readOnly(["frequency","depth"]);this.connectEffect(this._amplitude);this._lfo.connect(this._amplitude.gain);this.type=options.type};Tone.extend(Tone.Tremolo,Tone.Effect);Tone.Tremolo.defaults={frequency:10,type:"sine",depth:.5};Tone.Tremolo.prototype.start=function(time){this._lfo.start(time);return this};Tone.Tremolo.prototype.stop=function(time){this._lfo.stop(time);return this};Tone.Tremolo.prototype.sync=function(delay){this._lfo.sync(delay);return this};Tone.Tremolo.prototype.unsync=function(){this._lfo.unsync();return this};Object.defineProperty(Tone.Tremolo.prototype,"type",{get:function(){return this._lfo.type},set:function(type){this._lfo.type=type}});Tone.Tremolo.prototype.dispose=function(){Tone.Effect.prototype.dispose.call(this);this._writable(["frequency","depth"]);this._lfo.dispose();this._lfo=null;this._amplitude.disconnect();this._amplitude=null;this.frequency=null;this.depth=null;return this};return Tone.Tremolo});Module(function(Tone){Tone.Clip=function(min,max){if(min>max){var tmp=min;min=max;max=tmp}this.min=this.input=new Tone.Min(max);this._readOnly("min");this.max=this.output=new Tone.Max(min);this._readOnly("max");this.min.connect(this.max)};Tone.extend(Tone.Clip,Tone.SignalBase);Tone.Clip.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable("min");this.min.dispose();this.min=null;this._writable("max");this.max.dispose();this.max=null;return this};return Tone.Clip});Module(function(Tone){Tone.Normalize=function(inputMin,inputMax){this._inputMin=this.defaultArg(inputMin,0);this._inputMax=this.defaultArg(inputMax,1);this._sub=this.input=new Tone.Add(0);this._div=this.output=new Tone.Multiply(1);this._sub.connect(this._div);this._setRange()};Tone.extend(Tone.Normalize,Tone.SignalBase);Object.defineProperty(Tone.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(min){this._inputMin=min;this._setRange()}});Object.defineProperty(Tone.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(max){this._inputMax=max;this._setRange()}});Tone.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin;this._div.value=1/(this._inputMax-this._inputMin)};Tone.Normalize.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._sub.dispose();this._sub=null;this._div.dispose();this._div=null;return this};return Tone.Normalize});Module(function(Tone){Tone.Route=function(outputCount){outputCount=this.defaultArg(outputCount,2);Tone.call(this,1,outputCount);this.gate=new Tone.Signal(0);this._readOnly("gate");for(var i=0;i<outputCount;i++){var routeGate=new RouteGate(i);this.output[i]=routeGate;this.gate.connect(routeGate.selecter);this.input.connect(routeGate)}};Tone.extend(Tone.Route,Tone.SignalBase);Tone.Route.prototype.select=function(which,time){which=Math.floor(which);this.gate.setValueAtTime(which,this.toSeconds(time));return this};Tone.Route.prototype.dispose=function(){this._writable("gate");this.gate.dispose();this.gate=null;for(var i=0;i<this.output.length;i++){this.output[i].dispose();this.output[i]=null}Tone.prototype.dispose.call(this);return this};var RouteGate=function(num){this.selecter=new Tone.Equal(num);this.gate=this.input=this.output=this.context.createGain();this.selecter.connect(this.gate.gain)};Tone.extend(RouteGate);RouteGate.prototype.dispose=function(){Tone.prototype.dispose.call(this);this.selecter.dispose();this.selecter=null;this.gate.disconnect();this.gate=null};return Tone.Route});Module(function(Tone){Tone.Switch=function(open){open=this.defaultArg(open,false);Tone.call(this);this.gate=new Tone.Signal(0);this._readOnly("gate");this._thresh=new Tone.GreaterThan(.5);this.input.connect(this.output);this.gate.chain(this._thresh,this.output.gain);if(open){this.open()}};Tone.extend(Tone.Switch,Tone.SignalBase);Tone.Switch.prototype.open=function(time){this.gate.setValueAtTime(1,this.toSeconds(time));return this};Tone.Switch.prototype.close=function(time){this.gate.setValueAtTime(0,this.toSeconds(time));return this};Tone.Switch.prototype.dispose=function(){Tone.prototype.dispose.call(this);this._writable("gate");this.gate.dispose();this.gate=null;this._thresh.dispose();this._thresh=null;return this};return Tone.Switch});Module(function(Tone){Tone.Microphone=function(inputNum){Tone.Source.call(this);this._mediaStream=null;this._stream=null;this._constraints={audio:true};var self=this;MediaStreamTrack.getSources(function(media_sources){if(inputNum<media_sources.length){self.constraints.audio={optional:[{sourceId:media_sources[inputNum].id}]}}})};Tone.extend(Tone.Microphone,Tone.Source);Tone.Microphone.prototype._start=function(){navigator.getUserMedia(this._constraints,this._onStream.bind(this),this._onStreamError.bind(this))};Tone.Microphone.prototype._stop=function(){this._stream.stop();return this};Tone.Microphone.prototype._onStream=function(stream){this._stream=stream;this._mediaStream=this.context.createMediaStreamSource(stream);this._mediaStream.connect(this.output)};Tone.Microphone.prototype._onStreamError=function(e){console.error(e)};Tone.Microphone.prototype.dispose=function(){Tone.Source.prototype.dispose.call(this);if(this._mediaStream){this._mediaStream.disconnect();this._mediaStream=null}this._stream=null;this._constraints=null;return this};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return Tone.Microphone});if(typeof define==="function"&&define.amd){define("Tone",[],function(){return Tone})}else if(typeof module==="object"){module.exports=Tone}else{root.Tone=Tone}})(this)},{}],109:[function(require,module,exports){(function(process){var TWEEN=TWEEN||function(){var _tweens=[];return{getAll:function(){return _tweens},removeAll:function(){_tweens=[]},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);if(i!==-1){_tweens.splice(i,1)}},update:function(time,preserve){if(_tweens.length===0){return false}var i=0;time=time!==undefined?time:TWEEN.now();while(i<_tweens.length){if(_tweens[i].update(time)||preserve){i++}else{_tweens.splice(i,1)}}return true}}}();if(typeof window==="undefined"&&typeof process!=="undefined"){TWEEN.now=function(){var time=process.hrtime();return time[0]*1e3+time[1]/1e6}}else if(typeof window!=="undefined"&&window.performance!==undefined&&window.performance.now!==undefined){TWEEN.now=window.performance.now.bind(window.performance)}else if(Date.now!==undefined){TWEEN.now=Date.now}else{TWEEN.now=function(){return(new Date).getTime()}}TWEEN.Tween=function(object){var _object=object;var _valuesStart={};var _valuesEnd={};var _valuesStartRepeat={};var _duration=1e3;var _repeat=0;var _repeatDelayTime;var _yoyo=false;var _isPlaying=false;var _reversed=false;var _delayTime=0;var _startTime=null;var _easingFunction=TWEEN.Easing.Linear.None;var _interpolationFunction=TWEEN.Interpolation.Linear;var _chainedTweens=[];var _onStartCallback=null;var _onStartCallbackFired=false;var _onUpdateCallback=null;var _onCompleteCallback=null;var _onStopCallback=null;this.to=function(properties,duration){_valuesEnd=properties;if(duration!==undefined){_duration=duration}return this};this.start=function(time){TWEEN.add(this);_isPlaying=true;_onStartCallbackFired=false;_startTime=time!==undefined?time:TWEEN.now();_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(_valuesEnd[property].length===0){continue}_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}if(_object[property]===undefined){continue}_valuesStart[property]=_object[property];if(_valuesStart[property]instanceof Array===false){_valuesStart[property]*=1}_valuesStartRepeat[property]=_valuesStart[property]||0}return this};this.stop=function(){if(!_isPlaying){return this}TWEEN.remove(this);_isPlaying=false;if(_onStopCallback!==null){_onStopCallback.call(_object,_object)}this.stopChainedTweens();return this};this.end=function(){this.update(_startTime+_duration);return this};this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++){_chainedTweens[i].stop()}};this.delay=function(amount){_delayTime=amount;return this};this.repeat=function(times){_repeat=times;return this};this.repeatDelay=function(amount){_repeatDelayTime=amount;return this};this.yoyo=function(yoyo){_yoyo=yoyo;return this};this.easing=function(easing){_easingFunction=easing;return this};this.interpolation=function(interpolation){_interpolationFunction=interpolation;return this};this.chain=function(){_chainedTweens=arguments;return this};this.onStart=function(callback){_onStartCallback=callback;return this};this.onUpdate=function(callback){_onUpdateCallback=callback;return this};this.onComplete=function(callback){_onCompleteCallback=callback;return this};this.onStop=function(callback){_onStopCallback=callback;return this};this.update=function(time){var property;var elapsed;var value;if(time<_startTime){return true}if(_onStartCallbackFired===false){if(_onStartCallback!==null){_onStartCallback.call(_object,_object)}_onStartCallbackFired=true}elapsed=(time-_startTime)/_duration;elapsed=elapsed>1?1:elapsed;value=_easingFunction(elapsed);for(property in _valuesEnd){if(_valuesStart[property]===undefined){continue}var start=_valuesStart[property]||0;var end=_valuesEnd[property];if(end instanceof Array){_object[property]=_interpolationFunction(end,value)}else{if(typeof end==="string"){if(end.charAt(0)==="+"||end.charAt(0)==="-"){end=start+parseFloat(end)}else{end=parseFloat(end)}}if(typeof end==="number"){_object[property]=start+(end-start)*value}}}if(_onUpdateCallback!==null){_onUpdateCallback.call(_object,value)}if(elapsed===1){if(_repeat>0){if(isFinite(_repeat)){_repeat--}for(property in _valuesStartRepeat){if(typeof _valuesEnd[property]==="string"){_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property])}if(_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property];_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}if(_yoyo){_reversed=!_reversed}if(_repeatDelayTime!==undefined){_startTime=time+_repeatDelayTime}else{_startTime=time+_delayTime}return true}else{if(_onCompleteCallback!==null){_onCompleteCallback.call(_object,_object)}for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++){_chainedTweens[i].start(_startTime+_duration)}return false}}return true}};TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1){return.5*k*k}return-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){if((k*=2)<1){return.5*k*k*k}return.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){if((k*=2)<1){return.5*k*k*k*k}return-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){if((k*=2)<1){return.5*k*k*k*k*k}return.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0){return 0}if(k===1){return 1}if((k*=2)<1){return.5*Math.pow(1024,k-1)}return.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){if((k*=2)<1){return-.5*(Math.sqrt(1-k*k)-1)}return.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){if(k===0){return 0}if(k===1){return 1}return-Math.pow(2,10*(k-1))*Math.sin((k-1.1)*5*Math.PI)},Out:function(k){if(k===0){return 0}if(k===1){return 1}return Math.pow(2,-10*k)*Math.sin((k-.1)*5*Math.PI)+1},InOut:function(k){if(k===0){return 0}if(k===1){return 1}k*=2;if(k<1){return-.5*Math.pow(2,10*(k-1))*Math.sin((k-1.1)*5*Math.PI)}return.5*Math.pow(2,-10*(k-1))*Math.sin((k-1.1)*5*Math.PI)+1}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1){return.5*(k*k*((s+1)*k-s))}return.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function(k){if(k<.5){return TWEEN.Easing.Bounce.In(k*2)*.5}return TWEEN.Easing.Bounce.Out(k*2-1)*.5+.5}}};TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);var fn=TWEEN.Interpolation.Utils.Linear;if(k<0){return fn(v[0],v[1],f)}if(k>1){return fn(v[m],v[m-1],m-f)}return fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var b=0;var n=v.length-1;var pw=Math.pow;var bn=TWEEN.Interpolation.Utils.Bernstein;for(var i=0;i<=n;i++){b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i)}return b},CatmullRom:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);var fn=TWEEN.Interpolation.Utils.CatmullRom;if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(k<0){return v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0])}if(k>1){return v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var s=1;if(a[n]){return a[n]}for(var i=n;i>1;i--){s*=i}a[n]=s;return s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5;var v1=(p3-p1)*.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}};(function(root){if(typeof define==="function"&&define.amd){define([],function(){return TWEEN})}else if(typeof module!=="undefined"&&typeof exports==="object"){module.exports=TWEEN}else if(root!==undefined){root.TWEEN=TWEEN}})(this)}).call(this,require("_process"))},{_process:113}],110:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output="";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol="";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function wtf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString="";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error("Invalid byte index")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error("Invalid byte index")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error("Invalid WTF-8 detected")}var byteArray;var byteCount;var byteIndex;function wtf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var wtf8={version:"1.0.0",encode:wtf8encode,decode:wtf8decode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return wtf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=wtf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in wtf8){hasOwnProperty.call(wtf8,key)&&(freeExports[key]=wtf8[key])}}}else{root.wtf8=wtf8}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],111:[function(require,module,exports){"use strict";var alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0,prev;function encode(num){var encoded="";do{encoded=alphabet[num%length]+encoded;num=Math.floor(num/length)}while(num>0);return encoded}function decode(str){var decoded=0;for(i=0;i<str.length;i++){decoded=decoded*length+map[str.charAt(i)]}return decoded}function yeast(){var now=encode(+new Date);if(now!==prev)return seed=0,prev=now;return now+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode;yeast.decode=decode;module.exports=yeast},{}],112:[function(require,module,exports){},{}],113:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}]},{},[6]);